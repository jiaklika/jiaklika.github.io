<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta name="keywords" content="通向财务自由之路">
<meta property="og:type" content="article">
<meta property="og:title" content="第7章 成功交易系统的六个关键">
<meta property="og:url" content="http://yoursite.com/2021/07/27/第7章-成功交易系统的六个关键/index.html">
<meta property="og:site_name" content="车斌的技术博客">
<meta property="og:description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2021-07-28T07:07:49.437Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第7章 成功交易系统的六个关键">
<meta name="twitter:description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">






  <link rel="canonical" href="http://yoursite.com/2021/07/27/第7章-成功交易系统的六个关键/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>第7章 成功交易系统的六个关键 | 车斌的技术博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">车斌的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">专注</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/27/第7章-成功交易系统的六个关键/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CheBin">
      <meta itemprop="description" content="放弃会成为一种习惯">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="车斌的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">第7章 成功交易系统的六个关键

              
            
          </h1>
        

        <div class="post-meta">

          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-07-27 11:23:18" itemprop="dateCreated datePublished" datetime="2021-07-27T11:23:18+08:00">2021-07-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-07-28 15:07:49" itemprop="dateModified" datetime="2021-07-28T15:07:49+08:00">2021-07-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/期货/" itemprop="url" rel="index"><span itemprop="name">期货</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">11k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">10 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>思考并回答以下问题：</p>
<ul>
<li>总结一下，这章作者最主要想表达什么观点？</li>
</ul>
<a id="more"></a>
<p>知者不言，言者不知。——老子</p>
<p>这一章是理解成功的交易商在交易系统方面的思维方式的关键，如果你想获得作为交易商或投资者的真正成功的话，本章的内容是至关重要的。因此，我决定在很多不同的场合通过不同的比喻来反复进行阐述，但是你必须一次就领会它，理解这些因素能够带给你令人难以置信的收益。</p>
<p>在我看来，为了开发一个成功的交易系统，有六个关键可变因素你必须理解。让我们一起来探究这六个可变因素以及它们如何影响你作为一位交易商或投资者的利润或亏损。</p>
<p>（1）可靠度或者百分之多少的时间你是赚钱的。比如，你的投资是否有60%是赚钱的，而有40%是赔钱的呢？</p>
<p>（2）在以可能的最低水平（就是说，一股股票或一手期货合约）进行交易时，相对于损失而言，你的利润水平的相对规模。例如，假如交易失败每股赔1美元，而交易成功每股赚1美元，那么你的利润水平的相对规模是一样的。然而，如果交易成功，每股赚到了10美元，而交易失败，每股只赔1美元，那么相对规模就非常不同。</p>
<p>（3）每笔交易或投资的成本。只要进行交易，对你的账户规模都是一种减损的力量。它是执行成本和佣金支出，这些成本会随着很多交易而越积越多。以前日交易负担不起这些高昂的成本，即使在佣金已经大幅度下降的今天，如果交易非常频繁，它仍然是你必须考虑的一个因素。</p>
<p>（4）获得交易机会的频率。现在假设以上三个可变因素保持不变，其综合效应就取决于你交易的频率。每天做100次交易和每年做100次交易的结果将大相径庭。</p>
<p>（5）头寸规模确定模型或者说一次交易多少个单位（比如一股股票相对于10000股段股票）。显然，你每股的盈利或亏损金额就要乘上交易的股票数量。</p>
<p>（6）交易——投资的资本规模。前面四个可变因素对账户的影响很大程度上取决于你的账户规模。例如，交易成本对一个1000美元账户的影响要远远大于对一个100万美元账户的影响。如果每笔交易的成本为20美元，那么1000美元的账户在每笔交易扣除2%的费用后才能获利，因此，为了抵消交易成本，你每笔交易的平均利润必须达到2%以上。然而，如果你的账户是100万美元，那么同样是20美元的成本对你的影响就微不足道了（0.002%）。类似地，500美元的损失对1 000美元的账户而言是致命的打击，但是对100万美元的账户就几乎没有影响（0.05%）。</p>
<p>你只是想关注这六个可变因素中的一个还是认为这六个可变因素都同等重要呢？在我以这样的方式问这个问题时，你可能会同意这六个可变因素都是重要的。</p>
<p>然而，如果你打算全力以赴地只关注其中一个可变因素，那么会是哪一个呢？也许你觉得，既然它们都重要，这个问题就有点幼稚。不管怎样，我问这个问题自有其原因，你把答案写下来吧。</p>
<p>我之所以要求你的注意力集中于一个可变因素的原因是，大多数交易商或投资者在他们日复一日的交易中经常只关注其中一个可变因素。他们往往集中注意力于第一个可变因素，即可靠度或者说是正确的渴望。人们被它所困扰而对其他因素都视而不见，然而，如果这六个要素对成功来说都是重要的，那么你可能就会开始认识到只把注意力放在追求正确上是多么的幼稚。</p>
<p>前四个可变因素是我称之为期望值这一主题的一部分，它们是本章的主要焦点。后两个可变因素是我称之为“多少”的因素或头寸规模确定的一部分。本章只是简单涉及一下头寸规模确定的问题，本书后面将对其进行详细讨论。</p>
<h1 id="打雪仗的比喻"><a href="#打雪仗的比喻" class="headerlink" title="打雪仗的比喻"></a><span style="color:#339AFF;">打雪仗的比喻</span></h1><p>为了解释以上所有六个可变因素的重要性，下面我通过一个比喻来引导你，这个比喻可能会为你提供一个不同于只考虑钱和系统的视角。想象一下你正躲在一面巨大的雪墙后面，有人正在向你的雪墙上扔雪球，而你的目标是保持墙面尽可能的大以便获得最大程度的保护。</p>
<p>因此，这个比喻马上告诉你，墙的大小是一个非常重要的可变因素。如果墙太小，你难免会被击中，而如果墙很大，你可能就不会被击中。可变因素6——初始资本的规模，就有点像雪墙的大小。实际上，你可以将初始资本视为一面保护你的财富之墙，假定其他因素保持不变，你拥有的钱越多，得到的保护也就越多。</p>
<p>现在想象向你扔雪球的人有两种不同的雪球—白雪球和黑雪球。白雪球有点类似盈利的交易，它们只会黏到雪墙上增加它的大小。现在设想一下一大堆白雪球向你扔过来的结果，它们只会增加雪墙的大小，雪墙会越变越大，而你会得到更多的保护。</p>
<p>假设黑雪球会使雪融化并在墙上弄出一个和它们大小相等的洞来，你可以把照雪球当做“融化雪”。因此，如果有一大堆黑雪球扔向你的雪墙，雪墙就会很快消失或者至少会有一大堆黑洞在上边。黑雪球很像亏损的交易-侵蚀你的安全防护墙，就如亏损的交易侵蚀你的资本一样。</p>
<p>可变因素1，即可靠度，就有点像关注白雪球的百分比。你自然想所有扔向你的墙的雪球都是白的，从而增加墙的大小。也许你很容易明白那些不关注大环境的人是如何全力以赴地把雪球尽可能多地做成白色的了。</p>
<p>但是考虑一下两种雪球的相对大小。黑白雪球相对于彼此有多大呢？比如，假设白雪球有高尔夫球一般大小，而黑雪球像直径1.83米的巨石。如果是这样的话，可能只需一个黑雪球就可以把你的雪墻完全摧毁—即使白雪球一整天都在向你扔过来。反过来，如果白雪球有直径1.83米的巨石那么大，那么每天一个白雪球就可能把墙增至足够大，来保护你免受高尔夫球大小的黑雪球的连续轰击。两种雪球的相对大小就等于模型中的可变因素2-利润与损失的相对大小。非常希望你通过想象打雪仗的比喻，能够理解可变因素2的重要性。</p>
<p>可变因素3-交易成本，就有点像每个雪球都对雪墙有轻微的破坏作用-不管它是白的还是黑的。每一个白雪球都对墙有轻微的破坏作用，希望破坏作用要比它对墙的加固作用小。类似地，每一个黑雪球扔到墙上也都会对它造成轻微的破坏，这只是加重了黑雪球对墙的正常的破坏效果。很明显，这种总的破坏力量会对打雪仗的结果有一个总体的影响</p>
<p>假定一次只有一个雪球扔向墙，在100个雪球扔到墙上以后，墙的状况就取决于扔到其上的黑白雪球的相对大小。在我们的模型中，你可以以墙的状况来度量雪仗的结果。如果墙在增大，就表明扔到墙上的白雪球的总量大于黑雪球的总量。在增大的墙就好比是在增加的利润，随着它的增大，你就会有更大的安全感。如果墙在缩小，就意味着相对更多的黑雪球而不是白雪球在扔向墙，最终，你的墙将失去其所有的保护，你也没法再玩下去了。</p>
<p>当你把前面三个可变因素放在一起考虑，就可以测算出扔到墙上的每一个雪球的平均效果。在100个雪球扔到墙上以后，你想得到扔到墙上的黑白雪球的总量，不仅要从白雪球的正面影响中减掉黑雪球造成的负面影响，还要减掉黑白雪球造成的总的破坏作用（可变因素3），一旦确定了100个雪球的总效果，用其除以100，你就会得到每个雪球的效果。如果这一结果是正的（白雪球相对更多），那么雪墙会增大。如果这一结果为负（黑雪球相对更多），那么雪墙将会缩小。每个雪球的相对效果就等同于我在交易里称之为期望值的雪球。</p>
<p>对一些喜欢用数学表达的人来说，下面就是一个这样的例子:假如有60个白雪球扔到墙上，雪墙就增加6.792立方米；假如有40个黑雪球扔到墙上，雪墙就缩小3.396立方米；<br>假如100个雪球总的破坏效果是0.283立方米， 100个雪球总的效果是（6.792-3.396-0.283）立方米的破坏效果。最终的效果为增加3.113立方米；<br>如果用100个雪球去除3.113立方米，那么最终的影响就是每一个雪球将雪墙增大0.031立方米</p>
<p>在投资或交易的真实世界里，期望值告诉你经过大量的一个单位的交易，你可以期望每一风险美元能获得的净的利润或损失。如果每一笔交易的最终结果为正，你就可以期望你的账户金额增加。如果最终的结果为负，你就会预测到你的账户将消失。</p>
<p>要注意的是，在期望值模型中，你可能会有99次交易亏损，每次亏损一美元，结果，你会减少99美元。然而，如果你有一次交易赚了500美元，那么你的净收入就是401美元（500美元减99美元）-尽管你只有一次交易是赚钱的，而99%的交易都是赔钱的。假设每次交易的成本是1美元或每100次交易的成本是100美元，你的净利润就是301美元，你的期望值（每次交易的平均影响）就是每冒1美元的风险用来交易，你的结果就增加3.01美元。你是否开始理解为什么期望值是由前三个可变因素共同组成的了？正如可以由每一个雪球的平均影响（雪球的期望效果）来预测对雪墙的影响一样，你可以通过每次交易的平均影响来预测交易对你的资本，一股股票或一手期货合约就可以是一个单位。<br>的影响（交易的期望值）。</p>
<p>现在把打雪仗的比喻深入一点。可变因素4从本质上讲就是雪球扔过来的频率。假如每个雪球的平均影响就是给雪墙增加0.031立方米的雪，如果每分钟扔一个雪球，扔了1个小时，那么总的效果就是给雪墙增加了1.868立方米的雪。如果每小时扔两个雪球，那么雪墙每小时将只会增加0.062立方米的雪。显然，第一种情形的影响是第二种的30倍。因此，雪球扔的速度对墙的大小有很大的影响。</p>
<p>交易的频率对资本的变化速度也会有类似的影响。如果在100次交易后，你的净收入是500美元，那么你做这100笔交易所花的时间将决定账户的增加速度。如果你用一年的时间做这100笔交易，那么你的账户每年将只增加500美元。如果每天做100次交易，那么你的账户将每月增加10 000美元（假定每月有20个交易日）或者说每年增加120 000美元。你想用哪种方法进行交易:每年获利500美元的方法还是每年获利120000美元的方法？答案是显然的，但是方法也可能是非常相似的（因为两种方法有一样的期望）。唯一的区别是交易的频率。</p>
<p>根据对打雪仗这个比喻的讨论，现在你认为前四个可变因素中哪几个最为重要？为什么？你的根据是什么？希望你现在能明白每一个可变因素的重要性。这些构成了期望值的基础，它们决定了你的交易系统的有效性。</p>
<p>可变因素5和因素6-头寸规模确定因素—在你的总体利润水平中是最为重要的因素。你应该已经理解了在打雪仗的游戏里，墙的大小（可变因素6）是多么的重要。如果墙太小，几个黑雪球就能把它摧毁。为了保护你，它必须足够大。</p>
<p>让我们来看可变因素5，它告诉你“多少”的概念。到目前为止，我们都假定一次只有一个雪球扔向墙，但是想象一下同时有很多雪球扔向墙的结果。设想一下一个高尔夫球大小的黑雪球扔到墙上的效果，它将在墙上砸出一个高尔夫球大小的洞。现在，想象一下10000个黑雪球同时扔到墙上的情形。它完全改变了你能想到的效果，不是吗？</p>
<p>10000个雪球的比喻简单地解释了头寸规模确定的重要性-系统告诉你“多少”的那部分。我们直到现在都在讨论一个单位的规模-一个雪球或一股股票。10 000个高尔夫球大小的黑雪球的攻击完全可以摧毁你的雪墻，除非它非常大。</p>
<p>类似地，你可能有一个交易方法，在其亏损时，每股股票只损失1美元。然而，如果你买进10000个单位，那么损失突然之间就会变得非常巨大，现在它就是10000美元!现在再来看看头寸规模确定的重要性。如果你的资本是100万美元，那么</p>
<p>10000美元的损失只相当于1%，但是如果你的资本是20000美元，那么10000美元的损失就是50%。</p>
<p>既然你对一个系统（或是打雪仗）的成功所包含的所有关键因素都有了认识，我们就可以详细讨论期望值了。要记住的是期望值是雪球的平均影响，类似地，期望值也就是每一笔交易每一风险美元对你的账户的平均影响。</p>
<h1 id="在放大镜下观察期望值"><a href="#在放大镜下观察期望值" class="headerlink" title="在放大镜下观察期望值"></a><span style="color:#339AFF;">在放大镜下观察期望值</span></h1><p>交易成功的真实秘密之一就是从回报一风险比率的角度进行思考。类似地，理解期望值的第一个关键就是从回报一风险比率的角度来考虑你的交易。问问自己这笔交易的风险是什么以及潜在的回报是否值得去冒潜在的风险。那么如何确定一笔交易潜在的风险呢？在进入每一笔交易之前，你应该事先确定为了保住资本而将退出市场的点，这一点就是你的交易所承担的风险或者说是你的预期损失。例如，如果你花40美元买了一只股票，而且决定在它降到30美元时就退出市场，那么你的风除就是10美元。</p>
<p>我喜欢把交易中的风险叫做R，这样比较容易记，因为R是风险（risk）的缩写。R可以代表你每一个单位的风险，在上面那个例子中就是每股10美元，它也可以代表你全部的风险，如果你买了100股股票，每股风险为10美元，那么你的全部风险就将是1000美元。</p>
<p>我要求你从同报一风险比率的角度进行思考。如果知道在某一个头寸上的全部初始风险是1000美元，那么你就可以把你所有的利润和损失表示为初始风险的比率。例如，如果你赚到了2 000美元的利润（或者说每股20美元），那么利润就是2R；如果实现了10000美元的利润，那么利润就是10R</p>
<p>对损失而言也是一样。如果你损失了500美元，那么损失就是0.5R；如果你的损失是2000美元，那么就是2R，但是你会说，如果全部风险是1000美元，怎么会有2R的损失呢？也许关于承担1000美元损失的想法，你没有说到做到，在你该退出市场时你没有退出，市场可能背离你而去，大于1R的损失总是在发生的。作为一个交易商（或投资者）的目标就是把损失控制在1R或更小。沃伦·巴菲特，他是很多人都知道的世界上最成功的投资者，他说，投资的第一法则就是不赔钱。然而和普遍的看法相反，巴菲特也赔过钱。因此，对巴菲特第一法则更好的解释可能是把你的损失控制在1R或更低。</p>
<p>在有了一系列表示为回报-风险比率的利润和损失后，你就真正拥有了我所说的R乘数分布。因此，任何交易系统都可以描述为R乘数分布。实际上，从R乘数分布的角度思考交易系统有助于你对系统的理解以及清楚你对系统将来的期望值。<br>那么这一切都和期望值有何关系呢？在由交易系统得出了R乘数分布之后，你需要得到这一分布的平均值。我把这一R<br>对巴菲特第一法则更好的解释可能是乘数的平均值称为系统的期望值。期望值把你的损失控制在1R或更低。</p>
<p>就是经过很多次交易，期望系统能够实现</p>
<p>为平均R值。换一种表达方式，期望值就是在大量的交易之后，你可以期望每一风险美元平均能够给你带来的收益。在打雪仗的游戏中，期望值就是每一个雪球的平均影响。在交易和投资世界里，期望值就是相对于初始风险或R而言，任何一笔交易的平均影响。</p>
<p>看一个例子。既然一个交易系统可以由R乘数分布表示，我喜欢用一袋玻璃球来模仿交易系统。假设我们有一袋玻璃球，其中有蓝色的玻璃球60个和黑色的40个。根据游戏规则，如果拿出的是一个蓝球，你就赢了冒着风险拿出的数量（赢了1R），如果拿出的是一个黑球，你就输掉了冒着风险拿出的数量（输了1R）。每次拿出一个球以后，都要再放回袋子。现在你很容易算出这个游戏的期望值，因为它表示的是一袋球的平均R乘数。赢的频率是60个1R，输的频率是40个1R，所有球的最终结果是赢了20R，因为有100个球（100次交易），一袋子的期望值就是20R除以100，即0.2R，经过很多次交易平均下来，我们能够期望每次交易的结果为0.2R有了期望值，就可以大概估计出一定次数的交易能够带来的结果。例如，假如每拿出一个球冒着2美元的风险，取了1000次球，每个球在取出后都放回袋子以保证每次交易的期望不变。因为你的平均收益是0.2R，经过1 000次交易你会期望得到200R，如果每次交易冒着2美元的风险（R=2美元），那么你将期望赚到400美元。现在你明白为什么把它称为期望值了吗？它告诉你，平均来看，可以对你的系统有何（每一风险美元）期望。</p>
<p>假如你每月做20次交易，月平均收益是4R，但是每月都会赚到4R吗？不会的，期望值只是以R表示的平均收益（或损失）。有大约一半的月份你会赚到较少的钱，而有一半的月份你将赚到较多的钱。实际上，我利用R乘数分布模仿了10000次每月20次的交易，就是说，我模仿了一个每月20次的交易，我用电脑从一个袋子里每次取出一个球（然后又放回袋子），共取了20次，看总的结果会是怎样的。我将这一过程重复了10 000遍以确定可以平均从该系统期望的结果，我发现该系统在大约12%的月份里会赔钱。</p>
<p>如果玻璃球袋子再复杂一些会怎样-就像市场和大多数运气游戏？假定你有很多不同的赢和输的概率。例如，假如你有一个袋子，里面装有不同颜色的球共计100个。根据表7-1给出的矩阵，我们赋予每种颜色一个不同的回报。</p>
<blockquote>
<p>表7-1 玻璃球的回报矩阵</p>
</blockquote>

<p>还是假定一个球被取出后又重新放回袋子，注意这个游戏赢的概率只有36%。你想玩吗？为什么想或者为什么不想玩？在回答这个问题之前，记住我们对投资成功的前四个关键要素的讨论。在这个基础上，问问自己这个游戏的期望值是多少？它比第一个游戏是好还是差？</p>
<p>为了找出游戏的期望值，需要确定平均的R乘数，可以先算出总的R乘数，然后再除以球数（平均数的定义）。所有取球成功的R乘数总和为+160K，而所有取球失败的R乘数的总和为-82R，这意味着整个袋子所有的R乘数的和是+78R，因为袋子里共有100个球，所以平均值就为0.78R，因此这个袋子的期望值要远远大于第一个袋子。在第一个游戏里，我们只能期望每次交易的结果为0.2R，而这个游戏每次交易给我们0.78R的期望。</p>
<p>通过这两个例子，你应该已经领会了很重要的一点，即大多数人寻找赢的概率很大的交易游戏。在第一个游戏里，虽然你有60%赢的机会，但是只有0.2R的期望值。在第二个游戏里，你只有36%赢的机会，但是你的期望值是0.78R，因此，就期望值而言，游戏2要比游戏1好4倍。</p>
<p>在这里需要提醒你:可变因素5和6对你的盈利是至关重要的。只有明智地根据资本规模调整头寸，你才可以在长期里实现期望值。头寸规模确定就是系统中告诉你在每一个头寸上可以冒多大风险的那部分，它是整体系统中至关重要的部分，我们将在本书后面进行深入讨论。</p>
<p>让我们通过一个例子来看头寸规模确定和期望值是如何相辅相成的。假如玩游戏1-有60%赢的概率的玻璃球游戏。你共有资本100美元，假如在开始玩游戏第-次取球时把100美元都押上，你输掉的概率为40% ，而碰巧就取出了一个黑球。这是有可能发生的，如果发生了，你就丢掉了全部的赔注。换句话说，相对于资本安全，你的头寸（赌注大小）太大了，你没法接着玩了，因为你没有更多的钱。所以，你无法通过长期玩游戏而实现0.2R的期望值。</p>
<p>让我们看看游戏1的另一种例子。假如你决定每取一次球，只押上50%的赌注，而不是100%，因此，你以50美元的赌注<br>记住，在给定的交易中头寸必须足够 开始。取出一个黑球，结果输了，现在赌小，才能实现系统的长期期望值。</p>
<p>注减少到了50美元。你下一次赌注是所剩赌注的50%，即25美元，结果，又输了。现在你只剩下25美元了，再下一次的赌注是12.5美元，结果又输了。现在就剩下12.5美元了。在一个只有60%获胜机会的系统下，连续三次输掉是有可能的（概率是1/10）e。你现在必须挣回87.5美元才能保本-这是700%的增幅。你根本不可能靠期望值仅仅为1R的交易挣同那么多钱。结果，因为不合适的头寸规模确定，你还是没能在长期的交易中实现你的期望值.以赔钱告终。</p>
<p>你可能会说你将通过退出市场来控制风险，而不是头寸规模确定，但你还记得打雪仗的比喻吗？风险的本质是可变因素2，即盈利与亏损的相对大小，这是通过退出市场加以控制的。头寸规模本质上是你在盈亏的相对大小之外利用的另一可变因素（可变因素5），它告诉你，相对于资本而言，你应该承担的全部风险是多少。</p>
<h1 id="机会与期望值"><a href="#机会与期望值" class="headerlink" title="机会与期望值"></a><span style="color:#339AFF;">机会与期望值</span></h1><p>在评估系统时，还有一个和期望值一样重要的可变因素，这一因素就是机会，即第四个可变因素。你玩游戏的频率如何？假如，游戏1或者游戏2你都可以玩，不过，游戏2只允许你每5分钟取出一个球，而游戏1允许你每分钟取出一个球，在这种情形下，你愿意玩哪一个？</p>
<p>让我们来看机会因素如何改变游戏的价值。假如可以玩一个小时的游戏，因为在游戏1中每分钟可以取出一个球，你的机会因素就是60，或者说有60次玩游戏的机会。而在游戏2中每5分钟才可以取出一个球，你的机会因素就是12，即有12次机会玩游戏。</p>
<p>记住你的期望值是经过大量的机会每一风险美元可以挣到的收益，因此，你玩游戏的次数越多，就越有可能实现游戏的期望值。</p>
<p>为了评价每一个游戏的相对优势，必须用你可以玩游戏的次数去乘以期望值。在对两个游戏玩一个小时的结果进行比较时，你会得到以下结果:</p>
<p>游戏1: 0.2R的期望值x60次机会=12R/小时</p>
<p>游戏2:0.78R的期望值×12次机会=9.36R/小时</p>
<p>因此，在任意施加了以上机会约束后，游戏1实际上要比游戏2还好。而在对市场交易进行评价时，也必须对系统可以向你展示的机会次数给予类似的考虑。例如，个期望值为0.5R （扣除交易成本之后），每周提供3次交易机会的系统要比每月提供一次交易机会期望值也为0.SR （同样也是在扣除交易成本之后）的交易系统优越得多。</p>
<h1 id="预测-致命的陷阱"><a href="#预测-致命的陷阱" class="headerlink" title="预测:致命的陷阱"></a><span style="color:#339AFF;">预测:致命的陷阱</span></h1><p>现在讨论一个大多数交易商和投资者都会遇到的一个陷阱-预测陷阱。想一想期望值的概念就会让我们更清楚地看到，为什么那么多人很多年来在预测市场将来的走向时频频受挫。实际上，第5章讨论的大多数交易理念都是基于对未来要发生什么进行“预测”的某种方法。比如，我们可能会认为:<br>趋势将会继续；<br>价格会移动到相反的波段里；基本因素推动价格变化；<br>价格是多个市场行为共同作用的结果；价格根据历史周期进行变动；<br>，世界的有序可循有助于预测价格和转折点。</p>
<p>所有这些概念都是将其预测方法建立在历史的基础上的-有时甚至认为历史会重演。然而，极其成功的预测甚至也会导致你输掉全部的资本。怎么会呢？你可以有一个准确率为90%的交易方法，但是你利用它进行交易仍然会赔掉所有的钱。<br>考虑以下系统，利用该系统交易成功的概率为90%，平均每次成功交易的收益为1R，失败交易平均损失为10R，你可能会说可以利用该系统成功地进行预测，因为在这个系统下90%是正确的，但是该系统的期望值是多少呢？期望值=0.9x1R-0. 1 x10R=-0.1R</p>
<p>期望值是负的，这就是一个你在90%的时间里交易成功但最终你却会赔掉所有的钱的交易系统。我们对于投资行为存在强烈的追求正确的心理偏好。对大多数人而言，这种偏好大大压倒了利用交易方法实现总体利润的渴望，或者说它妨碍了我们实现真正的潜在的利润。大多数人压倒一切地渴望控制市场，结果，市场却控制了他们。</p>
<p>到现在为止，你应该很清楚是成功的回报和机会的共同作用让你确定一个方法是否可行。这就是为什么期望值，即每一笔交易中的每一风险美元的总的影响是如此重要的原因。你同样还必须考虑可变因素4 （玩游戏的频率）来确定一个系统或方法的相对价值。</p>
<h1 id="交易的实际应用"><a href="#交易的实际应用" class="headerlink" title="交易的实际应用"></a><span style="color:#339AFF;">交易的实际应用</span></h1><p>到现在为止我们一直在讨论玻璃球。在每一袋里，我们知道玻璃球的数量以及每一个玻璃球被取出的概率和带来的回报，但在真实的市场交易里，这些都是未知数。</p>
<p>在市场上交易时你是不知道赢或输的准确概率的，另外，也不知道你会赢或输的确切金额，但你可以进行历史性的测试并从中获得有关期望值的一些启示（样本）。你还可以从实时交易和投资中得到大量的表示为R乘数的样本数据。虽然它不是系统将会产生的交易的准确次数，但是它确实给我们关于期望值的启示。</p>
<p>记住我一直用R乘数表示一笔交易的回报一风险比率-R就是回报一风险的缩写。为了计算交易的R乘数，只需用一笔交易的初始风险去除你所获得的总利润或损失。表7-2为你展示了这样一组数据的例子。</p>
<blockquote>
<p>表7-2 交易数据的R乘数初始风险（美元）</p>
</blockquote>

<p>你可能会注意到表7-2的一些特点。首先，每一只股票的初始风险几乎是相同的。这是通过确定头寸规模使得风险等于资本的1%。在此情况下， 50000美元账户的1%等于500美元的风险，但因为四含五入的原因这些账户在不同的交易之间略有不同。</p>
<p>最坏情形下的市场退出（以发出停价指令表示）对每一只股票的影响都有所不同，但是我们仍然假设每一只股票的初始风险都大致相同。这是因为，我们让每笔交易的总的风险都等于总资本50 000美元的1%，即500美元。换句话说就是，尽管停价指令是不同的，但是我们可以利用头寸规模确定使得初始风险基本相等。后面将详细讨论设定初始风险和头寸规模确定的重要性。</p>
<p>其次，真实的R乘数通常不像玻璃球游戏一样都是整数。在表7-2的例子中，四舍五入到小数点后两位数。因此，对一个真实的系统很难说30%的亏损将是1R的亏损；相反，这些亏损可能会是1.11R， 1.21R， 0.98R、 1.05R和0.79R等。这是非常可能的，因为在盈亏账户中你需要考虑交易成本。</p>
<p>最后，表7-2中的样本很小，只有6笔交易，结果可以有一个不错的期望值1.15R，但是你必须问自己一个问题:真的可以基于6笔交易就明白交易系统会怎样吗？不会的， 6笔交易是一个太小的样本，不会有什么意义。样本越大，就越有可能知道系统的实际表现将会如何。我认为，哪怕只是要对期望值有所了解，交易次数至少也要达到30次。当然，通过100次交易你也许可以更好地对系统在将来的表现进行预测。</p>
<p>让我们来看一个期望值直接应用到市场交易中的例子。假如你有一个使用了两年的交易系统，它一共产生了103次交易: 43次交易是赢的， 60次是输的。表7.3描述了交易的分布，它是你每次只进行一个单位交易的结果（最小的头寸规模）。</p>
<blockquote>
<p>表7-3 两年里一个样本系统所产生的交易 （单位:美元）</p>
</blockquote>

<p>你会注意到表中没有列出每笔交易的初始风险。如果你一直在进行交易但从未理解过R乘数的概念，这是有可能的。然而，即使你没有可以了解每笔交易的初始风险的数据，仍然可以通过把平均损失当做1R来对你的期望值和R乘数分布进行估计，这就是我们将利用表7-3的数据所要做的工作。</p>
<p>平均利润 净利润-10843 -105.27 （美元）103 = 103<br>期望值=平均利润/每笔交易-105.27美元=0.15K平均损失”721.73美元</p>
<p>这只是一个期望值的粗略估计，但是在不具有每笔交易的初始风险数据时，这是你必须做的。</p>
<p>现在，为了理解如何利用期望值来确定每一个系统的相对优势，让我们来看两个不同的交易系统。</p>
<p>1，弗雷德的系统</p>
<p>第一个系统来自一位名叫弗雷德（Fred）的期权交易商。5月1日-8月31日，他做了21笔交易，都列在了表7-4中。</p>
<blockquote>
<p>表7-4 弗雷德的期权交易总结</p>
</blockquote>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/通向财务自由之路/" rel="tag"># 通向财务自由之路</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/07/27/第6章-适应大环境的交易策略/" rel="next" title="第6章 适应大环境的交易策略">
                <i class="fa fa-chevron-left"></i> 第6章 适应大环境的交易策略
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/07/27/第8章-利用方案设法启动你的系统/" rel="prev" title="第8章 利用方案设法启动你的系统">
                第8章 利用方案设法启动你的系统 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="CheBin">
            
              <p class="site-author-name" itemprop="name">CheBin</p>
              <div class="site-description motion-element" itemprop="description">放弃会成为一种习惯</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">451</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">60</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          


          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/2021/09/30/13-网络编程-构建服务器与客户端/" title="13-网络编程-构建服务器与客户端" target="_blank">13-网络编程-构建服务器与客户端</a>
                  </li>
                
                  <li>
                    <a href="/2021/09/30/12-Go网络编程基础/" title="12-Go网络编程基础" target="_blank">12-Go网络编程基础</a>
                  </li>
                
                  <li>
                    <a href="/2021/09/30/11-代码测试，优化及分析/" title="11-代码测试，优化及分析" target="_blank">11-代码测试，优化及分析</a>
                  </li>
                
                  <li>
                    <a href="/2021/09/30/10-Go并发-进阶讨论/" title="10-Go并发-进阶讨论" target="_blank">10-Go并发-进阶讨论</a>
                  </li>
                
                  <li>
                    <a href="/2021/09/30/9-并发-Goroutine，Channel和Pipeline/" title="9-并发-Goroutine，Channel和Pipeline" target="_blank">9-并发-Goroutine，Channel和Pipeline</a>
                  </li>
                
              </ul>
            </div>
        

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#打雪仗的比喻"><span class="nav-number">1.</span> <span class="nav-text">打雪仗的比喻</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在放大镜下观察期望值"><span class="nav-number">2.</span> <span class="nav-text">在放大镜下观察期望值</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#机会与期望值"><span class="nav-number">3.</span> <span class="nav-text">机会与期望值</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#预测-致命的陷阱"><span class="nav-number">4.</span> <span class="nav-text">预测:致命的陷阱</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#交易的实际应用"><span class="nav-number">5.</span> <span class="nav-text">交易的实际应用</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CheBin</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">4.4m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">66:28</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
