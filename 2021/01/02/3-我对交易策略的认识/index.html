<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="思考并回答以下问题：">
<meta name="keywords" content="从亏损到盈利">
<meta property="og:type" content="article">
<meta property="og:title" content="3-我对交易策略的认识">
<meta property="og:url" content="http://yoursite.com/2021/01/02/3-我对交易策略的认识/index.html">
<meta property="og:site_name" content="车斌的技术博客">
<meta property="og:description" content="思考并回答以下问题：">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2021/01/02/3-我对交易策略的认识/1.jpeg">
<meta property="og:image" content="http://yoursite.com/2021/01/02/3-我对交易策略的认识/2.png">
<meta property="og:updated_time" content="2021-02-13T05:05:46.796Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3-我对交易策略的认识">
<meta name="twitter:description" content="思考并回答以下问题：">
<meta name="twitter:image" content="http://yoursite.com/2021/01/02/3-我对交易策略的认识/1.jpeg">






  <link rel="canonical" href="http://yoursite.com/2021/01/02/3-我对交易策略的认识/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>3-我对交易策略的认识 | 车斌的技术博客</title><meta name="robots" content="noindex">
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">车斌的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">放弃会成为一种习惯</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/02/3-我对交易策略的认识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CheBin">
      <meta itemprop="description" content="看视频才能学会，看文字学不会的">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="车斌的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">3-我对交易策略的认识

              
            
          </h1>
        

        <div class="post-meta">

          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-01-02 13:06:39" itemprop="dateCreated datePublished" datetime="2021-01-02T13:06:39+08:00">2021-01-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-02-13 13:05:46" itemprop="dateModified" datetime="2021-02-13T13:05:46+08:00">2021-02-13</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/期货/" itemprop="url" rel="index"><span itemprop="name">期货</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">9.1k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">8 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>思考并回答以下问题：</p>
<a id="more"></a>
<h1 id="交易策略的定义及分类"><a href="#交易策略的定义及分类" class="headerlink" title="交易策略的定义及分类"></a><span style="color:#339AFF;">交易策略的定义及分类</span></h1><p>所谓策略，也叫谋略，是指在动手做一件事之前，针对事情发展中各种可能出现的情况，事先规划好的主动应对方案。交易策略就是在交易之前，事先制定好的何时开仓、何时平仓、仓位控制的规则体系。<span style="color:red">开仓时机、平仓时机和仓位控制是交易策略的三大要素，缺一不可</span>，否则就危及交易策略的完整性而使之不成为交易策略了。这实际上是一种系统化交易的思想，不管是人工交易还是电脑自动交易，都必须遵循这种正确的思维方式。</p>
<p>现在在投资界有几个相关的术语，很容易混淆，今辨析如下。</p>
<p><strong>交易系统</strong>：这个概念本意是指能够发出具体的买入、卖出、开仓、平仓、手数等交易指令的一整套交易规则，真正的交易员和分析师对此都心照不宜。可是后来很多软件开发人员把给交易所和期货公司用的那套实现交易功能的大型软件也称为交易系统，还有些水平没到位的人把仅仅是技术指标的东西也叫做交易系统，所以现在这个词应用得颇为混乱。本书所提到的交易系统，和交易策略是相近的意思，但是交易策略的含义更广一些，比如同一个交易策略下可能有几个具体的、稍有不同的交易系统，也即交易策略更偏向于一般性、思想性一些。</p>
<p><strong>交易模型</strong>：和交易系统的原始意思相同，所以这个词更准确。</p>
<p><strong>技术指标</strong>：往往简称指标，是指能够绘出图形但不发出交易指令的某个数学公式，仅仅用于技术分析，和交易无直接关系。</p>
<p><strong>性能指标</strong>：是指用于评价交易系统性能是否良好、优缺点如何的评价指标。</p>
<p><strong>公式</strong>：泛指技术指标和交易模型。</p>
<p><strong>交易信号</strong>：在技术指标上标出来的提示买卖的信号，比如箭头、文字等，也是属于技术分析的范畴。</p>
<p><strong>交易指令</strong>：指电脑自动交易系统或人工交易所发出的委托单指令，属于交易范畴。</p>
<p>在我看来，交易策略可以分成纯客观、纯主观、粗线条客观细节处主观三大类。</p>
<p>纯客观的交易策略强调整个决策链中的每一步都要能够客观描述，具有完整性、客观性和惟一性。依据这类交易策略做成的交易系统往往体现为一组公式，然后编成电脑自动交易软件，这类交易系统适用于短、中、长线交易，并且方便进行历史数据测试及参数优化。然而，由于金融市场的混沌性，要想对趋势进行较精确的描述、建模是件极困难的事。而且并不是所有的纯客观交易策略都可以编成电脑自动交易程序，因为有些因素虽然客观但不容易量化，或不适合编成程序。</p>
<p>纯主观的交易策略，即在开仓时机、平仓时机和仓位控制方面完全是凭主观判断，是一种艺术型的投资风格。尽管每一步都是主观判断，可是成功的纯主观交易策略，其交易思想仍然类似于其他类型的成功的交易理念，其结果统计也符合通用的成功的交易策略的性能评价指标。高手凭直觉主观交易就能成功，是因为他对市场运行规律、对理念、心态、策略、技术的整体把握已经非常到位；而新手如果也企图凭直觉交易，则会陷入主观随意的情绪性交易而亏得一塌糊涂，这是因为他的天性并未扭转过来，他内心深处的“慢性病”并未治愈，所以他的直觉更多地只是错觉。这类交易系统也适于短、中、长线交易。纯主观的交易策略能否进行历史数据的测试？过去一直认为是不能的。然而，我发现有一个办法可以测试。在我开发的投资培训游戏中，当数据库中的训练样本足够大时，受训者的记忆效应将被完全抹除，这样，给定他一组历史数据，他就可以根据纯主观的交易策略，决定是买、卖还是观望，做出决策后再按一下空格键，又出来一个新的历史数据，这样一直测试下去，最后对交易结果进行统计评价（相对于传统的纯粹机器测试法，我把这种测试方法称为“人工测试法”）。</p>
<p>粗线条客观细节处主观的交易策略，是我最欣赏的一类交易策略，我目前也在使用，并认为它综合了纯客观和纯主观交易策略的优点。顾名思义，先找一个在粗线条上，比如在周线、双周线、月线上测试性能良好的纯客观交易策略，这样就把自己的交易策略建立在一个可靠的坚实的客观基础之上，然后，在充分理解这个交易策略的背后思想之后，再兼顾金融市场的混沌性和电脑程序的笨拙性，在细节地方充分发挥人的灵活性，这样就把机器的客观性和人的主观能动性充分结合起来了。我所使用的具体的交易系统一般都经过粗线条的客观测试和细节处的主观修正这两个步骤。显然这类策略只适用于中、长线交易，并且对交易员的整体的理念、心态的修炼要求比较高，否则在细节处的主观发挥就会变味。这类交易策略除了在粗线条上使用纯粹机器测试外，也可对最终策略使用人工测试法。</p>
<h1 id="交易策略之关键要素及交易系统性能评价指标"><a href="#交易策略之关键要素及交易系统性能评价指标" class="headerlink" title="交易策略之关键要素及交易系统性能评价指标"></a><span style="color:#339AFF;">交易策略之关键要素及交易系统性能评价指标</span></h1><p>从实际操作的过程来说，任何交易策略必须包含开仓时机、平仓时机和仓位控制三大要素，缺了任意一个都不能称之为交易策略或交易系统。若再细分起来，则有开仓、持仓、止损、加仓、减仓、止盈、重新开仓、资金管理公式等等。经常听到某某人说他新发现了个什么秘诀，仔细一听却只是一个关于开仓时机的方法，对于平仓时机及仓位控制没任何描述，不禁哑然失笑。</p>
<p>从性能评价的角度来说，成功的交易策略（交易系统）包括六个方面的关键要素：可靠性（胜率）、利润和亏损的相对大小（风险回报率）、交易成本（佣金）、交易频率、账户规模、头寸调整模型。很多人往往只重视这六个因素中的某一个而忽视其他因素，因而导致投资理念上有重大缺陷。</p>
<p>下面结合其他指标来解释为什么这六个要素很关键。</p>
<p>图3-1是我开发的交易系统中所使用的性能评价指标，分别介绍如下：</p>
<blockquote>
<p>图3-1 我开发的交易系统中的性能评价指标</p>
</blockquote>
<img src="/2021/01/02/3-我对交易策略的认识/1.jpeg">
<p>N = 测试的交易日天数/240（即一年按240个交易日计算）</p>
<p>年复利率为考虑所有因素后得到一个净结果的最终评价指标。如果有某种策略使得每个月的年复利率为正，不管具体数值多大或多小，则几年下来会滚动成一个惊人的数字。所以每个月的年复利率为正就成了投资的终极目标。</p>
<center>算术期望（期望收益）=（期末净资产-期初净资产）/总交易次数=净利润/
总交易次数=平均单次盈利额×盈利几率（胜率）-平均单次亏损额×亏损几率-平均单次佣金</center>

<p><br>显然算术期望为正是一个交易系统有实际价值的首要条件，并且越大越好。从实际交易经验来看，对短线交易，平均单次盈利额和平均单次亏损额相差不太远，故要求胜率大于50%，且越大越好；但对长线交易而言，只要做到“迅速止损，放足盈利”，则平均单次盈利额和平均单次亏损额非常悬殊，故对胜率没有太高要求，一般达到30%~40%就可以接受。平均单次佣金对短线和长线都差不多，但长线交易次数少，故总的佣金很少，而短线若过度交易，则佣金会非常庞大。然而，短线的优势是交易机会频率高，一旦找到正算术期望的交易系统，则会导致年复利率非常之高。我就见过一个短线高手在10个月之内将账户上的资金翻了30倍，其中只有2个月是亏损的，这样的资金增值速度对长线来说是很困难的（不过做短线赚钱的人极其罕见，读者不可盲目模仿）。</p>
<p>此处附带讲讲短线和长线在交易原则上的一个重大区别：长线行情的持续性和稀缺性都很强，这就决定了长线交易必须追涨杀跌；而短线行情并不稀缺，但持续性很差，所以短线必须高抛低吸，而且短线交易在趋势不明显的时候做才更合适。另外，若考虑的时间尺度越大，则技术分析的效果越好，故而对中长线交易不需太重视基本面；但若时间尺度越小，则随机性的干扰越明显，故而对短线交易一定要高度重视基本面的作用，单靠纯粹的技术分析往往效果不佳，最明显的例子是外汇短线交易。我的这个观点刚好和市面上流行的观点相反。由于二者的理念刚好倒过来，所以能同时做好长线和短线的人是非常罕见的。新手往往既喜欢做短线，又喜欢追涨杀跌，焉有不败之理。我过去刚开始做股票和期货的时候，就犯了好几年这样的错误。</p>
<p>几何期望 = 期末净资产/期初净资产，M=总交易次数</p>
<p>显然：几何期望反映的是平均每次交易净资产的增值的倍数，而算术期望反映的是平均每次交易净资产的增值的绝对数额。</p>
<p>由于几何期望是资产的倍数增值因子，而算术期望只是加减增值额，故几何期望比算术期望更加重要。二者有如下关系（设A为算术期望，G为几何期望，R为单次收益率，S为（R<sub>i</sub>+1）的标准差，G为期初净资产）：</p>
<p>这个关系表明，若每次收益太分散，则标准差S会变大，从而会抵消算术平均值的好处。我在本书第一章中指出，一个好的交易系统不但要有高的算术期望，还要求资产增值曲线平稳增长，实际上就是这里的S要小，这样G才大。图3-2画出了G与平均单次收益率Ri的关系。</p>
<blockquote>
<p>图3-2 G与平均单次收益率Ri的关系。</p>
</blockquote>
<img src="/2021/01/02/3-我对交易策略的认识/2.png">
<center>利润系数 = 所有盈利之和/所有亏损之和</center>

<p>由于利润系数这个评价指标不太好用，于是引入悲观利润率这个新指标：</p>
<p>悲观利润率是赋予亏损交易更多的权重，总交易次数越多，悲观利润率越接近利润系数。</p>
<p>悲观利润率在评价和比较不同的交易系统方面是个很好的指标。若一个交易系统的悲观利润率大于2.0，则表明此系统的性能很好，若大于2.5，则为优秀。</p>
<center>单位风险收益=算术期望/最小单笔亏损</center>

<p>撒普博士提出了“一元风险的期望收益”（R乘数），即期望收益除以初始止损额度，这个概念用于衡量风险收益比非常好，也很方便使用，但就是难以让电脑全自动计算，于是我把初始止损额度改为最小单笔亏损，杜撰了“单位风险收益”这个指标，这样一来电脑是会自动计算了，但结果常常比真正的收益风险比偏大，因为有些亏损小于初始止损额度。所以这个指标没有字面意思上那么重要。</p>
<center>月交易频率 = 总交易次数 × 20 / 总测试天数</center>

<p>月交易频率就是平均每月交易多少次。</p>
<center>胜率 = 盈利交易次数 / 总交易次数</center>

<p>胜率只有对短线交易才重要。</p>
<center>报酬率 = （期末净资产-期初净资产） / 期初净资产 × 100%</center>

<p>期初金额即期初账户净资产，期末金额即期末账户净资产。资产最高点、最低点，即账户在测试期间的最高、最低净资产，获利金额即所有盈利之和，亏损总额即所有亏损之和，净利总额即获利总额减去亏损总额，期初金额加上净利总额减去佣金即得期末余额。平均获利金额即获利总额除以获利笔数，平均亏损金额即亏损总额除以亏损笔数，平均每笔盈亏即净利总额减去佣金后除以交易笔数。其他指标的含义和字面意思相同。</p>
<p>交易笔数即总交易次数，一般要大于20次，其统计结果才有可信度，图3-1中的这个例子交易笔数太少了。</p>
<p>对于佣金，咋一看好像对交易结果的影响并不大，但事实上如果频繁交易，到月底一看账单会吓你一大跳！很多人做短线交易所得的盈利还不够交佣金，所以说佣金是个无形杀手。</p>
<p>单笔最高亏损和最大连续亏损次数，这两个指标对于资金管理（头寸调整）具有重要意义。</p>
<p>现在我们回头理解撒普博士所说的六个关键因素。从算术期望的数学公式可以看出，一组匹配恰当的胜率、利润亏损比及佣金，就会产生一个正的算术期望，这个正的算术期望是整个交易系统的基础。可是这个正算术期望只是一个统计结果，我们还要考虑它的构成，于是就发现每次收益越均匀越好，即几何期望越大越好。有了这个正的算术期望（最好还要有高的几何期望），则交易频率越高越好，它决定收益出现的时间密集度。而头寸调整模型，即资金管理模式，决定了收益出现的空间密集度。当单笔最高亏损和最大连续亏损次数越小，也即每次收益越均匀，几何期望越大，资产增长曲线越平稳，凹坑越小，则开平仓规则和资金管理模式越容易匹配良好，资金管理模式就越灵活，仓位加重后出现大亏的可能性越小。而合适的交易资本的规模，即账户资金的大小，则是前面这一切的前提条件。当资金量太小时，只能生硬地交易1手、2手，资金管理模式无从谈起，还往往导致一次止损就已经是损失过大了，比如5万元的资金账户去交易铜，或20万元的资金去交易HS300股指期货，那么一次止损的损失很可能已经远超5%了，故而很不恰当。</p>
<h1 id="资金管理模式"><a href="#资金管理模式" class="headerlink" title="资金管理模式"></a><span style="color:#339AFF;">资金管理模式</span></h1><p>资金管理模式，我指的是仓位控制，或叫头寸管理，即什么时候开多大的仓位。一般人所说的止损幅度多大，或者该持有几个不相关的品种，我认为这些是属于风险控制或投资组合（分散化）的问题，并不属于资金管理模式的问题。资金管理模式专注于该开多少仓位的问题，有些做法是依据某个数学公式，另一些做法则不能写成简单的公式，故统称模式。如上节所述，资金管理模式决定收益出现的空间密集度，因此是一个事关交易成败并且能否把期货事业做大的决定性问题。</p>
<p>很多做股票出身的人往往喜欢简单地使用满仓、半仓、三分之一仓的做法，我认为这是不妥的，对于期货交易而言，无论是做长线还是短线，这样都是一次性开了太重的仓位了。</p>
<p>如果是做长线，因为持仓时间长，可以从容地试探，加码，再加码，具体多少仓位可以有一定的随意性，只要能满足轻仓的原则就可以了。但是，如果做短线，因为交易次数很多，资金滚动的复利效应很突出，仓位管理上的微小差别对将来都有显著性影响，因此最好严格使用经过充分论证的某个数学公式。</p>
<p>不论具体采用何种方法，我认为成功的资金管理模式都必须遵循两个原则，一是控制单次亏损额，一般以不超过总资产的5%为宜；二是要乘胜追击，而不是屡败屡战，即在盈利时增加仓位，而在亏损时减少仓位。当然乘胜追击时所增加的仓位也是逐步增加，而不能一次加太多。至于每次亏损则增加仓位这一“等价鞅”策略会带来两个致命的问题，首先，每个人的资金都是有限的，这个过程无法永远持续下去，其次，会产生报复性交易心理，不但仓位加重，进出也变得更频繁、更草率，甚至情绪失控，结果把一笔小亏损演变成一场灾难。赔钱时，最好的办法是赶紧止损离场，出去打打球或者回家睡一觉，下次再从小仓位重新开始。赔钱后的首要任务不是急着扳平，而是重建交易信心。</p>
<p>资金管理模式有没有一套经过严密论证的系统化的科学理论？很遗憾，在我所了解的范围内，没见过这样的理论。所以下面只能介绍一些我所知的经验性的做法。</p>
<p>模式1：每固定金额开仓1手合约。</p>
<p>例如，每5000元可用资金则买入1手白糖合约，或1手大豆，如果有10万元则买入20手白糖或20手大豆。这种模式的优点是简单明了，缺点也很严重，它把不同品种的风险同等对待，实际上1手白糖和1手大豆的风险并不相同，而每5000元买1手PTA的风险可能太大了，风险暴露过度。归根到底，此法对交易风险无明确的概念，因此我不建议大家使用此方法。</p>
<p>模式2：每固定金额交易一个品种。</p>
<p>比如一个账户有20万元，分成2份，每份10万元，事先定好杠杆比都为5倍，则每份交易额有50万元，分别交易沪铜和棉花，假定1手沪铜的价值为25万元（即5万元/吨），则可买2手沪铜，假定1手棉花的价值为7.5万元（即1.5万元/吨），则可买6手棉花。这种方法的优点是对持仓中的每个品种赋予相同的权重，杠杆比也很清晰，缺点是对每笔交易所承担的风险大小仍然没有一个事先明晰的概念。</p>
<p>模式3：每固定风险百分比交易一个不相关品种。比如一个账户有10万元，事先确定单笔风险为5%，即若止损的话损失的钱不能超过100000x5%=5000元，现在大豆报价每吨3000元，若买进的话事先确定止损点为2900元，即：亏100元就斩仓出来，那么应该开仓5000/100/10=5（手）；同时再做与大豆不相关的沪铝，假定报价为20 000元/吨，若做多的话事先确定止损点为19900，即止损幅度为100元，那么应开仓5000/100/5= 10（手）（显然大豆的止损宽松些，而沪铝的止损很紧）。这就是说，不管交易什么品种，最多只能亏5%。按照这种做法，你还可以再拿5000元风险额度去交易白糖，最终会导致满仓，甚至保证金不够用。这样做听起来好像很危险，其实只要你同时交易的是不相关的品种，而且给予宽松一些的止损幅度，则风险是完全可控的，并不容易招致经纪公司强行平仓，资金利用率也很高。只要你严格止损，那么风险是事先预知的、可控的。我个人很欣赏这种风险完全清晰的做法。</p>
<p>模式4：每固定波动性百分比交易一个不相关品种。</p>
<p>波动性是指期货品种的日常真实价格波动幅度。真实价格幅度是指以下三者的绝对值的最大值：①当天的最高点减去最低点，②当天的最高点减去前一天的收盘价， ③当天的最低点减去前一天的收盘价。这个模式的要点在于把每一头寸的波动值限制在总资本的一个固定百分比。比如一个账户有10万元资本，假定只允许资本的最大波动性为2%，则100000 ×2%= 2000元，再假定白糖的日常平均波动幅度为30元，则可开仓手数为2000/30/10=6手。如果账户还有剩余可用资金，可以交易不相关的其他品种。此模式同样存在满仓甚至保证金不足的问题。经过编程实际测试，这个模式的效果也很好，但比模式3更加激进。缺点是必须另外指定止损点，波动性大小并不是实际的止损风险。</p>
<p>模式5：凯利公式。</p>
<p>凯利公式原来是信息论中的一条公式，后来被引入到赌博论中，再后来被拉瑞·威廉姆斯应用于一次期货实盘大赛中，结果他在一年内将1万美元最高做到210万美元，之后又跌到70万美元，年底比赛结束时回升到110万美元，轰动全美。</p>
<p>设P为胜率， R为风险收益率，即R= （各次盈利之和/盈利次数） / （各次亏损之和/亏损次数）， F为账户资金的可用百分比，则：F=（（R+1）P-1）/R</p>
<p>例如一个账户有10万元，所使用的交易系统胜率P-0.65， R=3，则F=0.53，可开仓之资金为100 000×x0.53=53000元，假定大豆每吨2500元，则可开仓手数为53 000/ （2500 × 10×0.08 （保证金比例））=26手。</p>
<p>凯利公式为什么导致大起大落？后来拉夫·威斯在研究后指出”，这个公式本身要求每次盈利和亏损的大小是分别固定的，而期货交易显然不满足此条件。</p>
<p>模式6：琼斯的固定比例交易。</p>
<p>关于琼斯的固定比例交易，由于翻译进来的两本书都没有讲清楚，而我又没有英文版，因此对这个模式我也没彻底理解。大意是说，每当盈利达到账户资产的某个固定百分比，开仓时才能增加一份新合约。比如10万元的账户，假定按照现在的策略和价格可以买卖10手大豆，那么可以规定只有盈利达到账户的10%，即盈利1万元，开仓时才能增加到11手合约。</p>
<p>模式7：拉里·威廉姆斯公式。</p>
<p>拉里认为造成资产大起大落的真正原因不是胜率，而是来自亏损最大的那笔交易，并且强调此观念十分重要，因此必须把最大亏损纳入资金管理模式中。他提出的公式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">开仓手数=账户余额×风险百分比/历史单手最大亏损</span><br></pre></td></tr></table></figure></p>
<p>风险百分比是人为定出的，拉里建议一般不要超过15%，历史单手最大损失就是每次只开仓1手对历史数据进行测试时的最大亏损额。例如一个账户有10万元，风险百分比定为15%，所使用的交易系统的历史测试单手最大亏损为6000元，则开仓手数=100 000 15% /6000~2。拉里认为这条公式是通向财富王国的金钥匙，他已经用此赚了数百万美元。我的编程实践表明，此公式确实比较稳健。</p>
<p>模式8：拉夫·威斯的最优风险百分比公式。</p>
<p>在拉里·威廉姆斯公式中，风险百分比是根据经验人为地决定的，可是拉夫·威斯的研究表明，可以用一种方法找到客观的最优风险百分比。</p>
<p>设风险百分比为，PLi为第1次交易的盈亏额（带正负号），BL为历史最大单手亏损（为负），M为总交易次数， G为几何期望，则：<br>用电脑对f从0到1进行扫描，找出对应最大G的即为最优风险百分比。</p>
<p>开仓手数=账户余额×最优风险百分比/历史单手最大亏损</p>
<p>拉夫通过实例表明，对任何交易系统都存在一个客观的最优风险百分比fop，当交易次数很多时，f对fop的微小偏差都会引起最终收益的巨大变化。当实际应用的广小于fop，则未发挥系统的最大潜力，当实际/大于fop，则在暴露更大风险的同时实际收益反而下降，若实际/超出fop一定限度，即使是具有正算术期望的系统也会稳定地亏钱（读者用电脑对f从0到1扫描也能得出此结论，几何期望小于1即为亏损）。所以，对任何交易系统都不是仓位越重越好!一个具有微弱正算术期望的交易系统，若工作在fop，都会产生良好的收益，反之，一个具有巨大正算术期望的系统，若工作在糟糕的5，同样会产生糟糕的结果，所以fop是一个极端重要的概念。若已经有了一个具有正算术期望的交易系统，不去进一步寻找它的fop，而再花时间去寻找其他“更好的方法”，是一种常见的不正确的行为。</p>
<p>拉夫有一个研究结论很值得一提，至少对电脑自动交易系统而言，如果你想在某一时间段内获得最多的资产增值，或者想用最短的时间达到某个资产增值目标，那么在过程当中的资产大幅返折是不可避免的。所以，一般人通常的做法，比如开一个100万的账户，却只允许最多亏损10万，这是不正确的。正确的做法是，开一个不要太大的而且你能容忍85%~90%返折的账户，即哪怕有时几乎输光了你也能坦然接受，然后放开手脚严格按照数学去执行，而一旦达到目标资产，则严格按计划止赢，提出应提部分，不要保留。据说拉里·威廉姆斯也是每年年初都从小账户重新开始。这种做法有一定合理性，特别是账户一定要止赢，但是这种做法只适于电脑自动交易，若需要主观临时判断，则会造成对亏钱毫不心疼，对心态影响极坏。</p>
<p><strong>模式9：试探一加码法。</strong></p>
<p>对于长线交易如何加仓？何时加减仓？加减多少仓位？有无仓位的计算公式？这些问题在公开的文献中很少有人探讨，偶有提到也只是笼统地说迅速止损，放足盈利，或说用倒金字塔加码，所以加仓的问题仍然是个未解的难题。就我本人的做法来说，我认为倒金字塔是不合理的，它把最大的一笔风险放在第一次交易上，根本未知水深水浅就投进最大一笔资金。合理的仓位管理应该是菱形的，先投少量资金试探，发现看对了行情时，才逐步加仓，判断主行情来了才投入大部队作战，随着主升（跌）浪的过去，加码的资金越来越少，甚至停止加码，每次没有浮动利润不允许加码，浮动利润没超出品种日常波动幅度也不允许加码。实战中我会逐步加至满仓，但在仓位过半后，若加仓后三天内行情不再往前走，则会砍掉新加的仓位，但在每次加仓的具体数目上，我仍有一定的主观随意性。如果每次加仓都严格按照上面的模式1至模式8来计算，则会如何？我认为这个做法很好，只要每次加仓都事先明确风险，并且严格止损，那就没问题。</p>
<p>图3-3是我前几年编程开发的一个交易系统加资金管理模式的历史数据测试结果，图中所示的是一种比较稳健的资金管理模式。当然对历史数据测试的一个突出问题是，当账户资金变大了也无法考虑市场容量问题。</p>
<p>坦率地讲，对于资金管理模式的诸多问题，比如长线的加仓问题，短线的不同性能的交易系统与不同的资金管理模式的匹配问题，等等，我都有模糊的地方，当然这些也是整个业界所面对的共同的难题。为安全起见，目前我只使用较保守的试探一加码模式。</p>
<!-- flag of hidden posts -->
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/从亏损到盈利/" rel="tag"># 从亏损到盈利</a>
          
        </div>
      

      
      
      

      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="CheBin">
            
              <p class="site-author-name" itemprop="name">CheBin</p>
              <div class="site-description motion-element" itemprop="description">看视频才能学会，看文字学不会的</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">1140</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">79</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          


          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/2023/07/19/zero-admin-3/" title="zero-admin-3" target="_blank">zero-admin-3</a>
                  </li>
                
                  <li>
                    <a href="/2023/07/19/zero-admin-2/" title="zero-admin-2" target="_blank">zero-admin-2</a>
                  </li>
                
                  <li>
                    <a href="/2023/07/19/zero-admin-1/" title="zero-admin-1" target="_blank">zero-admin-1</a>
                  </li>
                
                  <li>
                    <a href="/2023/07/19/Day7-服务发现与注册中心/" title="Day7 服务发现与注册中心" target="_blank">Day7 服务发现与注册中心</a>
                  </li>
                
                  <li>
                    <a href="/2023/07/19/Day6-负载均衡/" title="Day6 负载均衡" target="_blank">Day6 负载均衡</a>
                  </li>
                
              </ul>
            </div>
        

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#交易策略的定义及分类"><span class="nav-number">1.</span> <span class="nav-text">交易策略的定义及分类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#交易策略之关键要素及交易系统性能评价指标"><span class="nav-number">2.</span> <span class="nav-text">交易策略之关键要素及交易系统性能评价指标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#资金管理模式"><span class="nav-number">3.</span> <span class="nav-text">资金管理模式</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CheBin</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">8.9m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">135:21</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });
  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling }
        if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next) }
      }
    });
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
    }
  });
</script>
<script src="//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
