<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta name="keywords" content="海龟交易法则">
<meta property="og:type" content="article">
<meta property="og:title" content="附 原版海龟交易法则">
<meta property="og:url" content="http://yoursite.com/2021/06/22/附-原版海龟交易法则/index.html">
<meta property="og:site_name" content="车斌的技术博客">
<meta property="og:description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2021-06-22T08:55:01.422Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="附 原版海龟交易法则">
<meta name="twitter:description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">






  <link rel="canonical" href="http://yoursite.com/2021/06/22/附-原版海龟交易法则/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>附 原版海龟交易法则 | 车斌的技术博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">车斌的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">专注</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/06/22/附-原版海龟交易法则/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CheBin">
      <meta itemprop="description" content="放弃会成为一种习惯">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="车斌的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">附 原版海龟交易法则

              
            
          </h1>
        

        <div class="post-meta">

          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-06-22 15:14:46 / 修改时间：16:55:01" itemprop="dateCreated datePublished" datetime="2021-06-22T15:14:46+08:00">2021-06-22</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/期货/" itemprop="url" rel="index"><span itemprop="name">期货</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">12k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">11 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>思考并回答以下问题：</p>
<ul>
<li>总结一下，这章作者最主要想表达什么观点？</li>
</ul>
<a id="more"></a>
<p>我说过很多次，你可以把我的交易法则登在报纸上，但没人会遵守它们。关键是统一性和纪律性。几乎每一个人都可以列出一串法则，而且不比我们的那些法则差多少。但他们不能给别人信心，而唯有对法则充满信心，你才会坚持这些法则，即使遭遇逆境。一理查德·丹尼斯，见杰克·D.施瓦格的 《金融怪杰》 </p>
<p>完整的交易系统<br>大多数成功的交易者都使用机械性的交易系统。这并非偶然。一个好的机械性交易系统可以自动完成整个交易过程，代替交易者作出每一个必要的决策。有了它，交易者更容易保持策略的统一性，因为系统的一整套法则已经明确而又严格地限定了每一个操作细节。交易技巧与交易者的主观判断毫无关系。<br>如果你知道你的系统能在长期内赚钱，你就更容易在不利时期坚持遵守交易信号，根据系统的命令采取行动。如果你依赖的是你自己的判断，那么你也许会发现，你往往在应该大胆的时候畏手畏脚，在应该谨慎的时候却莽撞激进。<br>如果你有一个有效的交易系统，而且能坚定不移地遵守它，你的行动就会更具统一性，尽管连续的损失或巨大的赢利也会激起内心的思想斗争。一个千锤百炼的机械性交易系统能赋予你信心、统一性和纪律性，这就是许多顶尖交易者的成功要诀。<br>海龟交易系统是一个完整的交易系统。它的法则囊括了交易中的每一个环节，没给交易者留下任何主观思考的余地。它有一个完整的交易系统所应该有的所有成分，涵盖了成功交易中的每一个必要决策:<br>·市场:买卖什么?<br>·头寸规模:买卖多少?·人市:什么时候买卖?<br>·止损:什么时候放弃一个亏损的头寸?·退出:什么时候退出一个赢利的头寸?·战术:怎么买卖?</p>
<p>市场:买卖什么?<br>第一个必须要作的决策就是买卖什么产品，从本质上说，这就是选择市场的过程。如果你选择的市场太少，你抓住趋势的概率就会大大降低。另一方面，你也不希望不加区分地随意选择那些容量太小或鲜有趋势的市场。<br>头寸规模:买卖多少?<br>应该买卖多少是一个基础性的问题，但一般交易者往往会忽视或错误地处理这个问题。<br>头寸规模对分散化和资金管理策略都有影响。分散化旨在将风险分散到多种不同工具中，同时通过提高成功交易的概率来提高赢利水平。因此，恰当的分散化要求交易者在多种不同工具上投入类似甚至相同的赌注。资金管理实际上就是控制风险，以免过大的风险让你在迎来好趋势之前就被迫出局。<br>应该买卖多少就是交易中最重要的一个问题。新手们大多在单笔交易上投注过大，这大大提高了他们的破产风险，即使他们的策略在其他方面是有效的。</p>
<p>入市:什么时候买卖?<br>有关什么时候买卖的决策被称为入市决策。自动化的系统会产生入市信号，明确规定入市时的价格和市场条件，正是这些信号告诉你何时通过买入或卖出而进入市场。</p>
<p>止损:什么时候放弃一个亏损的头寸?<br>长期来看，不能及时甩掉损失的交易者不可能成功。要想控制损失，最重要的一件事就是在入市之前就确定退出的标准。</p>
<p>退出:什么时候退出一个赢利的头寸?<br>有许多“交易系统”号称是完整的系统，但实际上并没有明确解决赢利头寸的退出问题。但是，赢利头寸的退出时机对系统的赢利能力至关重要。任何不能回答这个问题的系统都不是完整的系统。</p>
<p>战术: 怎么买卖?<br>一旦系统产生了交易信号，执行方法上的战术技巧就成了重点。对比较大的账户来说尤其如此，因为大账户的举动有可能导致价格的大幅度不利变动，也就是对市场的冲击。<br>使用机械性的交易系统是保持行动统一性的最佳方法。如果你知道你的系统能在长期内赚钱，你就更容易遵守交易信号，在亏损时期也坚持你的系统。这里有必要再强调一下:如果你依赖的是自主判断，那么你往往会在应该大胆的时候畏首畏尾，在应该谨慎的时候却胆大包天。<br>如果你有一个有效的机械性交易系统，而且能严格地遵守它，系统就会为你赢利，而且能帮助你克服连续损失或巨大利润下的那种不可避免的心理波折。<br>海龟们所使用的系统就是个完整的交易系统，这也是我们获得成功的一大因素。这个系统使我们更容易保持行动统一性，赢面也更大，因为它不会把重要的决策留给交易者的大脑。</p>
<p>市场：海龟们的选择<br>海龟们都是期货交易者。我们在最具影响力的美国期货交易所买卖期货合约。由于我们手中有数百万美元，我们不能选择那种每日成交量只有几百份合约的市场，因为在这样的小市场中，大交易会导致市场的剧烈动荡，不承受较大的损失是很难进入或退出的。海龟们只选流动性最高的市场。事实上，流动性是理查德·丹尼斯为海龟们选择市场的首要标准。<br>一般来说，海龟们涉足美国所有的高流动市场，除了谷物和肉类。由于理查德·丹尼斯本人的账户已经达到了谷物交易头寸的法定上限，他无法再让我们作谷物交易，否则将超过交易所的头寸限制。我们不碰肉类市场是因为肉类交易厅的场内交易者们有腐败问题。海龟班解散若干年后，联邦调查局对芝加哥肉类交易厅展开了一次大规模清查行动，以价格操纵和其他形式的腐败罪名起诉了多名交易者。<br>以下是海龟们所交易的期货市场:芝加哥期货交易所<br>·30年期美国长期国库券.10年期美国中期国库券<br>细约咖啡、糖与可可交易所·咖啡·可可·糖<br>·棉花<br>芝加哥商业交易所·瑞士法郎·德国马克英镑<br>·法国法郎·日元<br>加拿大元<br>·标准普尔500股票指数<br>•欧元<br>.90天美国短期国库券纽约商品交易所·黄金·白银·铜<br>纽约商业期货交易所·原油</p>
<p>·民用燃料油·无铅汽油<br>海龟们有权不选择上述任何一种产品，但是，一旦一个海龟排除了某一个市场，他就再也不能进入这个市场。因为我们要保持行动的统一性。</p>
<p>头寸规模<br>海龟们所使用的头寸规模算法在那个时代非常先进，因为它会根据一个市场的绝对波动幅度来调整头寸的规模，等于将头寸的绝对波动幅度标准化了。这意味着，一个特定头寸在某一天的向上或向下变动幅度（以绝对美元金额来衡量）与其他市场上的头寸基本相同，无论这个特定市场的波动性是大还是小。<br>其中的原理是:如果一个市场的合约价值波动性较强，那么这个市场中的合约持有量就少一些;相反，如果一个市场的波动性较弱，这个市场中的头寸就可以大一些。总之，市场的波动性与头寸的规模是相互抵消的。<br>这种波动性标准化处理非常重要，因为这意味着不同市场上的<br>不同交易在盈亏概率上是相同的:它们都有同样的机会赚一美元或赔一美元。这便提高了多重市场分散化的效果。<br>即便某个市场的波动性较弱，一次大趋势也能让海龟们打个大胜仗，因为一种合约的波动性越低，海龟们手中的合约就越多。</p>
<p>波动性: N的含义<br>海龟们用一个特殊的概念来衡量一个市场的潜在波动性，理查德·丹尼斯和比尔·埃克哈特称之为N， N就是真实波动幅度的20日指数移动平均值，现在更常见的名称是真实波动幅度均值（或ATR）。从理论上说， N代表着一个市场在一天内的平均波动幅度，包括开盘跳空的情况在内。N的单位是点数，也就是这个市场的价格点数。<br>每一天的真实波动幅度是用下列关系式计算的:<br>真实波动幅度=Max （H-L， H-PDC， PDC-L）其中:</p>
<p>H=当日最高价L=当日最低价<br>PDC=前一日收盘价N的计算公式如下:</p>
<p>N 19 x PDN + TR20</p>
<p>其中:</p>
<p>PDN=前一日的N值<br>TR=当日的真实波动幅度<br>由于公式中需要前一日的N值，你在首次计算N的时候不能用这个公式，只能计算真实波动幅度的20日简单平均值。</p>
<p>美元波动幅度<br>决定头寸规模的第一个步骤就是计算绝对波动幅度，而绝对波动幅度是根据市场的价格波动性（N值）算出的。<br>这听起来复杂，实际上很简单。绝对波动幅度的计算公式就是:绝对波动幅度=Nx每一点数所代表的美元</p>
<p>波幅调整后的头寸单位<br>海龟们把头寸分为一个个单位，我们称之为头寸单位。头寸单位的大小要根据市场的波动性进行调整，目的是让一个N相当于账户净值的1%。<br>因此，一个特定市场或产品的头寸规模单位可以用下列公式算出:</p>
<p>头寸规模单位=账户的1%<br>市场的绝对波动幅度</p>
<p>或者</p>
<p>账户的1%<br>头寸规模单位=Nx每一点数所代表的美元</p>
<p>请看以下例子:<br>附表1 2003年3月份民用燃料油合约的价格、真实波动幅度和N值<br>根据2002年12月4日的N值0.0141， 12月6日的头寸单位规模计算如下:<br>N=0.0141</p>
<p>账户规模=1 000 000美元<br>每一点数所代表的美元=42 000 （每份合约代表42 000加仑民用燃料油，以美元报价）<br>0.01 x1 000 000<br>头寸单位规模=0.0141 x42 000<br>=16.88<br>由于期货合约是不能拆分的，我们舍去小数，得出16份合约的结果。<br>你可能会问: “你们多长时间算一次N值和头寸单位规模?”实际上，海龟们每个星期一都能拿到一张头寸单位规模表，上面列明了我们所交易的每一种合约的N值和头寸单位规模。</p>
<p>头寸规模的重要性<br>前面说过，分散化旨在将风险分散到多种不同工具中，同时通过提高成功交易的概率来提高赢利水平。恰当的分散化要求交易者在多种不同工具上投入类似甚至相同的赌注。<br>海龟系统用市场波动性来衡量每一个市场的风险水平。然后，我们会根据这个风险准绳来逐步建立风险量（或波幅）相同的头寸。这增强了分散化的效果，提高了赢利交易弥补亏损交易的概率。<br>请注意，如果你没有足够的资金，这样的分散化是很难实现的。在上面的例子中，假如账户的规模不是100万美元，而是10万美元，那么头寸单位的规模将是1份合约，因为1.688舍去小数就是1，对这种小账户来说，调整的精确性太低，这会大大降低分散化的效果。</p>
<p>风险与头寸单位<br>由于海龟们用头寸单位来衡量头寸的大小，而这样的头寸单位要根据波动性风险进行调整，头寸单位实际上就成了单个头寸和整个头寸组合的一个风险衡量指标。<br>海龟资金管理法则在4个不同层面上限制了我们的交易量。从本质上说，这些法则控制了交易者的总体风险水平。无论是在没完没了的亏损时期还是翻天覆地的价格动荡中，这些限制都能把损失最小化。<br>1987年10月股崩之后的那一天就是惊天大动荡的一个例子。为了唤起人们对股市和美国经济的信心，美联储在一夜之间决定降息几个百分点。海龟们已经大举抛空利率类合约，比如欧洲美元、短期国库券和长期国库券。因此第二天的损失大得可怕。大多数海龟的账户净值都在一天内损失了40%~60%。但是，如果没有最大头寸的限制，我们的损失还要比这个数字大得多。这四个层面的限制如下:</p>
<p>附表2 四个层面的限制<br>单个市场:每一个市场中的头寸单位不得超过4个。<br>高度关联的多个市场:在紧密关联的市场中，我们在某一个方向上的头寸单位不得超过6个（也就是说，空头单位最多6个，多头单位也最多6个）。高度关联的市场组合包括:民用燃料油与原油，黄金和白银，所有外汇，像短期国库券和欧洲美元这样的利率类期货等。<br>松散关联的多个市场:对松散关联的市场来说，我们在某一个方向上的头寸单位不得超过10个。松散关联的市场包括黄金与铜，白银与铜，以及海龟们因为法定头寸限制而无法交易的许多谷类组合。<br>单个方向:任何一个方向上的总头寸单位都不得超过12个。因此，一个海龟从理论上说可以同时持有12个空头单位和12个多头单位。<br>海龟们用“满仓”这个词来表示他们已经达到了某个层面上的头寸规模上限。因此，日元满仓是指已经持有4个单位的日元合约，完全满仓是指某个方向上的头寸单位已经达到12个，诸如此类。</p>
<p>调整交易规模<br>有时候，市场会连续多个月没有趋势出现。在这种情况下，你的账户净值有可能遭受巨大的损失。<br>而在一场场大捷之后，你可能想扩大账户规模，进而扩大头寸规模。<br>海龟们的账户并不是那种在初始净值的基础上逐笔结算的普通账户。我们拿到的是名义账户，大小是指定的，初始净值为0，例如，当我们在1983年2月刚刚开始实战时，许多海龟拿到的是一个100万美元的名义账户。账户规模每年年初调整一次。上调还是下调要看里奇对交易者的评价。调整幅度一般与这个账户上一年度的盈亏状况紧密相关。<br>每当我们损失了初始账户的10%时，里奇都会把我们的账户规模缩减20%。这样，如果我们的100万美元初始账户损失了10% ，也就是10万美元，我们的账户规模将会下调到80万美元，直到账户净值恢复到年初水平。如果我们又一次损失了10% （80万美元的10%，也就是8万美元，这样总损失达到了18万美元），我们就得把账户再压缩20%，这样就只剩下了64万美元的名义账户。<br>根据盈亏状况调整账户规模可能还有更好的方法。以上只是海龟们的方法。</p>
<p>入市策略<br>交易者大多从人市信号的角度来评判一个特定的交易系统。他们相信，人市策略是一个交易系统最重要的一个环节。<br>所以他们可能想不到，海龟们使用的是一个以理查德·唐奇安的通道突破系统为基础的非常简单的入市系统。<br>海龟们使用两个有所差异但也彼此相关的入市系统，我们称之为系统1和系统2，我们可以自由决定如何在这两个系统之间分配资金。有的海龟只用系统2，有的在两个系统上各投入50%的资金，还有的采用其他组合。这两个系统分别是:系统1:以20日突破为基础的短期系统系统2:以55日突破为基础的长期系统</p>
<p>突破<br>突破是指价格超越了过去一定时期内的最高点或最低点。所以，20日突破就是指价格超越了过去20天内的最高或最低点。<br>海龟们总是在突破发生时立即入市交易，不会等到当日收盘或次日开盘时。在跳空开盘的情况下，假如开盘价已经跳过了突破价，海龟们就在开盘时入市。</p>
<p>系统1入市法则<br>只要价格超越20日最高或最低点一个最小单位，海龟们就马上行动。如果价格超越了20日高点，海龟们就买入1个头寸单位，开始做多。如果价格跌破了20日低点，海龟们就卖出1个头寸单位，开始做空。<br>但是，假如上一次突破是一次赢利性突破（也就是可以带来一次赢利的交易），那么系统1的当前入市信号将被忽略。注意:对这一法则来说，上一次突破就是指市场的上一次实际突破，不管交易者当时采取了突破交易还是根据这一法则而忽略了那次突破。那么什么是亏损型的突破呢?如果突破日之后的价格在头寸有机会退出获利（根据10日突破退出法则）之前发生了2N幅度的不利变动，这就被视为一次亏损性的突破。<br>对这一法则来说，上一次突破的方向并不重要。因此，无论上一次突破是向上突破还是向下突破，只要是亏损型突破，那么目前的新突破（无论是向上还是向下突破）就会被视为有效的入市信号。<br>不过，如果一次突破因为这条法则而被忽略，那么交易者将在55日突破点入市，这是为了避免错过重大趋势。这个55日突破点被视为一个保障性突破点。<br>在任何时候，如果一个交易者处于离场等待的状态，那么总有某个价位能引发空头入市信号，也总有某个更高的价位能引发多头人市信号。如果上一次突破是亏损性的，那么新突破点（也就是20日突破点）将更接近于当前价格;如果上一次突破是赢利性的，那么新突破点可能离当前价远得多，因为那有可能是个55日1突破点。</p>
<p>系统2入市法则<br>只要价格超越55日最高或最低点一个最小单位，我们就入市。<br>如果价格超越了55日高点，海龟们就买入1个头寸单位，开始做多。如果价格跌破了55日低点，海龟们就卖出1个头寸单位，开始做空。<br>对系统2来说，所有突破都被视为有效信号，无论上一次突破是亏损性还是赢利性的。</p>
<p>逐步建仓</p>
<p>海龟们首先在突破点建立1个单位的头寸，然后按1/2N的价格间隔一步一步扩大头寸。这个1/2N的间隔以上一份订单的实际成交价格为基础。所以，如果最初的突破交易发生了1/2N的成交价偏差，那么新订单的价格将与突破点相差1N，也就是最初1/2N的偏差加上1/2N的标准间隔。<br>这个过程将继续下去，一直到头寸规模达到上限。如果市场足够活跃，我们有可能在一天内加满4个头寸单位。请看下面的例子:黄金</p>
<p>N=2.50<br>55日突破价=310.00第一个单位: 310.00<br>第二个单位: 310.00 + 1/2 x 2. 5=311.25第三个单位: 311.25 +1/2 x2.5=312.50第四个单位: 312. 50 +1/2 x2.5=313.75原油<br>N= 1.20<br>55日突破价=28.30<br>第一个单位: 28.30<br>第二个单位: 28. 30 +1/2 x 1.20=28.90第三个单位: 28.90 +1/2 x 1.20=29.50第四个单位: 29. 50+1/2 x1.20 =30. 10</p>
<p>统一性</p>
<p>里奇要求海龟们坚定不移地遵守入市信号，因为一整年的大部分利润很有可能就来自于两三次大的赢利交易。哪怕你只忽略或错过了一个信号，这一年的回报率也可能大打折扣。<br>表现最好的海龟们都是入市法则的坚定信徒。表现最差的海龟和那些被淘汰出海龟计划的人都不能始终如一地坚持法则。</p>
<p>止损<br>交易行业里有这么一句话: “有老交易者，也有不怕死的交易者，但是没有不怕死的老交易者。”不用止损点的交易者十有八九会破产。海龟们一定会用止损点。<br>面对一个亏损的头寸，你可以坚守阵地，寄希望于失而复得;也可以割肉退出，承认这次交易不成功。对大多数人来说，前者远比后者要容易。<br>我可以明明白白地告诉你:遵守系统法则的命令退出亏损的头寸是一个生死攸关的要点。不会甩掉损失的交易者在长期内都不会成功。包括巴林银行和长期资本管理基金的灾难在内，几乎所有失去控制的致命交易行为都与不能防微杜渐地及时控制损失有关。<br>要控制损失，最重要的一件事就是在入市之前就确定退出的标准。一旦价格到达了你的止损标准，你必须退出-坚定不移，无一例外。犹豫和动摇终将酿成灾难。<br>注意:读者也许会注意到，这里的观点与我在第十章的说法有所不同。在第十章，我曾说加入止损点有时候对系统不利，因此并不一定有必要。但是，之前所说的那些表现良好的系统看似没有止损点，实际上却有一种内在的止损机制，因为当价格向不利的方向持续变化时，移动均线早晚会交叉，损失水平终会受到限制。因此从某种意义上说，系统中有一个止损点，只不过交易者看不到它或不知道它罢了。不过，对大多数交易者来说，有一个明确的止损退出点在心理上更容易接受。对新手们来说尤其如此。目睹头寸日益萎缩但却一眼看不到苦日子的尽头，这对交易者来说是一种的心理上的折磨。</p>
<p>海龟止损点<br>海龟们会使用止损点，但这并不意味着我们真的会向经纪人下止损订单（stop order）<br>由于海龟们手中的头寸非常庞大，我们不愿意下止损单，因为这有可能暴露我们的头寸状况或交易策略。我们会事先确定一个特定的止损价位，当市场达到这个价位，我们将通过限价订单或市价订单来退出我们的头寸。<br>这些止损价位就是雷打不动的退出点。只要市场到达了止损价位，我们就毫不迟疑地坚决退出。</p>
<p>止损标准<br>海龟们根据头寸风险来设定止损标准。任何一笔交易的风险程度都不得超过2%。<br>由于IN的价格变动代表着账户净值的1%，在2%的风险限制下，价格变动的上限就是2N，海龟们止损标准就是2N:对多头头寸来说，止损价比入市价低2N;对空头头寸来说，止损价比入市价高2N<br>为了把整体头寸风险控制在最低水平，如果我们（按1/2N的价格间隔）后续补充了头寸单位，那么之前头寸单位的止损点将相应地调整1/2N，一般来说，这意味着整个头寸的止损点将与最新添加的头寸单位相距2N的距离。不过，如果头寸补充的价格间隔因为市场变化过快或开盘跳空等情况而大于1/2N，止损标准也会有所变化。<br>下面是一个例子:<br>备选止损策略:双重损失<br>海龟们也学习了另外一种叫做双重损失（the whipsaw）的止损策略。这种策略可以实现更高的利润率，但更难执行，因为它所制造的损失要比一般策略多得多，胜负比率会大大降低。<br>在双重损失策略下，每一笔交易的风险上限不是2%，而是0.5%。也就是说，价格波动的上限是1/2N，在一个头寸单位止损退出后，交易者将在价格恢复到最初的人市价时重新建立这个单位。有几个海龟很成功地运用了这种策略。<br>双重损失策略还有一个好处:它不需要随着新头寸单位的补充而调整之前单位的止损点，因为我们最多只能有4个单位，总风险水平不可能超过2%。<br>比如，如果采用双重损失止损策略，上述原油交易将变成下面的样子:<br>海龟止损策略的优势</p>
<p>由于海龟止损点以N为基础，它们与市场的波动性息息相关。更具波动性的市场有更大的止损范围，但每个头寸单位的合约数量也相对较少。这便统一了所有交易的风险水平，加强了分散化的效果和风险管理的稳健性。<br>退出</p>
<p>交易行业里还有一句老话: “落袋为安的人永远也不会破产。”但海龟们不会同意这种论调。趋势跟踪者们最常犯的错误之一就是过早地退出赢利的头寸，也就是过早地“落袋为安”。<br>价格永远也不会直上直下，没有波动。因此，要想抓住一次趋势，你必须允许价格偶尔向不利的方向变动。在趋势的初期，这往往意味着10%-30%的利润在你眼前化为乌有，反而转为小小的损失。在趋势的中期，你或许会眼睁睁地看着80%~ 100%的利润跌去三四成。在这些情况下，放掉包袱、“锁定利润”的诱惑是很强大的。<br>海龟们知道，赢利的时机问题足以决定你的胜败。<br>海龟系统在突破点入市，但大多数突破点都不会引发趋势。这意味着海龟们的大多数交易都是亏损的。如果少数赢利的交易赚不到足够多的钱来弥补这些损失，海龟们会是输家。每一个有效的交易系统都有自己的最佳退出点。<br>考虑一下海龟交易系统:如果你总是在1N的利润水平下退出赢利的交易，却在2N的止损点退出亏损的交易，你的赢利次数必须是亏损次数的两倍才能做到盈亏平衡。<br>交易系统的各个成分之前有着复杂的关系。因此，如果你不考虑人市点、资金管理和其他因素，你就没法去考虑正确的退出策略。赢利头寸的退出策略是最重要的问题之一，但也是最不受重视的问题之一。然而，它完全可以决定一笔交易的成败得失。</p>
<p>海龟退出策略<br>系统1采用10日突破退出法则:对多头头寸来说，在价格跌破<br>过去10日最低点时退出;对空头头寸来说，在价格超过10日最高点时退出。总之，如果价格发生了不利于头寸的10日突破，所有头寸单位都要退出。<br>系统2则采用20日突破退出法则:对多头来说是20日向下突破，对空头来说是20日向上突破。只要价格发生了不利于头寸的20日突破，所有头寸单位都会退出。<br>就像入市策略一样，海龟们一般不会通过止损订单而退出，而是会紧密观察市场的动向，在价格达到退出突破点时马上下单退出。</p>
<p>退出不易<br>对大多数交易者来说，海龟系统的退出策略可能是整个系统中最难忍受的一个环节。你必须等待市场创下10日或20日新低才能退出，这往往意味着目睹20%、40%甚至100%的巨额利润瞬间蒸发。<br>所以，交易者总有一种提早退出的强烈冲动。你需要极强的纪律性才能坚守阵地，忍受利润的蒸发，直到抓住真正的大趋势。在大的赢利交易中遵守纪律和法则的能力就是经验丰富的成功交易者们的标志。</p>
<p>战术</p>
<p>著名建筑师密斯·凡德罗（Mies van der Rohe）在谈到建筑设计时曾说过这么一句话: “细节就是上帝。”对交易系统来说同样如此。在使用海龟交易法则的过程中，有些重要的细节对你的赢利水平有举足轻重的影响。<br>下单</p>
<p>前面说过，理查德·丹尼斯和比尔·埃克哈特建议海龟们不要使用止损订单，而是随时观察市场动向，在价格到达止损价位的时候再行动。他们还告诉我们，限价订单总的来说要强于市价订单。相比起市价订单，限价订单更容易以更有利的价格成交，成交价偏差也要小一些。<br>任何时候的任何市场都有买入价和卖出价这两个报价。买入价就是买者们愿意接受的买价，卖出价就是卖者们愿意接受的卖价。只要买入价超过了卖出价，交易就会发生。如果市场的成交量足够大，市价订单总能在买入价位或卖出价位成交，不过大订单的成交价有时候也会稍差一些。<br>一般来说，市场总会发生一定幅度的相对随机性波动，这有时候被称为反弹（bounce），之所以使用限价订单，就是为了把价格定在反弹区域的底端，而不是简简单单地接受当前的市价。一个小的限价订单不会触动市场，即使订单较大，它对市场的触动也小于市价订单。<br>确定限价订单的最佳定价是需要一定技巧的。不过，只要多做练习，你完全能学会用接近市价的限价订单获得比市价订单更好的成交价。</p>
<p>急变市场<br>有时候，市场变化速度太快，顷刻之间就会跳过你的订单价。如果你用的是限价单，你根本没机会成交。在这类急变市场中，每份合约的价值可能在短短几分钟之内涨跌数千美元之多。<br>在这种情况下，海龟们的原则是保持冷静，等市场稳定下来再做打算。但大多数新手都很难做到这一点。他们会惊慌失措，手忙脚乱地发出市价单。他们十有八九是在最差的时机下单的，到头来一算，他们的成交价是一天内最差的价格，不是最高点就是最低点。在一个急变市场中，流动性会暂时固定。如果市场露出急变的迹象，卖者会停手观望，等待价格继续上涨，而且在飙升趋势停止之前不会再卖。这样一来，卖出价会急剧上升，而且买卖价差会有所扩大。<br>随着卖者不断抬高要价，买者们也被迫抬高出价，于是价格的上涨越来越快，最终引来更多的卖者。随着卖者越来越多，价格会平稳下来，往往还会快速逆转，大幅回调。<br>到头来，市价订单的成交点通常就是上行趋势的最高点，也就是市场开始止升企稳的时候。<br>在这类情况下，海龟们会一直等到市场出现逆转迹象（至少是暂时逆转）的时候再行动，这时候的成交价通常要比市价订单下的成交价好得多。如果市场趋于稳定后的价格已经超过了我们最初的止损价，我们会退出市场，但不会惊慌失措。</p>
<p>同步入市信号<br>在很多时候，市场非常平稳，波澜不惊，所以海龟们除了监控手头的头寸之外基本上无事可做，有可能在很长一段时间内没有任何动作。有的时候也会有点忙碌，几个小时内陆陆续续地出现多个信号，我们会按部就班地行动，直到达到相应市场的头寸上限。<br>但也有的时候，似乎所有的事情都在同一时间发生，我们个个忙得昏天黑地，在一两天之内就从两手空空变成了满仓。而且相互<br>关联的市场上常常会同时发出信号，令疯狂的节奏变得更加疯狂。<br>如果各个市场一开盘就跳空越过了入市信号，那就更不用说了。你可能在同一天内看到原油、民用燃料油和无铅汽油市场的跳空开盘人市信号。对期货合约来说，同一个市场的多个不同月份的合约同时出现信号也是司空见惯的事。在这种情况下，你必须高效、快速地行动，而且不能惊慌，不能乱下市价订单，否则你的成交价必然会大大恶化。</p>
<p>买强卖弱<br>如果多个信号在同一时间出现，我们会在同一类市场中选择最强势的市场买入，选择最弱势的市场卖空。<br>另外，我们在同一时间只会选择一个月份的合约，而且只会建立一个头寸单位。比如，我们不会同时买入2月份、3月份和4月份的民用燃料油合约，而是会选择最强势而且有足够高的成交量和流动性的合约。<br>这一点极其重要。在同一类相互关联的市场中，最好的多头交易都存在于最强势的市场中（这些市场的表现几乎必然强于较弱的同类市场）。同样，最好的空头交易都存在于最弱势的市场中。<br>海龟们用多种不同的衡量标准来判断市场的强弱。最简单也最常用的一种方法就是察看图表，根据视觉判断来选出“看起来”更强（或更弱）的市场。<br>有些海龟的衡量标准是N:他们会比较一下各个市场自发生突破之后已经变化了多少个N，然后在变动幅度最大（以N来衡量）的市场中买入。还有一些海龟把不同市场的变化标准化了:他们用当前价减去3个月之前的价格，然后再除以N值。结果值最高的就<br>是最强的市场，最低的就是最弱的市场。<br>这些方法都很有效。总而言之，要点在于在最强的市场上做多，在最弱的市场上做空。</p>
<p>合约滚动<br>当一期合约到期时，你在转向后期新合约之前需要注意两个因素首先，在很多时候，近期的合约虽然有很好的趋势，但较远期的合约并没有表现出同样的势头。除非新合约的趋势同样符合你的要求，否则不要向新合约滚动。<br>其次，你必须赶在现有合约的成交量和未平仓量（open interest）大幅萎缩之前滚向新合约。什么叫“大幅萎缩”要看头寸单位有多大。一般来说，海龟们会在合约到期之前几个星期将现有头寸滚向后期新合约，除非现有合约的表现远好于后期的新合约。</p>
<p>结束语<br>以上就是完整海龟交易系统的全套法则。你可能会觉得它们并没有多么复杂。<br>但是，单单知道这些法则是没有用的，你必须有遵守这些法则的能力。<br>想想理查德·丹尼斯的话: “我说过很多次，你可以把我的交易法则登在报纸上，但没人会遵守它们。关键是统一性和纪律性。几乎每一个人都可以列出一串法则，而且不比我们的那些法则差多少。但他们不能给别人信心，而唯有对法则充满信心，你才会坚持这些法则，即使遭遇逆境。”<br>海龟们的表现也许就是对这段话的最好诠释:有许多海龟并没有赚钱。这不是因为我的法则无效，而是因为他们不能也没有遵守这些法则。<br>海龟法则是很难坚持的，因为它们以捕捉相对罕见的大趋势为基础。正因为大趋势难得一见，所以你在迎来赢利期之前可能要等上好多个月，有时候甚至是一两年。在漫长的等待中，你很容易对海龟系统产生怀疑，忍无可忍地放弃这个系统。你会想:如果这些法则不再有效了怎么办?如果市场已经变了怎么办?如果这些法则有重要的错漏怎么办?我怎么知道这个系统一定有效?<br>有个不到一年就被淘汰的首期海龟班成员一开始就怀疑里奇有意对全班隐瞒了某些信息，最终，他开始相信里奇有一些不会透露的秘诀。这个海龟不敢勇敢地面对一个简单的事实:他的糟糕表现完全是他的疑心和不安全感造成的，正是这些心理因素导致他无法遵守我们的法则。<br>改变法则的冲动也是一个问题。有很多海龟对我们的法则做了一些轻微的调整，说是为了降低交易的风险，但效果往往适得其反。下面是一个例子。<br>有时候，交易者建立头寸不像法则规定的那样快（每隔1/2N建立一个单位）。这听起来似乎是一种更为保守的方法，但实际上并非如此。对海龟们所使用的人市系统来说，如果头寸补充较慢，市场的回调就更容易触及止损退出点，造成意外损失。而快速行动可以让你的头寸安然度过市场回调，避免触发止损。在特定市场状况下，这种微小的变化足以对系统的利润率产生重大的影响。<br>要想坚持一个交易系统的法则，建立对系统的信心是非常重要的。无论是海龟系统、类似系统还是其他完全不同的系统，你必须亲自用历史交易数据检验你的系统。别人说一个系统有效是没用的，<br>其他人的研究结果也不代表什么。你必须自己完成这个任务。<br>用点心思，亲力亲为。研究一下交易记录，看看每日净值报告，把系统的交易方式和损失的程度和频率摸个滚瓜烂熟。<br>如果你知道过去的20年中曾有过很多旷日持久的亏损期，你就更容易忍受一个历时8个月的亏损期。如果你知道快速补充头寸是系统赢利的一个关键环节，你就更容易遵守法则，快速行动。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/海龟交易法则/" rel="tag"># 海龟交易法则</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/06/10/尾声-万事俱备/" rel="next" title="尾声 万事俱备">
                <i class="fa fa-chevron-left"></i> 尾声 万事俱备
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/07/05/第十章-蜡烛图信号的汇聚/" rel="prev" title="第十章 蜡烛图信号的汇聚">
                第十章 蜡烛图信号的汇聚 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="CheBin">
            
              <p class="site-author-name" itemprop="name">CheBin</p>
              <div class="site-description motion-element" itemprop="description">放弃会成为一种习惯</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">438</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">59</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          


          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/2021/09/28/插座/" title="插座" target="_blank">插座</a>
                  </li>
                
                  <li>
                    <a href="/2021/09/24/第24章-部署Go语言代码/" title="第24章 部署Go语言代码" target="_blank">第24章 部署Go语言代码</a>
                  </li>
                
                  <li>
                    <a href="/2021/09/24/第23章-Go语言时间编程/" title="第23章 Go语言时间编程" target="_blank">第23章 Go语言时间编程</a>
                  </li>
                
                  <li>
                    <a href="/2021/09/24/第22章-正则表达式简介/" title="第22章 正则表达式简介" target="_blank">第22章 正则表达式简介</a>
                  </li>
                
                  <li>
                    <a href="/2021/09/24/第21章-处理文件/" title="第21章 处理文件" target="_blank">第21章 处理文件</a>
                  </li>
                
              </ul>
            </div>
        

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CheBin</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">4.1m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">62:40</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
