<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta name="keywords" content="Go语言编程入门与实战技巧">
<meta property="og:type" content="article">
<meta property="og:title" content="第7章 包">
<meta property="og:url" content="http://yoursite.com/2021/09/08/第7章-包/index.html">
<meta property="og:site_name" content="车斌的技术博客">
<meta property="og:description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2021/09/08/第7章-包/1.png">
<meta property="og:updated_time" content="2021-11-04T07:38:59.052Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第7章 包">
<meta name="twitter:description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta name="twitter:image" content="http://yoursite.com/2021/09/08/第7章-包/1.png">






  <link rel="canonical" href="http://yoursite.com/2021/09/08/第7章-包/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>第7章 包 | 车斌的技术博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">车斌的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">放弃会成为一种习惯</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/09/08/第7章-包/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CheBin">
      <meta itemprop="description" content="什么是强迫自己？就是不想去干什么，就去干什么">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="车斌的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">第7章 包

              
            
          </h1>
        

        <div class="post-meta">

          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-09-08 09:56:12" itemprop="dateCreated datePublished" datetime="2021-09-08T09:56:12+08:00">2021-09-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-11-04 15:38:59" itemprop="dateModified" datetime="2021-11-04T15:38:59+08:00">2021-11-04</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">18k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">16 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>思考并回答以下问题：</p>
<ul>
<li>总结一下，这章作者最主要想表达什么观点？</li>
</ul>
<a id="more"></a>
<p>现如今即便是个人开发的一般程序，其包含的函数可能超过了1万个，这些函数代码一般都由他人编写并打包为“包”或者“模块”的形式，并通过相关社区分发，最后由软件作者通过调用这些“包”或者“模块”的函数来更高效地完成开发。因此在大部分时候，作者只会用到其中很小的一部分函数，但是通过“包”或者“模块”的形式重用代码使得编程开发变得更加轻松，这也是当今大部分编程语言都有自己的包管理工具和包分发渠道的原因。</p>
<p>在前面的章节中，几乎每个例子都使用到了Go语言包，例如像fmt、os等这样具有常用功能的内置包在Go语言中有一百多个，我们习惯称为标准包（标准库），这些标准包大部分都内置到Go语言本身。（完整列表可以在Go Walker中查看，或者使用<code>go list std</code>命令查看标准包列表。）</p>
<p>在本章的学习中，将包含以下知识点：</p>
<ul>
<li>包结构认识</li>
<li>包的使用基础</li>
<li>常用标准包详解</li>
<li>使用自定义包</li>
</ul>
<h1 id="包的基础"><a href="#包的基础" class="headerlink" title="包的基础"></a><span style="color:#339AFF;">包的基础</span></h1><p>在大部分编程语言中都存在“包”的概念，而任何一种包设计的目的都是为了简化大型软件设计和维护的工作，实际上包是函数和数据的集合，通过把一组有相关特性的函数和数据放进一个单元中，方便使用和更新相应的模块。这种包系统的设计使得每一个模块（包）都与程序、其他单元（其他包）保持一定的独立性，这使得每一个模块（包）可以被应用到不同的程序部分中，当然也包括其他程序中，甚至可以通过社区分发渠道流通到世界各地的项目中被不断重复利用，不仅降低了项目模块之间的耦合度，也提高了整体的开发效率。</p>
<p>在编写代码的过程中，不同模块（包）之间为了实现某一个类似的功能可能会采用相同的名字去命名一个函数，如果一个软件开发过程中需要同时使用两个模块（包），就会在调用函数时产生歧义。为了解决这个问题，Go语言引入了命名空间的概念，让每个包都定义一个命名空间，用于内部标识符的访问。因为每个命名空间关联一个特定的包，这使得我们在调用类型、函数时有了独一无二的简短明了的名字，避免在使用它们的时候产生命名冲突。</p>
<p>为了提高包的独立性以及安全性，Go语言的包可以通过控制包内名字的可见性来实现包的封装，通过限制包成员的可见性、隐藏具体的实现过程可以极大提高软件的安全性，同时开发人员调用时也不必关心其实现过程，直接使用包的API，另一方面也允许包的维护者在不影响包的用户使用的前提下调整包的内部实现。通过限定包内函数与变量的可见性来约束用户操作，只允许用户通过特定的函数来访问和控制包内部的变量，这样不仅可以提高安全性（变量一致），还可以保持并发操作时的互斥约束。</p>
<p>与大部分编译语言类似，在Go语言中，当改动了一个源文件时，就必须重新编译该源文件，以及它对应的包和所有依赖该包的其他包。即使是从头构建，Go语言编译器的编译速度也明显快于绝大部分编译语言。如此优异的编译速度主要得益于其包设计的三个特性。</p>
<p>（1）显式声明：所有导入的包必须在每个文件的开头显式声明，这样编译器就没有必要读取和分析整个源文件来判断包的依赖关系。</p>
<p>（2）无环依赖：禁止包的环状依赖，因为没有循环依赖，包的依赖关系形成一个有向无环图，每个包可以被独立编译，而且很可能是被并发编译。</p>
<p>（3）无须遍历：编译后包的目标文件不仅记录包本身的导出信息，同时还记录了包的依赖关系。因此，在编译一个包的时候，编译器只需要读取每个直接导入包的目标文件，而不需要遍历所有依赖的文件，毕竟很多都是重复的间接依赖。</p>
<h2 id="包的结构"><a href="#包的结构" class="headerlink" title="包的结构"></a><span style="color:#00ACC1;">包的结构</span></h2><p>在前面的学习中就可以知道Go语言编译工具对源码目录有很严格的要求，每个工作空间（workspace）必须由bin、pkg、src三个目录组成。bin目录主要存放可执行文件；pkg目录存放编译好的库文件，主要是*.a文件；src目录主要存放Go语言的源文件。</p>
<img src="/2021/09/08/第7章-包/1.png">
<p><strong>1，工作空间</strong></p>
<p>因为Go语言采用了工作空间这种方式来管理本地代码，这与大部分编程语言不一样，因此这里解释一下GOROOT和GOPATH之间的关系。首先，显而易见的一点就是GOROOT是一个全局并且唯一的变量，用于指定存放Go语言本身的目录路径（安装路径）；而GOPATH是一个工作空间的变量，它可以有很多个（用“;”号分隔），用于指定工作空间的目录路径。例如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOPATH=<span class="variable">$HOME</span>/workspace/golib;<span class="variable">$HOME</span>/projects/go</span><br></pre></td></tr></table></figure></p>
<p>通常go get会使用第一个工作空间保存下载的第三方库（包），在开发时不管是哪一个工作空间下载的包都可以在任意工作空间使用。需要注意的一点就是尽量不要把GOROOT和GOPATH设置为同一个路径。</p>
<p>包的源代码书写与正常的Go语言没有区别，文件必须是UTF-8格式，编写规范与本书强调的编程规范一致。</p>
<p><strong>2，包的源文件</strong></p>
<p>包的代码必须全部都放在包中，并且源文件头部都必须一致使用<code>package &lt;name&gt;</code>的语句进行声明。Go语言包可以由多个文件组成，所以文件名不需要与包名一致，包名建议使用小写字符。包名类似命名空间（namespace），与包所在目录、编译文件名无关，目录名尽量不要使用保留名称（main、all、std），对于可执行文件必须包含package main以及入口函数main。</p>
<p>Go语言使用名称首字母大小写来判断一个对象（全局变量、全局常量、类型、结构字段、函数、方法）的访问权限，对于包而言同样如此。包中成员名称首字母大小写决定了该成员的访问权限。首字母大写，可被包外访问，即为public（公开的）；首字母小写，则仅包内成员可以访问，即为internal（内部的）。</p>
<p>与大部分现代编程语言一样，Go语言同样支持使用UTF-8字符来命名对象，因此关于“大写”这个概念不限于US ASII，它被扩展到了所有大小写字母表（包括拉丁文、希腊文、斯拉夫文、亚美尼亚文和埃及古文等）。汉字一般没有大小写的概念（除了汉字数字），因此如果使用汉字作为一个函数的名称，该函数默认是私有的，需要在汉字前面加上一个大写字母才能使其变为公有函数。</p>
<p><strong>3，包的声明</strong></p>
<p>上面提到每一个包内源文件都需要在开头声明所在包，这其实就是包的声明。包的声明对于包内而言主要用于源文件编译时能够为编译器指明哪些是包的源代码；对于包外而言，在导入包的时候可以使用“包名.函数名”的方式使用包内函数。</p>
<p>对于包名相同的情况，例如math/rand包和crypto/rand包的包名都是rand，Go语言也有相应的办法解决，在下一节导入包时将会介绍。</p>
<p>关于包的声明有一个例外，那就是包编译后是一个可执行程序时，会使用package main的方式声明main包，这时候main包本身的导入路径是无关紧要的，这个名字实际是给go build构建命令一个信息，这个包编译完之后必须调用连接器生成一个可执行程序。（本章暂不讨论测试包的情况。）</p>
<h2 id="包的导入"><a href="#包的导入" class="headerlink" title="包的导入"></a><span style="color:#00ACC1;">包的导入</span></h2><p>如前所述，使用包成员之前先要导入包。导入包的关键字是import，因为Go语言包不能形成环形依赖，如果遇到导入包循环依赖的情况，Go语言的构建工具将返回错误。一般而言对于直接从分发渠道下载回来的包都不会轻易产生依赖环：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"相对目录/包主文件名"</span></span><br></pre></td></tr></table></figure></p>
<p>相对目录是指从/pkg/开始的子目录，以标准库为例：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span> <span class="comment">// 对应/usr/local/go/pkg/linux_amd64/fmt.a</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"os/exec"</span><span class="comment">// 对应/usr/local/go/pkg/linux_amd64/os/exec.a</span></span><br></pre></td></tr></table></figure></p>
<p>除了一行一个包的方式导入，还可以使用一条语句导入多个包的写法：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os/exec"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p><strong>1，导入声明</strong></p>
<p>在上一节中有一个问题没有解决，就是同名包导入时会有冲突。虽然包的命名空间解决了函数重名的情况，但是没有避免包重名的情况，因此Go语言在导入包时可以对包名做重定向，以解决包名冲突的情况。例如下面的几种例子。<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>   <span class="string">"crypto/rand"</span> <span class="comment">// 默认模式：rand.Function</span></span><br><span class="line"><span class="keyword">import</span> R <span class="string">"crypto/rand"</span> <span class="comment">// 包重命名：R.Function</span></span><br><span class="line"><span class="keyword">import</span> . <span class="string">"crypto/rand"</span> <span class="comment">// 简便模式：Function</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="string">"crypto/rand"</span> <span class="comment">// 匿名导入：仅让该包执行初始化函数</span></span><br></pre></td></tr></table></figure></p>
<p>另一种写法：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"crypto/rand"</span></span><br><span class="line">    mrand <span class="string">"math/rand"</span> <span class="comment">// 包重命名</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：</p>
<p>（1）Go语言不允许导入包却又不使用，如果导入的包并未使用，在编译时会被视为错误（不包括“import _”）。</p>
<p>（2）包的重命名不仅可以用于解决包名冲突，还可以解决包名过长、避免与变量或常量名称冲突等情况。</p>
<p>除了以上比较常见的包导入方式，还有子包导入方式以及自定义路径导入包方式。其中对于当前目录下的子包，除使用默认完整导入路径外，还可使用相对路径的方式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">└── src</span><br><span class="line">    └── test</span><br><span class="line">        ├── main.go</span><br><span class="line">        └── test2</span><br><span class="line">            └── test.go</span><br></pre></td></tr></table></figure></p>
<p>如上面的目录结构，可以在main.go文件中使用下面的方式导入test2这个包：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"test/test2"</span><span class="comment">// 一般使用这种方式导入</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./test2"</span> <span class="comment">// 也可以使用相对目录，但这种方式导入的包仅对Go语言有效</span></span><br></pre></td></tr></table></figure></p>
<p>如果在一个文件中导入的包比较多，为了管理源代码中导入的包，还可以为导入的包分组。分组是通过空行来分隔的，例如：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"html/template"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"golang.org/x/net/html"</span></span><br><span class="line">    <span class="string">"golang.org/x/net/ipv4"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>我们知道Go语言编译的时候会格式化代码，因此导入包的顺序并不需要我们调整，编译时会自动按字母排序。可以调整的只有包分组，同样每一个分组内的包在编译时会被格式化为按字母排序。</p>
<p><strong>2，导入路径</strong></p>
<p>当前Go语言的规范并没有强制包的导入路径字符串的格式，导入路径由构建工具来解释。但如果打算分享或发布自己编写的包，那么最好使用全球唯一的导入路径。</p>
<p>这主要是为了避免导入路径冲突，因此有一个约定俗成的路径格式是：所有非标准库包的导入路径以所在组织的互联网域名为前缀，这样一来就有了一个独一无二的路径，另一方面也有利于包的检索。</p>
<p>例如下面导入的包中就有两个使用了互联网域名为前缀：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math/rand"</span></span><br><span class="line">    <span class="string">"encoding/json"</span></span><br><span class="line">    <span class="string">"golang.org/x/net/html"</span></span><br><span class="line">    <span class="string">"github.com/go-sql-driver/mysql"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p><strong>3，自定义路径</strong></p>
<p>在上一节中使用了一种域名为前缀的导入路径，对于编译器来说，只有较为流行的代码托管站点才可以直接使用这种路径。对于一些个人站点（例如企业自己搭建的私有GitLab仓库），为了可以更方便使用这种方式导入就需要告诉编译器这是一个包代码链接。</p>
<p>我们有三种方式实现这个功能，一是直接在包链接中加上VCS格式，目前支持的格式有：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Bazaar      .bzr</span><br><span class="line">Git         .git</span><br><span class="line">Mercurial   .hg</span><br><span class="line">Subversion  .svn</span><br></pre></td></tr></table></figure></p>
<p>例如：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"example.org/user/foo.git"</span></span><br></pre></td></tr></table></figure></p>
<p>第二种办法是针对没有提供版本控制符的链接，go get甚至不知道应该如何下载代码的情况，例如下面这种链接：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example.org/repo/foo</span><br></pre></td></tr></table></figure></p>
<p>这个时候就需要在网页中加入一句标签：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"go-import"</span> <span class="attr">content</span>=<span class="string">"import-prefix vcs repo-root"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后就可以使用链接导入：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"example.org/pkg/foo"</span></span><br></pre></td></tr></table></figure></p>
<p>第三种情况是重定向网页链接，例如下面的情况，go get访问链接时会被重定向到<example.org r p exproj>:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"go-import"</span> <span class="attr">content</span>=<span class="string">"example.org git https://example.org/r/p/exproj"</span>&gt;</span></span><br></pre></td></tr></table></figure></example.org></p>
<p>如果没有服务器还可以使用Go语言搭建一个简单的本地服务器：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    fmt.Fprint(w,<span class="string">`&lt;meta name="go-import" content = "example.com/zuolan/test git https://github.com/zuolan/test"&gt;`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.HandleFunc(<span class="string">"/zuolan/test"</span>, handler)</span><br><span class="line">    http.ListenAndServe(<span class="string">":80"</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>保存为server.go，然后编译执行，就可以实现把<example.com zuolan test>重定向到<github.com zuolan test>。</github.com></example.com></p>
<p><strong>4，匿名导入</strong></p>
<p>如果只是导入一个包而并不使用导入的包将会导致一个编译错误。但是有时候我们只是想利用导入包而产生的副作用：它会计算包级变量的初始化表达式和执行导入包的init初始化函数。这时候需要抑制“unused import”编译错误，可以用下划线来重命名导入的包。像往常一样，下画线为空白标识符，并不能被访问：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="string">"image/png"</span> <span class="comment">// PNG解码器</span></span><br></pre></td></tr></table></figure></p>
<p>这个被称为包的匿名导入，它通常用来实现一个编译时机制，然后通过在main主程序入口选择性地导入附加的包。首先，让我们看看如何使用该特性，然后再看看它是如何工作的。</p>
<p>标准库的image图像包包含了一个Decode函数，用于从io.Reader接口读取数据并解码图像，它调用底层注册的图像解码器来完成任务，然后返回image.Image类型的图像。使用image.Decode很容易编写一个图像格式的转换工具，读取一种格式的图像，然后编码为另一种图像格式：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jpeg包从标准输入读取PNG图像，并将其作为JPEG图像写入标准输出</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"image"</span></span><br><span class="line">    <span class="string">"image/jpeg"</span></span><br><span class="line">    _ <span class="string">"image/png"</span> <span class="comment">// PNG解码器</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> err := toJPEG(os.Stdin, os.Stdout); err != <span class="literal">nil</span>&#123;</span><br><span class="line">        fmt.Fprintf(os.Stderr,<span class="string">"jpeg:%v\n"</span>,err)</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">toJPEG</span><span class="params">(in io.Reader, out io.Writer)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    img, kind, err := image.Decode(in)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Fprintln(os.Stderr, <span class="string">"Input format ="</span>, kind)</span><br><span class="line">    <span class="keyword">return</span> jpeg.Encode(out, img, &amp;jpeg.Options&#123;Quality: <span class="number">95</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果将输出导入一个程序的标准输入，它将解码输入的PNG格式图像，然后转换为JPEG格式的图像输出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ go build gopl.io/ch3/mandelbrot</span><br><span class="line">$ go build gopl.io/ch10/jpeg</span><br><span class="line">$ ./mandelbrot I ./jpeg &gt;mandelbrot.jpg</span><br><span class="line">Input format = png</span><br></pre></td></tr></table></figure></p>
<p>要注意image/png包的匿名导入语句，如果没有这一行语句，程序依然可以编译和运行，但是它将不能正确识别和解码PNG格式的图像：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go build gopl.io/ch1o/jpeg</span><br><span class="line">$ ./mandelbrot I ./jpeg&gt;mandelbrot.jpg</span><br><span class="line">jpeg:image: unknown format</span><br></pre></td></tr></table></figure></p>
<p>上面的代码演示了它的工作机制，标准库还提供了GIF、PNG和JPEG等格式图像的解码器，用户也可以提供自己的解码器，但是为了保持程序体积较小，很多解码器并没有被全部包含，除非是明确需要支持的格式。</p>
<p>image.Decode函数在解码时会依次查询支持的格式列表。每个格式驱动列表的每个入口指定了四件事情：格式的名称；一个用于描述这种图像数据开头部分模式的字符串，用于解码器检测识别；一个Decode函数用于完成解码图像工作；一个DecodeConfig函数用于解码图像的大小和颜色空间的信息。每个驱动入口是通过调用image.RegisterFormat函数注册的，一般是在每个格式包的init初始化函数中调用的，例如image/png包是这样注册的：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> png <span class="comment">// image/png</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Decode</span><span class="params">(r io.Reader)</span> <span class="params">(image.Image, error)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">DecodeConfig</span><span class="params">(r io.Reader)</span> <span class="params">(image.Config, error)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">const</span> pngHeader = <span class="string">"\x89PNG\r\n\x1a\n"</span></span><br><span class="line">image. RegisterFormat(<span class="string">"png"</span>, pngHeader, Decode, Decodeconfig)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最终的效果是，主程序只需要匿名导入特定图像驱动包就可以用image.Decode解码对应格式的图像了。</p>
<p>数据库包database/sql也是采用了类似的技术，让用户可以根据自己的需要选择导入必要的数据库驱动。例如：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h2 id="包的使用"><a href="#包的使用" class="headerlink" title="包的使用"></a><span style="color:#00ACC1;">包的使用</span></h2><p>为了更好地理解包导入的细节，在本节中将创建一个包，这个包很简单，首先在工作空间建立一个项目test：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir <span class="variable">$GoPATH</span>/src/<span class="built_in">test</span></span><br></pre></td></tr></table></figure></p>
<p>在src/test中新建一个文件如下：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"><span class="comment">//公开函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Even</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">bool</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> i%<span class="number">2</span>==<span class="number">0</span></span><br><span class="line">]</span><br><span class="line"><span class="comment">//私有函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">odd</span> <span class="params">(iint)</span> <span class="title">bool</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> i %<span class="number">2</span> == <span class="number">1</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>然后保存为test.go文件，最后使用go build和go install命令编译和安装这个包。现在我们有了一个包，接下来看如何导入刚才建立的包，应用于新的程序之中。</p>
<p>新建一个文件，就叫作main.go吧（当然也可以命名为其他名字）：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="comment">//下面导入了本地包test和官方标准包fmt</span></span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line"><span class="string">"test'</span></span><br><span class="line"><span class="string">"</span>fmt<span class="string">"</span></span><br><span class="line"><span class="string">//调用test包中的Even函数。访问一个包中的函数的语法是package. Function() func main()&#123;</span></span><br><span class="line"><span class="string">i:=5</span></span><br><span class="line"><span class="string">fmt.Printf("</span>Is %d even? %v\n<span class="string">", i, test.Even(i))</span></span><br></pre></td></tr></table></figure></p>
<p>在上面的例子中，如果使用了odd这个函数，在编译的时候就会报错，因为在test包中定义了odd函数为私有函数，不能被外部访问。</p>
<h2 id="Go语言工具箱"><a href="#Go语言工具箱" class="headerlink" title="Go语言工具箱"></a><span style="color:#00ACC1;">Go语言工具箱</span></h2><p>Go语言的工具箱集成了一系列命令集，一方面它是一个强大的包管理器，可以用于包的查询，计算包的依赖关系，从远程版本控制系统下载包等任务；另一方面，它也是一个构建系统，计算依赖、构建程序，类似make命令。除此之外，它还是一个测试驱动程序，不过在本章中不会讨论关于测试的内容。</p>
<p><strong>1，包文档</strong></p>
<p>根据编程规范，每个包都应该有包注释，一般是在package前的一个注释块。对于多文件包，包注释只需要出现在任意一个文件前即可。包注释应当对包进行介绍，并提供关于包的整体信息，这会出现在godoc生成的关于包的页面上，并且相关的细节会一并显示。</p>
<p>包中每个导出的成员和包声明前都应该包含目的和用法说明的注释。下面是来自于fmt包的例子：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Printf formats according to a format specifier and writes to standard</span></span><br><span class="line">II output. It returns the number of bytes written and any write error</span><br><span class="line"><span class="comment">// encountered.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Printf</span><span class="params">(format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>)</span> <span class="params">(nint, err error)</span></span></span><br></pre></td></tr></table></figure></p>
<p>为了更好地管理文档（注释），Go语言提供了两个工具。首先是godoc命令，该命令打印包的声明和每个成员的文档注释。</p>
<p>例如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go doc <span class="built_in">test</span></span><br><span class="line">package <span class="built_in">test</span> II import <span class="string">"test"</span></span><br></pre></td></tr></table></figure></p>
<p>这是一个简单的演示包，这里一般写上这个包的简单介绍。</p>
<p>可导出的函数、变量成员等的解释。</p>
<p>查看某个具体包成员的注释文档：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go doc test.TestFunc</span><br></pre></td></tr></table></figure></p>
<p>该命令并不需要输入完整的包导入路径或正确的大小写。例如查看encoding/json包的（*json.Decoder）.Decode方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go doc json.decode</span><br></pre></td></tr></table></figure></p>
<p>第二个工具名字叫godoc，它提供可以相互交叉引用的HTML页面，输出的信息会比godoc要多一些。godoc有一个在线服务:ttp://godoc.org，它包含了成千上万的开源包的文档检索。你也可以在自己的工作区目录运行godoc服务，运行下面的命令，然后在浏览器中查看tp：/calhost：8000/pkg页面：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ godoc -http :8000</span><br></pre></td></tr></table></figure></p>
<p>其中-analysis=type 和-analysis-pointer命令行标志参数用于打开文档和代码中关于静态分析的结果。</p>
<p><strong>2，内部包</strong></p>
<p>原则上Go语言的封装只有两个特性，一个是私有的不可导出的成员，另一个是公开的可导出的成员。但有些时候需要一种中间状态一对一些包公开，对一些包不可见。这就引入了一个概念一内部包，在Go语言中，构建工具会对导入路径包含internal关键字的包做特殊处理。一个internal包只能被和internal目录有同一个父目录的包所导入。</p>
<p>例如，nethttp/intermal/chunked内部包只能被htthtptpttputil或nthttp包导入，但是不能被net/url包导入。不过net/url包却可以导入nttp/ttputil包：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net/http</span><br><span class="line">net/http/internal/chunked</span><br><span class="line">net/http/httputil</span><br><span class="line">net/url</span><br></pre></td></tr></table></figure></p>
<p><strong>3，查询包</strong></p>
<p>go list命令可以查询可用包的信息，其最简单的形式，可以测试包是否在工作区并打印它的导入路径：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go list github.com/go-sql-driver/mysql</span><br><span class="line">github.com/go-sql-driver/mysql</span><br></pre></td></tr></table></figure></p>
<p>go list命令的参数还可以用..表示匹配任意的包的导入路径，可以用它来列表工作区中的所有包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go list</span><br></pre></td></tr></table></figure></p>
<p>或者是特定子目录下的所有包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go list gopl.io/ch3/.</span><br><span class="line">gopl.io/ch3/basename1</span><br><span class="line">gopl.io/ch3/basename2</span><br></pre></td></tr></table></figure></p>
<p>或者是和某个主题相关的所有包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go list...xml.</span><br><span class="line">encoding/xml</span><br><span class="line">gopl.io/ch7/xmlselect</span><br></pre></td></tr></table></figure></p>
<p>go list命令还可以获取每个包完整的元数据，而不仅仅只是导入路径，这些元数据以不同格式提供给用户。其中-json命令行参数表示用JSON格式打印每个包的元数据：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ go list -json <span class="built_in">hash</span></span><br><span class="line"><span class="string">"Dir"</span>:<span class="string">"/home/gopher/go/src/hash"</span></span><br><span class="line"><span class="string">"ImportPath"</span>: <span class="string">"hash"</span>,</span><br><span class="line"><span class="string">"Name"</span>: <span class="string">"hash"</span>,</span><br><span class="line"><span class="string">"Doc"</span>: <span class="string">"Package hash provides interfaces for hash functions."</span>, <span class="string">"Target"</span>: <span class="string">"/home/gopher/go/pkg/darwin_amd64/hash.a"</span>,</span><br><span class="line"><span class="string">"Goroot"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"Standard"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"Root"</span>: <span class="string">"/home/gopher/go"</span>,</span><br><span class="line"><span class="string">"GoFiles"</span>:[</span><br><span class="line"><span class="string">"hash.go"</span></span><br><span class="line">]，</span><br><span class="line"><span class="string">"Imports"</span>:[</span><br><span class="line"><span class="string">"io'</span></span><br><span class="line"><span class="string">]，</span></span><br><span class="line"><span class="string">"</span>Deps<span class="string">":[</span></span><br><span class="line"><span class="string">"</span>errors<span class="string">",</span></span><br><span class="line"><span class="string">"</span>io<span class="string">".</span></span><br><span class="line"><span class="string">"</span>runtime<span class="string">",</span></span><br><span class="line"><span class="string">"</span>sync<span class="string">",</span></span><br><span class="line"><span class="string">"</span>sync/atomic<span class="string">",</span></span><br><span class="line"><span class="string">"</span>unsafe<span class="string">'</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">]</span></span><br></pre></td></tr></table></figure></p>
<p>查询时同样可以使用Go template格式化输出元数据。</p>
<h1 id="自定义包"><a href="#自定义包" class="headerlink" title="自定义包"></a><span style="color:#339AFF;">自定义包</span></h1><p>在前面提到的包的使用中，曾简单地介绍了如何新建一个包并导入到项目中。标准包为大多数的程序提供了必要的基础构件。而在Go语言的社区，有很多成熟的包被设计、共享、重用和改进。目前互联网上已经发布了非常多的Go语言开源包，它们可以通过<a href="http://godoc.org" target="_blank" rel="noopener">http://godoc.org</a>检索。本章将演示如果使用已有的包和创建新的包。</p>
<p>到目前为止，所有的例子都只在单个main包中。对于任何包，可以将它的代码分隔到多个文件中，只要这些文件在相同的目录中。比如使用单个main包，由多个单独的文件组成，并且在每个文件的第一条语句为package main。</p>
<p>对于大型的应用程序，可能想要将应用程序的功能按照逻辑单元划分成不同的包。同样，创建的包会被多个相似的应用程序使用。单个应用程序使用的包和跨应用程序使用的包没有什么差别，但是，可以创建一个隐式的差别，将单个应用程序专用包放到应用程序的子目录下，而多个程序共享包可以放到GOPATH的src目录。在GOPATH下的每一个目录都应该包含一个src的目录，这是Go语言规定的。</p>
<p>程序的源代码和包都应该放在GOPATH/src目录下的子目录中，打包之后还可以直接将自定义的包安装到GOROOT目录下。</p>
<h2 id="包的制作"><a href="#包的制作" class="headerlink" title="包的制作"></a><span style="color:#00ACC1;">包的制作</span></h2><p>创建自定义包最好是在GOPATH/src目录下（或者GOPATH/src下的其中一个子目录）。单个应用程序专用包可以在应用程序的目录中创建，而分享类型的包应当直接在GOPATH/src目录中创建。</p>
<p>按照约定，一个包的源代码放在和包名称相同的目录中。我们按自己喜欢的方式，将源代码划分到多个文件中，这些文件的名字可以是任意的（只要它们以.go结尾）。</p>
<p>如果在项目目录中执行go build命令，将获得一个可执行文件（名字为包名的可执行文件）。可是，如果想在GOPATH/bin目录中生成可执行文件，或者如果想让其他应用程序也可以使用这个包，必须使用go install安装。</p>
<p>当使用go install编译Go语言程序时，它将创建两个目录（如果不存在）：GOPATHbin创建对应可执行程序文件，GOPATH/pkg/linux_amd64/创建包含了静态的包的二进制库文件（以Linux64位为例）。</p>
<p>安装之后的包可以通过在Go语言程序中使用import”example/test”导入，这里给定的是完整的路径，除了GOPATH/src部分，实际上，GOPATH下的任何程序或者包都可以使用这种导入，因为Go语言不会区分应用程序专用的包和共享的包。</p>
<h2 id="特定平台的代码"><a href="#特定平台的代码" class="headerlink" title="特定平台的代码"></a><span style="color:#00ACC1;">特定平台的代码</span></h2><p>在某些情况下，需要不同平台的代码。比如，在类UNIX系统的shell中可以使用通配符，所以命令行中的*.txt可以在程序中接受，如[“README.txt”，”INSTALL.txt”]保存在 os.Args[1：]slice中。但是在Windows系统中，程序仅获得[“*.txt”]，因此可以在Windows 上使用filepath.Glob()函数达到同样的通配符功能。</p>
<p>在程序运行时决定是否使用filepath.Glob()的解决方案是通过runtime.GOOS==”windows”来判断当前运行时的操作系统为Windows。另一个解决方案是不同平台的代码放到对应的文件中，不同平台的文件可以定义名字相同但功能不同的函数。</p>
<p>当使用go build编译包时，在Linux的机器上会编译Linux平台的代码，而其他平台的文件将会被忽略。</p>
<h2 id="godoc生成文档"><a href="#godoc生成文档" class="headerlink" title="godoc生成文档"></a><span style="color:#00ACC1;">godoc生成文档</span></h2><p>Go语言的包，特别是对于打算分享的包，都需要一份规范的文档。Go语言提供了一个文档工具一godoc，它可以用来在控制台显示包的文档和函数，或者作为一个Web服务器，使得文档以网页的形式显示。</p>
<p>如果这个包在GOPATH下，godoc将自动找到它，并且在网页的左侧提供一个到这个包的链接。如果这个包没有在GOPATH下，可以运行godoc-path选项，将包的路径赋值给它。</p>
<p>本章不会讨论文档规范细节。在默认情况下，godoc只显示导出的types、classes、constants以及variables，所有这些都应该被文档化，文档是直接写在源文件中的。</p>
<p>对于一个包，在package语句之前添加整个包的描述，而第一句话是整个包的摘要：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map is a key-ordered map.</span></span><br><span class="line"><span class="comment">// The zero value is an invalid map! Use one of the construction functions // (e.g., New()),to create a map for a specific key type.</span></span><br><span class="line"><span class="keyword">type</span> Map <span class="keyword">struct</span> &#123;</span><br></pre></td></tr></table></figure></p>
<p>这个文档用于导出的类型，必须写在type语句之前，并且指明这个类型的零值是否有效：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// New returns an empty Map that uses the given less than function to</span></span><br><span class="line"><span class="number">11</span> compare keys. For example:</span><br><span class="line">|I</span><br><span class="line"><span class="keyword">type</span> Point &#123; X, Yint &#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">pointMap := omap.New(<span class="function"><span class="keyword">func</span><span class="params">(a,binterface&#123;&#125;)</span> <span class="title">bool</span></span>&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">a,B:=a.(Point),b.(Point)</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">if</span> a.X!=p.X&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">return</span> a.x&lt;B.x</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">return</span> a.Y&lt;B.Y</span><br><span class="line">II</span><br><span class="line">&#125;)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(less <span class="keyword">func</span>(<span class="keyword">interface</span>&#123;&#125;, <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>) *<span class="title">Map</span></span> &#123;</span><br></pre></td></tr></table></figure></p>
<p>这段文档用于函数和方法，它们必须写在函数的第一条语句之前，注释中的缩进最终会渲染为HTML的代码。</p>
<p>下面展示了一个便利的构造函数的文档：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Insert inserts a new key-value into the Map and returns true; or</span></span><br><span class="line">l/ replaces an existing key-value pair<span class="string">'s value if the keys are equal and</span></span><br><span class="line"><span class="string">// returns false. For example:</span></span><br><span class="line"><span class="string">//</span></span><br><span class="line"><span class="string">inserted := myMap.Insert(key, value).</span></span><br><span class="line"><span class="string">func (m *Map) Insert(key, value interface&#123;&#125;) (inserted bool) &#123;</span></span><br></pre></td></tr></table></figure></p>
<p>上面是Insert()方法的文档。需要稍加注意的是，在Go语言中有一个约定是函数和方法的文档，都是以这个函数或者方法的名称开始的，并且不要加上圆括号。</p>
<h2 id="包的打包与发布"><a href="#包的打包与发布" class="headerlink" title="包的打包与发布"></a><span style="color:#00ACC1;">包的打包与发布</span></h2><p>此处的打包发布不仅指Go语言包项目在本地编译和安装，还包括分发到其他设备系统中的打包方法。在前面的内容中，Go语言包的编译安装其实就是一个打包过程（go install命令），但这个过程仅针对本地而言，面向的是开发者们的打包发布方式。对于一些企业级用户而言，应该尽量把分发部署操作简化，最理想的状态就是把整个项目打包成一个文件，拿到这个文件的人可以直接执行就完成部署了。</p>
<p>目前Go语言的确能够实现这种高度集成的发布方式，而且还不止一种方式。目前社区中比较主流的处理方式有三种，一是使用Go.rice，还有就是使用Statik，最后一个是比较老旧但接口丰富的go-bindata，这三个项目的地址如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/GeertJohan/go.rice</span><br><span class="line">https://github.com/rakyll/statik</span><br><span class="line">https://github.com/jteeuwen/go-bindata</span><br></pre></td></tr></table></figure></p>
<p>安装这三个包的方式都是使用go get获取的：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get github.com/rakyll/statik</span><br><span class="line">goget github.com/GeertJohan/<span class="keyword">go</span>.rice</span><br><span class="line"><span class="keyword">go</span> get github.com/GeertJohan/<span class="keyword">go</span>.rice/rice #此处rice是一个单独的工具</span><br><span class="line">goget github.com/jteeuwen/<span class="keyword">go</span>-bindata</span><br><span class="line"><span class="number">1.</span><span class="keyword">go</span>.rice</span><br></pre></td></tr></table></figure></p>
<p>先说rice这个项目，它需要在main.go中导入这个包：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"github.com/GeertJohan/go.rice"</span></span><br></pre></td></tr></table></figure></p>
<p>go.rice相比其他几个项目不同的是，它不仅仅是一个打包工具，还是一个静态文件操作库，自带文件访问服务。rice会把一个目录认为是一个rice.Box来操作：</p>
<p>go.rice的打包命令是rice，用起来非常直接：在有使用go.rice操作的Go代码目录中，直接执行rice embed-go：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">￥1</span><br><span class="line">rice embed-go</span><br><span class="line">1g5amd</span><br><span class="line">rice -i <span class="string">"github.com/xx/</span></span><br></pre></td></tr></table></figure></p>
<p>ooo”embed-go#-i处理指定包里的go.rice操作<br>它会生成当前包名下的、嵌入了文件的代码文件rice-box.go。但是，它不递归处理 import，它会分析当前目录下的Go代码中go.rice的使用，找到对应的需要嵌入的文件夹。但是子目录下和import包里面的go.rice使用情况则不会分析，需要开发者手动进入相应文件夹执行命令，或者使用-i指定要处理的包。这样非常不友好，所以也是rice的一大缺憾。</p>
<p>不过rice是直接支持http.FileSystem接口的，可以实现类似Nginx静态资源访问的页面：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MustFindBox出错直接panic</span></span><br><span class="line">http. Handle(<span class="string">"/"</span>, http.FileServer(rice.MustFindBox(<span class="string">"theme"</span>) . HTTPBox()))</span><br><span class="line">http. ListenAndServe(<span class="string">":1234"</span>,<span class="literal">nil</span>)</span><br></pre></td></tr></table></figure></p>
<p>但是rice.FindBox（dir）只能加载一个目录，因此如果遇到多个目录的场景，可以这样写：</p>
<p><strong>2，statik</strong></p>
<p>根据上面命令进行安装之后即可使用，假设要把assets目录里的静态资源文件demo.txt嵌入到执行文件中，首先要导入statik这个包：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例代码7-3</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"io/ioutil'</span></span><br><span class="line"><span class="string">"</span>os<span class="string">"</span></span><br><span class="line"><span class="string">"</span>testProject/statik<span class="string">"//自动生成的目录"</span>github.com/rakyll/statik/fs<span class="string">"</span></span><br><span class="line"><span class="string">//开始构建之前先执行go generate</span></span><br><span class="line"><span class="string">func main()&#123;</span></span><br><span class="line"><span class="string">statikFs, err := fs.New()</span></span><br><span class="line"><span class="string">if err !=nil&#123;</span></span><br><span class="line"><span class="string">fmt.Printf("</span>err:%v\n<span class="string">",err)</span></span><br><span class="line"><span class="string">os.Exit(1)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">//导入的目录路径和上面rice的用法一样</span></span><br><span class="line"><span class="string">file, err :=statikFs.open("</span>/assets/demo.txt<span class="string">") if err != nil&#123;</span></span><br><span class="line"><span class="string">fmt. Printf("</span>err:%v\n<span class="string">",err)</span></span><br><span class="line"><span class="string">os.Exit(1)</span></span><br><span class="line"><span class="string">//读取文件内容并输出</span></span><br><span class="line"><span class="string">content, err := ioutil.ReadAll(file) if err !=nil&#123;</span></span><br><span class="line"><span class="string">fmt.Printf("</span>err:%v\n<span class="string">",err) os.Exit(1)</span></span><br><span class="line"><span class="string">fmt.Printf("</span>content: %s\n<span class="string">", content)</span></span><br><span class="line"><span class="string">7]</span></span><br></pre></td></tr></table></figure></p>
<p>然后执行：statik-src=./assets &amp; go generate，这段代码的功能就是从statikFS提供的文件系统接口获取/assets/demo.txt这个文件的内容并输出，可以看到操作起来和操作普通文件的方法基本一致。</p>
<p>上面命令会生成一个statik目录，里面存放的是自动生成的Go文件，所有assets下的文件变成一个压缩后的字符串放在这个文件中，并且在程序启动时会解析这个字符串，构造一个http.FileSystem对象，之后就可以使用对文件系统类似的操作来获取文件内容。</p>
<p>statik同样也实现了标准库中的http.FileSystem接口，所以也可以直接使用http包提供静态资源的访问服务，关键部分代码如下：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(</span><br><span class="line"><span class="string">"github.com/rakyll/statik/fs"</span></span><br><span class="line"><span class="string">"testProject/statik/statik'</span></span><br><span class="line"><span class="string">statikFs, err :=fs.New()</span></span><br><span class="line"><span class="string">if err !=nil&#123;</span></span><br><span class="line"><span class="string">log.Fatal(err)</span></span><br><span class="line"><span class="string">7</span></span><br><span class="line"><span class="string">http.Handle("</span>/assets/<span class="string">", http.stripPrefix("</span>/assets/<span class="string">", http.FileServer(statikFS))) http.ListenAndServe("</span>:<span class="number">8080</span><span class="string">",nil)</span></span><br></pre></td></tr></table></figure></p>
<p>现在编译执行之后，可以在ttp://localhost:8080/assets/中看到打包后的那些文件。</p>
<p><strong>3，go-bindata</strong></p>
<p>安装go-bindata命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/jteeuwen/go-bindata/..</span><br></pre></td></tr></table></figure></p>
<p>注意goget地址最后有三个点，这样安装时会分析所有子目录并下载依赖编译子目录内容。go-bindata的命令工具在子目录中（上面的rice项目也可以使用类似的方式安装而不用输入两次go get命令）。</p>
<p>最简单的用法就是：go-bindata data/，它会在当前工作目录中生成一个bindata.go文件，并打包data目录中的所有资源文件（如果要递归子文件夹应该加上三个点：go-bindatadata…)。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go-bindata -o=data/asset.go -pkg=data</span><br></pre></td></tr></table></figure></p>
<p>source/… theme/…doc/src/…doc/images/…上面是一个稍微复杂的用法，其中-o表示输出文件到datalasset.go，包名-pkg=data，然后是需要打包的目录，三个点包括所有子目录。这样就可以把所有相关文件打包到asset.go中，包名为package data，保持和目录一致。</p>
<p>接下来是释放静态文件的代码：<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dirs ：=[]<span class="keyword">string</span>&#123;<span class="string">"source"</span>，<span class="string">"theme"</span>，<span class="string">"doc"</span>&#125;<span class="comment">//设置需要释放的目录</span></span><br><span class="line">for_, dir := <span class="keyword">range</span> dirs &#123;</span><br></pre></td></tr></table></figure></p>
<p>asset.go内的静态内容根据实际的目录位置索引，所以可以直接通过目录或者文件地址去操作。</p>
<p>go-bindata支持开发模式，即不嵌入静态内容，只生成操作方法到输出的Go代码中，在命令后面加上-debug即可。</p>
<p>-debug参数生成的代码会直接将静态文件读取到内存，而不是编码到代码中。这使得代码文件更小，你可以更快速地编写业务逻辑，等到一切正常再一次性打包，不必每次花费时间在打包上。<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-pkg=asset，打包的包名是asset</span></span><br><span class="line">bytes，err ：= asset.Asset（<span class="string">"theme/default/post.html"</span>）<span class="comment">//根据地址获取对应内容if err !=nil&#123;</span></span><br><span class="line">fmt. Println(err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">t, err :=template.New(<span class="string">"tpl"</span>).Parse(<span class="keyword">string</span>(bytes))</span><br><span class="line"><span class="comment">//比如用于模板处理</span></span><br><span class="line">fmt. Println(t,err)</span><br></pre></td></tr></table></figure></p>
<p>使用-ignore参数可以忽略某些文件夹，除此之外go-bindata的第三方包go-bindatassetts还实现了HTTP静态文件服务接口，支持HTTP访问静态文件目录。 扩展包地址:ttp://github.com/elazar/go-bindata-assetfs.</p>
<p>以我们上面编译好的asset.go为例：</p>
<p>访问ttp://localhost:1234，就可以看到嵌入的source、theme、doc三个目录的列表页面，和Nginx查看静态文件目录是类似的。<br>和中链琳特内态领的内0</p>
<h2 id="自定义包的导入"><a href="#自定义包的导入" class="headerlink" title="自定义包的导入"></a><span style="color:#00ACC1;">自定义包的导入</span></h2><p>自定义包的导入与7.1.2并无差别，不过Go语言允许对导入的包使用别名来标识，这使得开发者可以在不同应用场景下切换导入的包而不改变应用原有的业务代码。例如，开发中的项目有一个专门提供API接口的模块被打包为一个模块包，api包拥有多个版本（例如api_v1、api_v2等），但在实际业务代码中，只需把api包导入并命名为api（例如 import api “api_v1”），此后切换版本只需改动api_v1为api_v2即可（即为import api “api_v2”)。</p>
<p>以上都基于一个前提，那便是api_vl和api_v2的API必须是兼容的，这样其余所有的代码都不需要做任何改动。对于导入的第三方包，不要使用标准库的包名作为别名，也别对标准库的包使用自定义的别名，避免造成不必要的误会。</p>
<p>之前在第5章提到过，当导入一个包时，它所有的init函数就会被执行。有些时候并非真的需要使用这些包，仅仅是希望它的init函数被执行而已。</p>
<p>例如下面例子中（Docker日志驱动的初始化代码），导入了不少项目模块的包，但并不意味着这个文件的代码会用到这些包里面的某些函数：udigl：aodd：t过3</p>
<p>这个例子中导入了众多logger模块，这些模块内部的函数并不会被当前文件调用，只有在导入daemon模块的文件（import “daemon”）时才会执行这些包的init()函数用于初始化，init()函数会为daemon包注册这些导入的日志引擎。由于没有用到这些包提供的功能，所以可以把这些包的别名都写为空白标识符。</p>
<h1 id="本章小结"><a href="#本章小结" class="headerlink" title="本章小结"></a><span style="color:#339AFF;">本章小结</span></h1><p>在Go语言中包是组织代码的基本单位。环境变量GOPATH决定了Go语言源代码在磁盘上被保存、编译和安装的位置，可以为每个工程设置不同的GOPATH，以保持源代码和依赖的隔离。</p>
<p>Go语言工具是最常用的开发工具，开发人员可以使用goget来获取别人的包并将其安装到自己的GOPATH指定的目录。想要为别人创建包很简单，只要把源代码放到公用代码库，并遵守一些简单的规则就可以了，Go语言在设计时将分享代码作为语言的核心特性和驱动力。</p>
<p>推荐使用依赖管理工具来管理依赖，有很多社区开发的依赖管理工具，如godep、vender和gb都是很不错的包管理工具。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Go语言编程入门与实战技巧/" rel="tag"># Go语言编程入门与实战技巧</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/09/08/第6章-复合数据类型/" rel="next" title="第6章 复合数据类型">
                <i class="fa fa-chevron-left"></i> 第6章 复合数据类型
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/09/08/第8章-结构体与方法/" rel="prev" title="第8章 结构体与方法">
                第8章 结构体与方法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="CheBin">
            
              <p class="site-author-name" itemprop="name">CheBin</p>
              <div class="site-description motion-element" itemprop="description">什么是强迫自己？就是不想去干什么，就去干什么</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">983</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">69</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          


          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/2023/03/20/47丨如何利用SQL对零售数据进行分析？/" title="47丨如何利用SQL对零售数据进行分析？" target="_blank">47丨如何利用SQL对零售数据进行分析？</a>
                  </li>
                
                  <li>
                    <a href="/2023/03/20/26丨索引的使用原则：如何通过索引让SQL查询效率最大化？/" title="26丨索引的使用原则：如何通过索引让SQL查询效率最大化？" target="_blank">26丨索引的使用原则：如何通过索引让SQL查询效率最大化？</a>
                  </li>
                
                  <li>
                    <a href="/2023/03/20/23丨索引的概览：用还是不用索引，这是一个问题/" title="23丨索引的概览：用还是不用索引，这是一个问题" target="_blank">23丨索引的概览：用还是不用索引，这是一个问题</a>
                  </li>
                
                  <li>
                    <a href="/2023/03/20/15丨初识事务隔离：隔离的级别有哪些，它们都解决了哪些异常问题？/" title="15丨初识事务隔离：隔离的级别有哪些，它们都解决了哪些异常问题？" target="_blank">15丨初识事务隔离：隔离的级别有哪些，它们都解决了哪些异常问题？</a>
                  </li>
                
                  <li>
                    <a href="/2023/03/14/17-消息队列：秒杀时如何处理每秒上万次的下单请求？/" title="17丨消息队列：秒杀时如何处理每秒上万次的下单请求？" target="_blank">17丨消息队列：秒杀时如何处理每秒上万次的下单请求？</a>
                  </li>
                
              </ul>
            </div>
        

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#包的基础"><span class="nav-number">1.</span> <span class="nav-text">包的基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#包的结构"><span class="nav-number">1.1.</span> <span class="nav-text">包的结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#包的导入"><span class="nav-number">1.2.</span> <span class="nav-text">包的导入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#包的使用"><span class="nav-number">1.3.</span> <span class="nav-text">包的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Go语言工具箱"><span class="nav-number">1.4.</span> <span class="nav-text">Go语言工具箱</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#自定义包"><span class="nav-number">2.</span> <span class="nav-text">自定义包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#包的制作"><span class="nav-number">2.1.</span> <span class="nav-text">包的制作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#特定平台的代码"><span class="nav-number">2.2.</span> <span class="nav-text">特定平台的代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#godoc生成文档"><span class="nav-number">2.3.</span> <span class="nav-text">godoc生成文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#包的打包与发布"><span class="nav-number">2.4.</span> <span class="nav-text">包的打包与发布</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义包的导入"><span class="nav-number">2.5.</span> <span class="nav-text">自定义包的导入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#本章小结"><span class="nav-number">3.</span> <span class="nav-text">本章小结</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CheBin</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">8.1m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">122:39</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
