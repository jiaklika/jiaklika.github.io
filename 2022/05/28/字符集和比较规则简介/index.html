<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta name="keywords" content="MySQL是怎样运行的：从根儿上理解MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="字符集和比较规则简介">
<meta property="og:url" content="http://yoursite.com/2022/05/28/字符集和比较规则简介/index.html">
<meta property="og:site_name" content="车斌的技术博客">
<meta property="og:description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2022-09-08T09:21:38.281Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="字符集和比较规则简介">
<meta name="twitter:description" content="思考并回答以下问题：  总结一下，这章作者最主要想表达什么观点？">






  <link rel="canonical" href="http://yoursite.com/2022/05/28/字符集和比较规则简介/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>字符集和比较规则简介 | 车斌的技术博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">车斌的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">放弃会成为一种习惯</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/05/28/字符集和比较规则简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CheBin">
      <meta itemprop="description" content="什么是强迫自己？就是不想去干什么，就去干什么">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="车斌的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">字符集和比较规则简介

              
            
          </h1>
        

        <div class="post-meta">

          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2022-05-28 17:20:01" itemprop="dateCreated datePublished" datetime="2022-05-28T17:20:01+08:00">2022-05-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2022-09-08 17:21:38" itemprop="dateModified" datetime="2022-09-08T17:21:38+08:00">2022-09-08</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">21k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">19 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>思考并回答以下问题：</p>
<ul>
<li>总结一下，这章作者最主要想表达什么观点？</li>
</ul>
<a id="more"></a>
<p>字符集简介<br>我们知道在计算机中只能存储二进制数据，那该怎么存储字符串呢？当然是建立字符与二进制数据的映射关系了，建立这个关系最起码要搞清楚两件事儿：</p>
<p>你要把哪些字符映射成二进制数据？</p>
<p>也就是界定清楚字符范围。</p>
<p>怎么映射？</p>
<p>将一个字符映射成一个二进制数据的过程也叫做编码，将一个二进制数据映射到一个字符的过程叫做解码。</p>
<p>人们抽象出一个字符集的概念来描述某个字符范围的编码规则。比方说我们来自定义一个名称为xiaohaizi的字符集，它包含的字符范围和编码规则如下：</p>
<p>包含字符’a’、’b’、’A’、’B’。</p>
<p>编码规则如下：</p>
<p>采用1个字节编码一个字符的形式，字符和字节的映射关系如下：</p>
<p>‘a’ -&gt; 00000001 (十六进制：0x01)<br>‘b’ -&gt; 00000010 (十六进制：0x02)<br>‘A’ -&gt; 00000011 (十六进制：0x03)<br>‘B’ -&gt; 00000100 (十六进制：0x04)<br>有了xiaohaizi字符集，我们就可以用二进制形式表示一些字符串了，下边是一些字符串用xiaohaizi字符集编码后的二进制表示：</p>
<p>‘bA’ -&gt; 0000001000000011  (十六进制：0x0203)<br>‘baB’ -&gt; 000000100000000100000100  (十六进制：0x020104)<br>‘cd’ -&gt; 无法表示，字符集xiaohaizi不包含字符’c’和’d’<br>比较规则简介<br>在我们确定了xiaohaizi字符集表示字符的范围以及编码规则后，怎么比较两个字符的大小呢？最容易想到的就是直接比较这两个字符对应的二进制编码的大小，比方说字符’a’的编码为0x01，字符’b’的编码为0x02，所以’a’小于’b’，这种简单的比较规则也可以被称为二进制比较规则，英文名为binary collation。</p>
<p>二进制比较规则是简单，但有时候并不符合现实需求，比如在很多场合对于英文字符我们都是不区分大小写的，也就是说’a’和’A’是相等的，在这种场合下就不能简单粗暴的使用二进制比较规则了，这时候我们可以这样指定比较规则：</p>
<p>将两个大小写不同的字符全都转为大写或者小写。<br>再比较这两个字符对应的二进制数据。<br>这是一种稍微复杂一点点的比较规则，但是实际生活中的字符不止英文字符一种，比如我们的汉字有几万之多，对于某一种字符集来说，比较两个字符大小的规则可以制定出很多种，也就是说同一种字符集可以有多种比较规则，我们稍后就要介绍各种现实生活中用的字符集以及它们的一些比较规则。</p>
<p>一些重要的字符集<br>不幸的是，这个世界太大了，不同的人制定出了好多种字符集，它们表示的字符范围和用到的编码规则可能都不一样。我们看一下一些常用字符集的情况：</p>
<p>ASCII字符集</p>
<p>共收录128个字符，包括空格、标点符号、数字、大小写字母和一些不可见字符。由于总共才128个字符，所以可以使用1个字节来进行编码，我们看一些字符的编码方式：</p>
<p>‘L’ -&gt;  01001100（十六进制：0x4C，十进制：76）<br>‘M’ -&gt;  01001101（十六进制：0x4D，十进制：77）<br>ISO 8859-1字符集</p>
<p>共收录256个字符，是在ASCII字符集的基础上又扩充了128个西欧常用字符(包括德法两国的字母)，也可以使用1个字节来进行编码。这个字符集也有一个别名latin1。</p>
<p>GB2312字符集</p>
<p>收录了汉字以及拉丁字母、希腊字母、日文平假名及片假名字母、俄语西里尔字母。其中收录汉字6763个，其他文字符号682个。同时这种字符集又兼容ASCII字符集，所以在编码方式上显得有些奇怪：</p>
<p>如果该字符在ASCII字符集中，则采用1字节编码。<br>否则采用2字节编码。<br>这种表示一个字符需要的字节数可能不同的编码方式称为变长编码方式。比方说字符串’爱u’，其中’爱’需要用2个字节进行编码，编码后的十六进制表示为0xB0AE，’u’需要用1个字节进行编码，编码后的十六进制表示为0x75，所以拼合起来就是0xB0AE75。</p>
<p>小贴士：</p>
<p>我们怎么区分某个字节代表一个单独的字符还是代表某个字符的一部分呢？别忘了<code>ASCII</code>字符集只收录128个字符，使用0～127就可以表示全部字符，所以如果某个字节是在0～127之内的，就意味着一个字节代表一个单独的字符，否则就是两个字节代表一个单独的字符。<br>GBK字符集</p>
<p>GBK字符集只是在收录字符范围上对GB2312字符集作了扩充，编码方式上兼容GB2312。</p>
<p>utf8字符集</p>
<p>收录地球上能想到的所有字符，而且还在不断扩充。这种字符集兼容ASCII字符集，采用变长编码方式，编码一个字符需要使用1～4个字节，比方说这样：</p>
<p>‘L’ -&gt;  01001100（十六进制：0x4C）<br>‘啊’ -&gt;  111001011001010110001010（十六进制：0xE5958A）<br>小贴士：</p>
<p>其实准确的说，utf8只是Unicode字符集的一种编码方案，Unicode字符集可以采用utf8、utf16、utf32这几种编码方案，utf8使用1～4个字节编码一个字符，utf16使用2个或4个字节编码一个字符，utf32使用4个字节编码一个字符。更详细的Unicode和其编码方案的知识不是本书的重点，大家上网查查哈～</p>
<p>MySQL中并不区分字符集和编码方案的概念，所以后边唠叨的时候把utf8、utf16、utf32都当作一种字符集对待。<br>对于同一个字符，不同字符集也可能有不同的编码方式。比如对于汉字’我’来说，ASCII字符集中根本没有收录这个字符，utf8和gb2312字符集对汉字我的编码方式如下：</p>
<p>utf8编码：111001101000100010010001 (3个字节，十六进制表示是：0xE68891)<br>gb2312编码：1100111011010010 (2个字节，十六进制表示是：0xCED2)<br>MySQL中支持的字符集和排序规则<br>MySQL中的utf8和utf8mb4<br>我们上边说utf8字符集表示一个字符需要使用1～4个字节，但是我们常用的一些字符使用1～3个字节就可以表示了。而在MySQL中字符集表示一个字符所用最大字节长度在某些方面会影响系统的存储和性能，所以设计MySQL的大叔偷偷的定义了两个概念：</p>
<p>utf8mb3：阉割过的utf8字符集，只使用1～3个字节表示字符。</p>
<p>utf8mb4：正宗的utf8字符集，使用1～4个字节表示字符。</p>
<p>有一点需要大家十分的注意，在MySQL中utf8是utf8mb3的别名，所以之后在MySQL中提到utf8就意味着使用1~3个字节来表示一个字符，如果大家有使用4字节编码一个字符的情况，比如存储一些emoji表情啥的，那请使用utf8mb4。</p>
<p>字符集的查看<br>MySQL支持好多好多种字符集，查看当前MySQL中支持的字符集可以用下边这个语句：</p>
<p>SHOW (CHARACTER SET|CHARSET) [LIKE 匹配的模式];<br>其中CHARACTER SET和CHARSET是同义词，用任意一个都可以。我们查询一下（支持的字符集太多了，我们省略了一些）：</p>
<p>mysql&gt; SHOW CHARSET;<br>+—————+————————————————-+——————————-+————+<br>| Charset  | Description                     | Default collation   | Maxlen |<br>+—————+————————————————-+——————————-+————+<br>| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |<br>…<br>| latin1   | cp1252 West European            | latin1_swedish_ci   |      1 |<br>| latin2   | ISO 8859-2 Central European     | latin2_general_ci   |      1 |<br>…<br>| ascii    | US ASCII                        | ascii_general_ci    |      1 |<br>…<br>| gb2312   | GB2312 Simplified Chinese       | gb2312_chinese_ci   |      2 |<br>…<br>| gbk      | GBK Simplified Chinese          | gbk_chinese_ci      |      2 |<br>| latin5   | ISO 8859-9 Turkish              | latin5_turkish_ci   |      1 |<br>…<br>| utf8     | UTF-8 Unicode                   | utf8_general_ci     |      3 |<br>| ucs2     | UCS-2 Unicode                   | ucs2_general_ci     |      2 |<br>…<br>| latin7   | ISO 8859-13 Baltic              | latin7_general_ci   |      1 |<br>| utf8mb4  | UTF-8 Unicode                   | utf8mb4_general_ci  |      4 |<br>| utf16    | UTF-16 Unicode                  | utf16_general_ci    |      4 |<br>| utf16le  | UTF-16LE Unicode                | utf16le_general_ci  |      4 |<br>…<br>| utf32    | UTF-32 Unicode                  | utf32_general_ci    |      4 |<br>| binary   | Binary pseudo charset           | binary              |      1 |<br>…<br>| gb18030  | China National Standard GB18030 | gb18030_chinese_ci  |      4 |<br>+—————+————————————————-+——————————-+————+<br>41 rows in set (0.01 sec)<br>可以看到，我使用的这个MySQL版本一共支持41种字符集，其中的Default collation列表示这种字符集中一种默认的比较规则。大家注意返回结果中的最后一列Maxlen，它代表该种字符集表示一个字符最多需要几个字节。为了让大家的印象更深刻，我把几个常用到的字符集的Maxlen列摘抄下来，大家务必记住：</p>
<p>字符集名称    Maxlen<br>ascii    1<br>latin1    1<br>gb2312    2<br>gbk    2<br>utf8    3<br>utf8mb4    4<br>比较规则的查看<br>查看MySQL中支持的比较规则的命令如下：</p>
<p>SHOW COLLATION [LIKE 匹配的模式];<br>我们前边说过一种字符集可能对应着若干种比较规则，MySQL支持的字符集就已经非常多了，所以支持的比较规则更多，我们先只查看一下utf8字符集下的比较规则：</p>
<p>mysql&gt; SHOW COLLATION LIKE ‘utf8_%’;<br>+—————————————+————-+——-+————-+—————+————-+<br>| Collation                | Charset | Id  | Default | Compiled | Sortlen |<br>+—————————————+————-+——-+————-+—————+————-+<br>| utf8_general_ci          | utf8    |  33 | Yes     | Yes      |       1 |<br>| utf8_bin                 | utf8    |  83 |         | Yes      |       1 |<br>| utf8_unicode_ci          | utf8    | 192 |         | Yes      |       8 |<br>| utf8_icelandic_ci        | utf8    | 193 |         | Yes      |       8 |<br>| utf8_latvian_ci          | utf8    | 194 |         | Yes      |       8 |<br>| utf8_romanian_ci         | utf8    | 195 |         | Yes      |       8 |<br>| utf8_slovenian_ci        | utf8    | 196 |         | Yes      |       8 |<br>| utf8_polish_ci           | utf8    | 197 |         | Yes      |       8 |<br>| utf8_estonian_ci         | utf8    | 198 |         | Yes      |       8 |<br>| utf8_spanish_ci          | utf8    | 199 |         | Yes      |       8 |<br>| utf8_swedish_ci          | utf8    | 200 |         | Yes      |       8 |<br>| utf8_turkish_ci          | utf8    | 201 |         | Yes      |       8 |<br>| utf8_czech_ci            | utf8    | 202 |         | Yes      |       8 |<br>| utf8_danish_ci           | utf8    | 203 |         | Yes      |       8 |<br>| utf8_lithuanian_ci       | utf8    | 204 |         | Yes      |       8 |<br>| utf8_slovak_ci           | utf8    | 205 |         | Yes      |       8 |<br>| utf8_spanish2_ci         | utf8    | 206 |         | Yes      |       8 |<br>| utf8_roman_ci            | utf8    | 207 |         | Yes      |       8 |<br>| utf8_persian_ci          | utf8    | 208 |         | Yes      |       8 |<br>| utf8_esperanto_ci        | utf8    | 209 |         | Yes      |       8 |<br>| utf8_hungarian_ci        | utf8    | 210 |         | Yes      |       8 |<br>| utf8_sinhala_ci          | utf8    | 211 |         | Yes      |       8 |<br>| utf8_german2_ci          | utf8    | 212 |         | Yes      |       8 |<br>| utf8_croatian_ci         | utf8    | 213 |         | Yes      |       8 |<br>| utf8_unicode_520_ci      | utf8    | 214 |         | Yes      |       8 |<br>| utf8_vietnamese_ci       | utf8    | 215 |         | Yes      |       8 |<br>| utf8_general_mysql500_ci | utf8    | 223 |         | Yes      |       1 |<br>+—————————————+————-+——-+————-+—————+————-+<br>27 rows in set (0.00 sec)<br>这些比较规则的命名还挺有规律的，具体规律如下：</p>
<p>比较规则名称以与其关联的字符集的名称开头。如上图的查询结果的比较规则名称都是以utf8开头的。</p>
<p>后边紧跟着该比较规则主要作用于哪种语言，比如utf8_polish_ci表示以波兰语的规则比较，utf8_spanish_ci是以西班牙语的规则比较，utf8_general_ci是一种通用的比较规则。</p>
<p>名称后缀意味着该比较规则是否区分语言中的重音、大小写啥的，具体可以用的值如下：</p>
<p>后缀    英文释义    描述<br>_ai    accent insensitive    不区分重音<br>_as    accent sensitive    区分重音<br>_ci    case insensitive    不区分大小写<br>_cs    case sensitive    区分大小写<br>_bin    binary    以二进制方式比较<br>比如utf8_general_ci这个比较规则是以ci结尾的，说明不区分大小写。</p>
<p>每种字符集对应若干种比较规则，每种字符集都有一种默认的比较规则，SHOW COLLATION的返回结果中的Default列的值为YES的就是该字符集的默认比较规则，比方说utf8字符集默认的比较规则就是utf8_general_ci。</p>
<p>字符集和比较规则的应用<br>各级别的字符集和比较规则<br>MySQL有4个级别的字符集和比较规则，分别是：</p>
<p>服务器级别<br>数据库级别<br>表级别<br>列级别<br>我们接下来仔细看一下怎么设置和查看这几个级别的字符集和比较规则。</p>
<p>服务器级别<br>MySQL提供了两个系统变量来表示服务器级别的字符集和比较规则：</p>
<p>系统变量    描述<br>character_set_server    服务器级别的字符集<br>collation_server    服务器级别的比较规则<br>我们看一下这两个系统变量的值：</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_server’;<br>+———————————+———-+<br>| Variable_name        | Value |<br>+———————————+———-+<br>| character_set_server | utf8  |<br>+———————————+———-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘collation_server’;<br>+—————————+————————-+<br>| Variable_name    | Value           |<br>+—————————+————————-+<br>| collation_server | utf8_general_ci |<br>+—————————+————————-+<br>1 row in set (0.00 sec)</p>
<p>可以看到在我的计算机中服务器级别默认的字符集是utf8，默认的比较规则是utf8_general_ci。</p>
<p>我们可以在启动服务器程序时通过启动选项或者在服务器程序运行过程中使用SET语句修改这两个变量的值。比如我们可以在配置文件中这样写：</p>
<p>[server]<br>character_set_server=gbk<br>collation_server=gbk_chinese_ci<br>当服务器启动的时候读取这个配置文件后这两个系统变量的值便修改了。</p>
<p>数据库级别<br>我们在创建和修改数据库的时候可以指定该数据库的字符集和比较规则，具体语法如下：</p>
<p>CREATE DATABASE 数据库名<br>    [[DEFAULT] CHARACTER SET 字符集名称]<br>    [[DEFAULT] COLLATE 比较规则名称];</p>
<p>ALTER DATABASE 数据库名<br>    [[DEFAULT] CHARACTER SET 字符集名称]<br>    [[DEFAULT] COLLATE 比较规则名称];<br>其中的DEFAULT可以省略，并不影响语句的语义。比方说我们新创建一个名叫charset_demo_db的数据库，在创建的时候指定它使用的字符集为gb2312，比较规则为gb2312_chinese_ci：</p>
<p>mysql&gt; CREATE DATABASE charset_demo_db<br>    -&gt; CHARACTER SET gb2312<br>    -&gt; COLLATE gb2312_chinese_ci;<br>Query OK, 1 row affected (0.01 sec)<br>如果想查看当前数据库使用的字符集和比较规则，可以查看下面两个系统变量的值（前提是使用USE语句选择当前默认数据库，如果没有默认数据库，则变量与相应的服务器级系统变量具有相同的值）：</p>
<p>系统变量    描述<br>character_set_database    当前数据库的字符集<br>collation_database    当前数据库的比较规则<br>我们来查看一下刚刚创建的charset_demo_db数据库的字符集和比较规则：</p>
<p>mysql&gt; USE charset_demo_db;<br>Database changed</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_database’;<br>+————————————+————+<br>| Variable_name          | Value  |<br>+————————————+————+<br>| character_set_database | gb2312 |<br>+————————————+————+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘collation_database’;<br>+——————————+—————————-+<br>| Variable_name      | Value             |<br>+——————————+—————————-+<br>| collation_database | gb2312_chinese_ci |<br>+——————————+—————————-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt;<br>可以看到这个charset_demo_db数据库的字符集和比较规则就是我们在创建语句中指定的。需要注意的一点是： character_set_database 和 collation_database 这两个系统变量是只读的，我们不能通过修改这两个变量的值而改变当前数据库的字符集和比较规则。</p>
<p>数据库的创建语句中也可以不指定字符集和比较规则，比如这样：</p>
<p>CREATE DATABASE 数据库名;<br>这样的话将使用服务器级别的字符集和比较规则作为数据库的字符集和比较规则。</p>
<p>表级别<br>我们也可以在创建和修改表的时候指定表的字符集和比较规则，语法如下：</p>
<p>CREATE TABLE 表名 (列的信息)<br>    [[DEFAULT] CHARACTER SET 字符集名称]<br>    [COLLATE 比较规则名称]]</p>
<p>ALTER TABLE 表名<br>    [[DEFAULT] CHARACTER SET 字符集名称]<br>    [COLLATE 比较规则名称]<br>比方说我们在刚刚创建的charset_demo_db数据库中创建一个名为t的表，并指定这个表的字符集和比较规则：</p>
<p>mysql&gt; CREATE TABLE t(<br>    -&gt;     col VARCHAR(10)<br>    -&gt; ) CHARACTER SET utf8 COLLATE utf8_general_ci;<br>Query OK, 0 rows affected (0.03 sec)<br>如果创建和修改表的语句中没有指明字符集和比较规则，将使用该表所在数据库的字符集和比较规则作为该表的字符集和比较规则。假设我们的创建表t的语句是这么写的：</p>
<p>CREATE TABLE t(<br>    col VARCHAR(10)<br>);<br>因为表t的建表语句中并没有明确指定字符集和比较规则，则表t的字符集和比较规则将继承所在数据库charset_demo_db的字符集和比较规则，也就是gb2312和gb2312_chinese_ci。</p>
<p>列级别<br>需要注意的是，对于存储字符串的列，同一个表中的不同的列也可以有不同的字符集和比较规则。我们在创建和修改列定义的时候可以指定该列的字符集和比较规则，语法如下：</p>
<p>CREATE TABLE 表名(<br>    列名 字符串类型 [CHARACTER SET 字符集名称] [COLLATE 比较规则名称],<br>    其他列…<br>);</p>
<p>ALTER TABLE 表名 MODIFY 列名 字符串类型 [CHARACTER SET 字符集名称] [COLLATE 比较规则名称];<br>比如我们修改一下表t中列col的字符集和比较规则可以这么写：</p>
<p>mysql&gt; ALTER TABLE t MODIFY col VARCHAR(10) CHARACTER SET gbk COLLATE gbk_chinese_ci;<br>Query OK, 0 rows affected (0.04 sec)<br>Records: 0  Duplicates: 0  Warnings: 0</p>
<p>mysql&gt;<br>对于某个列来说，如果在创建和修改的语句中没有指明字符集和比较规则，将使用该列所在表的字符集和比较规则作为该列的字符集和比较规则。比方说表t的字符集是utf8，比较规则是utf8_general_ci，修改列col的语句是这么写的：</p>
<p>ALTER TABLE t MODIFY col VARCHAR(10);<br>那列col的字符集和编码将使用表t的字符集和比较规则，也就是utf8和utf8_general_ci。</p>
<p>小贴士：</p>
<p>在转换列的字符集时需要注意，如果转换前列中存储的数据不能用转换后的字符集进行表示会发生错误。比方说原先列使用的字符集是utf8，列中存储了一些汉字，现在把列的字符集转换为ascii的话就会出错，因为ascii字符集并不能表示汉字字符。<br>仅修改字符集或仅修改比较规则<br>由于字符集和比较规则是互相有联系的，如果我们只修改了字符集，比较规则也会跟着变化，如果只修改了比较规则，字符集也会跟着变化，具体规则如下：</p>
<p>只修改字符集，则比较规则将变为修改后的字符集默认的比较规则。<br>只修改比较规则，则字符集将变为修改后的比较规则对应的字符集。<br>不论哪个级别的字符集和比较规则，这两条规则都适用，我们以服务器级别的字符集和比较规则为例来看一下详细过程：</p>
<p>只修改字符集，则比较规则将变为修改后的字符集默认的比较规则。</p>
<p>mysql&gt; SET character_set_server = gb2312;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_server’;<br>+———————————+————+<br>| Variable_name        | Value  |<br>+———————————+————+<br>| character_set_server | gb2312 |<br>+———————————+————+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt;  SHOW VARIABLES LIKE ‘collation_server’;<br>+—————————+—————————-+<br>| Variable_name    | Value             |<br>+—————————+—————————-+<br>| collation_server | gb2312_chinese_ci |<br>+—————————+—————————-+<br>1 row in set (0.00 sec)<br>我们只修改了character_set_server的值为gb2312，collation_server的值自动变为了gb2312_chinese_ci。</p>
<p>只修改比较规则，则字符集将变为修改后的比较规则对应的字符集。</p>
<p>mysql&gt; SET collation_server = utf8_general_ci;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_server’;<br>+———————————+———-+<br>| Variable_name        | Value |<br>+———————————+———-+<br>| character_set_server | utf8  |<br>+———————————+———-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘collation_server’;<br>+—————————+————————-+<br>| Variable_name    | Value           |<br>+—————————+————————-+<br>| collation_server | utf8_general_ci |<br>+—————————+————————-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt;<br>我们只修改了collation_server的值为utf8_general_ci，character_set_server的值自动变为了utf8。</p>
<p>各级别字符集和比较规则小结<br>我们介绍的这4个级别字符集和比较规则的联系如下：</p>
<p>如果创建或修改列时没有显式的指定字符集和比较规则，则该列默认用表的字符集和比较规则<br>如果创建表时没有显式的指定字符集和比较规则，则该表默认用数据库的字符集和比较规则<br>如果创建数据库时没有显式的指定字符集和比较规则，则该数据库默认用服务器的字符集和比较规则<br>知道了这些规则之后，对于给定的表，我们应该知道它的各个列的字符集和比较规则是什么，从而根据这个列的类型来确定存储数据时每个列的实际数据占用的存储空间大小了。比方说我们向表t中插入一条记录：</p>
<p>mysql&gt; INSERT INTO t(col) VALUES(‘我我’);<br>Query OK, 1 row affected (0.00 sec)</p>
<p>mysql&gt; SELECT * FROM t;<br>+————+<br>| s      |<br>+————+<br>| 我我   |<br>+————+<br>1 row in set (0.00 sec)<br>首先列col使用的字符集是gbk，一个字符’我’在gbk中的编码为0xCED2，占用两个字节，两个字符的实际数据就占用4个字节。如果把该列的字符集修改为utf8的话，这两个字符就实际占用6个字节啦～</p>
<p>客户端和服务器通信中的字符集<br>编码和解码使用的字符集不一致的后果<br>说到底，字符串在计算机上的体现就是一个字节串，如果你使用不同字符集去解码这个字节串，最后得到的结果可能让你挠头。</p>
<p>我们知道字符’我’在utf8字符集编码下的字节串长这样：0xE68891，如果一个程序把这个字节串发送到另一个程序里，另一个程序用不同的字符集去解码这个字节串，假设使用的是gbk字符集来解释这串字节，解码过程就是这样的：</p>
<p>首先看第一个字节0xE6，它的值大于0x7F（十进制：127），说明是两字节编码，继续读一字节后是0xE688，然后从gbk编码表中查找字节为0xE688对应的字符，发现是字符’鎴’</p>
<p>继续读一个字节0x91，它的值也大于0x7F，再往后读一个字节发现木有了，所以这是半个字符。</p>
<p>所以0xE68891被gbk字符集解释成一个字符’鎴’和半个字符。</p>
<p>假设用iso-8859-1，也就是latin1字符集去解释这串字节，解码过程如下：</p>
<p>先读第一个字节0xE6，它对应的latin1字符为æ。</p>
<p>再读第二个字节0x88，它对应的latin1字符为ˆ。</p>
<p>再读第三个字节0x91，它对应的latin1字符为‘。</p>
<p>所以整串字节0xE68891被latin1字符集解释后的字符串就是’æˆ‘’</p>
<p>可见，如果对于同一个字符串编码和解码使用的字符集不一样，会产生意想不到的结果，作为人类的我们看上去就像是产生了乱码一样。</p>
<p>字符集转换的概念<br>如果接收0xE68891这个字节串的程序按照utf8字符集进行解码，然后又把它按照gbk字符集进行编码，最后编码后的字节串就是0xCED2，我们把这个过程称为字符集的转换，也就是字符串’我’从utf8字符集转换为gbk字符集。</p>
<p>MySQL中字符集的转换<br>我们知道从客户端发往服务器的请求本质上就是一个字符串，服务器向客户端返回的结果本质上也是一个字符串，而字符串其实是使用某种字符集编码的二进制数据。这个字符串可不是使用一种字符集的编码方式一条道走到黑的，从发送请求到返回结果这个过程中伴随着多次字符集的转换，在这个过程中会用到3个系统变量，我们先把它们写出来看一下：</p>
<p>系统变量    描述<br>character_set_client    服务器解码请求时使用的字符集<br>character_set_connection    服务器处理请求时会把请求字符串从character_set_client转为character_set_connection<br>character_set_results    服务器向客户端返回数据时使用的字符集<br>这几个系统变量在我的计算机上的默认值如下（不同操作系统的默认值可能不同）：</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_client’;<br>+———————————+———-+<br>| Variable_name        | Value |<br>+———————————+———-+<br>| character_set_client | utf8  |<br>+———————————+———-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_connection’;<br>+—————————————+———-+<br>| Variable_name            | Value |<br>+—————————————+———-+<br>| character_set_connection | utf8  |<br>+—————————————+———-+<br>1 row in set (0.01 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_results’;<br>+———————————-+———-+<br>| Variable_name         | Value |<br>+———————————-+———-+<br>| character_set_results | utf8  |<br>+———————————-+———-+<br>1 row in set (0.00 sec)<br>大家可以看到这几个系统变量的值都是utf8，为了体现出字符集在请求处理过程中的变化，我们这里特意修改一个系统变量的值：</p>
<p>mysql&gt; set character_set_connection = gbk;<br>Query OK, 0 rows affected (0.00 sec)<br>所以现在系统变量character_set_client和character_set_results的值还是utf8，而character_set_connection的值为gbk。现在假设我们客户端发送的请求是下边这个字符串：</p>
<p>SELECT * FROM t WHERE s = ‘我’;<br>为了方便大家理解这个过程，我们只分析字符’我’在这个过程中字符集的转换。</p>
<p>现在看一下在请求从发送到结果返回过程中字符集的变化：</p>
<p>客户端发送请求所使用的字符集</p>
<p>一般情况下客户端所使用的字符集和当前操作系统一致，不同操作系统使用的字符集可能不一样，如下：</p>
<p>类Unix系统使用的是utf8<br>Windows使用的是gbk<br>例如我在使用的macOS操作系统时，客户端使用的就是utf8字符集。所以字符’我’在发送给服务器的请求中的字节形式就是：0xE68891</p>
<p>小贴士：</p>
<p>如果你使用的是可视化工具，比如navicat之类的，这些工具可能会使用自定义的字符集来编码发送到服务器的字符串，而不采用操作系统默认的字符集（所以在学习的时候还是尽量用黑框框哈）。<br>服务器接收到客户端发送来的请求其实是一串二进制的字节，它会认为这串字节采用的字符集是character_set_client，然后把这串字节转换为character_set_connection字符集编码的字符。</p>
<p>由于我的计算机上character_set_client的值是utf8，首先会按照utf8字符集对字节串0xE68891进行解码，得到的字符串就是’我’，然后按照character_set_connection代表的字符集，也就是gbk进行编码，得到的结果就是字节串0xCED2。</p>
<p>因为表t的列col采用的是gbk字符集，与character_set_connection一致，所以直接到列中找字节值为0xCED2的记录，最后找到了一条记录。</p>
<p>小贴士：</p>
<p>如果某个列使用的字符集和character_set_connection代表的字符集不一致的话，还需要进行一次字符集转换。<br>上一步骤找到的记录中的col列其实是一个字节串0xCED2，col列是采用gbk进行编码的，所以首先会将这个字节串使用gbk进行解码，得到字符串’我’，然后再把这个字符串使用character_set_results代表的字符集，也就是utf8进行编码，得到了新的字节串：0xE68891，然后发送给客户端。</p>
<p>由于客户端是用的字符集是utf8，所以可以顺利的将0xE68891解释成字符我，从而显示到我们的显示器上，所以我们人类也读懂了返回的结果。</p>
<p>如果你读上边的文字有点晕，可以参照这个图来仔细分析一下这几个步骤：</p>
<p>image_1d6dfk4orjaj1ra8536aijb99.png-112.4kB</p>
<p>从这个分析中我们可以得出这么几点需要注意的地方：</p>
<p>服务器认为客户端发送过来的请求是用character_set_client编码的。</p>
<p>假设你的客户端采用的字符集和 character_set_client 不一样的话，这就会出现意想不到的情况。比如我的客户端使用的是utf8字符集，如果把系统变量character_set_client的值设置为ascii的话，服务器可能无法理解我们发送的请求，更别谈处理这个请求了。</p>
<p>服务器将把得到的结果集使用character_set_results编码后发送给客户端。</p>
<p>假设你的客户端采用的字符集和 character_set_results 不一样的话，这就可能会出现客户端无法解码结果集的情况，结果就是在你的屏幕上出现乱码。比如我的客户端使用的是utf8字符集，如果把系统变量character_set_results的值设置为ascii的话，可能会产生乱码。</p>
<p>character_set_connection只是服务器在将请求的字节串从character_set_client转换为character_set_connection时使用，它是什么其实没多重要，但是一定要注意，该字符集包含的字符范围一定涵盖请求中的字符，要不然会导致有的字符无法使用character_set_connection代表的字符集进行编码。比如你把character_set_client设置为utf8，把character_set_connection设置成ascii，那么此时你如果从客户端发送一个汉字到服务器，那么服务器无法使用ascii字符集来编码这个汉字，就会向用户发出一个警告。</p>
<p>知道了在MySQL中从发送请求到返回结果过程里发生的各种字符集转换，但是为啥要转来转去的呢？不晕么？</p>
<p>答：是的，很头晕，所以我们通常都把 character_set_client 、character_set_connection、character_set_results 这三个系统变量设置成和客户端使用的字符集一致的情况，这样减少了很多无谓的字符集转换。为了方便我们设置，MySQL提供了一条非常简便的语句：</p>
<p>SET NAMES 字符集名;<br>这一条语句产生的效果和我们执行这3条的效果是一样的：</p>
<p>SET character_set_client = 字符集名;<br>SET character_set_connection = 字符集名;<br>SET character_set_results = 字符集名;<br>比方说我的客户端使用的是utf8字符集，所以需要把这几个系统变量的值都设置为utf8：</p>
<p>mysql&gt; SET NAMES utf8;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_client’;<br>+———————————+———-+<br>| Variable_name        | Value |<br>+———————————+———-+<br>| character_set_client | utf8  |<br>+———————————+———-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt;  SHOW VARIABLES LIKE ‘character_set_connection’;<br>+—————————————+———-+<br>| Variable_name            | Value |<br>+—————————————+———-+<br>| character_set_connection | utf8  |<br>+—————————————+———-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘character_set_results’;<br>+———————————-+———-+<br>| Variable_name         | Value |<br>+———————————-+———-+<br>| character_set_results | utf8  |<br>+———————————-+———-+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt;<br>小贴士：</p>
<p>如果你使用的是Windows系统，那应该设置成gbk。<br>另外，如果你想在启动客户端的时候就把character_set_client、character_set_connection、character_set_results这三个系统变量的值设置成一样的，那我们可以在启动客户端的时候指定一个叫default-character-set的启动选项，比如在配置文件里可以这么写：</p>
<p>[client]<br>default-character-set=utf8<br>它起到的效果和执行一遍SET NAMES utf8是一样一样的，都会将那三个系统变量的值设置成utf8。</p>
<p>比较规则的应用<br>结束了字符集的漫游，我们把视角再次聚焦到比较规则，比较规则的作用通常体现比较字符串大小的表达式以及对某个字符串列进行排序中，所以有时候也称为排序规则。比方说表t的列col使用的字符集是gbk，使用的比较规则是gbk_chinese_ci，我们向里边插入几条记录：</p>
<p>mysql&gt; INSERT INTO t(col) VALUES(‘a’), (‘b’), (‘A’), (‘B’);<br>Query OK, 4 rows affected (0.00 sec)<br>Records: 4  Duplicates: 0  Warnings: 0</p>
<p>mysql&gt;<br>我们查询的时候按照t列排序一下：</p>
<p>mysql&gt; SELECT * FROM t ORDER BY col;<br>+———+<br>| col  |<br>+———+<br>| a    |<br>| A    |<br>| b    |<br>| B    |<br>| 我   |<br>+———+<br>5 rows in set (0.00 sec)<br>可以看到在默认的比较规则gbk_chinese_ci中是不区分大小写的，我们现在把列col的比较规则修改为gbk_bin：</p>
<p>mysql&gt; ALTER TABLE t MODIFY col VARCHAR(10) COLLATE gbk_bin;<br>Query OK, 5 rows affected (0.02 sec)<br>Records: 5  Duplicates: 0  Warnings: 0<br>由于gbk_bin是直接比较字符的编码，所以是区分大小写的，我们再看一下排序后的查询结果：</p>
<p>mysql&gt; SELECT * FROM t ORDER BY s;<br>+———+<br>| s    |<br>+———+<br>| A    |<br>| B    |<br>| a    |<br>| b    |<br>| 我   |<br>+———+<br>5 rows in set (0.00 sec)</p>
<p>mysql&gt;<br>所以如果以后大家在对字符串做比较或者对某个字符串列做排序操作时没有得到想象中的结果，需要思考一下是不是比较规则的问题～</p>
<p>小贴士：</p>
<p>列<code>col</code>中各个字符在使用gbk字符集编码后对应的数字如下：<br>‘A’ -&gt; 65 （十进制）<br>‘B’ -&gt; 66 （十进制）<br>‘a’ -&gt; 97 （十进制）<br>‘b’ -&gt; 98 （十进制）<br>‘我’ -&gt; 25105 （十进制）</p>
<p>总结<br>字符集指的是某个字符范围的编码规则。</p>
<p>比较规则是针对某个字符集中的字符比较大小的一种规则。</p>
<p>在MySQL中，一个字符集可以有若干种比较规则，其中有一个默认的比较规则，一个比较规则必须对应一个字符集。</p>
<p>查看MySQL中查看支持的字符集和比较规则的语句如下：</p>
<p>SHOW (CHARACTER SET|CHARSET) [LIKE 匹配的模式];<br>SHOW COLLATION [LIKE 匹配的模式];<br>MySQL有四个级别的字符集和比较规则</p>
<p>服务器级别</p>
<p>character_set_server表示服务器级别的字符集，collation_server表示服务器级别的比较规则。</p>
<p>数据库级别</p>
<p>创建和修改数据库时可以指定字符集和比较规则：</p>
<p>CREATE DATABASE 数据库名<br>    [[DEFAULT] CHARACTER SET 字符集名称]<br>    [[DEFAULT] COLLATE 比较规则名称];</p>
<p>ALTER DATABASE 数据库名<br>    [[DEFAULT] CHARACTER SET 字符集名称]<br>    [[DEFAULT] COLLATE 比较规则名称];<br>character_set_database表示当前数据库的字符集，collation_database表示当前默认数据库的比较规则，这两个系统变量是只读的，不能修改。如果没有指定当前默认数据库，则变量与相应的服务器级系统变量具有相同的值。</p>
<p>表级别</p>
<p>创建和修改表的时候指定表的字符集和比较规则：</p>
<p>CREATE TABLE 表名 (列的信息)<br>    [[DEFAULT] CHARACTER SET 字符集名称]<br>    [COLLATE 比较规则名称]];</p>
<p>ALTER TABLE 表名<br>    [[DEFAULT] CHARACTER SET 字符集名称]<br>    [COLLATE 比较规则名称];<br>列级别</p>
<p>创建和修改列定义的时候可以指定该列的字符集和比较规则：</p>
<p>CREATE TABLE 表名(<br>    列名 字符串类型 [CHARACTER SET 字符集名称] [COLLATE 比较规则名称],<br>    其他列…<br>);</p>
<p>ALTER TABLE 表名 MODIFY 列名 字符串类型 [CHARACTER SET 字符集名称] [COLLATE 比较规则名称];<br>从发送请求到接收结果过程中发生的字符集转换：</p>
<p>客户端使用操作系统的字符集编码请求字符串，向服务器发送的是经过编码的一个字节串。</p>
<p>服务器将客户端发送来的字节串采用character_set_client代表的字符集进行解码，将解码后的字符串再按照character_set_connection代表的字符集进行编码。</p>
<p>如果character_set_connection代表的字符集和具体操作的列使用的字符集一致，则直接进行相应操作，否则的话需要将请求中的字符串从character_set_connection代表的字符集转换为具体操作的列使用的字符集之后再进行操作。</p>
<p>将从某个列获取到的字节串从该列使用的字符集转换为character_set_results代表的字符集后发送到客户端。</p>
<p>客户端使用操作系统的字符集解析收到的结果集字节串。</p>
<p>在这个过程中各个系统变量的含义如下：</p>
<p>系统变量    描述<br>character_set_client    服务器解码请求时使用的字符集<br>character_set_connection    服务器处理请求时会把请求字符串从character_set_client转为character_set_connection<br>character_set_results    服务器向客户端返回数据时使用的字符集<br>一般情况下要使用保持这三个变量的值和客户端使用的字符集相同。</p>
<p>比较规则的作用通常体现比较字符串大小的表达式以及对某个字符串列进行排序中。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MySQL是怎样运行的：从根儿上理解MySQL/" rel="tag"># MySQL是怎样运行的：从根儿上理解MySQL</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/05/28/启动选项和系统变量/" rel="next" title="启动选项和系统变量">
                <i class="fa fa-chevron-left"></i> 启动选项和系统变量
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/06/01/InnoDB记录存储结构/" rel="prev" title="InnoDB记录存储结构">
                InnoDB记录存储结构 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="CheBin">
            
              <p class="site-author-name" itemprop="name">CheBin</p>
              <div class="site-description motion-element" itemprop="description">什么是强迫自己？就是不想去干什么，就去干什么</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">971</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">68</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          


          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/2023/03/12/08-秒杀系统设计：你的系统可以应对万人抢购盛况吗？/" title="08丨秒杀系统设计：你的系统可以应对万人抢购盛况吗？" target="_blank">08丨秒杀系统设计：你的系统可以应对万人抢购盛况吗？</a>
                  </li>
                
                  <li>
                    <a href="/2023/03/11/17-消息队列：秒杀时如何处理每秒上万次的下单请求？/" title="17丨消息队列：秒杀时如何处理每秒上万次的下单请求？" target="_blank">17丨消息队列：秒杀时如何处理每秒上万次的下单请求？</a>
                  </li>
                
                  <li>
                    <a href="/2023/03/11/09-数据库优化方案（二）：写入数据量增加时，如何实现分库分表？/" title="09丨数据库优化方案（二）：写入数据量增加时，如何实现分库分表？" target="_blank">09丨数据库优化方案（二）：写入数据量增加时，如何实现分库分表？</a>
                  </li>
                
                  <li>
                    <a href="/2023/03/11/08-数据库优化方案（一）：查询请求增加时，如何做主从分离？/" title="08丨数据库优化方案（一）：查询请求增加时，如何做主从分离？" target="_blank">08丨数据库优化方案（一）：查询请求增加时，如何做主从分离？</a>
                  </li>
                
                  <li>
                    <a href="/2023/03/08/Go主流框架高频面试题大全/" title="Go主流框架高频面试题大全" target="_blank">Go主流框架高频面试题大全</a>
                  </li>
                
              </ul>
            </div>
        

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CheBin</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">8.1m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">122:06</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
