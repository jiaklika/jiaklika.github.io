<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Fnext-boot%2F</url>
    <content type="text"><![CDATA[/* global NexT, CONFIG */ $(document).ready(function() { $(document).trigger('bootstrap:before'); /** * Register JS handlers by condition option. * Need to add config option in Front-End at 'layout/_partials/head.swig' file. */ CONFIG.fastclick && NexT.utils.isMobile() && window.FastClick.attach(document.body); CONFIG.lazyload && NexT.utils.lazyLoadPostsImages(); NexT.utils.registerESCKeyEvent(); CONFIG.back2top && NexT.utils.registerBackToTop(); // Mobile top menu bar. $('.site-nav-toggle button').on('click', function() { var $siteNav = $('.site-nav'); var ON_CLASS_NAME = 'site-nav-on'; var isSiteNavOn = $siteNav.hasClass(ON_CLASS_NAME); var animateAction = isSiteNavOn ? 'slideUp' : 'slideDown'; var animateCallback = isSiteNavOn ? 'removeClass' : 'addClass'; $siteNav.stop()[animateAction]('fast', function() { $siteNav[animateCallback](ON_CLASS_NAME); }); }); /** * Register JS handlers by condition option. * Need to add config option in Front-End at 'layout/_partials/head.swig' file. */ CONFIG.fancybox && NexT.utils.wrapImageWithFancyBox(); CONFIG.tabs && NexT.utils.registerTabsTag(); NexT.utils.embeddedVideoTransformer(); // Define Motion Sequence. NexT.motion.integrator .add(NexT.motion.middleWares.logo) .add(NexT.motion.middleWares.menu) .add(NexT.motion.middleWares.postList) .add(NexT.motion.middleWares.sidebar); $(document).trigger('motion:before'); // Bootstrap Motion. CONFIG.motion.enable && NexT.motion.integrator.bootstrap(); $(document).trigger('bootstrap:after'); });]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Fpost-details%2F</url>
    <content type="text"><![CDATA[/* global NexT, CONFIG */ $(document).ready(function() { function initScrollSpy() { var tocSelector = '.post-toc'; var $tocElement = $(tocSelector); var activeCurrentSelector = '.active-current'; function removeCurrentActiveClass() { $(tocSelector + ' ' + activeCurrentSelector) .removeClass(activeCurrentSelector.substring(1)); } $tocElement .on('activate.bs.scrollspy', function() { var $currentActiveElement = $(tocSelector + ' .active').last(); removeCurrentActiveClass(); $currentActiveElement.addClass('active-current'); // Scrolling to center active TOC element if TOC content is taller then viewport. $tocElement.scrollTop($currentActiveElement.offset().top - $tocElement.offset().top + $tocElement.scrollTop() - ($tocElement.height() / 2)); }) .on('clear.bs.scrollspy', removeCurrentActiveClass); $('body').scrollspy({ target: tocSelector }); } initScrollSpy(); }); $(document).ready(function() { var html = $('html'); var TAB_ANIMATE_DURATION = 200; var hasVelocity = $.isFunction(html.velocity); $('.sidebar-nav li').on('click', function() { var item = $(this); var activeTabClassName = 'sidebar-nav-active'; var activePanelClassName = 'sidebar-panel-active'; if (item.hasClass(activeTabClassName)) { return; } var currentTarget = $('.' + activePanelClassName); var target = $('.' + item.data('target')); hasVelocity ? currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function() { target .velocity('stop') .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION) .addClass(activePanelClassName); }) : currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function() { currentTarget.hide(); target .stop() .css({'opacity': 0, 'display': 'block'}) .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function() { currentTarget.removeClass(activePanelClassName); target.addClass(activePanelClassName); }); }); item.siblings().removeClass(activeTabClassName); item.addClass(activeTabClassName); }); // TOC item animation navigate & prevent #item selector in adress bar. $('.post-toc a').on('click', function(e) { e.preventDefault(); var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href')); var offset = $(targetSelector).offset().top; hasVelocity ? html.velocity('stop').velocity('scroll', { offset : offset + 'px', mobileHA: false }) : $('html, body').stop().animate({ scrollTop: offset }, 500); }); // Expand sidebar on post detail page by default, when post has a toc. var $tocContent = $('.post-toc-content'); var display = CONFIG.page.sidebar; if (typeof display !== 'boolean') { // There's no definition sidebar in the page front-matter var isSidebarCouldDisplay = CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always'; var hasTOC = $tocContent.length > 0 && $tocContent.html().trim().length > 0; display = isSidebarCouldDisplay && hasTOC; } if (display) { CONFIG.motion.enable ? NexT.motion.middleWares.sidebar = function() { NexT.utils.displaySidebar(); } : NexT.utils.displaySidebar(); } });]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Fscrollspy%2F</url>
    <content type="text"><![CDATA[/* ======================================================================== * Bootstrap: scrollspy.js v3.3.2 * http://getbootstrap.com/javascript/#scrollspy * ======================================================================== * Copyright 2011-2015 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE) * ======================================================================== */ /** * Customized by iissnan & Ivan.Nginx * * - Add a `clear.bs.scrollspy` event. * - Esacpe targets selector. * - Refactored with eslint-config-theme-next style. */ /* global NexT */ (function($) { 'use strict'; // SCROLLSPY CLASS DEFINITION // ========================== function ScrollSpy(element, options) { this.$body = $(document.body); this.$scrollElement = $(element).is(document.body) ? $(window) : $(element); this.options = $.extend({}, ScrollSpy.DEFAULTS, options); this.selector = (this.options.target || '') + ' .nav li > a'; this.offsets = []; this.targets = []; this.activeTarget = null; this.scrollHeight = 0; this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this)); this.refresh(); this.process(); } ScrollSpy.VERSION = '3.3.2'; ScrollSpy.DEFAULTS = { offset: 10 }; ScrollSpy.prototype.getScrollHeight = function() { return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight); }; ScrollSpy.prototype.refresh = function() { var that = this; var offsetMethod = 'offset'; var offsetBase = 0; this.offsets = []; this.targets = []; this.scrollHeight = this.getScrollHeight(); if (!$.isWindow(this.$scrollElement[0])) { offsetMethod = 'position'; offsetBase = this.$scrollElement.scrollTop(); } this.$body .find(this.selector) .map(function() { var $el = $(this); var href = $el.data('target') || $el.attr('href'); var $href = /^#./.test(href) && $(NexT.utils.escapeSelector(href)); // Need to escape selector. return ($href && $href.length && $href.is(':visible') && [[$href[offsetMethod]().top + offsetBase, href]]) || null; }) .sort(function(a, b) { return a[0] - b[0]; }) .each(function() { that.offsets.push(this[0]); that.targets.push(this[1]); }); }; ScrollSpy.prototype.process = function() { var scrollTop = this.$scrollElement.scrollTop() + this.options.offset; var scrollHeight = this.getScrollHeight(); var maxScroll = this.options.offset + scrollHeight - this.$scrollElement.height(); var offsets = this.offsets; var targets = this.targets; var activeTarget = this.activeTarget; var i; if (this.scrollHeight !== scrollHeight) { this.refresh(); } if (scrollTop >= maxScroll) { return activeTarget !== (i = targets[targets.length - 1]) && this.activate(i); } if (activeTarget && scrollTop < offsets[0]) { $(this.selector).trigger('clear.bs.scrollspy'); // Add a custom event. this.activeTarget = null; return this.clear(); } for (i = offsets.length; i--;) { activeTarget !== targets[i] && scrollTop >= offsets[i] && (!offsets[i + 1] || scrollTop]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Fpisces%2F</url>
    <content type="text"><![CDATA[/* global NexT, CONFIG */ $(document).ready(function() { var sidebarInner = $('.sidebar-inner'); var sidebarOffset = CONFIG.sidebar.offset || 12; function getHeaderOffset() { return $('.header-inner').height() + sidebarOffset; } function getFooterOffset() { var footer = $('#footer'); var footerInner = $('.footer-inner'); var footerMargin = footer.outerHeight() - footerInner.outerHeight(); var footerOffset = footer.outerHeight() + footerMargin; return footerOffset; } function initAffix() { var headerOffset = getHeaderOffset(); var footerOffset = getFooterOffset(); var sidebarHeight = $('#sidebar').height() + NexT.utils.getSidebarb2tHeight(); var contentHeight = $('#content').height(); // Not affix if sidebar taller than content (to prevent bottom jumping). if (headerOffset + sidebarHeight < contentHeight) { sidebarInner.affix({ offset: { top : headerOffset - sidebarOffset, bottom: footerOffset } }); sidebarInner.affix('checkPosition'); } $('#sidebar').css({ 'margin-top': headerOffset, 'margin-left': 'auto' }); } function recalculateAffixPosition() { $(window).off('.affix'); sidebarInner.removeData('bs.affix').removeClass('affix affix-top affix-bottom'); initAffix(); } function resizeListener() { var mql = window.matchMedia('(min-width: 992px)'); mql.addListener(function(e) { if (e.matches) { recalculateAffixPosition(); } }); } initAffix(); resizeListener(); });]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Faffix%2F</url>
    <content type="text"><![CDATA[/* ======================================================================== * Bootstrap: affix.js v3.3.5 * http://getbootstrap.com/javascript/#affix * ======================================================================== * Copyright 2011-2015 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE) * ======================================================================== */ /** * Customized by Ivan.Nginx * * - Refactored with eslint-config-theme-next style. */ (function($) { 'use strict'; // AFFIX CLASS DEFINITION // ====================== var Affix = function(element, options) { this.options = $.extend({}, Affix.DEFAULTS, options); this.$target = $(this.options.target) .on('scroll.bs.affix.data-api', $.proxy(this.checkPosition, this)) .on('click.bs.affix.data-api', $.proxy(this.checkPositionWithEventLoop, this)); this.$element = $(element); this.affixed = null; this.unpin = null; this.pinnedOffset = null; this.checkPosition(); }; Affix.VERSION = '3.3.5'; Affix.RESET = 'affix affix-top affix-bottom'; Affix.DEFAULTS = { offset: 0, target: window }; Affix.prototype.getState = function(scrollHeight, height, offsetTop, offsetBottom) { var scrollTop = this.$target.scrollTop(); var position = this.$element.offset(); var targetHeight = this.$target.height(); if (offsetTop != null && this.affixed === 'top') return scrollTop < offsetTop ? 'top' : false; if (this.affixed === 'bottom') { if (offsetTop != null) return scrollTop + this.unpin]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Fmotion%2F</url>
    <content type="text"><![CDATA[/* global NexT, CONFIG */ $(document).ready(function() { NexT.motion = {}; var sidebarToggleLines = { lines: [], push : function(line) { this.lines.push(line); }, init: function() { this.lines.forEach(function(line) { line.init(); }); }, arrow: function() { this.lines.forEach(function(line) { line.arrow(); }); }, close: function() { this.lines.forEach(function(line) { line.close(); }); } }; function SidebarToggleLine(settings) { this.el = $(settings.el); this.status = $.extend({}, { init: { width : '100%', opacity: 1, left : 0, rotateZ: 0, top : 0 } }, settings.status); } SidebarToggleLine.prototype.init = function() { this.transform('init'); }; SidebarToggleLine.prototype.arrow = function() { this.transform('arrow'); }; SidebarToggleLine.prototype.close = function() { this.transform('close'); }; SidebarToggleLine.prototype.transform = function(status) { this.el.velocity('stop').velocity(this.status[status]); }; var sidebarToggleLine1st = new SidebarToggleLine({ el : '.sidebar-toggle-line-first', status: { arrow: {width: '50%', rotateZ: '-45deg', top: '2px'}, close: {width: '100%', rotateZ: '-45deg', top: '5px'} } }); var sidebarToggleLine2nd = new SidebarToggleLine({ el : '.sidebar-toggle-line-middle', status: { arrow: {width: '90%'}, close: {opacity: 0} } }); var sidebarToggleLine3rd = new SidebarToggleLine({ el : '.sidebar-toggle-line-last', status: { arrow: {width: '50%', rotateZ: '45deg', top: '-2px'}, close: {width: '100%', rotateZ: '45deg', top: '-5px'} } }); sidebarToggleLines.push(sidebarToggleLine1st); sidebarToggleLines.push(sidebarToggleLine2nd); sidebarToggleLines.push(sidebarToggleLine3rd); var SIDEBAR_WIDTH = CONFIG.sidebar.width ? CONFIG.sidebar.width : '320px'; var SIDEBAR_DISPLAY_DURATION = 200; var xPos, yPos; var sidebarToggleMotion = { toggleEl : $('.sidebar-toggle'), dimmerEl : $('#sidebar-dimmer'), sidebarEl : $('.sidebar'), isSidebarVisible: false, init : function() { this.toggleEl.on('click', this.clickHandler.bind(this)); this.dimmerEl.on('click', this.clickHandler.bind(this)); this.toggleEl.on('mouseenter', this.mouseEnterHandler.bind(this)); this.toggleEl.on('mouseleave', this.mouseLeaveHandler.bind(this)); this.sidebarEl.on('touchstart', this.touchstartHandler.bind(this)); this.sidebarEl.on('touchend', this.touchendHandler.bind(this)); this.sidebarEl.on('touchmove', function(e) { e.preventDefault(); }); $(document) .on('sidebar.isShowing', function() { NexT.utils.isDesktop() && $('body').velocity('stop').velocity( {paddingRight: SIDEBAR_WIDTH}, SIDEBAR_DISPLAY_DURATION ); }) .on('sidebar.isHiding', function() { }); }, clickHandler: function() { this.isSidebarVisible ? this.hideSidebar() : this.showSidebar(); this.isSidebarVisible = !this.isSidebarVisible; }, mouseEnterHandler: function() { if (this.isSidebarVisible) { return; } sidebarToggleLines.arrow(); }, mouseLeaveHandler: function() { if (this.isSidebarVisible) { return; } sidebarToggleLines.init(); }, touchstartHandler: function(e) { xPos = e.originalEvent.touches[0].clientX; yPos = e.originalEvent.touches[0].clientY; }, touchendHandler: function(e) { var _xPos = e.originalEvent.changedTouches[0].clientX; var _yPos = e.originalEvent.changedTouches[0].clientY; if (_xPos - xPos > 30 && Math.abs(_yPos - yPos) < 20) { this.clickHandler(); } }, showSidebar: function() { var self = this; sidebarToggleLines.close(); this.sidebarEl.velocity('stop').velocity({ width: SIDEBAR_WIDTH }, { display : 'block', duration: SIDEBAR_DISPLAY_DURATION, begin : function() { $('.sidebar .motion-element').not('.site-state').velocity( 'transition.slideRightIn', { stagger : 50, drag : true, complete: function() { self.sidebarEl.trigger('sidebar.motion.complete'); } } ); $('.site-state').velocity( 'transition.slideRightIn', { stagger : 50, drag : true, display : 'flex' } ); }, complete: function() { self.sidebarEl.addClass('sidebar-active'); self.sidebarEl.trigger('sidebar.didShow'); } }); this.sidebarEl.trigger('sidebar.isShowing'); }, hideSidebar: function() { NexT.utils.isDesktop() && $('body').velocity('stop').velocity({paddingRight: 0}); this.sidebarEl.find('.motion-element').velocity('stop').css('display', 'none'); this.sidebarEl.velocity('stop').velocity({width: 0}, {display: 'none'}); sidebarToggleLines.init(); this.sidebarEl.removeClass('sidebar-active'); this.sidebarEl.trigger('sidebar.isHiding'); // Prevent adding TOC to Overview if Overview was selected when close & open sidebar. if ($('.post-toc-wrap')) { if ($('.site-overview-wrap').css('display') === 'block') { $('.post-toc-wrap').removeClass('motion-element'); } else { $('.post-toc-wrap').addClass('motion-element'); } } } }; sidebarToggleMotion.init(); NexT.motion.integrator = { queue : [], cursor: -1, add : function(fn) { this.queue.push(fn); return this; }, next: function() { this.cursor++; var fn = this.queue[this.cursor]; $.isFunction(fn) && fn(NexT.motion.integrator); }, bootstrap: function() { this.next(); } }; NexT.motion.middleWares = { logo: function(integrator) { var sequence = []; var $brand = $('.brand'); var $image = $('.custom-logo-image'); var $title = $('.site-title'); var $subtitle = $('.site-subtitle'); var $logoLineTop = $('.logo-line-before i'); var $logoLineBottom = $('.logo-line-after i'); $brand.length > 0 && sequence.push({ e: $brand, p: {opacity: 1}, o: {duration: 200} }); /** * Check if $elements exist. * @param {jQuery|Array} $elements * @returns {boolean} */ function hasElement($elements) { $elements = Array.isArray($elements) ? $elements : [$elements]; return $elements.every(function($element) { return $element.length > 0; }); } function getMistLineSettings(element, translateX) { return { e: $(element), p: {translateX: translateX}, o: { duration : 500, sequenceQueue: false } }; } function pushImageToSequence() { sequence.push({ e: $image, p: {opacity: 1, top: 0}, o: {duration: 200} }); } NexT.utils.isMist() && hasElement([$logoLineTop, $logoLineBottom]) && sequence.push( getMistLineSettings($logoLineTop, '100%'), getMistLineSettings($logoLineBottom, '-100%') ); NexT.utils.isMuse() && hasElement($image) && pushImageToSequence(); hasElement($title) && sequence.push({ e: $title, p: {opacity: 1, top: 0}, o: {duration: 200} }); hasElement($subtitle) && sequence.push({ e: $subtitle, p: {opacity: 1, top: 0}, o: {duration: 200} }); (NexT.utils.isPisces() || NexT.utils.isGemini()) && hasElement($image) && pushImageToSequence(); if (CONFIG.motion.async) { integrator.next(); } if (sequence.length > 0) { sequence[sequence.length - 1].o.complete = function() { integrator.next(); }; /* eslint-disable */ $.Velocity.RunSequence(sequence); /* eslint-enable */ } else { integrator.next(); } }, menu: function(integrator) { if (CONFIG.motion.async) { integrator.next(); } $('.menu-item').velocity('transition.slideDownIn', { display : null, duration: 200, complete: function() { integrator.next(); } }); }, postList: function(integrator) { //var $post = $('.post'); var $postBlock = $('.post-block, .pagination, .comments'); var $postBlockTransition = CONFIG.motion.transition.post_block; var $postHeader = $('.post-header'); var $postHeaderTransition = CONFIG.motion.transition.post_header; var $postBody = $('.post-body'); var $postBodyTransition = CONFIG.motion.transition.post_body; var $collHeader = $('.collection-title, .archive-year'); var $collHeaderTransition = CONFIG.motion.transition.coll_header; var $sidebarAffix = $('.sidebar-inner'); var $sidebarAffixTransition = CONFIG.motion.transition.sidebar; var hasPost = $postBlock.length > 0; function postMotion() { var postMotionOptions = window.postMotionOptions || { stagger: 100, drag : true }; postMotionOptions.complete = function() { // After motion complete need to remove transform from sidebar to let affix work on Pisces | Gemini. if (CONFIG.motion.transition.sidebar && (NexT.utils.isPisces() || NexT.utils.isGemini())) { $sidebarAffix.css({ 'transform': 'initial' }); } integrator.next(); }; //$post.velocity('transition.slideDownIn', postMotionOptions); if (CONFIG.motion.transition.post_block) { $postBlock.velocity('transition.' + $postBlockTransition, postMotionOptions); } if (CONFIG.motion.transition.post_header) { $postHeader.velocity('transition.' + $postHeaderTransition, postMotionOptions); } if (CONFIG.motion.transition.post_body) { $postBody.velocity('transition.' + $postBodyTransition, postMotionOptions); } if (CONFIG.motion.transition.coll_header) { $collHeader.velocity('transition.' + $collHeaderTransition, postMotionOptions); } // Only for Pisces | Gemini. if (CONFIG.motion.transition.sidebar && (NexT.utils.isPisces() || NexT.utils.isGemini())) { $sidebarAffix.velocity('transition.' + $sidebarAffixTransition, postMotionOptions); } } hasPost ? postMotion() : integrator.next(); if (CONFIG.motion.async) { integrator.next(); } }, sidebar: function(integrator) { if (CONFIG.sidebar.display === 'always') { NexT.utils.displaySidebar(); } integrator.next(); } }; });]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Futils%2F</url>
    <content type="text"><![CDATA[/* global NexT, CONFIG */ NexT.utils = NexT.$u = { /** * Wrap images with fancybox support. */ wrapImageWithFancyBox: function() { $('.content img') .not(':hidden') .each(function() { var $image = $(this); var imageTitle = $image.attr('title') || $image.attr('alt'); var $imageWrapLink = $image.parent('a'); if ($imageWrapLink.length < 1) { var imageLink = $image.attr('data-original') || $image.attr('src'); $imageWrapLink = $image.wrap('').parent('a'); if ($image.is('.post-gallery img')) { $imageWrapLink.addClass('post-gallery-img'); $imageWrapLink.attr('data-fancybox', 'gallery').attr('rel', 'gallery'); } else if ($image.is('.group-picture img')) { $imageWrapLink.attr('data-fancybox', 'group').attr('rel', 'group'); } else { $imageWrapLink.attr('data-fancybox', 'default').attr('rel', 'default'); } } if (imageTitle) { $imageWrapLink.append('' + imageTitle + ''); // Make sure img title tag will show correctly in fancybox $imageWrapLink.attr('title', imageTitle).attr('data-caption', imageTitle); } }); $('.fancybox').fancybox({ loop: true, helpers: { overlay: { locked: false } } }); }, lazyLoadPostsImages: function() { $('#posts').find('img').lazyload({ //placeholder: '/images/loading.gif', effect : 'fadeIn', threshold: 0 }); }, /** * Tabs tag listener (without twitter bootstrap). */ registerTabsTag: function() { var tNav = '.tabs ul.nav-tabs '; // Binding `nav-tabs` & `tab-content` by real time permalink changing. $(function() { $(window).bind('hashchange', function() { var tHash = location.hash; if (tHash !== '' && !tHash.match(/%\S{2}/)) { $(tNav + 'li:has(a[href="' + tHash + '"])').addClass('active').siblings().removeClass('active'); $(tHash).addClass('active').siblings().removeClass('active'); } }).trigger('hashchange'); }); $(tNav + '.tab').on('click', function(href) { href.preventDefault(); // Prevent selected tab to select again. if (!$(this).hasClass('active')) { // Add & Remove active class on `nav-tabs` & `tab-content`. $(this).addClass('active').siblings().removeClass('active'); var tActive = $(this).find('a').attr('href'); $(tActive).addClass('active').siblings().removeClass('active'); // Clear location hash in browser if #permalink exists. if (location.hash !== '') { history.pushState('', document.title, window.location.pathname + window.location.search); } } }); }, registerESCKeyEvent: function() { $(document).on('keyup', function(event) { var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible'); if (shouldDismissSearchPopup) { $('.search-popup').hide(); $('.search-popup-overlay').remove(); $('body').css('overflow', ''); } }); }, registerBackToTop: function() { var THRESHOLD = 50; var $top = $('.back-to-top'); function initBackToTop() { $top.toggleClass('back-to-top-on', window.pageYOffset > THRESHOLD); var scrollTop = $(window).scrollTop(); var contentVisibilityHeight = NexT.utils.getContentVisibilityHeight(); var scrollPercent = scrollTop / contentVisibilityHeight; var scrollPercentRounded = Math.round(scrollPercent * 100); var scrollPercentMaxed = scrollPercentRounded > 100 ? 100 : scrollPercentRounded; $('#scrollpercent>span').html(scrollPercentMaxed); } // For init back to top in sidebar if page was scrolled after page refresh. $(window).on('load', function() { initBackToTop(); }); $(window).on('scroll', function() { initBackToTop(); }); $top.on('click', function() { $.isFunction($('html').velocity) ? $('body').velocity('scroll') : $('html, body').animate({ scrollTop: 0 }); }); }, /** * Transform embedded video to support responsive layout. * @see http://toddmotto.com/fluid-and-responsive-youtube-and-vimeo-videos-with-fluidvids-js/ */ embeddedVideoTransformer: function() { var $iframes = $('iframe'); // Supported Players. Extend this if you need more players. var SUPPORTED_PLAYERS = [ 'www.youtube.com', 'player.vimeo.com', 'player.youku.com', 'music.163.com', 'www.tudou.com' ]; var pattern = new RegExp(SUPPORTED_PLAYERS.join('|')); function getDimension($element) { return { width : $element.width(), height: $element.height() }; } function getAspectRadio(width, height) { return height / width * 100; } $iframes.each(function() { var iframe = this; var $iframe = $(this); var oldDimension = getDimension($iframe); var newDimension; if (this.src.search(pattern) > 0) { // Calculate the video ratio based on the iframe's w/h dimensions var videoRatio = getAspectRadio(oldDimension.width, oldDimension.height); // Replace the iframe's dimensions and position the iframe absolute // This is the trick to emulate the video ratio $iframe.width('100%').height('100%') .css({ position: 'absolute', top : '0', left : '0' }); // Wrap the iframe in a new which uses a dynamically fetched padding-top property // based on the video's w/h dimensions var wrap = document.createElement('div'); wrap.className = 'fluid-vids'; wrap.style.position = 'relative'; wrap.style.marginBottom = '20px'; wrap.style.width = '100%'; wrap.style.paddingTop = videoRatio + '%'; // Fix for appear inside tabs tag. (wrap.style.paddingTop === '') && (wrap.style.paddingTop = '50%'); // Add the iframe inside our newly created var iframeParent = iframe.parentNode; iframeParent.insertBefore(wrap, iframe); wrap.appendChild(iframe); // Additional adjustments for 163 Music if (this.src.search('music.163.com') > 0) { newDimension = getDimension($iframe); var shouldRecalculateAspect = newDimension.width > oldDimension.width || newDimension.height < oldDimension.height; // 163 Music Player has a fixed height, so we need to reset the aspect radio if (shouldRecalculateAspect) { wrap.style.paddingTop = getAspectRadio(newDimension.width, oldDimension.height) + '%'; } } } }); }, hasMobileUA: function() { var nav = window.navigator; var ua = nav.userAgent; var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g; return pa.test(ua); }, isTablet: function() { return window.screen.width < 992 && window.screen.width > 767 && this.hasMobileUA(); }, isMobile: function() { return window.screen.width < 767 && this.hasMobileUA(); }, isDesktop: function() { return !this.isTablet() && !this.isMobile(); }, /** * Escape meta symbols in jQuery selectors. * * @param selector * @returns {string|void|XML|*} */ escapeSelector: function(selector) { return selector.replace(/[!"$%&'()*+,./:;?@[\\\]^`{|}~]/g, '\\$&'); }, displaySidebar: function() { if (!this.isDesktop() || this.isPisces() || this.isGemini()) { return; } $('.sidebar-toggle').trigger('click'); }, isMuse: function() { return CONFIG.scheme === 'Muse'; }, isMist: function() { return CONFIG.scheme === 'Mist'; }, isPisces: function() { return CONFIG.scheme === 'Pisces'; }, isGemini: function() { return CONFIG.scheme === 'Gemini'; }, getScrollbarWidth: function() { var $div = $('').addClass('scrollbar-measure').prependTo('body'); var div = $div[0]; var scrollbarWidth = div.offsetWidth - div.clientWidth; $div.remove(); return scrollbarWidth; }, getContentVisibilityHeight: function() { var docHeight = $('.container').height(); var winHeight = $(window).height(); var contentVisibilityHeight = docHeight > winHeight ? docHeight - winHeight : $(document).height() - winHeight; return contentVisibilityHeight; }, getSidebarb2tHeight: function() { var sidebarb2tHeight = (CONFIG.back2top && CONFIG.back2top_sidebar) ? $('.back-to-top').height() : 0; return sidebarb2tHeight; }, getSidebarSchemePadding: function() { var sidebarNavHeight = $('.sidebar-nav').css('display') === 'block' ? $('.sidebar-nav').outerHeight(true) : 0; var sidebarInner = $('.sidebar-inner'); var sidebarPadding = sidebarInner.innerWidth() - sidebarInner.width(); var sidebarOffset = CONFIG.sidebar.offset ? CONFIG.sidebar.offset : 12; var sidebarSchemePadding = this.isPisces() || this.isGemini() ? (sidebarPadding * 2) + sidebarNavHeight + sidebarOffset + this.getSidebarb2tHeight() : (sidebarPadding * 2) + (sidebarNavHeight / 2); return sidebarSchemePadding; } }; $(document).ready(function() { function wrapTable() { $('table').not('figure table').wrap(''); } /** * Init Sidebar & TOC inner dimensions on all pages and for all schemes. * Need for Sidebar/TOC inner scrolling if content taller then viewport. */ function updateSidebarHeight(height) { height = height || 'auto'; $('.site-overview, .post-toc').css('max-height', height); } function initSidebarDimension() { var updateSidebarHeightTimer; $(window).on('resize', function() { updateSidebarHeightTimer && clearTimeout(updateSidebarHeightTimer); updateSidebarHeightTimer = setTimeout(function() { var sidebarWrapperHeight = document.body.clientHeight - NexT.utils.getSidebarSchemePadding(); updateSidebarHeight(sidebarWrapperHeight); }, 0); }); // Initialize Sidebar & TOC Width. var scrollbarWidth = NexT.utils.getScrollbarWidth(); if ($('.site-overview-wrap').height() > (document.body.clientHeight - NexT.utils.getSidebarSchemePadding())) { $('.site-overview').css('width', 'calc(100% + ' + scrollbarWidth + 'px)'); } if ($('.post-toc-wrap').height() > (document.body.clientHeight - NexT.utils.getSidebarSchemePadding())) { $('.post-toc').css('width', 'calc(100% + ' + scrollbarWidth + 'px)'); } // Initialize Sidebar & TOC Height. updateSidebarHeight(document.body.clientHeight - NexT.utils.getSidebarSchemePadding()); } initSidebarDimension(); wrapTable(); });]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Fvelocity.ui.min%2F</url>
    <content type="text"><![CDATA[/* VelocityJS.org UI Pack (5.0.4). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License. Portions copyright Daniel Eden, Christian Pucci. */ !function(t){"function"==typeof require&&"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(["velocity"],t):t()}(function(){return function(t,a,e,r){function n(t,a){var e=[];return t&&a?($.each([t,a],function(t,a){var r=[];$.each(a,function(t,a){for(;a.toString().lengthparseFloat(e[1])):!1}if(!t.Velocity||!t.Velocity.Utilities)return void(a.console&&console.log("Velocity UI Pack: Velocity must be loaded first. Aborting."));var i=t.Velocity,$=i.Utilities,s=i.version,o={major:1,minor:1,patch:0};if(n(o,s)){var l="Velocity UI Pack: You need to update Velocity (jquery.velocity.js) to a newer version. Visit http://github.com/julianshapiro/velocity.";throw alert(l),new Error(l)}i.RegisterEffect=i.RegisterUI=function(t,a){function e(t,a,e,r){var n=0,s;$.each(t.nodeType?[t]:t,function(t,a){r&&(e+=t*r),s=a.parentNode,$.each(["height","paddingTop","paddingBottom","marginTop","marginBottom"],function(t,e){n+=parseFloat(i.CSS.getPropertyValue(a,e))})}),i.animate(s,{height:("In"===a?"+":"-")+"="+n},{queue:!1,easing:"ease-in-out",duration:e*("In"===a?.6:1)})}return i.Redirects[t]=function(n,s,o,l,c,u){function f(){s.display!==r&&"none"!==s.display||!/Out$/.test(t)||$.each(c.nodeType?[c]:c,function(t,a){i.CSS.setPropertyValue(a,"display","none")}),s.complete&&s.complete.call(c,c),u&&u.resolver(c||n)}var p=o===l-1;a.defaultDuration="function"==typeof a.defaultDuration?a.defaultDuration.call(c,c):parseFloat(a.defaultDuration);for(var d=0;d1&&($.each(a.reverse(),function(t,e){var r=a[t+1];if(r){var n=e.o||e.options,s=r.o||r.options,o=n&&n.sequenceQueue===!1?"begin":"complete",l=s&&s[o],c={};c[o]=function(){var t=r.e||r.elements,a=t.nodeType?[t]:t;l&&l.call(a,a),i(e)},r.o?r.o=$.extend({},s,c):r.options=$.extend({},s,c)}}),a.reverse()),i(a[0])}}(window.jQuery||window.Zepto||window,window,document)});]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Fvelocity.min%2F</url>
    <content type="text"><![CDATA[/*! VelocityJS.org (1.2.2). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License */ /*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License. */ !function(e){function t(e){var t=e.length,r=$.type(e);return"function"===r||$.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}if(!e.jQuery){var $=function(e,t){return new $.fn.init(e,t)};$.isWindow=function(e){return null!=e&&e==e.window},$.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?a[o.call(e)]||"object":typeof e},$.isArray=Array.isArray||function(e){return"array"===$.type(e)},$.isPlainObject=function(e){var t;if(!e||"object"!==$.type(e)||e.nodeType||$.isWindow(e))return!1;try{if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}for(t in e);return void 0===t||n.call(e,t)},$.each=function(e,r,a){var n,o=0,i=e.length,s=t(e);if(a){if(s)for(;i>o&&(n=r.apply(e[o],a),n!==!1);o++);else for(o in e)if(n=r.apply(e[o],a),n===!1)break}else if(s)for(;i>o&&(n=r.call(e[o],o,e[o]),n!==!1);o++);else for(o in e)if(n=r.call(e[o],o,e[o]),n===!1)break;return e},$.data=function(e,t,a){if(void 0===a){var n=e[$.expando],o=n&&r[n];if(void 0===t)return o;if(o&&t in o)return o[t]}else if(void 0!==t){var n=e[$.expando]||(e[$.expando]=++$.uuid);return r[n]=r[n]||{},r[n][t]=a,a}},$.removeData=function(e,t){var a=e[$.expando],n=a&&r[a];n&&$.each(t,function(e,t){delete n[t]})},$.extend=function(){var e,t,r,a,n,o,i=arguments[0]||{},s=1,l=arguments.length,u=!1;for("boolean"==typeof i&&(u=i,i=arguments[s]||{},s++),"object"!=typeof i&&"function"!==$.type(i)&&(i={}),s===l&&(i=this,s--);l>s;s++)if(null!=(n=arguments[s]))for(a in n)e=i[a],r=n[a],i!==r&&(u&&r&&($.isPlainObject(r)||(t=$.isArray(r)))?(t?(t=!1,o=e&&$.isArray(e)?e:[]):o=e&&$.isPlainObject(e)?e:{},i[a]=$.extend(u,o,r)):void 0!==r&&(i[a]=r));return i},$.queue=function(e,r,a){function n(e,r){var a=r||[];return null!=e&&(t(Object(e))?!function(e,t){for(var r=+t.length,a=0,n=e.length;r>a;)e[n++]=t[a++];if(r!==r)for(;void 0!==t[a];)e[n++]=t[a++];return e.length=n,e}(a,"string"==typeof e?[e]:e):[].push.call(a,e)),a}if(e){r=(r||"fx")+"queue";var o=$.data(e,r);return a?(!o||$.isArray(a)?o=$.data(e,r,n(a)):o.push(a),o):o||[]}},$.dequeue=function(e,t){$.each(e.nodeType?[e]:e,function(e,r){t=t||"fx";var a=$.queue(r,t),n=a.shift();"inprogress"===n&&(n=a.shift()),n&&("fx"===t&&a.unshift("inprogress"),n.call(r,function(){$.dequeue(r,t)}))})},$.fn=$.prototype={init:function(e){if(e.nodeType)return this[0]=e,this;throw new Error("Not a DOM node.")},offset:function(){var t=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:t.top+(e.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:t.left+(e.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function e(){for(var e=this.offsetParent||document;e&&"html"===!e.nodeType.toLowerCase&&"static"===e.style.position;)e=e.offsetParent;return e||document}var t=this[0],e=e.apply(t),r=this.offset(),a=/^(?:body|html)$/i.test(e.nodeName)?{top:0,left:0}:$(e).offset();return r.top-=parseFloat(t.style.marginTop)||0,r.left-=parseFloat(t.style.marginLeft)||0,e.style&&(a.top+=parseFloat(e.style.borderTopWidth)||0,a.left+=parseFloat(e.style.borderLeftWidth)||0),{top:r.top-a.top,left:r.left-a.left}}};var r={};$.expando="velocity"+(new Date).getTime(),$.uuid=0;for(var a={},n=a.hasOwnProperty,o=a.toString,i="Boolean Number String Function Array Date RegExp Object Error".split(" "),s=0;sn;++n){var o=u(r,e,a);if(0===o)return r;var i=l(r,e,a)-t;r-=i/o}return r}function p(){for(var t=0;b>t;++t)w[t]=l(t*x,e,a)}function f(t,r,n){var o,i,s=0;do i=r+(n-r)/2,o=l(i,e,a)-t,o>0?n=i:r=i;while(Math.abs(o)>h&&++s=y?c(t,s):0==l?s:f(t,r,r+x)}function g(){V=!0,(e!=r||a!=n)&&p()}var m=4,y=.001,h=1e-7,v=10,b=11,x=1/(b-1),S="Float32Array"in t;if(4!==arguments.length)return!1;for(var P=0;4>P;++P)if("number"!=typeof arguments[P]||isNaN(arguments[P])||!isFinite(arguments[P]))return!1;e=Math.min(e,1),a=Math.min(a,1),e=Math.max(e,0),a=Math.max(a,0);var w=S?new Float32Array(b):new Array(b),V=!1,C=function(t){return V||g(),e===r&&a===n?t:0===t?0:1===t?1:l(d(t),r,n)};C.getControlPoints=function(){return[{x:e,y:r},{x:a,y:n}]};var T="generateBezier("+[e,r,a,n]+")";return C.toString=function(){return T},C}function u(e,t){var r=e;return g.isString(e)?v.Easings[e]||(r=!1):r=g.isArray(e)&&1===e.length?s.apply(null,e):g.isArray(e)&&2===e.length?b.apply(null,e.concat([t])):g.isArray(e)&&4===e.length?l.apply(null,e):!1,r===!1&&(r=v.Easings[v.defaults.easing]?v.defaults.easing:h),r}function c(e){if(e){var t=(new Date).getTime(),r=v.State.calls.length;r>1e4&&(v.State.calls=n(v.State.calls));for(var o=0;r>o;o++)if(v.State.calls[o]){var s=v.State.calls[o],l=s[0],u=s[2],f=s[3],d=!!f,m=null;f||(f=v.State.calls[o][3]=t-16);for(var y=Math.min((t-f)/u.duration,1),h=0,b=l.length;b>h;h++){var S=l[h],w=S.element;if(i(w)){var V=!1;if(u.display!==a&&null!==u.display&&"none"!==u.display){if("flex"===u.display){var C=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];$.each(C,function(e,t){x.setPropertyValue(w,"display",t)})}x.setPropertyValue(w,"display",u.display)}u.visibility!==a&&"hidden"!==u.visibility&&x.setPropertyValue(w,"visibility",u.visibility);for(var T in S)if("element"!==T){var k=S[T],A,F=g.isString(k.easing)?v.Easings[k.easing]:k.easing;if(1===y)A=k.endValue;else{var E=k.endValue-k.startValue;if(A=k.startValue+E*F(y,u,E),!d&&A===k.currentValue)continue}if(k.currentValue=A,"tween"===T)m=A;else{if(x.Hooks.registered[T]){var j=x.Hooks.getRoot(T),H=i(w).rootPropertyValueCache[j];H&&(k.rootPropertyValue=H)}var N=x.setPropertyValue(w,T,k.currentValue+(0===parseFloat(A)?"":k.unitType),k.rootPropertyValue,k.scrollData);x.Hooks.registered[T]&&(i(w).rootPropertyValueCache[j]=x.Normalizations.registered[j]?x.Normalizations.registered[j]("extract",null,N[1]):N[1]),"transform"===N[0]&&(V=!0)}}u.mobileHA&&i(w).transformCache.translate3d===a&&(i(w).transformCache.translate3d="(0px, 0px, 0px)",V=!0),V&&x.flushTransformCache(w)}}u.display!==a&&"none"!==u.display&&(v.State.calls[o][2].display=!1),u.visibility!==a&&"hidden"!==u.visibility&&(v.State.calls[o][2].visibility=!1),u.progress&&u.progress.call(s[1],s[1],y,Math.max(0,f+u.duration-t),f,m),1===y&&p(o)}}v.State.isTicking&&P(c)}function p(e,t){if(!v.State.calls[e])return!1;for(var r=v.State.calls[e][0],n=v.State.calls[e][1],o=v.State.calls[e][2],s=v.State.calls[e][4],l=!1,u=0,c=r.length;c>u;u++){var p=r[u].element;if(t||o.loop||("none"===o.display&&x.setPropertyValue(p,"display",o.display),"hidden"===o.visibility&&x.setPropertyValue(p,"visibility",o.visibility)),o.loop!==!0&&($.queue(p)[1]===a||!/\.velocityQueueEntryFlag/i.test($.queue(p)[1]))&&i(p)){i(p).isAnimating=!1,i(p).rootPropertyValueCache={};var f=!1;$.each(x.Lists.transforms3D,function(e,t){var r=/^scale/.test(t)?1:0,n=i(p).transformCache[t];i(p).transformCache[t]!==a&&new RegExp("^\\("+r+"[^.]").test(n)&&(f=!0,delete i(p).transformCache[t])}),o.mobileHA&&(f=!0,delete i(p).transformCache.translate3d),f&&x.flushTransformCache(p),x.Values.removeClass(p,"velocity-animating")}if(!t&&o.complete&&!o.loop&&u===c-1)try{o.complete.call(n,n)}catch(d){setTimeout(function(){throw d},1)}s&&o.loop!==!0&&s(n),i(p)&&o.loop===!0&&!t&&($.each(i(p).tweensContainer,function(e,t){/^rotate/.test(e)&&360===parseFloat(t.endValue)&&(t.endValue=0,t.startValue=360),/^backgroundPosition/.test(e)&&100===parseFloat(t.endValue)&&"%"===t.unitType&&(t.endValue=0,t.startValue=100)}),v(p,"reverse",{loop:!0,delay:o.delay})),o.queue!==!1&&$.dequeue(p,o.queue)}v.State.calls[e]=!1;for(var g=0,m=v.State.calls.length;m>g;g++)if(v.State.calls[g]!==!1){l=!0;break}l===!1&&(v.State.isTicking=!1,delete v.State.calls,v.State.calls=[])}var f=function(){if(r.documentMode)return r.documentMode;for(var e=7;e>4;e--){var t=r.createElement("div");if(t.innerHTML="",t.getElementsByTagName("span").length)return t=null,e}return a}(),d=function(){var e=0;return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var r=(new Date).getTime(),a;return a=Math.max(0,16-(r-e)),e=r+a,setTimeout(function(){t(r+a)},a)}}(),g={isString:function(e){return"string"==typeof e},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isNode:function(e){return e&&e.nodeType},isNodeList:function(e){return"object"==typeof e&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(e))&&e.length!==a&&(0===e.length||"object"==typeof e[0]&&e[0].nodeType>0)},isWrapped:function(e){return e&&(e.jquery||t.Zepto&&t.Zepto.zepto.isZ(e))},isSVG:function(e){return t.SVGElement&&e instanceof t.SVGElement},isEmptyObject:function(e){for(var t in e)return!1;return!0}},$,m=!1;if(e.fn&&e.fn.jquery?($=e,m=!0):$=t.Velocity.Utilities,8>=f&&!m)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=f)return void(jQuery.fn.velocity=jQuery.fn.animate);var y=400,h="swing",v={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:t.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:r.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:$,Redirects:{},Easings:{},Promise:t.Promise,defaults:{queue:"",duration:y,easing:h,begin:a,complete:a,progress:a,display:a,visibility:a,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(e){$.data(e,"velocity",{isSVG:g.isSVG(e),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:2,patch:2},debug:!1};t.pageYOffset!==a?(v.State.scrollAnchor=t,v.State.scrollPropertyLeft="pageXOffset",v.State.scrollPropertyTop="pageYOffset"):(v.State.scrollAnchor=r.documentElement||r.body.parentNode||r.body,v.State.scrollPropertyLeft="scrollLeft",v.State.scrollPropertyTop="scrollTop");var b=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,r,a){var n={x:t.x+a.dx*r,v:t.v+a.dv*r,tension:t.tension,friction:t.friction};return{dx:n.v,dv:e(n)}}function r(r,a){var n={dx:r.v,dv:e(r)},o=t(r,.5*a,n),i=t(r,.5*a,o),s=t(r,a,i),l=1/6*(n.dx+2*(o.dx+i.dx)+s.dx),u=1/6*(n.dv+2*(o.dv+i.dv)+s.dv);return r.x=r.x+l*a,r.v=r.v+u*a,r}return function a(e,t,n){var o={x:-1,v:0,tension:null,friction:null},i=[0],s=0,l=1e-4,u=.016,c,p,f;for(e=parseFloat(e)||500,t=parseFloat(t)||20,n=n||null,o.tension=e,o.friction=t,c=null!==n,c?(s=a(e,t),p=s/n*u):p=u;;)if(f=r(f||o,p),i.push(1+f.x),s+=16,!(Math.abs(f.x)>l&&Math.abs(f.v)>l))break;return c?function(e){return i[e*(i.length-1)|0]}:s}}();v.Easings={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)}},$.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(e,t){v.Easings[t[0]]=l.apply(null,t[1])});var x=v.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var e=0;e=f)switch(e){case"name":return"filter";case"extract":var a=r.toString().match(/alpha\(opacity=(.*)\)/i);return r=a?a[1]/100:1;case"inject":return t.style.zoom=1,parseFloat(r)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(r),10)+")"}else switch(e){case"name":return"opacity";case"extract":return r;case"inject":return r}}},register:function(){9>=f||v.State.isGingerbread||(x.Lists.transformsBase=x.Lists.transformsBase.concat(x.Lists.transforms3D));for(var e=0;en&&(n=1),o=!/(\d)$/i.test(n);break;case"skew":o=!/(deg|\d)$/i.test(n);break;case"rotate":o=!/(deg|\d)$/i.test(n)}return o||(i(r).transformCache[t]="("+n+")"),i(r).transformCache[t]}}}();for(var e=0;e=f||3!==o.split(" ").length||(o+=" 1"),o;case"inject":return 8>=f?4===n.split(" ").length&&(n=n.split(/\s+/).slice(0,3).join(" ")):3===n.split(" ").length&&(n+=" 1"),(8>=f?"rgb":"rgba")+"("+n.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")"}}}()}},Names:{camelCase:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},SVGAttribute:function(e){var t="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(f||v.State.isAndroid&&!v.State.isChrome)&&(t+="|transform"),new RegExp("^("+t+")$","i").test(e)},prefixCheck:function(e){if(v.State.prefixMatches[e])return[v.State.prefixMatches[e],!0];for(var t=["","Webkit","Moz","ms","O"],r=0,a=t.length;a>r;r++){var n;if(n=0===r?e:t[r]+e.replace(/^\w/,function(e){return e.toUpperCase()}),g.isString(v.State.prefixElement.style[n]))return v.State.prefixMatches[e]=n,[n,!0]}return[e,!1]}},Values:{hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,a;return e=e.replace(t,function(e,t,r,a){return t+t+r+r+a+a}),a=r.exec(e),a?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:[0,0,0]},isCSSNullValue:function(e){return 0==e||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(e)},getUnitType:function(e){return/^(rotate|skew)/i.test(e)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(e)?"":"px"},getDisplayType:function(e){var t=e&&e.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(t)?"inline":/^(li)$/i.test(t)?"list-item":/^(tr)$/i.test(t)?"table-row":/^(table)$/i.test(t)?"table":/^(tbody)$/i.test(t)?"table-row-group":"block"},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=(e.className.length?" ":"")+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.toString().replace(new RegExp("(^|\\s)"+t.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(e,r,n,o){function s(e,r){function n(){u&&x.setPropertyValue(e,"display","none")}var l=0;if(8>=f)l=$.css(e,r);else{var u=!1;if(/^(width|height)$/.test(r)&&0===x.getPropertyValue(e,"display")&&(u=!0,x.setPropertyValue(e,"display",x.Values.getDisplayType(e))),!o){if("height"===r&&"border-box"!==x.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var c=e.offsetHeight-(parseFloat(x.getPropertyValue(e,"borderTopWidth"))||0)-(parseFloat(x.getPropertyValue(e,"borderBottomWidth"))||0)-(parseFloat(x.getPropertyValue(e,"paddingTop"))||0)-(parseFloat(x.getPropertyValue(e,"paddingBottom"))||0);return n(),c}if("width"===r&&"border-box"!==x.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var p=e.offsetWidth-(parseFloat(x.getPropertyValue(e,"borderLeftWidth"))||0)-(parseFloat(x.getPropertyValue(e,"borderRightWidth"))||0)-(parseFloat(x.getPropertyValue(e,"paddingLeft"))||0)-(parseFloat(x.getPropertyValue(e,"paddingRight"))||0);return n(),p}}var d;d=i(e)===a?t.getComputedStyle(e,null):i(e).computedStyle?i(e).computedStyle:i(e).computedStyle=t.getComputedStyle(e,null),"borderColor"===r&&(r="borderTopColor"),l=9===f&&"filter"===r?d.getPropertyValue(r):d[r],(""===l||null===l)&&(l=e.style[r]),n()}if("auto"===l&&/^(top|right|bottom|left)$/i.test(r)){var g=s(e,"position");("fixed"===g||"absolute"===g&&/top|left/i.test(r))&&(l=$(e).position()[r]+"px")}return l}var l;if(x.Hooks.registered[r]){var u=r,c=x.Hooks.getRoot(u);n===a&&(n=x.getPropertyValue(e,x.Names.prefixCheck(c)[0])),x.Normalizations.registered[c]&&(n=x.Normalizations.registered[c]("extract",e,n)),l=x.Hooks.extractValue(u,n)}else if(x.Normalizations.registered[r]){var p,d;p=x.Normalizations.registered[r]("name",e),"transform"!==p&&(d=s(e,x.Names.prefixCheck(p)[0]),x.Values.isCSSNullValue(d)&&x.Hooks.templates[r]&&(d=x.Hooks.templates[r][1])),l=x.Normalizations.registered[r]("extract",e,d)}if(!/^[\d-]/.test(l))if(i(e)&&i(e).isSVG&&x.Names.SVGAttribute(r))if(/^(height|width)$/i.test(r))try{l=e.getBBox()[r]}catch(g){l=0}else l=e.getAttribute(r);else l=s(e,x.Names.prefixCheck(r)[0]);return x.Values.isCSSNullValue(l)&&(l=0),v.debug>=2&&console.log("Get "+r+": "+l),l},setPropertyValue:function(e,r,a,n,o){var s=r;if("scroll"===r)o.container?o.container["scroll"+o.direction]=a:"Left"===o.direction?t.scrollTo(a,o.alternateValue):t.scrollTo(o.alternateValue,a);else if(x.Normalizations.registered[r]&&"transform"===x.Normalizations.registered[r]("name",e))x.Normalizations.registered[r]("inject",e,a),s="transform",a=i(e).transformCache[r];else{if(x.Hooks.registered[r]){var l=r,u=x.Hooks.getRoot(r);n=n||x.getPropertyValue(e,u),a=x.Hooks.injectValue(l,a,n),r=u}if(x.Normalizations.registered[r]&&(a=x.Normalizations.registered[r]("inject",e,a),r=x.Normalizations.registered[r]("name",e)),s=x.Names.prefixCheck(r)[0],8>=f)try{e.style[s]=a}catch(c){v.debug&&console.log("Browser does not support ["+a+"] for ["+s+"]")}else i(e)&&i(e).isSVG&&x.Names.SVGAttribute(r)?e.setAttribute(r,a):e.style[s]=a;v.debug>=2&&console.log("Set "+r+" ("+s+"): "+a)}return[s,a]},flushTransformCache:function(e){function t(t){return parseFloat(x.getPropertyValue(e,t))}var r="";if((f||v.State.isAndroid&&!v.State.isChrome)&&i(e).isSVG){var a={translate:[t("translateX"),t("translateY")],skewX:[t("skewX")],skewY:[t("skewY")],scale:1!==t("scale")?[t("scale"),t("scale")]:[t("scaleX"),t("scaleY")],rotate:[t("rotateZ"),0,0]};$.each(i(e).transformCache,function(e){/^translate/i.test(e)?e="translate":/^scale/i.test(e)?e="scale":/^rotate/i.test(e)&&(e="rotate"),a[e]&&(r+=e+"("+a[e].join(" ")+") ",delete a[e])})}else{var n,o;$.each(i(e).transformCache,function(t){return n=i(e).transformCache[t],"transformPerspective"===t?(o=n,!0):(9===f&&"rotateZ"===t&&(t="rotate"),void(r+=t+n+" "))}),o&&(r="perspective"+o+" "+r)}x.setPropertyValue(e,"transform",r)}};x.Hooks.register(),x.Normalizations.register(),v.hook=function(e,t,r){var n=a;return e=o(e),$.each(e,function(e,o){if(i(o)===a&&v.init(o),r===a)n===a&&(n=v.CSS.getPropertyValue(o,t));else{var s=v.CSS.setPropertyValue(o,t,r);"transform"===s[0]&&v.CSS.flushTransformCache(o),n=s}}),n};var S=function(){function e(){return l?T.promise||null:f}function n(){function e(e){function p(e,t){var r=a,i=a,s=a;return g.isArray(e)?(r=e[0],!g.isArray(e[1])&&/^[\d-]/.test(e[1])||g.isFunction(e[1])||x.RegEx.isHex.test(e[1])?s=e[1]:(g.isString(e[1])&&!x.RegEx.isHex.test(e[1])||g.isArray(e[1]))&&(i=t?e[1]:u(e[1],o.duration),e[2]!==a&&(s=e[2]))):r=e,t||(i=i||o.easing),g.isFunction(r)&&(r=r.call(n,w,P)),g.isFunction(s)&&(s=s.call(n,w,P)),[r||0,i,s]}function f(e,t){var r,a;return a=(t||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(e){return r=e,""}),r||(r=x.Values.getUnitType(e)),[a,r]}function d(){var e={myParent:n.parentNode||r.body,position:x.getPropertyValue(n,"position"),fontSize:x.getPropertyValue(n,"fontSize")},a=e.position===N.lastPosition&&e.myParent===N.lastParent,o=e.fontSize===N.lastFontSize;N.lastParent=e.myParent,N.lastPosition=e.position,N.lastFontSize=e.fontSize;var s=100,l={};if(o&&a)l.emToPx=N.lastEmToPx,l.percentToPxWidth=N.lastPercentToPxWidth,l.percentToPxHeight=N.lastPercentToPxHeight;else{var u=i(n).isSVG?r.createElementNS("http://www.w3.org/2000/svg","rect"):r.createElement("div");v.init(u),e.myParent.appendChild(u),$.each(["overflow","overflowX","overflowY"],function(e,t){v.CSS.setPropertyValue(u,t,"hidden")}),v.CSS.setPropertyValue(u,"position",e.position),v.CSS.setPropertyValue(u,"fontSize",e.fontSize),v.CSS.setPropertyValue(u,"boxSizing","content-box"),$.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(e,t){v.CSS.setPropertyValue(u,t,s+"%")}),v.CSS.setPropertyValue(u,"paddingLeft",s+"em"),l.percentToPxWidth=N.lastPercentToPxWidth=(parseFloat(x.getPropertyValue(u,"width",null,!0))||1)/s,l.percentToPxHeight=N.lastPercentToPxHeight=(parseFloat(x.getPropertyValue(u,"height",null,!0))||1)/s,l.emToPx=N.lastEmToPx=(parseFloat(x.getPropertyValue(u,"paddingLeft"))||1)/s,e.myParent.removeChild(u)}return null===N.remToPx&&(N.remToPx=parseFloat(x.getPropertyValue(r.body,"fontSize"))||16),null===N.vwToPx&&(N.vwToPx=parseFloat(t.innerWidth)/100,N.vhToPx=parseFloat(t.innerHeight)/100),l.remToPx=N.remToPx,l.vwToPx=N.vwToPx,l.vhToPx=N.vhToPx,v.debug>=1&&console.log("Unit ratios: "+JSON.stringify(l),n),l}if(o.begin&&0===w)try{o.begin.call(m,m)}catch(y){setTimeout(function(){throw y},1)}if("scroll"===k){var S=/^x$/i.test(o.axis)?"Left":"Top",V=parseFloat(o.offset)||0,C,A,F;o.container?g.isWrapped(o.container)||g.isNode(o.container)?(o.container=o.container[0]||o.container,C=o.container["scroll"+S],F=C+$(n).position()[S.toLowerCase()]+V):o.container=null:(C=v.State.scrollAnchor[v.State["scrollProperty"+S]],A=v.State.scrollAnchor[v.State["scrollProperty"+("Left"===S?"Top":"Left")]],F=$(n).offset()[S.toLowerCase()]+V),s={scroll:{rootPropertyValue:!1,startValue:C,currentValue:C,endValue:F,unitType:"",easing:o.easing,scrollData:{container:o.container,direction:S,alternateValue:A}},element:n},v.debug&&console.log("tweensContainer (scroll): ",s.scroll,n)}else if("reverse"===k){if(!i(n).tweensContainer)return void $.dequeue(n,o.queue);"none"===i(n).opts.display&&(i(n).opts.display="auto"),"hidden"===i(n).opts.visibility&&(i(n).opts.visibility="visible"),i(n).opts.loop=!1,i(n).opts.begin=null,i(n).opts.complete=null,b.easing||delete o.easing,b.duration||delete o.duration,o=$.extend({},i(n).opts,o);var E=$.extend(!0,{},i(n).tweensContainer);for(var j in E)if("element"!==j){var H=E[j].startValue;E[j].startValue=E[j].currentValue=E[j].endValue,E[j].endValue=H,g.isEmptyObject(b)||(E[j].easing=o.easing),v.debug&&console.log("reverse tweensContainer ("+j+"): "+JSON.stringify(E[j]),n)}s=E}else if("start"===k){var E;i(n).tweensContainer&&i(n).isAnimating===!0&&(E=i(n).tweensContainer),$.each(h,function(e,t){if(RegExp("^"+x.Lists.colors.join("$|^")+"$").test(e)){var r=p(t,!0),n=r[0],o=r[1],i=r[2];if(x.RegEx.isHex.test(n)){for(var s=["Red","Green","Blue"],l=x.Values.hexToRgb(n),u=i?x.Values.hexToRgb(i):a,c=0;cO;O++){var z={delay:F.delay,progress:F.progress};O===R-1&&(z.display=F.display,z.visibility=F.visibility,z.complete=F.complete),S(m,"reverse",z)}return e()}};v=$.extend(S,v),v.animate=S;var P=t.requestAnimationFrame||d;return v.State.isMobile||r.hidden===a||r.addEventListener("visibilitychange",function(){r.hidden?(P=function(e){return setTimeout(function(){e(!0)},16)},c()):P=t.requestAnimationFrame||d}),e.Velocity=v,e!==t&&(e.fn.velocity=S,e.fn.velocity.defaults=v.defaults),$.each(["Down","Up"],function(e,t){v.Redirects["slide"+t]=function(e,r,n,o,i,s){var l=$.extend({},r),u=l.begin,c=l.complete,p={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},f={};l.display===a&&(l.display="Down"===t?"inline"===v.CSS.Values.getDisplayType(e)?"inline-block":"block":"none"),l.begin=function(){u&&u.call(i,i);for(var r in p){f[r]=e.style[r];var a=v.CSS.getPropertyValue(e,r);p[r]="Down"===t?[a,0]:[0,a]}f.overflow=e.style.overflow,e.style.overflow="hidden"},l.complete=function(){for(var t in f)e.style[t]=f[t];c&&c.call(i,i),s&&s.resolver(i)},v(e,p,l)}}),$.each(["In","Out"],function(e,t){v.Redirects["fade"+t]=function(e,r,n,o,i,s){var l=$.extend({},r),u={opacity:"In"===t?1:0},c=l.complete;l.complete=n!==o-1?l.begin=null:function(){c&&c.call(i,i),s&&s.resolver(i)},l.display===a&&(l.display="In"===t?"auto":"none"),v(this,u,l)}}),v}(window.jQuery||window.Zepto||window,window,document)});]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Findex%2F</url>
    <content type="text"><![CDATA[/*! jQuery v2.1.3 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */ !function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.3",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=hb(),z=hb(),A=hb(),B=function(a,b){return a===b&&(l=!0),0},C=1]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Fmain%2F</url>
    <content type="text"><![CDATA[/* normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */ html { line-height: 1.15; /* 1 */ -webkit-text-size-adjust: 100%; /* 2 */ } body { margin: 0; } main { display: block; } h1 { font-size: 2em; margin: 0.67em 0; } hr { box-sizing: content-box; /* 1 */ height: 0; /* 1 */ overflow: visible; /* 2 */ } pre { font-family: monospace, monospace; /* 1 */ font-size: 1em; /* 2 */ } a { background-color: transparent; } abbr[title] { border-bottom: none; /* 1 */ text-decoration: underline; /* 2 */ text-decoration: underline dotted; /* 2 */ } b, strong { font-weight: bolder; } code, kbd, samp { font-family: monospace, monospace; /* 1 */ font-size: 1em; /* 2 */ } small { font-size: 80%; } sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; } sub { bottom: -0.25em; } sup { top: -0.5em; } img { border-style: none; } button, input, optgroup, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 1 */ line-height: 1.15; /* 1 */ margin: 0; /* 2 */ } button, input { /* 1 */ overflow: visible; } button, select { /* 1 */ text-transform: none; } button, [type="button"], [type="reset"], [type="submit"] { -webkit-appearance: button; } button::-moz-focus-inner, [type="button"]::-moz-focus-inner, [type="reset"]::-moz-focus-inner, [type="submit"]::-moz-focus-inner { border-style: none; padding: 0; } button:-moz-focusring, [type="button"]:-moz-focusring, [type="reset"]:-moz-focusring, [type="submit"]:-moz-focusring { outline: 1px dotted ButtonText; } fieldset { padding: 0.35em 0.75em 0.625em; } legend { box-sizing: border-box; /* 1 */ color: inherit; /* 2 */ display: table; /* 1 */ max-width: 100%; /* 1 */ padding: 0; /* 3 */ white-space: normal; /* 1 */ } progress { vertical-align: baseline; } textarea { overflow: auto; } [type="checkbox"], [type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ } [type="number"]::-webkit-inner-spin-button, [type="number"]::-webkit-outer-spin-button { height: auto; } [type="search"] { -webkit-appearance: textfield; /* 1 */ outline-offset: -2px; /* 2 */ } [type="search"]::-webkit-search-decoration { -webkit-appearance: none; } ::-webkit-file-upload-button { -webkit-appearance: button; /* 1 */ font: inherit; /* 2 */ } details { display: block; } summary { display: list-item; } template { display: none; } [hidden] { display: none; } ::selection { background: #262a30; color: #fff; } body { position: relative; font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif; font-size: 14px; line-height: 2; color: #555; background: #f5f7f9; } @media (max-width: 991px) { body { padding-right: 0 !important; } } @media (min-width: 1200px) { body { font-size: 16px; } } h1, h2, h3, h4, h5, h6 { margin: 20px 0 15px; padding: 0; font-weight: bold; line-height: 1.5; font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif; } h1 { font-size: 22px; } h1 code { font-size: 1em; } @media (max-width: 767px) { h1 { font-size: 18px; } h1 code { font-size: 1em; } } h2 { font-size: 20px; } h2 code { font-size: 1em; } @media (max-width: 767px) { h2 { font-size: 16px; } h2 code { font-size: 1em; } } h3 { font-size: 18px; } h3 code { font-size: 1em; } @media (max-width: 767px) { h3 { font-size: 14px; } h3 code { font-size: 1em; } } h4 { font-size: 16px; } h4 code { font-size: 1em; } @media (max-width: 767px) { h4 { font-size: 12px; } h4 code { font-size: 1em; } } h5 { font-size: 14px; } h5 code { font-size: 1em; } @media (max-width: 767px) { h5 { font-size: 10px; } h5 code { font-size: 1em; } } h6 { font-size: 12px; } h6 code { font-size: 1em; } @media (max-width: 767px) { h6 { font-size: 8px; } h6 code { font-size: 1em; } } p { margin: 0 0 20px 0; } a, span.exturl { overflow-wrap: break-word; word-wrap: break-word; background-color: transparent; color: #555; text-decoration: none; outline: none; border-bottom: 1px solid #999; cursor: pointer; } a:hover, span.exturl:hover { color: #222; border-bottom-color: #222; } video { max-width: 100%; display: block; margin-left: auto; margin-right: auto; } img { display: block; margin: auto; max-width: 100%; height: auto; } hr { margin: 40px 0; height: 3px; border: none; background-color: #ddd; background-image: repeating-linear-gradient(-45deg, #fff, #fff 4px, transparent 4px, transparent 8px); } blockquote { margin: 0; padding: 0 15px; color: #666; border-left: 4px solid #ddd; } blockquote cite::before { content: "-"; padding: 0 5px; } dt { font-weight: 700; } dd { margin: 0; padding: 0; } kbd { border: 1px solid #ccc; border-radius: 0.2em; box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1); background-color: #f9f9f9; font-family: inherit; background-image: linear-gradient(top, #eee, #fff, #eee); padding: 0.1em 0.3em; white-space: nowrap; } .text-left { text-align: left; } .text-center { text-align: center; } .text-right { text-align: right; } .text-justify { text-align: justify; } .text-nowrap { white-space: nowrap; } .text-lowercase { text-transform: lowercase; } .text-uppercase { text-transform: uppercase; } .text-capitalize { text-transform: capitalize; } .center-block { display: block; margin-left: auto; margin-right: auto; } .clearfix:before, .clearfix:after { content: " "; display: table; } .clearfix:after { clear: both; } .pullquote { width: 45%; } .pullquote.left { float: left; margin-left: 5px; margin-right: 10px; } .pullquote.right { float: right; margin-left: 10px; margin-right: 5px; } .affix { position: fixed; } .translation { margin-top: -20px; font-size: 14px; color: #999; } .scrollbar-measure { width: 100px; height: 100px; overflow: scroll; position: absolute; top: -9999px; } .use-motion .motion-element { opacity: 0; } .table-container { margin: 20px 0; overflow: auto; -webkit-overflow-scrolling: touch; } table { width: 100%; border-collapse: collapse; border-spacing: 0; font-size: 14px; } table > tbody > tr:nth-of-type(odd) { background-color: #f9f9f9; } table > tbody > tr:hover { background-color: #f5f5f5; } caption, th, td { padding: 8px; text-align: left; vertical-align: middle; font-weight: normal; } th, td { border: 1px solid #ddd; border-bottom: 3px solid #ddd; } th { padding-bottom: 10px; font-weight: 700; } td { border-bottom-width: 1px; } html, body { height: 100%; } .container { position: relative; } .header-inner { margin: 0 auto; padding: 100px 0 70px; width: calc(100% - 20px); } @media (min-width: 1200px) { .container .header-inner { width: 1160px; } } @media (min-width: 1600px) { .container .header-inner { width: 73%; } } .main-inner { margin: 0 auto; width: calc(100% - 20px); } @media (min-width: 1200px) { .container .main-inner { width: 1160px; } } @media (min-width: 1600px) { .container .main-inner { width: 73%; } } .footer { padding: 20px 0; } .footer-inner { box-sizing: border-box; margin: 0px auto; width: calc(100% - 20px); } @media (min-width: 1200px) { .container .footer-inner { width: 1160px; } } @media (min-width: 1600px) { .container .footer-inner { width: 73%; } } pre, .highlight { overflow: auto; margin: 20px 0; padding: 0; font-size: 14px; color: #eaeaea; background: #000; line-height: 1.6; } pre, code { font-family: consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace; } code { overflow-wrap: break-word; word-wrap: break-word; padding: 2px 4px; color: #555; background: #eee; border-radius: 3px; font-size: 14px; } pre { padding: 10px; } pre code { padding: 0; color: #eaeaea; background: none; text-shadow: none; } .highlight { border-radius: 1px; } .highlight pre { border: none; margin: 0; padding: 10px 0; } .highlight table { margin: 0; width: auto; border: none; } .highlight td { border: none; padding: 0; } .highlight figcaption { font-size: 1em; color: #eaeaea; line-height: 1em; margin-bottom: 1em; margin: 0em; padding: 0.5em; background: #eee; border-bottom: 1px solid #e9e9e9; } .highlight figcaption:before, .highlight figcaption:after { content: " "; display: table; } .highlight figcaption:after { clear: both; } .highlight figcaption a { float: right; color: #eaeaea; } .highlight figcaption a:hover { border-bottom-color: #eaeaea; } .highlight .gutter pre { padding-left: 10px; padding-right: 10px; color: #666; text-align: right; background-color: #292929; } .highlight .code pre { width: 100%; padding-left: 10px; padding-right: 10px; background-color: #000; } .highlight .line { height: 20px; } .gutter { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .gist table { width: auto; } .gist table td { border: none; } pre .deletion { background: #800000; } pre .addition { background: #008000; } pre .meta { color: #c397d8; } pre .comment { color: #969896; } pre .variable, pre .attribute, pre .tag, pre .name, pre .regexp, pre .ruby .constant, pre .xml .tag .title, pre .xml .pi, pre .xml .doctype, pre .html .doctype, pre .css .id, pre .css .class, pre .css .pseudo { color: #d54e53; } pre .number, pre .preprocessor, pre .built_in, pre .builtin-name, pre .literal, pre .params, pre .constant, pre .command { color: #e78c45; } pre .ruby .class .title, pre .css .rules .attribute, pre .string, pre .symbol, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata, pre .special, pre .formula { color: #b9ca4a; } pre .title, pre .css .hexcolor { color: #70c0b1; } pre .function, pre .python .decorator, pre .python .title, pre .ruby .function .title, pre .ruby .title .keyword, pre .perl .sub, pre .javascript .title, pre .coffeescript .title { color: #7aa6da; } pre .keyword, pre .javascript .function { color: #c397d8; } .posts-expand .post-body img.full-image { border: none; } .blockquote-center, .page-home .post-type-quote blockquote, .page-post-detail .post-type-quote blockquote { position: relative; margin: 40px 0; padding: 0; border-left: none; text-align: center; } .blockquote-center::before, .page-home .post-type-quote blockquote::before, .page-post-detail .post-type-quote blockquote::before, .blockquote-center::after, .page-home .post-type-quote blockquote::after, .page-post-detail .post-type-quote blockquote::after { position: absolute; content: ' '; display: block; width: 100%; height: 24px; opacity: 0.2; background-repeat: no-repeat; background-position: 0 -6px; background-size: 22px 22px; } .blockquote-center::before, .page-home .post-type-quote blockquote::before, .page-post-detail .post-type-quote blockquote::before { top: -20px; background-image: url("../images/quote-l.svg"); border-top: 1px solid #ccc; } .blockquote-center::after, .page-home .post-type-quote blockquote::after, .page-post-detail .post-type-quote blockquote::after { bottom: -20px; background-image: url("../images/quote-r.svg"); border-bottom: 1px solid #ccc; background-position: 100% 8px; } .blockquote-center p, .page-home .post-type-quote blockquote p, .page-post-detail .post-type-quote blockquote p, .blockquote-center div, .page-home .post-type-quote blockquote div, .page-post-detail .post-type-quote blockquote div { text-align: center; } .post .post-body .group-picture img { box-sizing: border-box; padding: 0 3px; border: none; } .post .group-picture-row { overflow: hidden; margin-top: 6px; } .post .group-picture-row:first-child { margin-top: 0; } .post .group-picture-column { float: left; } .page-post-detail .post-body .group-picture-column { float: none; margin-top: 10px; width: auto !important; } .page-post-detail .post-body .group-picture-column img { margin: 0 auto; } .page-archive .group-picture-container { overflow: hidden; } .page-archive .group-picture-row { float: left; } .page-archive .group-picture-row:first-child { margin-top: 6px; } .page-archive .group-picture-column { max-width: 150px; max-height: 150px; } .post-body .label { display: inline; padding: 0 2px; white-space: nowrap; } .post-body .label.default { background-color: #f0f0f0; } .post-body .label.primary { background-color: #efe6f7; } .post-body .label.info { background-color: #e5f2f8; } .post-body .label.success { background-color: #e7f4e9; } .post-body .label.warning { background-color: #fcf6e1; } .post-body .label.danger { background-color: #fae8eb; } .post-body .note { position: relative; padding: 15px; margin-bottom: 20px; border: 1px solid #eee; border-left-width: 5px; border-radius: 3px; } .post-body .note h2, .post-body .note h3, .post-body .note h4, .post-body .note h5, .post-body .note h6 { margin-top: 0; margin-bottom: 0; border-bottom: initial; padding-top: 0 !important; } .post-body .note p:first-child, .post-body .note ul:first-child, .post-body .note ol:first-child, .post-body .note table:first-child, .post-body .note pre:first-child, .post-body .note blockquote:first-child { margin-top: 0; } .post-body .note p:last-child, .post-body .note ul:last-child, .post-body .note ol:last-child, .post-body .note table:last-child, .post-body .note pre:last-child, .post-body .note blockquote:last-child { margin-bottom: 0; } .post-body .note.default { border-left-color: #777; } .post-body .note.default h2, .post-body .note.default h3, .post-body .note.default h4, .post-body .note.default h5, .post-body .note.default h6 { color: #777; } .post-body .note.primary { border-left-color: #6f42c1; } .post-body .note.primary h2, .post-body .note.primary h3, .post-body .note.primary h4, .post-body .note.primary h5, .post-body .note.primary h6 { color: #6f42c1; } .post-body .note.info { border-left-color: #428bca; } .post-body .note.info h2, .post-body .note.info h3, .post-body .note.info h4, .post-body .note.info h5, .post-body .note.info h6 { color: #428bca; } .post-body .note.success { border-left-color: #5cb85c; } .post-body .note.success h2, .post-body .note.success h3, .post-body .note.success h4, .post-body .note.success h5, .post-body .note.success h6 { color: #5cb85c; } .post-body .note.warning { border-left-color: #f0ad4e; } .post-body .note.warning h2, .post-body .note.warning h3, .post-body .note.warning h4, .post-body .note.warning h5, .post-body .note.warning h6 { color: #f0ad4e; } .post-body .note.danger { border-left-color: #d9534f; } .post-body .note.danger h2, .post-body .note.danger h3, .post-body .note.danger h4, .post-body .note.danger h5, .post-body .note.danger h6 { color: #d9534f; } .post-body .tabs { position: relative; display: block; margin-bottom: 20px; padding-top: 10px; } .post-body .tabs ul.nav-tabs { margin: 0; padding: 0; display: flex; margin-bottom: -1px; } @media (max-width: 413px) { .post-body .tabs ul.nav-tabs { display: block; margin-bottom: 5px; } } .post-body .tabs ul.nav-tabs li.tab { list-style-type: none !important; margin: 0 0.25em 0 0; border-top: 3px solid transparent; border-left: 1px solid transparent; border-right: 1px solid transparent; } @media (max-width: 413px) { .post-body .tabs ul.nav-tabs li.tab { margin: initial; border-top: 1px solid transparent; border-left: 3px solid transparent; border-right: 1px solid transparent; border-bottom: 1px solid transparent; } } .post-body .tabs ul.nav-tabs li.tab a { outline: 0; border-bottom: initial; display: block; line-height: 1.8em; padding: 0.25em 0.75em; transition-duration: 0.2s; transition-timing-function: ease-out; transition-delay: 0s; } .post-body .tabs ul.nav-tabs li.tab a i { width: 1.285714285714286em; } .post-body .tabs ul.nav-tabs li.tab.active { border-top: 3px solid #fc6423; border-left: 1px solid #ddd; border-right: 1px solid #ddd; background-color: #fff; } @media (max-width: 413px) { .post-body .tabs ul.nav-tabs li.tab.active { border-top: 1px solid #ddd; border-left: 3px solid #fc6423; border-right: 1px solid #ddd; border-bottom: 1px solid #ddd; } } .post-body .tabs ul.nav-tabs li.tab.active a { cursor: default; color: #555; } .post-body .tabs .tab-content { background-color: #fff; } .post-body .tabs .tab-content .tab-pane { border: 1px solid #ddd; padding: 20px 20px 0 20px; } .post-body .tabs .tab-content .tab-pane:not(.active) { display: none; } .post-body .tabs .tab-content .tab-pane.active { display: block; } .btn { display: inline-block; padding: 0 20px; font-size: 14px; color: #555; background: #fff; border: 2px solid #555; text-decoration: none; border-radius: 2px; transition-property: background-color; transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; line-height: 2; } .btn:hover { border-color: #222; color: #fff; background: #222; } .btn +.btn { margin: 0 0 8px 8px; } .btn .fa-fw { width: 1.285714285714286em; text-align: left; } .btn-bar { display: block; width: 22px; height: 2px; background: #555; border-radius: 1px; } .btn-bar+.btn-bar { margin-top: 4px; } .pagination { margin: 120px 0 40px; text-align: center; border-top: 1px solid #eee; } .page-number-basic, .pagination .prev, .pagination .next, .pagination .page-number, .pagination .space { display: inline-block; position: relative; top: -1px; margin: 0 10px; padding: 0 11px; } @media (max-width: 767px) { .page-number-basic, .pagination .prev, .pagination .next, .pagination .page-number, .pagination .space { margin: 0 5px; } } .pagination .prev, .pagination .next, .pagination .page-number { border-bottom: 0; border-top: 1px solid #eee; transition-property: border-color; transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; } .pagination .prev:hover, .pagination .next:hover, .pagination .page-number:hover { border-top-color: #222; } .pagination .space { padding: 0; margin: 0; } .pagination .prev { margin-left: 0; } .pagination .next { margin-right: 0; } .pagination .page-number.current { color: #fff; background: #ccc; border-top-color: #ccc; } @media (max-width: 767px) { .pagination { border-top: none; } .pagination .prev, .pagination .next, .pagination .page-number { margin-bottom: 10px; border-top: 0; border-bottom: 1px solid #eee; padding: 0 10px; } .pagination .prev:hover, .pagination .next:hover, .pagination .page-number:hover { border-bottom-color: #222; } } .comments { margin: 60px 20px 0; } .back-to-top { box-sizing: border-box; position: fixed; bottom: -100px; right: 30px; z-index: 1050; padding: 0 6px; width: initial; background: #222; font-size: 12px; opacity: 0.6; color: #fff; cursor: pointer; text-align: center; transition-property: bottom; transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; } .back-to-top.back-to-top-on { bottom: 30px; } .back-to-top:hover { color: #fc6423; } .header { background: transparent; } .header-inner { position: relative; } .headband { height: 3px; background: #222; } .site-meta { margin: 0; text-align: center; } @media (max-width: 767px) { .site-meta { text-align: center; } } .brand { position: relative; display: inline-block; padding: 0 40px; color: #fff; background: #222; border-bottom: none; } .brand:hover { color: #fff; } .logo { display: inline-block; margin-right: 5px; line-height: 36px; vertical-align: top; } .site-title { display: inline-block; vertical-align: top; line-height: 36px; font-size: 20px; font-weight: normal; font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif; } .site-subtitle { margin-top: 10px; font-size: 13px; color: #ddd; } .use-motion .brand { opacity: 0; } .use-motion .logo, .use-motion .site-title, .use-motion .site-subtitle, .use-motion .custom-logo-image { opacity: 0; position: relative; top: -10px; } .site-nav-toggle { display: none; position: absolute; top: 10px; left: 10px; } @media (max-width: 767px) { .site-nav-toggle { display: block; } } .site-nav-toggle button { margin-top: 2px; padding: 9px 10px; background: transparent; border: none; } @media (max-width: 767px) { .site-nav { display: none; margin: 0 -10px; padding: 0 10px; clear: both; border-top: 1px solid #ddd; } } @media (min-width: 768px) and (max-width: 991px) { .site-nav { display: block !important; } } @media (min-width: 992px) { .site-nav { display: block !important; } } .menu { margin-top: 20px; padding-left: 0; text-align: center; } .menu .menu-item { display: inline-block; margin: 0 10px; list-style: none; } @media (max-width: 767px) { .menu .menu-item { margin-top: 10px; } } .menu .menu-item a, .menu .menu-item span.exturl { display: block; font-size: 13px; line-height: inherit; border-bottom: 1px solid transparent; transition-property: border-color; transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; } .menu .menu-item a:hover, .menu .menu-item span.exturl:hover { border-bottom-color: #222; } .menu .menu-item .fa { margin-right: 5px; } .use-motion .menu-item { opacity: 0; } .post-body { overflow-wrap: break-word; word-wrap: break-word; font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif; } .post-body span.exturl .fa { font-size: 14px; margin-left: 4px; } .post-body .fancybox img { display: block !important; margin: 0 auto; cursor: pointer; cursor: zoom-in; } .post-body .image-caption, .post-body .figure .caption { margin: -20px auto 15px; text-align: center; font-size: 14px; color: #999; font-weight: bold; line-height: 1; } .post-sticky-flag { display: inline-block; font-size: 16px; transform: rotate(30deg); } .use-motion .post-block, .use-motion .pagination, .use-motion .comments { opacity: 0; } .use-motion .post-header { opacity: 0; } .use-motion .post-body { opacity: 0; } .use-motion .collection-title { opacity: 0; } .posts-expand { padding-top: 40px; } @media (max-width: 767px) { .posts-expand { margin: 0 20px; } .post-body pre .gutter pre { padding-right: 10px; } .post-body .highlight { margin-left: 0px; margin-right: 0px; padding: 0; } .post-body .highlight .gutter pre { padding-right: 10px; } } @media (min-width: 992px) { .posts-expand .post-body { text-align: justify; } } @media (max-width: 991px) { .posts-expand .post-body { text-align: justify; } } .posts-expand .post-body h2, .posts-expand .post-body h3, .posts-expand .post-body h4, .posts-expand .post-body h5, .posts-expand .post-body h6 { padding-top: 10px; } .posts-expand .post-body h2 .header-anchor, .posts-expand .post-body h3 .header-anchor, .posts-expand .post-body h4 .header-anchor, .posts-expand .post-body h5 .header-anchor, .posts-expand .post-body h6 .header-anchor { float: right; margin-left: 10px; color: #ccc; border-bottom-style: none; visibility: hidden; } .posts-expand .post-body h2 .header-anchor:hover, .posts-expand .post-body h3 .header-anchor:hover, .posts-expand .post-body h4 .header-anchor:hover, .posts-expand .post-body h5 .header-anchor:hover, .posts-expand .post-body h6 .header-anchor:hover { color: inherit; } .posts-expand .post-body h2:hover .header-anchor, .posts-expand .post-body h3:hover .header-anchor, .posts-expand .post-body h4:hover .header-anchor, .posts-expand .post-body h5:hover .header-anchor, .posts-expand .post-body h6:hover .header-anchor { visibility: visible; } .posts-expand .post-body img { box-sizing: border-box; margin: 0 auto 25px; padding: 3px; border: 1px solid #ddd; } @media (max-width: 767px) { .posts-collapse { margin: 0 20px; } .posts-collapse .post-title, .posts-collapse .post-meta { display: block; width: auto; text-align: left; } } .posts-collapse { position: relative; z-index: 1010; margin-left: 55px; } .posts-collapse::after { content: " "; position: absolute; top: 20px; left: 0; margin-left: -2px; width: 4px; height: 100%; background: #f5f5f5; z-index: -1; } @media (max-width: 767px) { .posts-collapse { margin: 0 20px; } } .posts-collapse .collection-title { position: relative; margin: 60px 0; } .posts-collapse .collection-title h1, .posts-collapse .collection-title h2 { margin-left: 20px; } .posts-collapse .collection-title small { color: #bbb; margin-left: 5px; } .posts-collapse .collection-title::before { content: " "; position: absolute; left: 0; top: 50%; margin-left: -4px; margin-top: -4px; width: 8px; height: 8px; background: #bbb; border-radius: 50%; } .posts-collapse .post { margin: 30px 0; } .posts-collapse .post-header { position: relative; transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; transition-property: border; border-bottom: 1px dashed #ccc; } .posts-collapse .post-header::before { content: " "; position: absolute; left: 0; top: 12px; width: 6px; height: 6px; margin-left: -4px; background: #bbb; border-radius: 50%; border: 1px solid #fff; transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; transition-property: background; } .posts-collapse .post-header:hover { border-bottom-color: #666; } .posts-collapse .post-header:hover::before { background: #222; } .posts-collapse .post-meta { position: absolute; font-size: 12px; left: 20px; top: 5px; } .posts-collapse .post-comments-count { display: none; } .posts-collapse .post-title { margin-left: 60px; font-size: 16px; font-weight: normal; line-height: inherit; } .posts-collapse .post-title::after { margin-left: 3px; opacity: 0.6; } .posts-collapse .post-title a, .posts-collapse .post-title span.exturl { color: #666; border-bottom: none; } .page-home .post-type-quote .post-header, .page-post-detail .post-type-quote .post-header, .page-home .post-type-quote .post-tags, .page-post-detail .post-type-quote .post-tags { display: none; } .posts-expand .post-title { overflow-wrap: break-word; word-wrap: break-word; text-align: center; font-weight: 400; } .posts-expand .post-title-link { display: inline-block; position: relative; color: #555; border-bottom: none; line-height: 1.2; vertical-align: top; } .posts-expand .post-title-link::before { content: ""; position: absolute; width: 100%; height: 2px; bottom: 0; left: 0; background-color: #000; visibility: hidden; transform: scaleX(0); transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; } .posts-expand .post-title-link:hover::before { visibility: visible; transform: scaleX(1); } .posts-expand .post-title-link .fa { font-size: 20px; margin-left: 5px; } .posts-expand .post-meta { margin: 3px 0 60px 0; color: #999; font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif; font-size: 12px; text-align: center; } .posts-expand .post-meta .post-category-list { display: inline-block; margin: 0; padding: 3px; } .posts-expand .post-meta .post-category-list-link { color: #999; } .posts-expand .post-meta .post-description { font-size: 14px; margin-top: 2px; } .posts-expand .post-meta time { border-bottom: 1px dashed #999; cursor: help; } .post-meta-divider { margin: 0 0.5em; } .post-meta-item-icon { margin-right: 3px; } @media (min-width: 768px) and (max-width: 991px) { .post-meta-item-icon { display: inline-block; } } @media (max-width: 767px) { .post-meta-item-icon { display: inline-block; } } @media (min-width: 768px) and (max-width: 991px) { .post-meta-item-text { display: none; } } @media (max-width: 767px) { .post-meta-item-text { display: none; } } .post-button { margin-top: 40px; } .posts-expand .post-tags { margin-top: 40px; text-align: center; } .posts-expand .post-tags a { display: inline-block; margin-right: 10px; font-size: 13px; } .post-nav { display: table; margin-top: 15px; width: 100%; border-top: 1px solid #eee; } .post-nav-divider { display: table-cell; width: 10%; } .post-nav-item { display: table-cell; padding: 10px 0 0 0; width: 45%; vertical-align: top; } .post-nav-item a { position: relative; display: block; line-height: 25px; font-size: 14px; color: #555; border-bottom: none; } .post-nav-item a:hover { color: #222; border-bottom: none; } .post-nav-item a:active { top: 2px; } .post-nav-item .fa { font-size: 12px; margin-right: 5px; } .post-nav-next a { padding-left: 5px; } .post-nav-prev { text-align: right; } .post-nav-prev a { padding-right: 5px; } .post-nav-prev .fa { margin-left: 5px; } .posts-expand .post-eof { display: block; margin: 80px auto 60px; width: 8%; height: 1px; background: #ccc; text-align: center; } .post:last-child .post-eof.post-eof.post-eof { display: none; } .post-gallery { display: table; table-layout: fixed; width: 100%; border-collapse: separate; } .post-gallery-row { display: table-row; } .post-gallery .post-gallery-img { display: table-cell; text-align: center; vertical-align: middle; border: none; } .post-gallery .post-gallery-img img { max-width: 100%; max-height: 100%; border: none; } .fancybox-close, .fancybox-close:hover { border: none; } .rtl.post-body p, .rtl.post-body a, .rtl.post-body h1, .rtl.post-body h2, .rtl.post-body h3, .rtl.post-body h4, .rtl.post-body h5, .rtl.post-body h6, .rtl.post-body li, .rtl.post-body ul, .rtl.post-body ol { direction: rtl; font-family: UKIJ Ekran; } .rtl.post-title { font-family: UKIJ Ekran; } .sidebar { position: fixed; right: 0; top: 0; bottom: 0; width: 0; z-index: 1040; box-shadow: inset 0 2px 6px #000; background: #222; } .sidebar a, .sidebar span.exturl { color: #999; border-bottom-color: #555; } .sidebar a:hover, .sidebar span.exturl:hover { color: #eee; border-bottom-color: #eee; } @media (max-width: 991px) { .sidebar { display: none; } } .sidebar-inner { position: relative; padding: 20px 10px; color: #999; text-align: center; } .site-overview-wrap { overflow: hidden; } .site-overview { overflow-y: auto; overflow-x: hidden; } .cc-license { margin-top: 10px; text-align: center; } .cc-license .cc-opacity { opacity: 0.7; border-bottom: none; } .cc-license .cc-opacity:hover { opacity: 0.9; } .cc-license img { display: inline-block; } .sidebar-toggle { position: fixed; right: 30px; bottom: 45px; width: 14px; height: 14px; padding: 5px; background: #222; line-height: 0; z-index: 1050; cursor: pointer; } .sidebar-toggle:hover .sidebar-toggle-line { background: #fc6423; } @media (max-width: 991px) { .sidebar-toggle { display: none; } } .sidebar-toggle-line { position: relative; display: inline-block; vertical-align: top; height: 2px; width: 100%; background: #fff; margin-top: 3px; } .sidebar-toggle-line:first-child { margin-top: 0; } .site-author-image { display: block; margin: 0 auto; padding: 2px; max-width: 120px; height: auto; border: 1px solid #eee; opacity: 1; } .site-author-name { margin: 0; text-align: center; color: #222; font-weight: 600; } .site-description { margin-top: 0; text-align: center; font-size: 13px; color: #999; } .links-of-author { margin-top: 20px; } .links-of-author a, .links-of-author span.exturl { display: inline-block; vertical-align: middle; margin-right: 10px; margin-bottom: 10px; border-bottom-color: #555; font-size: 13px; } .links-of-author a:before, .links-of-author span.exturl:before { display: inline-block; vertical-align: middle; margin-right: 3px; content: " "; width: 4px; height: 4px; border-radius: 50%; background: #30ff6f; } .feed-link, .chat { margin-top: 10px; } .feed-link a, .chat a { display: inline-block; padding: 0 15px; color: #fc6423; border: 1px solid #fc6423 !important; border-radius: 4px; } .feed-link a i, .chat a i { color: #fc6423; font-size: 14px; } .feed-link a:hover, .chat a:hover { color: #fff; background: #fc6423; } .feed-link a:hover i, .chat a:hover i { color: #fff; } .links-of-blogroll { margin-top: 10px; font-size: 13px; } .links-of-blogroll-title { margin-top: 0; font-size: 14px; font-weight: 600; } .links-of-blogroll-list { margin: 0; padding: 0; list-style: none; } .links-of-blogroll-item { padding: 2px 10px; } .links-of-blogroll-item a, .links-of-blogroll-item span.exturl { max-width: 280px; box-sizing: border-box; display: inline-block; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; } .sidebar-nav { margin: 0 0 20px; padding-left: 0; } .sidebar-nav li { display: inline-block; cursor: pointer; border-bottom: 1px solid transparent; font-size: 14px; color: #555; } .sidebar-nav li:hover { color: #fc6423; } .page-post-detail .sidebar-nav-toc { padding: 0 5px; } .page-post-detail .sidebar-nav-overview { margin-left: 10px; } .sidebar-nav .sidebar-nav-active { color: #fc6423; border-bottom-color: #fc6423; } .sidebar-nav .sidebar-nav-active:hover { color: #fc6423; } .sidebar-panel { display: none; } .sidebar-panel-active { display: block; } .site-state { display: flex; justify-content: center; overflow: hidden; line-height: 1.4; white-space: nowrap; text-align: center; margin-top: 10px; } .site-state-item { padding: 0 15px; border-left: 1px solid #eee; } .site-state-item:first-child { border-left: none; } .site-state-item a { border-bottom: none; } .site-state-item-count { display: block; text-align: center; color: inherit; font-weight: 600; font-size: 16px; } .site-state-item-name { font-size: 13px; color: #999; } .post-toc-empty { font-size: 14px; color: #666; } .post-toc-wrap { overflow: hidden; } .post-toc { overflow: auto; } .post-toc ol { margin: 0; padding: 0 2px 5px 10px; text-align: left; list-style: none; font-size: 14px; } .post-toc ol > ol { padding-left: 0; } .post-toc ol a { transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; transition-property: all; color: #666; border-bottom-color: #ccc; } .post-toc ol a:hover { color: #000; border-bottom-color: #000; } .post-toc .nav-item { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; line-height: 1.8; } .post-toc .nav .nav-child { display: none; } .post-toc .nav .active > .nav-child { display: block; } .post-toc .nav .active-current > .nav-child { display: block; } .post-toc .nav .active-current > .nav-child > .nav-item { display: block; } .post-toc .nav .active > a { color: #fc6423; border-bottom-color: #fc6423; } .post-toc .nav .active-current > a { color: #fc6423; } .post-toc .nav .active-current > a:hover { color: #fc6423; } .footer { font-size: 14px; color: #999; } .footer img { border: none; } .footer-inner { text-align: center; } .with-love { display: inline-block; margin: 0 5px; color: #808080; } .powered-by, .theme-info { display: inline-block; } @-moz-keyframes iconAnimate { 0%, 100% { transform: scale(1); } 10%, 30% { transform: scale(0.9); } 20%, 40%, 60%, 80% { transform: scale(1.1); } 50%, 70% { transform: scale(1.1); } } @-webkit-keyframes iconAnimate { 0%, 100% { transform: scale(1); } 10%, 30% { transform: scale(0.9); } 20%, 40%, 60%, 80% { transform: scale(1.1); } 50%, 70% { transform: scale(1.1); } } @-o-keyframes iconAnimate { 0%, 100% { transform: scale(1); } 10%, 30% { transform: scale(0.9); } 20%, 40%, 60%, 80% { transform: scale(1.1); } 50%, 70% { transform: scale(1.1); } } @keyframes iconAnimate { 0%, 100% { transform: scale(1); } 10%, 30% { transform: scale(0.9); } 20%, 40%, 60%, 80% { transform: scale(1.1); } 50%, 70% { transform: scale(1.1); } } .local-search-pop-overlay { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: 2080; background-color: rgba(0,0,0,0.3); } .local-search-popup { display: none; position: fixed; top: 10%; left: 50%; margin-left: -350px; width: 700px; height: 80%; padding: 0; background: #fff; color: #333; z-index: 9999; border-radius: 5px; } @media (max-width: 767px) { .local-search-popup { padding: 0; top: 0; left: 0; margin: 0; width: 100%; height: 100%; border-radius: 0; } } .local-search-popup ul.search-result-list { padding: 0; margin: 0 5px; } .local-search-popup p.search-result { border-bottom: 1px dashed #ccc; padding: 5px 0; } .local-search-popup a.search-result-title { font-weight: bold; font-size: 16px; } .local-search-popup .search-keyword { border-bottom: 1px dashed #f00; font-weight: bold; color: #f00; } .local-search-popup .local-search-header { padding: 5px; height: 36px; background: #f5f5f5; border-top-left-radius: 5px; border-top-right-radius: 5px; } .local-search-popup #local-search-result { overflow: auto; position: relative; padding: 5px 25px; height: calc(100% - 55px); } .local-search-popup .local-search-input-wrapper { display: inline-block; width: calc(100% - 90px); height: 36px; line-height: 36px; padding: 0 5px; } .local-search-popup .local-search-input-wrapper input { padding: 8px 0; height: 20px; display: block; width: 100%; outline: none; border: none; background: transparent; vertical-align: middle; } .local-search-popup .search-icon, .local-search-popup .popup-btn-close { display: inline-block; font-size: 18px; color: #999; height: 36px; width: 18px; padding-left: 10px; padding-right: 10px; } .local-search-popup .search-icon { float: left; } .local-search-popup .popup-btn-close { border-left: 1px solid #eee; float: right; cursor: pointer; } .local-search-popup #no-result { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: #ccc; } .copy-btn { display: inline-block; padding: 6px 12px; font-size: 13px; font-weight: 700; line-height: 20px; color: #333; white-space: nowrap; vertical-align: middle; cursor: pointer; background-color: #eee; background-image: linear-gradient(#fcfcfc, #eee); border: 1px solid #d5d5d5; border-radius: 3px; user-select: none; outline: 0; } .highlight-wrap .copy-btn { transition: opacity 0.3s ease-in-out; opacity: 0; padding: 2px 6px; position: absolute; right: 4px; top: 8px; } .highlight-wrap:hover .copy-btn, .highlight-wrap .copy-btn:focus { opacity: 1; } .highlight-wrap { position: relative; } .page-archive .archive-page-counter { position: relative; top: 3px; left: 20px; } @media (max-width: 767px) { .page-archive .archive-page-counter { top: 5px; } } .page-archive .posts-collapse .archive-move-on { position: absolute; top: 11px; left: 0; margin-left: -6px; width: 10px; height: 10px; opacity: 0.5; background: #555; border: 1px solid #fff; border-radius: 50%; } .page-archive .fa-external-link { font-size: 15px; margin-left: 5px; } .category-all-page .category-all-title { text-align: center; } .category-all-page .category-all { margin-top: 20px; } .category-all-page .category-list { margin: 0; padding: 0; list-style: none; } .category-all-page .category-list-item { margin: 5px 10px; } .category-all-page .category-list-count { color: #bbb; } .category-all-page .category-list-count:before { display: inline; content: " ("; } .category-all-page .category-list-count:after { display: inline; content: ") "; } .category-all-page .category-list-child { padding-left: 10px; } #event-list { padding-left: 30px; } #event-list hr { margin: 20px 0 45px 0 !important; background: #222; } #event-list hr:after { display: inline-block; content: 'NOW'; background: #222; color: #fff; font-weight: bold; text-align: right; padding: 0 5px; } #event-list li.event { margin: 20px 0px; background: #f9f9f9; padding-left: 10px; min-height: 40px; } #event-list li.event h2.event-summary { margin: 0; padding-bottom: 3px; } #event-list li.event h2.event-summary:before { display: inline-block; font-family: FontAwesome; font-size: 8px; content: '\f111'; vertical-align: middle; margin-right: 25px; color: #bbb; } #event-list li.event span.event-relative-time { display: inline-block; font-size: 12px; font-weight: 400; padding-left: 12px; color: #bbb; } #event-list li.event span.event-details { display: block; color: #bbb; margin-left: 56px; padding-top: 3px; padding-bottom: 6px; text-indent: -24px; line-height: 18px; } #event-list li.event span.event-details:before { text-indent: 0; display: inline-block; width: 14px; font-family: FontAwesome; text-align: center; margin-right: 9px; color: #bbb; } #event-list li.event span.event-details.event-location:before { content: '\f041'; } #event-list li.event span.event-details.event-duration:before { content: '\f017'; } #event-list li.event-past { background: #fcfcfc; padding: 15px 0 15px 10px; } #event-list li.event-past > * { opacity: 0.9; } #event-list li.event-past h2.event-summary { color: #bbb; } #event-list li.event-past h2.event-summary:before { color: #dfdfdf; } #event-list li.event-now { background: #222; color: #fff; padding: 15px 0 15px 10px; } #event-list li.event-now h2.event-summary:before { transform: scale(1.2); color: #fff; animation: dot-flash 1s alternate infinite ease-in-out; } #event-list li.event-now * { color: #fff !important; } #event-list li.event-future { background: #222; color: #fff; padding: 15px 0 15px 10px; } #event-list li.event-future h2.event-summary:before { transform: scale(1.2); color: #fff; animation: dot-flash 1s alternate infinite ease-in-out; } #event-list li.event-future * { color: #fff !important; } @-moz-keyframes dot-flash { from { opacity: 1; transform: scale(1.1); } to { opacity: 0; transform: scale(1); } } @-webkit-keyframes dot-flash { from { opacity: 1; transform: scale(1.1); } to { opacity: 0; transform: scale(1); } } @-o-keyframes dot-flash { from { opacity: 1; transform: scale(1.1); } to { opacity: 0; transform: scale(1); } } @keyframes dot-flash { from { opacity: 1; transform: scale(1.1); } to { opacity: 0; transform: scale(1); } } .page-post-detail .sidebar-toggle-line { background: #fc6423; } .page-post-detail .comments { overflow: hidden; } ul.breadcrumb { list-style: none; margin: 1em 0; padding: 0 2em; text-align: center; font-size: 12px; } ul.breadcrumb li { display: inline; } ul.breadcrumb li+li:before { padding: 0.5em; font-weight: normal; content: "/\00a0"; } ul.breadcrumb li+li:last-child { font-weight: bold; } .tag-cloud { text-align: center; } .tag-cloud a { display: inline-block; margin: 10px; } .tag-cloud a:hover { color: #222 !important; } .header { position: relative; margin: 0 auto; width: calc(100% - 20px); } @media (min-width: 1200px) { .header { width: 1160px; } } @media (min-width: 1600px) { .header { width: 73%; } } @media (max-width: 991px) { .header { width: auto; } } .header-inner { position: absolute; top: 0; overflow: hidden; padding: 0; width: 240px; background: #fff; box-shadow: initial; border-radius: initial; } @media (min-width: 1200px) { .container .header-inner { width: 240px; } } @media (max-width: 991px) { .header-inner { position: relative; width: auto; border-radius: initial; } } .main:before, .main:after { content: " "; display: table; } .main:after { clear: both; } @media (max-width: 991px) { .container .main-inner { width: auto; } } .content-wrap { float: right; box-sizing: border-box; padding: 40px; width: calc(100% - 252px); background: #fff; min-height: 700px; box-shadow: initial; border-radius: initial; } @media (min-width: 768px) and (max-width: 991px) { .content-wrap { width: 100%; padding: 20px; border-radius: initial; } } @media (max-width: 767px) { .content-wrap { width: 100%; padding: 20px; min-height: auto; border-radius: initial; } } .sidebar { position: static; float: left; margin-left: -100%; width: 240px; background: #f5f7f9; box-shadow: none; } @media (max-width: 991px) { .sidebar { display: none; } } .sidebar-toggle { display: none; } .footer-inner { padding-left: 260px; } @media (max-width: 991px) { .footer-inner { width: auto; padding-left: 0 !important; padding-right: 0 !important; } } .sidebar-position-right .header-inner { right: 0; } .sidebar-position-right .content-wrap { float: left; } .sidebar-position-right .sidebar { float: right; } .sidebar-position-right .footer-inner { padding-left: 0; padding-right: 260px; } .site-brand-wrapper { position: relative; } .site-meta { padding: 20px 0; color: #fff; background: #222; } @media (max-width: 991px) { .site-meta { box-shadow: 0 0 16px rgba(0,0,0,0.5); } } .brand { padding: 0; background: none; } .brand:hover { color: #fff; } .site-subtitle { margin: 10px 10px 0; font-weight: initial; } .custom-logo-image { margin-top: 20px; } @media (max-width: 991px) { .custom-logo-image { display: none; } } .site-search form { display: none; } .site-nav { border-top: none; } @media (min-width: 768px) and (max-width: 991px) { .site-nav { display: none !important; } } @media (min-width: 768px) and (max-width: 991px) { .site-nav-on { display: block !important; } } .menu-item-active a, .menu .menu-item a:hover, .menu .menu-item span.exturl:hover { background: #f9f9f9; border-bottom-color: #fff; } .menu-item-active a:after, .menu .menu-item a:hover:after, .menu .menu-item span.exturl:hover:after { content: " "; position: absolute; top: 50%; margin-top: -3px; right: 15px; width: 6px; height: 6px; border-radius: 50%; background-color: #bbb; } .menu .menu-item { display: block; margin: 0; } .menu .menu-item a, .menu .menu-item span.exturl { position: relative; box-sizing: border-box; padding: 5px 20px; text-align: left; line-height: inherit; transition-property: background-color; transition-duration: 0.2s; transition-timing-function: ease-in-out; transition-delay: 0s; } @media (hover: none) { .menu .menu-item a:hover, .menu .menu-item span.exturl:hover { background: none; } } .menu .menu-item .badge { display: inline-block; padding: 2px 5px; font-weight: 700; line-height: 1; color: #fff; text-align: center; white-space: nowrap; vertical-align: middle; background-color: #ccc; border-radius: 10px; float: right; margin: 0.35em 0 0 0; text-shadow: 1px 1px 0px rgba(0,0,0,0.1); } .menu .menu-item br { display: none; } .btn-bar { background-color: #fff; } .site-nav-toggle { left: 20px; top: 50%; transform: translateY(-50%); } @media (min-width: 768px) and (max-width: 991px) { .site-nav-toggle { display: block; } } .sub-menu { margin: 0; padding: 6px 0; background: #fff !important; border-bottom: 1px solid #ddd; } .sub-menu .menu-item { display: inline-block !important; } .sub-menu .menu-item a, .sub-menu .menu-item span.exturl { padding: initial !important; margin: 5px 10px; } .sub-menu .menu-item a:hover, .sub-menu .menu-item span.exturl:hover { background: initial !important; color: #fc6423; } .sub-menu .menu-item-active a { background: #fff !important; color: #fc6423; border-bottom-color: #fc6423; } .sub-menu .menu-item-active a:hover { background: #fff !important; border-bottom-color: #fc6423; } .sub-menu .menu-item-active a:after { content: initial; } .use-motion .sidebar .motion-element { opacity: 1; } .sidebar { right: auto; bottom: auto; -webkit-transform: none; } .sidebar a, .sidebar span.exturl { color: #555; } .sidebar a:hover, .sidebar span.exturl:hover { color: #222; border-bottom-color: #222; } .sidebar-inner { box-sizing: border-box; width: 240px; color: #555; background: #fff; box-shadow: initial; border-radius: initial; opacity: 0; } .sidebar-inner.affix { position: fixed; top: 12px; } .sidebar-inner.affix-bottom { position: absolute; } .site-overview { text-align: left; } .site-author:before, .site-author:after { content: " "; display: table; } .site-author:after { clear: both; } .site-state-item { padding: 0 10px; } .feed-link, .chat { border-top: 1px dotted #ccc; border-bottom: 1px dotted #ccc; text-align: center; } .feed-link a, .chat a { display: block; color: #fc6423; border: none; } .feed-link a:hover, .chat a:hover { background: none; color: #e34603; } .feed-link a:hover i, .chat a:hover i { color: #e34603; } .links-of-author { display: flex; flex-wrap: wrap; justify-content: center; } .links-of-author span.exturl { font-size: 13px; } .links-of-author-item { margin: 5px 0 0; width: 50%; } .links-of-author-item a, .links-of-author-item span.exturl { max-width: 216px; box-sizing: border-box; display: inline-block; margin-right: 0; margin-bottom: 0; padding: 0 5px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; } .links-of-author-item a:before, .links-of-author-item span.exturl:before { display: none; } .links-of-author-item a, .links-of-author-item span.exturl { border-bottom: none; text-decoration: underline; } .links-of-author-item a, .links-of-author-item span.exturl { display: block; text-decoration: none; } .links-of-author-item a:hover, .links-of-author-item span.exturl:hover { border-radius: 4px; background: #eee; } .links-of-author-item .fa { margin-right: 2px; font-size: 16px; } .links-of-author-item .fa-globe { font-size: 15px; } .links-of-blogroll { text-align: center; padding: 3px 0 0; } .links-of-blogroll-item { padding: 0; } .links-of-blogroll-inline:before, .links-of-blogroll-inline:after { content: " "; display: table; } .links-of-blogroll-inline:after { clear: both; } .links-of-blogroll-inline .links-of-blogroll-item { margin: 5px 0 0; width: 50%; display: inline-block; width: unset; } .links-of-blogroll-inline .links-of-blogroll-item a, .links-of-blogroll-inline .links-of-blogroll-item span.exturl { max-width: 216px; box-sizing: border-box; display: inline-block; margin-right: 0; margin-bottom: 0; padding: 0 5px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2020%2F12%2F08%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F%E7%AC%AC3%E7%AB%A0%20Python%E7%9A%84%E5%9B%BE%E8%A1%A8%E7%BB%98%E5%88%B6%20_%20%E8%BD%A6%E6%96%8C%E7%9A%84%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files%2Ffont-awesome.min%2F</url>
    <content type="text"><![CDATA[/*! * Font Awesome 4.7.0 by @davegandy - http://fontawesome.io - @fontawesome * License - http://fontawesome.io/license (Font: SIL OFL 1.1, CSS: MIT License) */@font-face{font-family:'FontAwesome';src:url('../fonts/fontawesome-webfont.eot?v=4.7.0');src:url('../fonts/fontawesome-webfont.eot?#iefix&v=4.7.0') format('embedded-opentype'),url('../fonts/fontawesome-webfont.woff2?v=4.7.0') format('woff2'),url('../fonts/fontawesome-webfont.woff?v=4.7.0') format('woff'),url('../fonts/fontawesome-webfont.ttf?v=4.7.0') format('truetype'),url('../fonts/fontawesome-webfont.svg?v=4.7.0#fontawesomeregular') format('svg');font-weight:normal;font-style:normal}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-fw{width:1.28571429em;text-align:center}.fa-ul{padding-left:0;margin-left:2.14285714em;list-style-type:none}.fa-ul>li{position:relative}.fa-li{position:absolute;left:-2.14285714em;width:2.14285714em;top:.14285714em;text-align:center}.fa-li.fa-lg{left:-1.85714286em}.fa-border{padding:.2em .25em .15em;border:solid .08em #eee;border-radius:.1em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left{margin-right:.3em}.fa.fa-pull-right{margin-left:.3em}.pull-right{float:right}.pull-left{float:left}.fa.pull-left{margin-right:.3em}.fa.pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}.fa-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";-webkit-transform:scale(-1, 1);-ms-transform:scale(-1, 1);transform:scale(-1, 1)}.fa-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";-webkit-transform:scale(1, -1);-ms-transform:scale(1, -1);transform:scale(1, -1)}:root .fa-rotate-90,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-flip-horizontal,:root .fa-flip-vertical{filter:none}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-glass:before{content:"\f000"}.fa-music:before{content:"\f001"}.fa-search:before{content:"\f002"}.fa-envelope-o:before{content:"\f003"}.fa-heart:before{content:"\f004"}.fa-star:before{content:"\f005"}.fa-star-o:before{content:"\f006"}.fa-user:before{content:"\f007"}.fa-film:before{content:"\f008"}.fa-th-large:before{content:"\f009"}.fa-th:before{content:"\f00a"}.fa-th-list:before{content:"\f00b"}.fa-check:before{content:"\f00c"}.fa-remove:before,.fa-close:before,.fa-times:before{content:"\f00d"}.fa-search-plus:before{content:"\f00e"}.fa-search-minus:before{content:"\f010"}.fa-power-off:before{content:"\f011"}.fa-signal:before{content:"\f012"}.fa-gear:before,.fa-cog:before{content:"\f013"}.fa-trash-o:before{content:"\f014"}.fa-home:before{content:"\f015"}.fa-file-o:before{content:"\f016"}.fa-clock-o:before{content:"\f017"}.fa-road:before{content:"\f018"}.fa-download:before{content:"\f019"}.fa-arrow-circle-o-down:before{content:"\f01a"}.fa-arrow-circle-o-up:before{content:"\f01b"}.fa-inbox:before{content:"\f01c"}.fa-play-circle-o:before{content:"\f01d"}.fa-rotate-right:before,.fa-repeat:before{content:"\f01e"}.fa-refresh:before{content:"\f021"}.fa-list-alt:before{content:"\f022"}.fa-lock:before{content:"\f023"}.fa-flag:before{content:"\f024"}.fa-headphones:before{content:"\f025"}.fa-volume-off:before{content:"\f026"}.fa-volume-down:before{content:"\f027"}.fa-volume-up:before{content:"\f028"}.fa-qrcode:before{content:"\f029"}.fa-barcode:before{content:"\f02a"}.fa-tag:before{content:"\f02b"}.fa-tags:before{content:"\f02c"}.fa-book:before{content:"\f02d"}.fa-bookmark:before{content:"\f02e"}.fa-print:before{content:"\f02f"}.fa-camera:before{content:"\f030"}.fa-font:before{content:"\f031"}.fa-bold:before{content:"\f032"}.fa-italic:before{content:"\f033"}.fa-text-height:before{content:"\f034"}.fa-text-width:before{content:"\f035"}.fa-align-left:before{content:"\f036"}.fa-align-center:before{content:"\f037"}.fa-align-right:before{content:"\f038"}.fa-align-justify:before{content:"\f039"}.fa-list:before{content:"\f03a"}.fa-dedent:before,.fa-outdent:before{content:"\f03b"}.fa-indent:before{content:"\f03c"}.fa-video-camera:before{content:"\f03d"}.fa-photo:before,.fa-image:before,.fa-picture-o:before{content:"\f03e"}.fa-pencil:before{content:"\f040"}.fa-map-marker:before{content:"\f041"}.fa-adjust:before{content:"\f042"}.fa-tint:before{content:"\f043"}.fa-edit:before,.fa-pencil-square-o:before{content:"\f044"}.fa-share-square-o:before{content:"\f045"}.fa-check-square-o:before{content:"\f046"}.fa-arrows:before{content:"\f047"}.fa-step-backward:before{content:"\f048"}.fa-fast-backward:before{content:"\f049"}.fa-backward:before{content:"\f04a"}.fa-play:before{content:"\f04b"}.fa-pause:before{content:"\f04c"}.fa-stop:before{content:"\f04d"}.fa-forward:before{content:"\f04e"}.fa-fast-forward:before{content:"\f050"}.fa-step-forward:before{content:"\f051"}.fa-eject:before{content:"\f052"}.fa-chevron-left:before{content:"\f053"}.fa-chevron-right:before{content:"\f054"}.fa-plus-circle:before{content:"\f055"}.fa-minus-circle:before{content:"\f056"}.fa-times-circle:before{content:"\f057"}.fa-check-circle:before{content:"\f058"}.fa-question-circle:before{content:"\f059"}.fa-info-circle:before{content:"\f05a"}.fa-crosshairs:before{content:"\f05b"}.fa-times-circle-o:before{content:"\f05c"}.fa-check-circle-o:before{content:"\f05d"}.fa-ban:before{content:"\f05e"}.fa-arrow-left:before{content:"\f060"}.fa-arrow-right:before{content:"\f061"}.fa-arrow-up:before{content:"\f062"}.fa-arrow-down:before{content:"\f063"}.fa-mail-forward:before,.fa-share:before{content:"\f064"}.fa-expand:before{content:"\f065"}.fa-compress:before{content:"\f066"}.fa-plus:before{content:"\f067"}.fa-minus:before{content:"\f068"}.fa-asterisk:before{content:"\f069"}.fa-exclamation-circle:before{content:"\f06a"}.fa-gift:before{content:"\f06b"}.fa-leaf:before{content:"\f06c"}.fa-fire:before{content:"\f06d"}.fa-eye:before{content:"\f06e"}.fa-eye-slash:before{content:"\f070"}.fa-warning:before,.fa-exclamation-triangle:before{content:"\f071"}.fa-plane:before{content:"\f072"}.fa-calendar:before{content:"\f073"}.fa-random:before{content:"\f074"}.fa-comment:before{content:"\f075"}.fa-magnet:before{content:"\f076"}.fa-chevron-up:before{content:"\f077"}.fa-chevron-down:before{content:"\f078"}.fa-retweet:before{content:"\f079"}.fa-shopping-cart:before{content:"\f07a"}.fa-folder:before{content:"\f07b"}.fa-folder-open:before{content:"\f07c"}.fa-arrows-v:before{content:"\f07d"}.fa-arrows-h:before{content:"\f07e"}.fa-bar-chart-o:before,.fa-bar-chart:before{content:"\f080"}.fa-twitter-square:before{content:"\f081"}.fa-facebook-square:before{content:"\f082"}.fa-camera-retro:before{content:"\f083"}.fa-key:before{content:"\f084"}.fa-gears:before,.fa-cogs:before{content:"\f085"}.fa-comments:before{content:"\f086"}.fa-thumbs-o-up:before{content:"\f087"}.fa-thumbs-o-down:before{content:"\f088"}.fa-star-half:before{content:"\f089"}.fa-heart-o:before{content:"\f08a"}.fa-sign-out:before{content:"\f08b"}.fa-linkedin-square:before{content:"\f08c"}.fa-thumb-tack:before{content:"\f08d"}.fa-external-link:before{content:"\f08e"}.fa-sign-in:before{content:"\f090"}.fa-trophy:before{content:"\f091"}.fa-github-square:before{content:"\f092"}.fa-upload:before{content:"\f093"}.fa-lemon-o:before{content:"\f094"}.fa-phone:before{content:"\f095"}.fa-square-o:before{content:"\f096"}.fa-bookmark-o:before{content:"\f097"}.fa-phone-square:before{content:"\f098"}.fa-twitter:before{content:"\f099"}.fa-facebook-f:before,.fa-facebook:before{content:"\f09a"}.fa-github:before{content:"\f09b"}.fa-unlock:before{content:"\f09c"}.fa-credit-card:before{content:"\f09d"}.fa-feed:before,.fa-rss:before{content:"\f09e"}.fa-hdd-o:before{content:"\f0a0"}.fa-bullhorn:before{content:"\f0a1"}.fa-bell:before{content:"\f0f3"}.fa-certificate:before{content:"\f0a3"}.fa-hand-o-right:before{content:"\f0a4"}.fa-hand-o-left:before{content:"\f0a5"}.fa-hand-o-up:before{content:"\f0a6"}.fa-hand-o-down:before{content:"\f0a7"}.fa-arrow-circle-left:before{content:"\f0a8"}.fa-arrow-circle-right:before{content:"\f0a9"}.fa-arrow-circle-up:before{content:"\f0aa"}.fa-arrow-circle-down:before{content:"\f0ab"}.fa-globe:before{content:"\f0ac"}.fa-wrench:before{content:"\f0ad"}.fa-tasks:before{content:"\f0ae"}.fa-filter:before{content:"\f0b0"}.fa-briefcase:before{content:"\f0b1"}.fa-arrows-alt:before{content:"\f0b2"}.fa-group:before,.fa-users:before{content:"\f0c0"}.fa-chain:before,.fa-link:before{content:"\f0c1"}.fa-cloud:before{content:"\f0c2"}.fa-flask:before{content:"\f0c3"}.fa-cut:before,.fa-scissors:before{content:"\f0c4"}.fa-copy:before,.fa-files-o:before{content:"\f0c5"}.fa-paperclip:before{content:"\f0c6"}.fa-save:before,.fa-floppy-o:before{content:"\f0c7"}.fa-square:before{content:"\f0c8"}.fa-navicon:before,.fa-reorder:before,.fa-bars:before{content:"\f0c9"}.fa-list-ul:before{content:"\f0ca"}.fa-list-ol:before{content:"\f0cb"}.fa-strikethrough:before{content:"\f0cc"}.fa-underline:before{content:"\f0cd"}.fa-table:before{content:"\f0ce"}.fa-magic:before{content:"\f0d0"}.fa-truck:before{content:"\f0d1"}.fa-pinterest:before{content:"\f0d2"}.fa-pinterest-square:before{content:"\f0d3"}.fa-google-plus-square:before{content:"\f0d4"}.fa-google-plus:before{content:"\f0d5"}.fa-money:before{content:"\f0d6"}.fa-caret-down:before{content:"\f0d7"}.fa-caret-up:before{content:"\f0d8"}.fa-caret-left:before{content:"\f0d9"}.fa-caret-right:before{content:"\f0da"}.fa-columns:before{content:"\f0db"}.fa-unsorted:before,.fa-sort:before{content:"\f0dc"}.fa-sort-down:before,.fa-sort-desc:before{content:"\f0dd"}.fa-sort-up:before,.fa-sort-asc:before{content:"\f0de"}.fa-envelope:before{content:"\f0e0"}.fa-linkedin:before{content:"\f0e1"}.fa-rotate-left:before,.fa-undo:before{content:"\f0e2"}.fa-legal:before,.fa-gavel:before{content:"\f0e3"}.fa-dashboard:before,.fa-tachometer:before{content:"\f0e4"}.fa-comment-o:before{content:"\f0e5"}.fa-comments-o:before{content:"\f0e6"}.fa-flash:before,.fa-bolt:before{content:"\f0e7"}.fa-sitemap:before{content:"\f0e8"}.fa-umbrella:before{content:"\f0e9"}.fa-paste:before,.fa-clipboard:before{content:"\f0ea"}.fa-lightbulb-o:before{content:"\f0eb"}.fa-exchange:before{content:"\f0ec"}.fa-cloud-download:before{content:"\f0ed"}.fa-cloud-upload:before{content:"\f0ee"}.fa-user-md:before{content:"\f0f0"}.fa-stethoscope:before{content:"\f0f1"}.fa-suitcase:before{content:"\f0f2"}.fa-bell-o:before{content:"\f0a2"}.fa-coffee:before{content:"\f0f4"}.fa-cutlery:before{content:"\f0f5"}.fa-file-text-o:before{content:"\f0f6"}.fa-building-o:before{content:"\f0f7"}.fa-hospital-o:before{content:"\f0f8"}.fa-ambulance:before{content:"\f0f9"}.fa-medkit:before{content:"\f0fa"}.fa-fighter-jet:before{content:"\f0fb"}.fa-beer:before{content:"\f0fc"}.fa-h-square:before{content:"\f0fd"}.fa-plus-square:before{content:"\f0fe"}.fa-angle-double-left:before{content:"\f100"}.fa-angle-double-right:before{content:"\f101"}.fa-angle-double-up:before{content:"\f102"}.fa-angle-double-down:before{content:"\f103"}.fa-angle-left:before{content:"\f104"}.fa-angle-right:before{content:"\f105"}.fa-angle-up:before{content:"\f106"}.fa-angle-down:before{content:"\f107"}.fa-desktop:before{content:"\f108"}.fa-laptop:before{content:"\f109"}.fa-tablet:before{content:"\f10a"}.fa-mobile-phone:before,.fa-mobile:before{content:"\f10b"}.fa-circle-o:before{content:"\f10c"}.fa-quote-left:before{content:"\f10d"}.fa-quote-right:before{content:"\f10e"}.fa-spinner:before{content:"\f110"}.fa-circle:before{content:"\f111"}.fa-mail-reply:before,.fa-reply:before{content:"\f112"}.fa-github-alt:before{content:"\f113"}.fa-folder-o:before{content:"\f114"}.fa-folder-open-o:before{content:"\f115"}.fa-smile-o:before{content:"\f118"}.fa-frown-o:before{content:"\f119"}.fa-meh-o:before{content:"\f11a"}.fa-gamepad:before{content:"\f11b"}.fa-keyboard-o:before{content:"\f11c"}.fa-flag-o:before{content:"\f11d"}.fa-flag-checkered:before{content:"\f11e"}.fa-terminal:before{content:"\f120"}.fa-code:before{content:"\f121"}.fa-mail-reply-all:before,.fa-reply-all:before{content:"\f122"}.fa-star-half-empty:before,.fa-star-half-full:before,.fa-star-half-o:before{content:"\f123"}.fa-location-arrow:before{content:"\f124"}.fa-crop:before{content:"\f125"}.fa-code-fork:before{content:"\f126"}.fa-unlink:before,.fa-chain-broken:before{content:"\f127"}.fa-question:before{content:"\f128"}.fa-info:before{content:"\f129"}.fa-exclamation:before{content:"\f12a"}.fa-superscript:before{content:"\f12b"}.fa-subscript:before{content:"\f12c"}.fa-eraser:before{content:"\f12d"}.fa-puzzle-piece:before{content:"\f12e"}.fa-microphone:before{content:"\f130"}.fa-microphone-slash:before{content:"\f131"}.fa-shield:before{content:"\f132"}.fa-calendar-o:before{content:"\f133"}.fa-fire-extinguisher:before{content:"\f134"}.fa-rocket:before{content:"\f135"}.fa-maxcdn:before{content:"\f136"}.fa-chevron-circle-left:before{content:"\f137"}.fa-chevron-circle-right:before{content:"\f138"}.fa-chevron-circle-up:before{content:"\f139"}.fa-chevron-circle-down:before{content:"\f13a"}.fa-html5:before{content:"\f13b"}.fa-css3:before{content:"\f13c"}.fa-anchor:before{content:"\f13d"}.fa-unlock-alt:before{content:"\f13e"}.fa-bullseye:before{content:"\f140"}.fa-ellipsis-h:before{content:"\f141"}.fa-ellipsis-v:before{content:"\f142"}.fa-rss-square:before{content:"\f143"}.fa-play-circle:before{content:"\f144"}.fa-ticket:before{content:"\f145"}.fa-minus-square:before{content:"\f146"}.fa-minus-square-o:before{content:"\f147"}.fa-level-up:before{content:"\f148"}.fa-level-down:before{content:"\f149"}.fa-check-square:before{content:"\f14a"}.fa-pencil-square:before{content:"\f14b"}.fa-external-link-square:before{content:"\f14c"}.fa-share-square:before{content:"\f14d"}.fa-compass:before{content:"\f14e"}.fa-toggle-down:before,.fa-caret-square-o-down:before{content:"\f150"}.fa-toggle-up:before,.fa-caret-square-o-up:before{content:"\f151"}.fa-toggle-right:before,.fa-caret-square-o-right:before{content:"\f152"}.fa-euro:before,.fa-eur:before{content:"\f153"}.fa-gbp:before{content:"\f154"}.fa-dollar:before,.fa-usd:before{content:"\f155"}.fa-rupee:before,.fa-inr:before{content:"\f156"}.fa-cny:before,.fa-rmb:before,.fa-yen:before,.fa-jpy:before{content:"\f157"}.fa-ruble:before,.fa-rouble:before,.fa-rub:before{content:"\f158"}.fa-won:before,.fa-krw:before{content:"\f159"}.fa-bitcoin:before,.fa-btc:before{content:"\f15a"}.fa-file:before{content:"\f15b"}.fa-file-text:before{content:"\f15c"}.fa-sort-alpha-asc:before{content:"\f15d"}.fa-sort-alpha-desc:before{content:"\f15e"}.fa-sort-amount-asc:before{content:"\f160"}.fa-sort-amount-desc:before{content:"\f161"}.fa-sort-numeric-asc:before{content:"\f162"}.fa-sort-numeric-desc:before{content:"\f163"}.fa-thumbs-up:before{content:"\f164"}.fa-thumbs-down:before{content:"\f165"}.fa-youtube-square:before{content:"\f166"}.fa-youtube:before{content:"\f167"}.fa-xing:before{content:"\f168"}.fa-xing-square:before{content:"\f169"}.fa-youtube-play:before{content:"\f16a"}.fa-dropbox:before{content:"\f16b"}.fa-stack-overflow:before{content:"\f16c"}.fa-instagram:before{content:"\f16d"}.fa-flickr:before{content:"\f16e"}.fa-adn:before{content:"\f170"}.fa-bitbucket:before{content:"\f171"}.fa-bitbucket-square:before{content:"\f172"}.fa-tumblr:before{content:"\f173"}.fa-tumblr-square:before{content:"\f174"}.fa-long-arrow-down:before{content:"\f175"}.fa-long-arrow-up:before{content:"\f176"}.fa-long-arrow-left:before{content:"\f177"}.fa-long-arrow-right:before{content:"\f178"}.fa-apple:before{content:"\f179"}.fa-windows:before{content:"\f17a"}.fa-android:before{content:"\f17b"}.fa-linux:before{content:"\f17c"}.fa-dribbble:before{content:"\f17d"}.fa-skype:before{content:"\f17e"}.fa-foursquare:before{content:"\f180"}.fa-trello:before{content:"\f181"}.fa-female:before{content:"\f182"}.fa-male:before{content:"\f183"}.fa-gittip:before,.fa-gratipay:before{content:"\f184"}.fa-sun-o:before{content:"\f185"}.fa-moon-o:before{content:"\f186"}.fa-archive:before{content:"\f187"}.fa-bug:before{content:"\f188"}.fa-vk:before{content:"\f189"}.fa-weibo:before{content:"\f18a"}.fa-renren:before{content:"\f18b"}.fa-pagelines:before{content:"\f18c"}.fa-stack-exchange:before{content:"\f18d"}.fa-arrow-circle-o-right:before{content:"\f18e"}.fa-arrow-circle-o-left:before{content:"\f190"}.fa-toggle-left:before,.fa-caret-square-o-left:before{content:"\f191"}.fa-dot-circle-o:before{content:"\f192"}.fa-wheelchair:before{content:"\f193"}.fa-vimeo-square:before{content:"\f194"}.fa-turkish-lira:before,.fa-try:before{content:"\f195"}.fa-plus-square-o:before{content:"\f196"}.fa-space-shuttle:before{content:"\f197"}.fa-slack:before{content:"\f198"}.fa-envelope-square:before{content:"\f199"}.fa-wordpress:before{content:"\f19a"}.fa-openid:before{content:"\f19b"}.fa-institution:before,.fa-bank:before,.fa-university:before{content:"\f19c"}.fa-mortar-board:before,.fa-graduation-cap:before{content:"\f19d"}.fa-yahoo:before{content:"\f19e"}.fa-google:before{content:"\f1a0"}.fa-reddit:before{content:"\f1a1"}.fa-reddit-square:before{content:"\f1a2"}.fa-stumbleupon-circle:before{content:"\f1a3"}.fa-stumbleupon:before{content:"\f1a4"}.fa-delicious:before{content:"\f1a5"}.fa-digg:before{content:"\f1a6"}.fa-pied-piper-pp:before{content:"\f1a7"}.fa-pied-piper-alt:before{content:"\f1a8"}.fa-drupal:before{content:"\f1a9"}.fa-joomla:before{content:"\f1aa"}.fa-language:before{content:"\f1ab"}.fa-fax:before{content:"\f1ac"}.fa-building:before{content:"\f1ad"}.fa-child:before{content:"\f1ae"}.fa-paw:before{content:"\f1b0"}.fa-spoon:before{content:"\f1b1"}.fa-cube:before{content:"\f1b2"}.fa-cubes:before{content:"\f1b3"}.fa-behance:before{content:"\f1b4"}.fa-behance-square:before{content:"\f1b5"}.fa-steam:before{content:"\f1b6"}.fa-steam-square:before{content:"\f1b7"}.fa-recycle:before{content:"\f1b8"}.fa-automobile:before,.fa-car:before{content:"\f1b9"}.fa-cab:before,.fa-taxi:before{content:"\f1ba"}.fa-tree:before{content:"\f1bb"}.fa-spotify:before{content:"\f1bc"}.fa-deviantart:before{content:"\f1bd"}.fa-soundcloud:before{content:"\f1be"}.fa-database:before{content:"\f1c0"}.fa-file-pdf-o:before{content:"\f1c1"}.fa-file-word-o:before{content:"\f1c2"}.fa-file-excel-o:before{content:"\f1c3"}.fa-file-powerpoint-o:before{content:"\f1c4"}.fa-file-photo-o:before,.fa-file-picture-o:before,.fa-file-image-o:before{content:"\f1c5"}.fa-file-zip-o:before,.fa-file-archive-o:before{content:"\f1c6"}.fa-file-sound-o:before,.fa-file-audio-o:before{content:"\f1c7"}.fa-file-movie-o:before,.fa-file-video-o:before{content:"\f1c8"}.fa-file-code-o:before{content:"\f1c9"}.fa-vine:before{content:"\f1ca"}.fa-codepen:before{content:"\f1cb"}.fa-jsfiddle:before{content:"\f1cc"}.fa-life-bouy:before,.fa-life-buoy:before,.fa-life-saver:before,.fa-support:before,.fa-life-ring:before{content:"\f1cd"}.fa-circle-o-notch:before{content:"\f1ce"}.fa-ra:before,.fa-resistance:before,.fa-rebel:before{content:"\f1d0"}.fa-ge:before,.fa-empire:before{content:"\f1d1"}.fa-git-square:before{content:"\f1d2"}.fa-git:before{content:"\f1d3"}.fa-y-combinator-square:before,.fa-yc-square:before,.fa-hacker-news:before{content:"\f1d4"}.fa-tencent-weibo:before{content:"\f1d5"}.fa-qq:before{content:"\f1d6"}.fa-wechat:before,.fa-weixin:before{content:"\f1d7"}.fa-send:before,.fa-paper-plane:before{content:"\f1d8"}.fa-send-o:before,.fa-paper-plane-o:before{content:"\f1d9"}.fa-history:before{content:"\f1da"}.fa-circle-thin:before{content:"\f1db"}.fa-header:before{content:"\f1dc"}.fa-paragraph:before{content:"\f1dd"}.fa-sliders:before{content:"\f1de"}.fa-share-alt:before{content:"\f1e0"}.fa-share-alt-square:before{content:"\f1e1"}.fa-bomb:before{content:"\f1e2"}.fa-soccer-ball-o:before,.fa-futbol-o:before{content:"\f1e3"}.fa-tty:before{content:"\f1e4"}.fa-binoculars:before{content:"\f1e5"}.fa-plug:before{content:"\f1e6"}.fa-slideshare:before{content:"\f1e7"}.fa-twitch:before{content:"\f1e8"}.fa-yelp:before{content:"\f1e9"}.fa-newspaper-o:before{content:"\f1ea"}.fa-wifi:before{content:"\f1eb"}.fa-calculator:before{content:"\f1ec"}.fa-paypal:before{content:"\f1ed"}.fa-google-wallet:before{content:"\f1ee"}.fa-cc-visa:before{content:"\f1f0"}.fa-cc-mastercard:before{content:"\f1f1"}.fa-cc-discover:before{content:"\f1f2"}.fa-cc-amex:before{content:"\f1f3"}.fa-cc-paypal:before{content:"\f1f4"}.fa-cc-stripe:before{content:"\f1f5"}.fa-bell-slash:before{content:"\f1f6"}.fa-bell-slash-o:before{content:"\f1f7"}.fa-trash:before{content:"\f1f8"}.fa-copyright:before{content:"\f1f9"}.fa-at:before{content:"\f1fa"}.fa-eyedropper:before{content:"\f1fb"}.fa-paint-brush:before{content:"\f1fc"}.fa-birthday-cake:before{content:"\f1fd"}.fa-area-chart:before{content:"\f1fe"}.fa-pie-chart:before{content:"\f200"}.fa-line-chart:before{content:"\f201"}.fa-lastfm:before{content:"\f202"}.fa-lastfm-square:before{content:"\f203"}.fa-toggle-off:before{content:"\f204"}.fa-toggle-on:before{content:"\f205"}.fa-bicycle:before{content:"\f206"}.fa-bus:before{content:"\f207"}.fa-ioxhost:before{content:"\f208"}.fa-angellist:before{content:"\f209"}.fa-cc:before{content:"\f20a"}.fa-shekel:before,.fa-sheqel:before,.fa-ils:before{content:"\f20b"}.fa-meanpath:before{content:"\f20c"}.fa-buysellads:before{content:"\f20d"}.fa-connectdevelop:before{content:"\f20e"}.fa-dashcube:before{content:"\f210"}.fa-forumbee:before{content:"\f211"}.fa-leanpub:before{content:"\f212"}.fa-sellsy:before{content:"\f213"}.fa-shirtsinbulk:before{content:"\f214"}.fa-simplybuilt:before{content:"\f215"}.fa-skyatlas:before{content:"\f216"}.fa-cart-plus:before{content:"\f217"}.fa-cart-arrow-down:before{content:"\f218"}.fa-diamond:before{content:"\f219"}.fa-ship:before{content:"\f21a"}.fa-user-secret:before{content:"\f21b"}.fa-motorcycle:before{content:"\f21c"}.fa-street-view:before{content:"\f21d"}.fa-heartbeat:before{content:"\f21e"}.fa-venus:before{content:"\f221"}.fa-mars:before{content:"\f222"}.fa-mercury:before{content:"\f223"}.fa-intersex:before,.fa-transgender:before{content:"\f224"}.fa-transgender-alt:before{content:"\f225"}.fa-venus-double:before{content:"\f226"}.fa-mars-double:before{content:"\f227"}.fa-venus-mars:before{content:"\f228"}.fa-mars-stroke:before{content:"\f229"}.fa-mars-stroke-v:before{content:"\f22a"}.fa-mars-stroke-h:before{content:"\f22b"}.fa-neuter:before{content:"\f22c"}.fa-genderless:before{content:"\f22d"}.fa-facebook-official:before{content:"\f230"}.fa-pinterest-p:before{content:"\f231"}.fa-whatsapp:before{content:"\f232"}.fa-server:before{content:"\f233"}.fa-user-plus:before{content:"\f234"}.fa-user-times:before{content:"\f235"}.fa-hotel:before,.fa-bed:before{content:"\f236"}.fa-viacoin:before{content:"\f237"}.fa-train:before{content:"\f238"}.fa-subway:before{content:"\f239"}.fa-medium:before{content:"\f23a"}.fa-yc:before,.fa-y-combinator:before{content:"\f23b"}.fa-optin-monster:before{content:"\f23c"}.fa-opencart:before{content:"\f23d"}.fa-expeditedssl:before{content:"\f23e"}.fa-battery-4:before,.fa-battery:before,.fa-battery-full:before{content:"\f240"}.fa-battery-3:before,.fa-battery-three-quarters:before{content:"\f241"}.fa-battery-2:before,.fa-battery-half:before{content:"\f242"}.fa-battery-1:before,.fa-battery-quarter:before{content:"\f243"}.fa-battery-0:before,.fa-battery-empty:before{content:"\f244"}.fa-mouse-pointer:before{content:"\f245"}.fa-i-cursor:before{content:"\f246"}.fa-object-group:before{content:"\f247"}.fa-object-ungroup:before{content:"\f248"}.fa-sticky-note:before{content:"\f249"}.fa-sticky-note-o:before{content:"\f24a"}.fa-cc-jcb:before{content:"\f24b"}.fa-cc-diners-club:before{content:"\f24c"}.fa-clone:before{content:"\f24d"}.fa-balance-scale:before{content:"\f24e"}.fa-hourglass-o:before{content:"\f250"}.fa-hourglass-1:before,.fa-hourglass-start:before{content:"\f251"}.fa-hourglass-2:before,.fa-hourglass-half:before{content:"\f252"}.fa-hourglass-3:before,.fa-hourglass-end:before{content:"\f253"}.fa-hourglass:before{content:"\f254"}.fa-hand-grab-o:before,.fa-hand-rock-o:before{content:"\f255"}.fa-hand-stop-o:before,.fa-hand-paper-o:before{content:"\f256"}.fa-hand-scissors-o:before{content:"\f257"}.fa-hand-lizard-o:before{content:"\f258"}.fa-hand-spock-o:before{content:"\f259"}.fa-hand-pointer-o:before{content:"\f25a"}.fa-hand-peace-o:before{content:"\f25b"}.fa-trademark:before{content:"\f25c"}.fa-registered:before{content:"\f25d"}.fa-creative-commons:before{content:"\f25e"}.fa-gg:before{content:"\f260"}.fa-gg-circle:before{content:"\f261"}.fa-tripadvisor:before{content:"\f262"}.fa-odnoklassniki:before{content:"\f263"}.fa-odnoklassniki-square:before{content:"\f264"}.fa-get-pocket:before{content:"\f265"}.fa-wikipedia-w:before{content:"\f266"}.fa-safari:before{content:"\f267"}.fa-chrome:before{content:"\f268"}.fa-firefox:before{content:"\f269"}.fa-opera:before{content:"\f26a"}.fa-internet-explorer:before{content:"\f26b"}.fa-tv:before,.fa-television:before{content:"\f26c"}.fa-contao:before{content:"\f26d"}.fa-500px:before{content:"\f26e"}.fa-amazon:before{content:"\f270"}.fa-calendar-plus-o:before{content:"\f271"}.fa-calendar-minus-o:before{content:"\f272"}.fa-calendar-times-o:before{content:"\f273"}.fa-calendar-check-o:before{content:"\f274"}.fa-industry:before{content:"\f275"}.fa-map-pin:before{content:"\f276"}.fa-map-signs:before{content:"\f277"}.fa-map-o:before{content:"\f278"}.fa-map:before{content:"\f279"}.fa-commenting:before{content:"\f27a"}.fa-commenting-o:before{content:"\f27b"}.fa-houzz:before{content:"\f27c"}.fa-vimeo:before{content:"\f27d"}.fa-black-tie:before{content:"\f27e"}.fa-fonticons:before{content:"\f280"}.fa-reddit-alien:before{content:"\f281"}.fa-edge:before{content:"\f282"}.fa-credit-card-alt:before{content:"\f283"}.fa-codiepie:before{content:"\f284"}.fa-modx:before{content:"\f285"}.fa-fort-awesome:before{content:"\f286"}.fa-usb:before{content:"\f287"}.fa-product-hunt:before{content:"\f288"}.fa-mixcloud:before{content:"\f289"}.fa-scribd:before{content:"\f28a"}.fa-pause-circle:before{content:"\f28b"}.fa-pause-circle-o:before{content:"\f28c"}.fa-stop-circle:before{content:"\f28d"}.fa-stop-circle-o:before{content:"\f28e"}.fa-shopping-bag:before{content:"\f290"}.fa-shopping-basket:before{content:"\f291"}.fa-hashtag:before{content:"\f292"}.fa-bluetooth:before{content:"\f293"}.fa-bluetooth-b:before{content:"\f294"}.fa-percent:before{content:"\f295"}.fa-gitlab:before{content:"\f296"}.fa-wpbeginner:before{content:"\f297"}.fa-wpforms:before{content:"\f298"}.fa-envira:before{content:"\f299"}.fa-universal-access:before{content:"\f29a"}.fa-wheelchair-alt:before{content:"\f29b"}.fa-question-circle-o:before{content:"\f29c"}.fa-blind:before{content:"\f29d"}.fa-audio-description:before{content:"\f29e"}.fa-volume-control-phone:before{content:"\f2a0"}.fa-braille:before{content:"\f2a1"}.fa-assistive-listening-systems:before{content:"\f2a2"}.fa-asl-interpreting:before,.fa-american-sign-language-interpreting:before{content:"\f2a3"}.fa-deafness:before,.fa-hard-of-hearing:before,.fa-deaf:before{content:"\f2a4"}.fa-glide:before{content:"\f2a5"}.fa-glide-g:before{content:"\f2a6"}.fa-signing:before,.fa-sign-language:before{content:"\f2a7"}.fa-low-vision:before{content:"\f2a8"}.fa-viadeo:before{content:"\f2a9"}.fa-viadeo-square:before{content:"\f2aa"}.fa-snapchat:before{content:"\f2ab"}.fa-snapchat-ghost:before{content:"\f2ac"}.fa-snapchat-square:before{content:"\f2ad"}.fa-pied-piper:before{content:"\f2ae"}.fa-first-order:before{content:"\f2b0"}.fa-yoast:before{content:"\f2b1"}.fa-themeisle:before{content:"\f2b2"}.fa-google-plus-circle:before,.fa-google-plus-official:before{content:"\f2b3"}.fa-fa:before,.fa-font-awesome:before{content:"\f2b4"}.fa-handshake-o:before{content:"\f2b5"}.fa-envelope-open:before{content:"\f2b6"}.fa-envelope-open-o:before{content:"\f2b7"}.fa-linode:before{content:"\f2b8"}.fa-address-book:before{content:"\f2b9"}.fa-address-book-o:before{content:"\f2ba"}.fa-vcard:before,.fa-address-card:before{content:"\f2bb"}.fa-vcard-o:before,.fa-address-card-o:before{content:"\f2bc"}.fa-user-circle:before{content:"\f2bd"}.fa-user-circle-o:before{content:"\f2be"}.fa-user-o:before{content:"\f2c0"}.fa-id-badge:before{content:"\f2c1"}.fa-drivers-license:before,.fa-id-card:before{content:"\f2c2"}.fa-drivers-license-o:before,.fa-id-card-o:before{content:"\f2c3"}.fa-quora:before{content:"\f2c4"}.fa-free-code-camp:before{content:"\f2c5"}.fa-telegram:before{content:"\f2c6"}.fa-thermometer-4:before,.fa-thermometer:before,.fa-thermometer-full:before{content:"\f2c7"}.fa-thermometer-3:before,.fa-thermometer-three-quarters:before{content:"\f2c8"}.fa-thermometer-2:before,.fa-thermometer-half:before{content:"\f2c9"}.fa-thermometer-1:before,.fa-thermometer-quarter:before{content:"\f2ca"}.fa-thermometer-0:before,.fa-thermometer-empty:before{content:"\f2cb"}.fa-shower:before{content:"\f2cc"}.fa-bathtub:before,.fa-s15:before,.fa-bath:before{content:"\f2cd"}.fa-podcast:before{content:"\f2ce"}.fa-window-maximize:before{content:"\f2d0"}.fa-window-minimize:before{content:"\f2d1"}.fa-window-restore:before{content:"\f2d2"}.fa-times-rectangle:before,.fa-window-close:before{content:"\f2d3"}.fa-times-rectangle-o:before,.fa-window-close-o:before{content:"\f2d4"}.fa-bandcamp:before{content:"\f2d5"}.fa-grav:before{content:"\f2d6"}.fa-etsy:before{content:"\f2d7"}.fa-imdb:before{content:"\f2d8"}.fa-ravelry:before{content:"\f2d9"}.fa-eercast:before{content:"\f2da"}.fa-microchip:before{content:"\f2db"}.fa-snowflake-o:before{content:"\f2dc"}.fa-superpowers:before{content:"\f2dd"}.fa-wpexplorer:before{content:"\f2de"}.fa-meetup:before{content:"\f2e0"}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}]]></content>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F12%2F04%2F%E8%B7%B3%E8%B7%83%E8%A1%A8%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172class Node&#123; private $id; public $value; public $level; public $forward = []; public function __construct($value, $level) &#123; $this-&gt;id = uniqid(); $this-&gt;level = $level; $this-&gt;value = $value; for ($i = 0; $i &lt; $level; $i++) &#123; $this-&gt;forward[$i] = 0; &#125; &#125; public function getID() &#123; return $this-&gt;id; &#125;&#125;class SkipList&#123; private $maxLevel; public $nodePool = []; public $header; public function __construct($maxLevel) &#123; $this-&gt;maxLevel = $maxLevel; $header = new Node(-1, $maxLevel); $this-&gt;addToNodePool($header-&gt;getID(), $header); $this-&gt;header = $header-&gt;getID(); &#125; public function addToNodePool($id, $object) &#123; $this-&gt;nodePool[$id] = $object; &#125; /** * @param $id * @return Node */ public function getFromNodePool($id) &#123; return isset($this-&gt;nodePool[$id]) ? $this-&gt;nodePool[$id] : null; &#125; public function insert($value) &#123; $visitTrace = []; $count = 0; $tmp = $this-&gt;getFromNodePool($this-&gt;header); for ($i = $this-&gt;maxLevel - 1; $i &gt;= 0; $i--) &#123; while ($tmp &amp;&amp; $tmp-&gt;forward[$i]) &#123; $count++; if ($count &gt; 20) &#123; break; &#125; $forward = $this-&gt;getFromNodePool($tmp-&gt;forward[$i]); if ($forward-&gt;value &lt; $value) &#123; $tmp = $forward; &#125; else if ($forward-&gt;value &gt; $value) &#123; break; &#125; else &#123; return false; &#125; &#125; if ($tmp) &#123; $visitTrace[$i] = $tmp-&gt;getID(); &#125; &#125; $level = $this-&gt;randomLevel(); $newNode = new Node($value, $level); $this-&gt;addToNodePool($newNode-&gt;getID(), $newNode); for ($i = 0; $i &lt; $level; $i++) &#123; $trace = $this-&gt;getFromNodePool($visitTrace[$i]); $newNode-&gt;forward[$i] = $trace-&gt;forward[$i]; $trace-&gt;forward[$i] = $newNode-&gt;getID(); &#125; return true; &#125; public function find($value) &#123; $tmp = $this-&gt;getFromNodePool($this-&gt;header); $count = 0; for ($i = $this-&gt;maxLevel - 1; $i &gt;= 0; $i--) &#123; while ($tmp &amp;&amp; $tmp-&gt;forward[$i]) &#123; $count++; if ($count &gt; 20) &#123; break; &#125; $forward = $this-&gt;getFromNodePool($tmp-&gt;forward[$i]); if ($forward-&gt;value &lt; $value) &#123; $tmp = $forward; &#125; else if ($forward-&gt;value &gt; $value) &#123; break; &#125; else &#123; return true; &#125; &#125; &#125; return false; &#125; private function randomLevel() &#123; $level = 1; if (rand(0, 1) &amp;&amp; $level &lt; $this-&gt;maxLevel) &#123; $level++; &#125; return $level; &#125;&#125;$testData = [898888, 300, 234, 123, 333, 456, 23, 99];$skipList = new SkipList(3);foreach ($testData as $value) &#123; $skipList-&gt;insert($value);&#125;$test = [898888, 300, 234, 123, 333, 456, 23, 99, 100, 111];foreach ($test as $value) &#123; $result = $skipList-&gt;find($value); if (in_array($value, $testData) &amp;&amp; in_array($value, $test)) &#123; if ($result) &#123; echo '&lt;br&gt;'; &#125; else &#123; echo '&lt;br&gt;'; &#125; &#125; else &#123; if ($result) &#123; echo '&lt;br&gt;'; &#125; else &#123; echo '&lt;br&gt;'; &#125; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F12%2F04%2F%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%B3%E8%B7%83%E8%A1%A8%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[]]></content>
  </entry>
  <entry>
    <title><![CDATA[HTTPRPC]]></title>
    <url>%2F2020%2F11%2F25%2F%E6%97%A2%E7%84%B6%E6%9C%89HTTP%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E7%94%A8RPC%E8%B0%83%E7%94%A8%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[  HTTP  RPC   RPC  HTTP  RPC Servlet  Web   RPCHTTP HTTPRestfulRestfulRPC KeXueShangWangQiang HTTPHTTPHTTPHTTP RPCHTTPRPCRPCHTTP RPCHTTP  RPCRemote Procedure CallRPC  AB ABHTTPBRestfulARestfulBRestfulHTTP Restful ABRPC RPC    IP        RPC RPCRPCUDPTCPHTTPHTTP RPCRPC https://github.com/yeecode/EasyRPC RPC RPC RPC RPCRPC RPC RPCHTTP ]]></content>
      <categories>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[rediskey]]></title>
    <url>%2F2020%2F11%2F24%2F%E8%B0%88%E8%B0%88redis%E7%9A%84%E7%83%ADkey%E9%97%AE%E9%A2%98%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%2F</url>
    <content type="text"><![CDATA[ ()rediskeykeyrediskeyXXXXKeyps:hot keybig key key   Keykeyrediskeyrediskey key:keykeykeykeykey:redis:ProxyProxyTwemproxyProxyredisproxy :redis(1)monitorrediskeyredis-fainaredis(2)hotkeysredis 4.0.3redis-clikeyredis-clihotkeyskey:RedisTCPRESPRESPkey (1)ehcacheHashMapkeykeyJVMkeyjvmrediskey,redis50OKjvm2000JVMvalueredis(2)keykeyrediskeyrediskeyredisredisN :2N3N4N 12345678910const M = N * 2//random = GenRandom(0, M)//keybakHotKey = hotKey + _ + randomdata = redis.GET(bakHotKey)if data == NULL &#123; data = GetFromDB() redis.SET(bakHotKey, expireTime + GenRandom(0,5))&#125; OK key (1)key(2)TMCkey(1)keykeyTMC TMC jedisJedisPoolJedisJedisPoolTMC+Hermes-SDK jedisjarHermes-SDKHermes-SDKOKJedis-ClientkeyHermes-SDK keyHermes :flinkrediskafkakafkakey (2):keyHermesHermes-SDK:keykeyHermes-SDKkeyHermes-SDKkey keyzookeeperkey ]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis-]]></title>
    <url>%2F2020%2F11%2F24%2FRedis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E8%B7%B3%E8%B7%83%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[   O(n)  8798888    RedisRedisRedis Redis  RedisRediszskiplistNodezskiplistzskiplistNodezskiplist skiplist headerO(1) tail,O(1) level,O(1) length,,O(1) zskiplistNode level 12L3L1L  ,powerlaw132level backward BW score 1.02.03.0 oj o1o2o3: Redis    O(1)  O(N)  O(logN)O(logN)N  O(logN)O(logN)N  O(logN)O(logN)N  O(logN)O(logN)N  O(1)  O(logN)O(logN)N  O(logN)O(logN)N  O(N)N range015202810 O(N)N    Redis RediszskiplistzskiplistNodezskiplistzskiplistNode Redis132 ]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHPArrayAccess]]></title>
    <url>%2F2020%2F11%2F04%2FPHP%E4%B8%AD%E7%9A%84ArrayAccess%E7%94%A8%E6%B3%95%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ LaravelPHP SPLArrayAccessArrayAccess FooArrayAccess 12345678910111213141516171819202122class Foo implements ArrayAccess&#123; public function offsetExists( $offset ) &#123; echo " offsetExists()   &#123;$offset&#125;"; &#125; public function offsetGet( $offset ) &#123; echo " offsetGet()   $offset"; &#125; public function offsetSet( $offset, $value ) &#123; echo " offsetSet()   &#123;$offset&#125;=&#123;$value&#125;"; &#125; public function offsetUnset( $offset ) &#123; echo " offsetUnset()   &#123;$offset&#125;"; &#125;&#125;  isset$foo[how]offsetExists$foo[xxxx]ArrayAccess$foo[xxxx]issetoffsetExistsechovar_dump($t); falseoffsetExistsnullfalse 123$foo = new Foo();$t = isset($foo['how']);// :  offsetExists()   howvar_dump($t);// : boolean false $foo[xxxx]$foo[xxxx]$foo[xxxx]offsetGet 12$foo = new Foo();$foo['what'];// :  offsetGet()   what offsetSet 12$foo = new Foo();$foo['when'] = 'today';// :  offsetSet()   when=today unset $foo = new Foo(); unset($foo['wow']);// :  offsetUnset()   wow  ArrayAccess$foo[xxx] $foo[xxx] offsetGet $foo[xxx] = yyy offsetSet isset($foo[xxx]) offsetExists unset($foo[xxx]) offsetUnset ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis]]></title>
    <url>%2F2020%2F07%2F30%2FRedis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E8%A7%A3%E5%86%B3%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[ Redismulti watchmulti RedisRedis 1.redis 2.  multi 1.exec 2.exec 3.redis Redis 1234567# Multi# EXECatomic&gt; multi #redisincr booksincr books&gt; exec #&gt; discard # 12345678910111213141516def multi_test(): r = redis.Redis(host='127.0.0.1') pipe = r.pipeline() pipe.multi() #  pipe.set('key2', 400) #  pipe.execute() #  print("" + r.get('key2').decode("utf-8")) pipe.multi() #  pipe.set('key2', 100) #  print("" + r.get("key2").decode("utf-8"))#400#400 mysqlrollbackredisdiscard 1.mysqlsqlsqlrollback 2.redisdiscard 1redis 2redis watch 1.watchredis 2.watchexecrediswatch 3.watchWatchError watch+multi setnxredis 1. 2.setnxset if not exists 3.del 123&gt; setnx lock:codehole true.... do something critical ....&gt; del lock:codehole 4.del 5.expire 1234&gt; setnx lock:codehole true&gt; expire lock:codehole 5.... do something critical ....&gt; del lock:codehole 6.setnxexpire 7.redis2.8setsetnxexpire 123&gt; set lock:codehole true ex 5 nx''' do something '''&gt; del lock:codehole RedisRediswatch+multi1234567891011121314151617181920212223242526#! /usr/bin/env python# -*- coding: utf-8 -*-import redisdef sale(rs): while True: with rs.pipeline() as p: try: p.watch('apple') # keyapple count = int(rs.get('apple')) print(': %d' % count) p.multi() #  if count&gt; 0 : #  p.set('apple', count - 1) p.execute() #  p.unwatch() break #  except Exception as e: # watchWatchError print('[Error]: %s' % e) continue # rs = redis.Redis(host='127.0.0.1', port=6379) # redisrs.set('apple',1000) # redisapplevalue1000sale(rs) 1 1.WATCHwatch 2.1 2 1.Redis 2.WATCH Rediswatch+multi+setnx1 1.SETNXRedis 2.setnx 2redis 1.RedisSETNXrs.setnx(lock_name, uuid) 2.128UUID 3 1.keyuuid 2.uuiddeleteredisrs.delete(lockname) 3.uuid 4 1. 2. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109import redisimport uuidimport time# 1.def get_conn(host,port=6379): rs = redis.Redis(host=host, port=port) return rs# 2. redisdef acquire_lock(rs, lock_name, expire_time=10): ''' rs:  lock_name:  acquire_time:  return -&gt; False  or True  ''' identifier = str(uuid.uuid4()) end = time.time() + expire_time while time.time() &lt; end: # False if rs.setnx(lock_name, identifier): #  return identifier # time.sleep(.001) return False# 3. def release_lock(rs, lockname, identifier): ''' rs:  lockname:  identifier: value ''' if rs.get(lockname).decode() == identifier: #  rs.delete(lockname) return True #  else: return False # #def acquire_expire_lock(rs, lock_name, expire_time=10, locked_time=10): ''' rs:  lock_name:  acquire_time:  locked_time:  return -&gt; False  or True  ''' identifier = str(uuid.uuid4()) end = time.time() + expire_time while time.time() &lt; end: # False if rs.setnx(lock_name, identifier): #  # print(': %s' % identifier) rs.expire(lock_name, locked_time) return identifier time.sleep(.001) return False''''''def sale(rs): start = time.time() #  with rs.pipeline() as p: '''   ''' while 1: lock = acquire_lock(rs, 'lock') if not lock: #  continue #"lock" p.watch("lock") try: # p.multi() count = int(rs.get('apple')) #  p.set('apple', count-1) #  # time.sleep(5) # p.execute() print(': %s' % count) # break except: # print("") # finally: res = release_lock(rs, 'lock', lock) # if res: print("") # else: print(",") res = rs.delete('lock') print(res) print('[time]: %.2f' % (time.time() - start))rs = redis.Redis(host='127.0.0.1', port=6379) # redis# rs.set('apple',1000) # # redisapple value1000sale(rs)  def acquire_expire_lock(rs, lock_name, expire_time=10, locked_time=10): ''' rs:  lock_name:  acquire_time:  locked_time:  return -&gt; False  or True  ''' identifier = str(uuid.uuid4()) end = time.time() + expire_time while time.time() &lt; end: # False if rs.setnx(lock_name, identifier): #  # print(': %s' % identifier) rs.expire(lock_name, locked_time) return identifier time.sleep(.001) return False]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Lock]]></title>
    <url>%2F2020%2F07%2F29%2FLaravel-Lock%2F</url>
    <content type="text"><![CDATA[  12345678910use Illuminate\Support\Facades\Cache;$lock = Cache::lock('foo', 10);if ($lock-&gt;get()) &#123; //  sleep(3); $lock-&gt;release();&#125;  getLaravel 123Cache::lock('foo')-&gt;get(function () &#123; // ...&#125;);  123456789101112use Illuminate\Contracts\Cache\LockTimeoutException;$lock = Cache::lock('foo', 10);try &#123; $lock-&gt;block(5); echo "5...";&#125; catch (LockTimeoutException $e) &#123; echo "5...";&#125; finally &#123; optional($lock)-&gt;release();&#125;  123Cache::lock('foo', 10)-&gt;block(5, function () &#123; echo "5...";&#125;);  1Cache::lock('foo')-&gt;forceRelease();  1234567// ...$podcast = Podcast::find($id);$lock = Cache::lock('foo', 120);if ($result = $lock-&gt;get()) &#123; ProcessPodcast::dispatch($podcast, $lock-&gt;owner());&#125; 123// ...// Cache::restoreLock('foo', $this-&gt;owner)-&gt;release();  Illuminate\Contracts\Cache\Lock.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;?phpnamespace Illuminate\Contracts\Cache;interface Lock&#123; /** *  * * @param callable|null $callback * @return mixed */ public function get($callback = null); /** *  * * @param int $seconds * @param callable|null $callback * @return bool */ public function block($seconds, $callback = null); /** * Release the lock. * * @return void */ public function release(); /** * Returns the current owner of the lock. * * @return string */ public function owner(); /** * Releases this lock in disregard of ownership. * * @return void */ public function forceRelease();&#125;  Illuminate\Cache\Lock.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167&lt;?phpnamespace Illuminate\Cache;use Illuminate\Contracts\Cache\Lock as LockContract;use Illuminate\Contracts\Cache\LockTimeoutException;use Illuminate\Support\InteractsWithTime;use Illuminate\Support\Str;abstract class Lock implements LockContract&#123; use InteractsWithTime; /** *  * * @var string */ protected $name; /** *  * * @var int */ protected $seconds; /** *  * * @var string */ protected $owner; /** *  * * @var int */ protected $sleepMilliseconds = 250; /** *  * * @param string $name * @param int $seconds * @param string|null $owner * @return void */ public function __construct($name, $seconds, $owner = null) &#123; if (is_null($owner)) &#123; $owner = Str::random(); &#125; $this-&gt;name = $name; $this-&gt;owner = $owner; $this-&gt;seconds = $seconds; &#125; /** *  * * @return bool */ abstract public function acquire(); /** *  * * @return bool */ abstract public function release(); /** *  * * @return string */ abstract protected function getCurrentOwner(); /** *  * * @param callable|null $callback * @return mixed */ public function get($callback = null) &#123; $result = $this-&gt;acquire(); if ($result &amp;&amp; is_callable($callback)) &#123; try &#123; return $callback(); &#125; finally &#123; $this-&gt;release(); &#125; &#125; return $result; &#125; /** *  * * @param int $seconds * @param callable|null $callback * @return bool * * @throws \Illuminate\Contracts\Cache\LockTimeoutException */ public function block($seconds, $callback = null) &#123; $starting = $this-&gt;currentTime(); while (! $this-&gt;acquire()) &#123; usleep($this-&gt;sleepMilliseconds * 1000); if ($this-&gt;currentTime() - $seconds &gt;= $starting) &#123; throw new LockTimeoutException; &#125; &#125; if (is_callable($callback)) &#123; try &#123; return $callback(); &#125; finally &#123; $this-&gt;release(); &#125; &#125; return true; &#125; /** *  * * @return string */ public function owner() &#123; return $this-&gt;owner; &#125; /** *  * * @return bool */ protected function isOwnedByCurrentProcess() &#123; return $this-&gt;getCurrentOwner() === $this-&gt;owner; &#125; /** *  * * @param int $milliseconds * @return $this */ public function betweenBlockedAttemptsSleepFor($milliseconds) &#123; $this-&gt;sleepMilliseconds = $milliseconds; return $this; &#125;&#125; Illuminate\Contracts\Cache\LockTimeoutException.php 12345678910&lt;?phpnamespace Illuminate\Contracts\Cache;use Exception;class LockTimeoutException extends Exception&#123; //&#125; Redis Illuminate\Cache\RedisLock.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;?phpnamespace Illuminate\Cache;class RedisLock extends Lock&#123; /** * Redis * * @var \Illuminate\Redis\Connections\Connection */ protected $redis; /** * Create a new lock instance. * * @param \Illuminate\Redis\Connections\Connection $redis * @param string $name * @param int $seconds * @param string|null $owner * @return void */ public function __construct($redis, $name, $seconds, $owner = null) &#123; parent::__construct($name, $seconds, $owner); $this-&gt;redis = $redis; &#125; /** * Attempt to acquire the lock. * * @return bool */ public function acquire() &#123; if ($this-&gt;seconds &gt; 0) &#123; return $this-&gt;redis-&gt;set($this-&gt;name, $this-&gt;owner, 'EX', $this-&gt;seconds, 'NX') == true; &#125; else &#123; return $this-&gt;redis-&gt;setnx($this-&gt;name, $this-&gt;owner) === 1; &#125; &#125; /** * Release the lock. * * @return bool */ public function release() &#123; return (bool) $this-&gt;redis-&gt;eval(LuaScripts::releaseLock(), 1, $this-&gt;name, $this-&gt;owner); &#125; /** *  * * @return void */ public function forceRelease() &#123; $this-&gt;redis-&gt;del($this-&gt;name); &#125; /** *  * * @return string */ protected function getCurrentOwner() &#123; return $this-&gt;redis-&gt;get($this-&gt;name); &#125;&#125; Lua 12345678910111213141516171819202122232425&lt;?phpnamespace Illuminate\Cache;class LuaScripts&#123; /** * Lua. * * KEYS[1] -  * ARGV[1] -  * * @return string */ public static function releaseLock() &#123; return &lt;&lt;&lt;'LUA'if redis.call("get",KEYS[1]) == ARGV[1] then return redis.call("del",KEYS[1])else return 0endLUA; &#125;&#125;  1.get() 2.block() 3.Redisset() 4.set()NX 5.set()EX 6.set()+expire()set() 7.RedisLua 8.Lua]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHPRedis]]></title>
    <url>%2F2020%2F07%2F29%2FPHP%E4%BD%BF%E7%94%A8Redis%E9%94%81%E9%99%90%E5%88%B6%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%E7%B1%BB%2F</url>
    <content type="text"><![CDATA[ 1.   1234if A() B() C()D() (A)(B)(C) 2.RedissetnxsetnxSet it Not eXists  RedisLock.class.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990&lt;?phpclass RedisLock &#123; private $_config; private $_redis; /** *  * * @param Array $config redis */ public function __construct($config=[]) &#123; $this-&gt;_config = $config; $this-&gt;_redis = $this-&gt;connect(); &#125; /** *  * * @param String $key  * @param Int $expire  * @return Boolean */ public function lock($key, $expire=5) &#123; $is_lock = $this-&gt;_redis-&gt;setnx($key, time()+$expire); //  if(!$is_lock) &#123; //  $lock_time = $this-&gt;_redis-&gt;get($key); //  if(time() &gt; $lock_time) &#123; $this-&gt;unlock($key); $is_lock = $this-&gt;_redis-&gt;setnx($key, time()+$expire); &#125; &#125; return $is_lock ? true : false; &#125; /** *  * * @param String $key  * @return Boolean */ public function unlock($key) &#123; return $this-&gt;_redis-&gt;del($key); &#125; /** * redis * * @return Link */ private function connect() &#123; try &#123; $redis = new Redis(); $redis-&gt;connect( $this-&gt;_config['host'], $this-&gt;_config['port'], $this-&gt;_config['timeout'], $this-&gt;_config['reserved'], $this-&gt;_config['retry_interval'] ); if(!empty($this-&gt;_config['auth'])) &#123; $redis-&gt;auth($this-&gt;_config['auth']); &#125; $redis-&gt;select($this-&gt;_config['index']); &#125;catch(RedisException $e) &#123; throw new Exception($e-&gt;getMessage()); &#125; return $redis; &#125;&#125; demo.php 1234567891011121314151617181920212223242526272829303132333435&lt;?phprequire 'RedisLock.class.php';$config = [ 'host' =&gt; 'localhost', 'port' =&gt; 6379, 'index' =&gt; 0, 'auth' =&gt; '', 'timeout' =&gt; 1, 'reserved' =&gt; NULL, 'retry_interval' =&gt; 100,];// redislock$oRedisLock = new RedisLock($config);// $key = 'mylock';// $is_lock = $oRedisLock-&gt;lock($key, 10);if($is_lock)&#123; echo 'get lock success&lt;br&gt;'; echo 'do sth..&lt;br&gt;'; sleep(5); echo 'success&lt;br&gt;'; $oRedisLock-&gt;unlock($key);// &#125;else&#123; echo 'request too frequently&lt;br&gt;';&#125;  ,A,Bdemo.php  123get lock successdo sth..success  1request too frequently  ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHPRedis]]></title>
    <url>%2F2020%2F07%2F29%2FPHP%E5%9C%A8%E5%A4%A7%E5%B9%B6%E5%8F%91%E4%B8%8BRedis%E9%94%81%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[  nosqlredisphpredisnginx ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F06%2F16%2F%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%2F</url>
    <content type="text"><![CDATA[           777         MaintainabilityReusability   71 1 7     Single Responsibility Principle SRP   Open-Closed Principle OCP   Liskov Substitution Principle LSP   Dependence Inversion Principle DIP   Interface Segregation Principle ISP   Composite Reuse Principle CRP   Law of Demeter LoD     1  1    CRMCustomer Relationship Management11  1GetConnection()FindCustomers()CreateChart()DisplayChart() 1CustomerDataChartFindCustomers()CustomerDataChart3 (1)DBUtilGetConnection() (2)CustomerDAOCustomerCustomerFindCustomers() (3)CustomerDataChartCreateChart()DisplayChart() 2 2    1   C#Java GoF23  1So1To2TPo1o2PST  1     1 : 1   Dependency InjectionDI3SetterSetter  CRMTXTExcelCustomerDAO33  3TXTDataConvertorExcelDataConvertorCustomerDAOCustomerDAO CustomerDAOCustomerDAODataConvertorCustomerDAODataConvertorDataConvertorDataConvertor4 4  3  1 C#JavainterfaceISP (1) (2)ISP  CRM5DataRead()TransformToXML()XMLCreateChart()DisplayChart()CreateReport()DisplayReport()5  XMLTransformToXML() 5CustomerDataDisplay 6 6   /Composition/Aggregate Reuse PrincipleCARP 1 / ///   Has-AIs-AIs-AHas-A  CRMAccessCustomerDAOGetConnection()DBUtilDBUtilGetConnection()CustomerDAODBUtil77  OracleOracleDBUtilOracleCustomerDAODBUtilCustomerDAOCustomerDAOOracleDBUtilDBUtil 8 8  8CustomerDAODBUtilDBUtilCustomerDAODBUtilOracleDBUtilOracleCustomerDAODBUtilDBUtilDBUtilCustomerDAOCustomerDAOOracleDBUtilOracle Least Knowledge PrincipleLKP 1  Dont talk to strangersTalk only to your immediate friends (1)this (2) (3) (4) (5)     CRMButtonListComboBoxTextBoxLabel99  9 Mediator10 10  10Mediator (1) (2) (3) (4) (5) (6) (7) (8)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Database-Eloquent Model]]></title>
    <url>%2F2020%2F06%2F11%2FLaravel-Database-Eloquent-Model%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%8B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ get 1234567891011121314151617public function get($columns = ['*'])&#123; $builder = $this-&gt;applyScopes(); if (count($models = $builder-&gt;getModels($columns)) &gt; 0) &#123; $models = $builder-&gt;eagerLoadRelations($models); &#125; return $builder-&gt;getModel()-&gt;newCollection($models);&#125;public function getModels($columns = ['*'])&#123; return $this-&gt;model-&gt;hydrate( $this-&gt;query-&gt;get($columns)-&gt;all() )-&gt;all();&#125; get QueryBuilderhydratehydrateEloquentModeleagerLoadRelations 12345678public function hydrate(array $items)&#123; $instance = $this-&gt;newModelInstance(); return $instance-&gt;newCollection(array_map(function ($item) use ($instance) &#123; return $instance-&gt;newFromBuilder($item); &#125;, $items));&#125; newModelInstanceconnection 123456public function newModelInstance($attributes = [])&#123; return $this-&gt;model-&gt;newInstance($attributes)-&gt;setConnection( $this-&gt;query-&gt;getConnection()-&gt;getName() );&#125; newFromBuilderEloquent Modelattributes 123456789101112public function newFromBuilder($attributes = [], $connection = null)&#123; $model = $this-&gt;newInstance([], true); $model-&gt;setRawAttributes((array) $attributes, true); $model-&gt;setConnection($connection ?: $this-&gt;getConnectionName()); $model-&gt;fireModelEvent('retrieved', false); return $model;&#125; newInstance 123456789101112public function newInstance($attributes = [], $exists = false)&#123; $model = new static((array) $attributes); $model-&gt;exists = $exists; $model-&gt;setConnection( $this-&gt;getConnectionName() ); return $model;&#125; newInstanceexisttrueexistupdate setRawAttributessync 1234567891011121314151617public function setRawAttributes(array $attributes, $sync = false)&#123; $this-&gt;attributes = $attributes; if ($sync) &#123; $this-&gt;syncOriginal(); &#125; return $this;&#125;public function syncOriginal()&#123; $this-&gt;original = $this-&gt;attributes; return $this;&#125; saveoriginalattributes  find findidfind 1234567891011121314151617public function find($id, $columns = ['*'])&#123; if (is_array($id) || $id instanceof Arrayable) &#123; return $this-&gt;findMany($id, $columns); &#125; return $this-&gt;whereKey($id)-&gt;first($columns);&#125;public function findMany($ids, $columns = ['*'])&#123; if (empty($ids)) &#123; return $this-&gt;model-&gt;newCollection(); &#125; return $this-&gt;whereKey($ids)-&gt;get($columns);&#125; findOrFail laravel  findOrFail  controller 12345678910111213141516public function findOrFail($id, $columns = ['*'])&#123; $result = $this-&gt;find($id, $columns); if (is_array($id)) &#123; if (count($result) == count(array_unique($id))) &#123; return $result; &#125; &#125; elseif (! is_null($result)) &#123; return $result; &#125; throw (new ModelNotFoundException)-&gt;setModel( get_class($this-&gt;model), $id );&#125;   Query BuilderselectselectSubwhereDatewhereBetweenEloquent ModelQuery Builder 1234567891011121314151617protected $passthru = [ 'insert', 'insertGetId', 'getBindings', 'toSql', 'exists', 'count', 'min', 'max', 'avg', 'sum', 'getConnection',];public function __call($method, $parameters)&#123; ... if (in_array($method, $this-&gt;passthru)) &#123; return $this-&gt;toBase()-&gt;&#123;$method&#125;(...$parameters); &#125; $this-&gt;query-&gt;&#123;$method&#125;(...$parameters); return $this;&#125; passthru aggregate 12345678910111213141516171819202122232425262728293031323334353637383940public function toBase()&#123; return $this-&gt;applyScopes()-&gt;getQuery();&#125;``` save Eloquent Modelsavemodel save ```phppublic function save(array $options = [])&#123; $query = $this-&gt;newQueryWithoutScopes(); if ($this-&gt;fireModelEvent('saving') === false) &#123; return false; &#125; if ($this-&gt;exists) &#123; $saved = $this-&gt;isDirty() ? $this-&gt;performUpdate($query) : true; &#125; else &#123; $saved = $this-&gt;performInsert($query); if (! $this-&gt;getConnectionName() &amp;&amp; $connection = $query-&gt;getConnection()) &#123; $this-&gt;setConnection($connection-&gt;getName()); &#125; &#125; if ($saved) &#123; $this-&gt;finishSave($options); &#125; return $saved;&#125; savesavewherewherequery\builderupdate 1234567891011121314151617public function newQueryWithoutScopes()&#123; $builder = $this-&gt;newEloquentBuilder($this-&gt;newBaseQueryBuilder()); return $builder-&gt;setModel($this) -&gt;with($this-&gt;with) -&gt;withCount($this-&gt;withCount);&#125;protected function newBaseQueryBuilder()&#123; $connection = $this-&gt;getConnection(); return new QueryBuilder( $connection, $connection-&gt;getQueryGrammar(), $connection-&gt;getPostProcessor() );&#125; newQueryWithoutScopesEloquent\builderEloquent\builder  Query\builder  performUpdate get() exists  true 12345678910111213141516171819public function isDirty($attributes = null)&#123; return $this-&gt;hasChanges( $this-&gt;getDirty(), is_array($attributes) ? $attributes : func_get_args() );&#125;public function getDirty()&#123; $dirty = []; foreach ($this-&gt;getAttributes() as $key =&gt; $value) &#123; if (! $this-&gt;originalIsEquivalent($key, $value)) &#123; $dirty[$key] = $value; &#125; &#125; return $dirty;&#125; getDirtyoriginalIsEquivalent 1234567891011121314151617181920212223protected function originalIsEquivalent($key, $current)&#123; if (! array_key_exists($key, $this-&gt;original)) &#123; return false; &#125; $original = $this-&gt;getOriginal($key); if ($current === $original) &#123; return true; &#125; elseif (is_null($current)) &#123; return false; &#125; elseif ($this-&gt;isDateAttribute($key)) &#123; return $this-&gt;fromDateTime($current) === $this-&gt;fromDateTime($original); &#125; elseif ($this-&gt;hasCast($key)) &#123; return $this-&gt;castAttribute($key, $current) === $this-&gt;castAttribute($key, $original); &#125; return is_numeric($current) &amp;&amp; is_numeric($original) &amp;&amp; strcmp((string) $current, (string) $original) === 0;&#125;  update   getDirty  UPDATED_AT  1234567891011121314151617181920212223242526272829303132333435protected function performUpdate(Builder $query)&#123; if ($this-&gt;fireModelEvent('updating') === false) &#123; return false; &#125; if ($this-&gt;usesTimestamps()) &#123; $this-&gt;updateTimestamps(); &#125; $dirty = $this-&gt;getDirty(); if (count($dirty) &gt; 0) &#123; $this-&gt;setKeysForSaveQuery($query)-&gt;update($dirty); $this-&gt;fireModelEvent('updated', false); $this-&gt;syncChanges(); &#125; return true;&#125;protected function updateTimestamps()&#123; $time = $this-&gt;freshTimestamp(); if (! is_null(static::UPDATED_AT) &amp;&amp; ! $this-&gt;isDirty(static::UPDATED_AT)) &#123; $this-&gt;setUpdatedAt($time); &#125; if (! $this-&gt;exists &amp;&amp; ! $this-&gt;isDirty(static::CREATED_AT)) &#123; $this-&gt;setCreatedAt($time); &#125;&#125; where  id 1234567891011121314151617protected function setKeysForSaveQuery(Builder $query)&#123; $query-&gt;where($this-&gt;getKeyName(), '=', $this-&gt;getKeyForSaveQuery()); return $query;&#125;protected function getKeyForSaveQuery()&#123; return $this-&gt;original[$this-&gt;getKeyName()] ?? $this-&gt;getKey();&#125;public function getKey()&#123; return $this-&gt;getAttribute($this-&gt;getKeyName());&#125;  EloquentBuilder  update  12345678910111213141516171819202122232425262728public function update(array $values)&#123; return $this-&gt;toBase()-&gt;update($this-&gt;addUpdatedAtColumn($values));&#125;protected function addUpdatedAtColumn(array $values)&#123; if (! $this-&gt;model-&gt;usesTimestamps()) &#123; return $values; &#125; return Arr::add( $values, $this-&gt;model-&gt;getUpdatedAtColumn(), $this-&gt;model-&gt;freshTimestampString() );&#125;public function freshTimestampString()&#123; return $this-&gt;fromDateTime($this-&gt;freshTimestamp());&#125;public function fromDateTime($value)&#123; return is_null($value) ? $value : $this-&gt;asDateTime($value)-&gt;format( $this-&gt;getDateFormat() );&#125; performInsert increment insertAndSetIdid id  12345678910111213141516171819202122232425262728293031protected function performInsert(Builder $query)&#123; if ($this-&gt;fireModelEvent('creating') === false) &#123; return false; &#125; if ($this-&gt;usesTimestamps()) &#123; $this-&gt;updateTimestamps(); &#125; $attributes = $this-&gt;attributes; if ($this-&gt;getIncrementing()) &#123; $this-&gt;insertAndSetId($query, $attributes); &#125; else &#123; if (empty($attributes)) &#123; return true; &#125; $query-&gt;insert($attributes); &#125; $this-&gt;exists = true; $this-&gt;wasRecentlyCreated = true; $this-&gt;fireModelEvent('created', false); return true;&#125; laravel  insertAndSetId  123456protected function insertAndSetId(Builder $query, $attributes)&#123; $id = $query-&gt;insertGetId($attributes, $keyName = $this-&gt;getKeyName()); $this-&gt;setAttribute($keyName, $id);&#125;  id   1public $incrementing = false;  update save laravel  Eloquent Model : update Eloquent Builder  update performUpdate   update  Model  update  123$flight = App\Flight::find(1);$flight-&gt;update(['name' =&gt; 'New Flight Name','desc' =&gt; 'test']);  Builder  update  12345678910111213141516App\Flight::where('active', 1) -&gt;where('destination', 'San Diego') -&gt;update(['delayed' =&gt; 1]);```  updated_at Model  update  fill  save ```phppublic function update(array $attributes = [], array $options = [])&#123; if (! $this-&gt;exists) &#123; return false; &#125; return $this-&gt;fill($attributes)-&gt;save($options);&#125; make save  make  123$model = App\Flight::make(['name' =&gt; 'New Flight Name','desc' =&gt; 'test']);$model-&gt;save(); make  Eloquent Model 1234567891011public function make(array $attributes = [])&#123; return $this-&gt;newModelInstance($attributes);&#125;public function newModelInstance($attributes = [])&#123; return $this-&gt;model-&gt;newInstance($attributes)-&gt;setConnection( $this-&gt;query-&gt;getConnection()-&gt;getName() );&#125; create  create  1App\Flight::create(['name' =&gt; 'New Flight Name','desc' =&gt; 'test']);  make create  save  123456public function create(array $attributes = [])&#123; return tap($this-&gt;newModelInstance($attributes), function ($instance) &#123; $instance-&gt;save(); &#125;);&#125;  fillable  guarded  forceCreate 123456public function forceCreate(array $attributes)&#123; return $this-&gt;model-&gt;unguarded(function () use ($attributes) &#123; return $this-&gt;newModelInstance()-&gt;create($attributes); &#125;);&#125; findOrNew laravel findOrNew 12345678public function findOrNew($id, $columns = ['*'])&#123; if (! is_null($model = $this-&gt;find($id, $columns))) &#123; return $model; &#125; return $this-&gt;newModelInstance();&#125;  attributes firstOrNew laravel firstOrNew 12345678public function firstOrNew(array $attributes, array $values = [])&#123; if (! is_null($instance = $this-&gt;where($attributes)-&gt;first())) &#123; return $instance; &#125; return $this-&gt;newModelInstance($attributes + $values);&#125;  attributes  values  firstOrCreate  firstOrNew firstOrCreate firstOrCreate  12345678910public function firstOrCreate(array $attributes, array $values = [])&#123; if (! is_null($instance = $this-&gt;where($attributes)-&gt;first())) &#123; return $instance; &#125; return tap($this-&gt;newModelInstance($attributes + $values), function ($instance) &#123; $instance-&gt;save(); &#125;);&#125; updateOrCreate  firstOrCreate  value  123456public function updateOrCreate(array $attributes, array $values = [])&#123; return tap($this-&gt;firstOrNew($attributes), function ($instance) use ($values) &#123; $instance-&gt;fill($values)-&gt;save(); &#125;);&#125; firstOr  firstOr  1234567891011121314public function firstOr($columns = ['*'], Closure $callback = null)&#123; if ($columns instanceof Closure) &#123; $callback = $columns; $columns = ['*']; &#125; if (! is_null($model = $this-&gt;first($columns))) &#123; return $model; &#125; return call_user_func($callback);&#125;  Eloquent Model  Eloquent Builder  model  12345678910111213141516171819202122public function delete()&#123; if (is_null($this-&gt;getKeyName())) &#123; throw new Exception('No primary key defined on model.'); &#125; if (! $this-&gt;exists) &#123; return; &#125; if ($this-&gt;fireModelEvent('deleting') === false) &#123; return false; &#125; $this-&gt;touchOwners(); $this-&gt;performDeleteOnModel(); $this-&gt;fireModelEvent('deleted', false); return true;&#125; performDeleteOnModel  12345678910111213protected function performDeleteOnModel()&#123; $this-&gt;setKeysForSaveQuery($this-&gt;newQueryWithoutScopes())-&gt;delete(); $this-&gt;exists = false;&#125;protected function setKeysForSaveQuery(Builder $query)&#123; $query-&gt;where($this-&gt;getKeyName(), '=', $this-&gt;getKeyForSaveQuery()); return $query;&#125; Model  builder  delete   Illuminate\Database\Eloquent\SoftDeletes  trait deleted_at dates :  1234567891011class Flight extends Model&#123; use SoftDeletes; /** *  * * @var array */ protected $dates = ['deleted_at'];&#125;  trait 12345678trait SoftDeletes &#123; public static function bootSoftDeletes() &#123; static::addGlobalScope(new SoftDeletingScope); &#125;&#125;  model  SoftDeletingScope : 123456789101112131415161718192021222324class SoftDeletingScope implements Scope&#123; protected $extensions = ['Restore', 'WithTrashed', 'WithoutTrashed', 'OnlyTrashed']; public function apply(Builder $builder, Model $model) &#123; $builder-&gt;whereNull($model-&gt;getQualifiedDeletedAtColumn()); &#125; public function extend(Builder $builder) &#123; foreach ($this-&gt;extensions as $extension) &#123; $this-&gt;&#123;"add&#123;$extension&#125;"&#125;($builder); &#125; $builder-&gt;onDelete(function (Builder $builder) &#123; $column = $this-&gt;getDeletedAtColumn($builder); return $builder-&gt;update([ $column =&gt; $builder-&gt;getModel()-&gt;freshTimestampString(), ]); &#125;); &#125;&#125; apply  get whereNull  where deleted_at  null  extend extend  model  WithTrashed 123456 protected function addWithTrashed(Builder $builder)&#123; $builder-&gt;macro('withTrashed', function (Builder $builder) &#123; return $builder-&gt;withoutGlobalScope($this); &#125;);&#125; withTrashed  withoutTrashed 123456789101112protected function addWithoutTrashed(Builder $builder)&#123; $builder-&gt;macro('withoutTrashed', function (Builder $builder) &#123; $model = $builder-&gt;getModel(); $builder-&gt;withoutGlobalScope($this)-&gt;whereNull( $model-&gt;getQualifiedDeletedAtColumn() ); return $builder; &#125;);&#125; withTrashed  onlyTrashed 123456789101112protected function addOnlyTrashed(Builder $builder)&#123; $builder-&gt;macro('onlyTrashed', function (Builder $builder) &#123; $model = $builder-&gt;getModel(); $builder-&gt;withoutGlobalScope($this)-&gt;whereNotNull( $model-&gt;getQualifiedDeletedAtColumn() ); return $builder; &#125;);&#125;  onlyTrashed whereNotNull restore 12345678protected function addRestore(Builder $builder)&#123; $builder-&gt;macro('restore', function (Builder $builder) &#123; $builder-&gt;withTrashed(); return $builder-&gt;update([$builder-&gt;getModel()-&gt;getDeletedAtColumn() =&gt; null]); &#125;);&#125;  restore deleted_at  null performDeleteOnModelSoftDeletes  trait  performDeleteOnModel  Eloquent Builder  delete  123456789101112131415161718192021222324252627protected function performDeleteOnModel()&#123; if ($this-&gt;forceDeleting) &#123; return $this-&gt;newQueryWithoutScopes()-&gt;where($this-&gt;getKeyName(), $this-&gt;getKey())-&gt;forceDelete(); &#125; return $this-&gt;runSoftDelete();&#125;protected function runSoftDelete()&#123; $query = $this-&gt;newQueryWithoutScopes()-&gt;where($this-&gt;getKeyName(), $this-&gt;getKey()); $time = $this-&gt;freshTimestamp(); $columns = [$this-&gt;getDeletedAtColumn() =&gt; $this-&gt;fromDateTime($time)]; $this-&gt;&#123;$this-&gt;getDeletedAtColumn()&#125; = $time; if ($this-&gt;timestamps) &#123; $this-&gt;&#123;$this-&gt;getUpdatedAtColumn()&#125; = $time; $columns[$this-&gt;getUpdatedAtColumn()] = $this-&gt;fromDateTime($time); &#125; $query-&gt;update($columns);&#125;  deleted_at updated_at ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Database-Eloquent Model]]></title>
    <url>%2F2020%2F06%2F11%2FLaravel-Database-Eloquent-Model%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%8A%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ Eloquent ModelEloquent ModelModel Eloquent ModelEloquentEloquentLaravelEloquent EloquentCarbonJSON &amp;getFooAttributeFoofirst_nameEloquentfirst_name 12345678910111213141516171819&lt;?phpnamespace App;use Illuminate\Database\Eloquent\Model;class User extends Model&#123; /** * . * * @param string $value * @return string */ public function getFirstNameAttribute($value) &#123; return ucfirst($value); &#125;&#125; first_name 123$user = App\User::find(1);$firstName = $user-&gt;first_name;  123456789/** * . * * @return string */public function getFullNameAttribute()&#123; return "&#123;$this-&gt;first_name&#125; &#123;$this-&gt;last_name&#125;";&#125; Tip/JSON setFooAttributeFoofirst_namefirst_name 12345678910111213141516171819&lt;?phpnamespace App;use Illuminate\Database\Eloquent\Model;class User extends Model&#123; /** * . * * @param string $value * @return void */ public function setFirstNameAttribute($value) &#123; $this-&gt;attributes['first_name'] = strtolower($value); &#125;&#125; Eloquent$attributesfirst_nameSally 123$user = App\User::find(1);$user-&gt;first_name = 'Sally'; setFirstNameAttributeSallystrtolower$attributes Eloquentcreated_atupdated_atCarbonPHPDateTime$dates 1234567891011121314151617&lt;?phpnamespace App;use Illuminate\Database\Eloquent\Model;class User extends Model&#123; /** * . * * @var array */ protected $dates = [ 'seen_at', ];&#125; Tip$timestampsfalsecreated_atupdated_at UNIXY-m-dDateTime/Carbon 12345$user = App\User::find(1);$user-&gt;deleted_at = now();$user-&gt;save(); $datesCarbonCarbon 123$user = App\User::find(1);return $user-&gt;deleted_at-&gt;getTimestamp();  Y-m-d Hs$dateFormatJSON 123456789101112131415&lt;?phpnamespace App;use Illuminate\Database\Eloquent\Model;class Flight extends Model&#123; /** * . * * @var string */ protected $dateFormat = 'U';&#125;  $casts$castsintegerrealfloatdoubledecimal:&lt;digits&gt;stringbooleanobjectarraycollectiondatedatetimetimestampdecimaldecimal:2 01is_admin 1234567891011121314151617&lt;?phpnamespace App;use Illuminate\Database\Eloquent\Model;class User extends Model&#123; /** * . * * @var array */ protected $casts = [ 'is_admin' =&gt; 'boolean', ];&#125; is_admin 12345$user = App\User::find(1);if ($user-&gt;is_admin) &#123; //&#125; &amp;JSON JSONarrayJSONJSONTEXTEloquentarrayPHP 1234567891011121314151617181920212223242526272829 &lt;?php namespace App; use Illuminate\Database\Eloquent\Model; class User extends Model &#123; /** * . * * @var array */ protected $casts = [ 'options' =&gt; 'array', ]; &#125;``` optionsJSONPHPoptionsJSON```php $user = App\User::find(1); $options = $user-&gt;options; $options['key'] = 'value'; $user-&gt;options = $options; $user-&gt;save(); Date datedatetimeJSON 12345678/** * . * * @var array */protected $casts = [ 'created_at' =&gt; 'datetime:Y-m-d',]; EloquentEloquent  1234567891011121314151617181920212223242526272829public function offsetSet($offset, $value)&#123; $this-&gt;setAttribute($offset, $value);&#125;public function setAttribute($key, $value)&#123; if ($this-&gt;hasSetMutator($key)) &#123; $method = 'set'.Str::studly($key).'Attribute'; return $this-&gt;&#123;$method&#125;($value); &#125; elseif ($value &amp;&amp; $this-&gt;isDateAttribute($key)) &#123; $value = $this-&gt;fromDateTime($value); &#125; if ($this-&gt;isJsonCastable($key) &amp;&amp; ! is_null($value)) &#123; $value = $this-&gt;castAttributeAsJson($key, $value); &#125; if (Str::contains($key, '-&gt;')) &#123; return $this-&gt;fillJsonAttribute($key, $value); &#125; $this-&gt;attributes[$key] = $value; return $this;&#125;  modeloffsetSetsetAttribute 1234public function hasSetMutator($key)&#123; return method_exists($this, 'set'.Str::studly($key).'Attribute');&#125;    12345678910111213141516171819protected function isDateAttribute($key)&#123; return in_array($key, $this-&gt;getDates()) || $this-&gt;isDateCastable($key);&#125;public function getDates()&#123; $defaults = [static::CREATED_AT, static::UPDATED_AT]; return $this-&gt;usesTimestamps() ? array_unique(array_merge($this-&gt;dates, $defaults)) : $this-&gt;dates;&#125;protected function isDateCastable($key)&#123; return $this-&gt;hasCast($key, ['date', 'datetime']);&#125; $dates 1protected $dates = ['date_attr'];  cast  1protected $casts = ['date_attr' =&gt; 'date']; LaraveldateFormatY-m-d H:i:s: 123protected $dateFormat = ['U'];protected $dateFormat = ['Y-m-d H:i:s']; CarbonDateTime 12345678910111213141516171819202122232425262728293031public function fromDateTime($value)&#123; return is_null($value) ? $value : $this-&gt;asDateTime($value)-&gt;format( $this-&gt;getDateFormat() );&#125;protected function asDateTime($value)&#123; if ($value instanceof Carbon) &#123; return $value; &#125; if ($value instanceof DateTimeInterface) &#123; return new Carbon( $value-&gt;format('Y-m-d H:i:s.u'), $value-&gt;getTimezone() ); &#125; if (is_numeric($value)) &#123; return Carbon::createFromTimestamp($value); &#125; if ($this-&gt;isStandardDateFormat($value)) &#123; return Carbon::createFromFormat('Y-m-d', $value)-&gt;startOfDay(); &#125; return Carbon::createFromFormat( $this-&gt;getDateFormat(), $value );&#125; json arrayjsonjson 123456789protected function isJsonCastable($key)&#123; return $this-&gt;hasCast($key, ['array', 'json', 'object', 'collection']);&#125;protected function asJson($value)&#123; return json_encode($value);&#125; Eloquent Model   12312  1234567891011121314151617public function getAttribute($key)&#123; if (! $key) &#123; return; &#125; if (array_key_exists($key, $this-&gt;attributes) || $this-&gt;hasGetMutator($key)) &#123; return $this-&gt;getAttributeValue($key); &#125; if (method_exists(self::class, $key)) &#123; return; &#125; return $this-&gt;getRelationValue($key);&#125;  12345678910111213141516171819public function getAttributeValue($key)&#123; $value = $this-&gt;getAttributeFromArray($key); if ($this-&gt;hasGetMutator($key)) &#123; return $this-&gt;mutateAttribute($key, $value); &#125; if ($this-&gt;hasCast($key)) &#123; return $this-&gt;castAttribute($key, $value); &#125; if (in_array($key, $this-&gt;getDates()) &amp;&amp; ! is_null($value)) &#123; return $this-&gt;asDateTime($value); &#125; return $value;&#125;   attributesattributesnull 123456protected function getAttributeFromArray($key)&#123; if (isset($this-&gt;attributes[$key])) &#123; return $this-&gt;attributes[$key]; &#125;&#125;   123456789public function hasGetMutator($key)&#123; return method_exists($this, 'get'.Str::studly($key).'Attribute');&#125;protected function mutateAttribute($key, $value)&#123; return $this-&gt;&#123;'get'.Str::studly($key).'Attribute'&#125;($value);&#125;   $casts  123456789101112131415161718192021222324252627282930313233343536373839404142434445public function hasCast($key, $types = null)&#123; if (array_key_exists($key, $this-&gt;getCasts())) &#123; return $types ? in_array($this-&gt;getCastType($key), (array) $types, true) : true; &#125; return false;&#125;protected function castAttribute($key, $value)&#123; if (is_null($value)) &#123; return $value; &#125; switch ($this-&gt;getCastType($key)) &#123; case 'int': case 'integer': return (int) $value; case 'real': case 'float': case 'double': return (float) $value; case 'string': return (string) $value; case 'bool': case 'boolean': return (bool) $value; case 'object': return $this-&gt;fromJson($value, true); case 'array': case 'json': return $this-&gt;fromJson($value); case 'collection': return new BaseCollection($this-&gt;fromJson($value)); case 'date': return $this-&gt;asDate($value); case 'datetime': return $this-&gt;asDateTime($value); case 'timestamp': return $this-&gt;asTimestamp($value); default: return $value; &#125;&#125;  CREATED_ATUPDATED_ATdatesasDateTime Eloquent Model toArray 1234public function toArray()&#123; return array_merge($this-&gt;attributesToArray(), $this-&gt;relationsToArray());&#125;  1234567891011121314151617181920public function attributesToArray()&#123; $attributes = $this-&gt;addDateAttributesToArray( $attributes = $this-&gt;getArrayableAttributes() ); $attributes = $this-&gt;addMutatedAttributesToArray( $attributes, $mutatedAttributes = $this-&gt;getMutatedAttributes() ); $attributes = $this-&gt;addCastAttributesToArray( $attributes, $mutatedAttributes ); foreach ($this-&gt;getArrayableAppends() as $key) &#123; $attributes[$key] = $this-&gt;mutateAttributeForArray($key, null); &#125; return $attributes;&#125;  getArrayableAttributes   attributes  1234567891011121314151617protected function getArrayableAttributes()&#123; return $this-&gt;getArrayableItems($this-&gt;attributes);&#125;protected function getArrayableItems(array $values)&#123; if (count($this-&gt;getVisible()) &gt; 0) &#123; $values = array_intersect_key($values, array_flip($this-&gt;getVisible())); &#125; if (count($this-&gt;getHidden()) &gt; 0) &#123; $values = array_diff_key($values, array_flip($this-&gt;getHidden())); &#125; return $values;&#125; $visible$hiddentoArray  12345678910111213141516171819protected function addDateAttributesToArray(array $attributes)&#123; foreach ($this-&gt;getDates() as $key) &#123; if (! isset($attributes[$key])) &#123; continue; &#125; $attributes[$key] = $this-&gt;serializeDate( $this-&gt;asDateTime($attributes[$key]) ); &#125; return $attributes;&#125;protected function serializeDate(DateTimeInterface $date)&#123; return $date-&gt;format($this-&gt;getDateFormat());&#125;   123456789101112131415161718192021222324public function getMutatedAttributes()&#123; $class = static::class; if (! isset(static::$mutatorCache[$class])) &#123; static::cacheMutatedAttributes($class); &#125; return static::$mutatorCache[$class];&#125;public static function cacheMutatedAttributes($class)&#123; static::$mutatorCache[$class] = collect(static::getMutatorMethods($class))-&gt;map(function ($match) &#123; return lcfirst(static::$snakeAttributes ? Str::snake($match) : $match); &#125;)-&gt;all();&#125;protected static function getMutatorMethods($class)&#123; preg_match_all('/(?&lt;=^|;)get([^;]+?)Attribute(;|$)/', implode(';', get_class_methods($class)), $matches); return $matches[1];&#125; get_class_methodsgetAttributemutatorCache  123456789101112131415161718192021protected function addMutatedAttributesToArray(array $attributes, array $mutatedAttributes)&#123; foreach ($mutatedAttributes as $key) &#123; if (! array_key_exists($key, $attributes)) &#123; continue; &#125; $attributes[$key] = $this-&gt;mutateAttributeForArray( $key, $attributes[$key] ); &#125; return $attributes;&#125;protected function mutateAttributeForArray($key, $value)&#123; $value = $this-&gt;mutateAttribute($key, $value); return $value instanceof Arrayable ? $value-&gt;toArray() : $value;&#125; cast  castcastAttribute 12345678910111213141516171819protected function addCastAttributesToArray(array $attributes, array $mutatedAttributes)&#123; foreach ($this-&gt;getCasts() as $key =&gt; $value) &#123; if (! array_key_exists($key, $attributes) || in_array($key, $mutatedAttributes)) &#123; continue; &#125; $attributes[$key] = $this-&gt;castAttribute( $key, $attributes[$key] ); if ($attributes[$key] &amp;&amp; ($value === 'date' || $value === 'datetime')) &#123; $attributes[$key] = $this-&gt;serializeDate($attributes[$key]); &#125; &#125; return $attributes;&#125; appends  toArray()appendsappends 12345678910111213141516171819202122232425262728293031323334353637383940414243444546protected function getArrayableAppends()&#123; if (! count($this-&gt;appends)) &#123; return []; &#125; return $this-&gt;getArrayableItems( array_combine($this-&gt;appends, $this-&gt;appends) );&#125;``` ## ### Laravel****Illuminate\Database\Eloquent\Scopeapplyapplywhere```php&lt;?phpnamespace App\Scopes;use Illuminate\Database\Eloquent\Scope;use Illuminate\Database\Eloquent\Model;use Illuminate\Database\Eloquent\Builder;class AgeScope implements Scope&#123; /** * Eloquent * * @param \Illuminate\Database\Eloquent\Builder $builder * @param \Illuminate\Database\Eloquent\Model $model * @return void */ public function apply(Builder $builder, Model $model) &#123; $builder-&gt;where('age', '&gt;', 200); &#125;&#125; selectaddSelectselectselect  bootaddGlobalScope 123456789101112131415161718192021&lt;?phpnamespace App;use App\Scopes\AgeScope;use Illuminate\Database\Eloquent\Model;class User extends Model&#123; /** *  * * @return void */ protected static function boot() &#123; parent::boot(); static::addGlobalScope(new AgeScope); &#125;&#125; User::all()SQL 1select * from `users` where `age` &gt; 200  Eloquent 1234567891011121314151617181920212223&lt;?phpnamespace App;use Illuminate\Database\Eloquent\Model;use Illuminate\Database\Eloquent\Builder;class User extends Model&#123; /** *  * * @return void */ protected static function boot() &#123; parent::boot(); static::addGlobalScope('age', function (Builder $builder) &#123; $builder-&gt;where('age', '&gt;', 200); &#125;); &#125;&#125;  withoutGlobalScope 1User::withoutGlobalScope(AgeScope::class)-&gt;get();  1User::withoutGlobalScope('age')-&gt;get(); withoutGlobalScopes 1234567// ...User::withoutGlobalScopes()-&gt;get();// ...User::withoutGlobalScopes([ FirstScope::class, SecondScope::class])-&gt;get();  123456789101112131415161718192021222324252627282930313233&lt;?phpnamespace Illuminate\Database\Eloquent\Concerns;use Closure;use Illuminate\Database\Eloquent\Scope;use Illuminate\Support\Arr;use InvalidArgumentException;trait HasGlobalScopes&#123; /** * Register a new global scope on the model. * * @param \Illuminate\Database\Eloquent\Scope|\Closure|string $scope * @param \Closure|null $implementation * @return mixed * * @throws \InvalidArgumentException */ public static function addGlobalScope($scope, Closure $implementation = null) &#123; if (is_string($scope) &amp;&amp; ! is_null($implementation)) &#123; return static::$globalScopes[static::class][$scope] = $implementation; &#125; elseif ($scope instanceof Closure) &#123; return static::$globalScopes[static::class][spl_object_hash($scope)] = $scope; &#125; elseif ($scope instanceof Scope) &#123; return static::$globalScopes[static::class][get_class($scope)] = $scope; &#125; throw new InvalidArgumentException('Global scope must be an instance of Closure or Scope.'); &#125;&#125; globalScopes Eloquent\ModelEloquent\BuilderEloquent\Builder 1234567891011121314151617181920abstract class Model&#123; use ForwardsCalls; /** * Handle dynamic method calls into the model. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; if (in_array($method, ['increment', 'decrement'])) &#123; return $this-&gt;$method(...$parameters); &#125; return $this-&gt;forwardCallTo($this-&gt;newQuery(), $method, $parameters); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839&lt;?phpnamespace Illuminate\Support\Traits;use BadMethodCallException;use Error;trait ForwardsCalls&#123; /** * Forward a method call to the given object. * * @param mixed $object * @param string $method * @param array $parameters * @return mixed * * @throws \BadMethodCallException */ protected function forwardCallTo($object, $method, $parameters) &#123; try &#123; return $object-&gt;&#123;$method&#125;(...$parameters); &#125; catch (Error | BadMethodCallException $e) &#123; $pattern = '~^Call to undefined method (?P&lt;class&gt;[^:]+)::(?P&lt;method&gt;[^\(]+)\(\)$~'; if (! preg_match($pattern, $e-&gt;getMessage(), $matches)) &#123; throw $e; &#125; if ($matches['class'] != get_class($object) || $matches['method'] != $method) &#123; throw $e; &#125; static::throwBadMethodCallException($method); &#125; &#125;&#125; Eloquent\BuildernewQuery 1234567891011121314151617181920212223242526public function newQuery()&#123; $builder = $this-&gt;newQueryWithoutScopes(); foreach ($this-&gt;getGlobalScopes() as $identifier =&gt; $scope) &#123; $builder-&gt;withGlobalScope($identifier, $scope); &#125; return $builder;&#125;public function getGlobalScopes()&#123; return Arr::get(static::$globalScopes, static::class, []);&#125;public function withGlobalScope($identifier, $scope)&#123; $this-&gt;scopes[$identifier] = $scope; if (method_exists($scope, 'extend')) &#123; $scope-&gt;extend($this); &#125; return $this;&#125; newQueryEloquent\builderglobalScopesEloquent\builderscopes get()Illuminate\Database\Eloquent\Builderget 12345678910public function get($columns = ['*'])&#123; $builder = $this-&gt;applyScopes(); if (count($models = $builder-&gt;getModels($columns)) &gt; 0) &#123; $models = $builder-&gt;eagerLoadRelations($models); &#125; return $builder-&gt;getModel()-&gt;newCollection($models);&#125; applyScopes 1234567891011121314151617181920212223242526public function applyScopes()&#123; if (! $this-&gt;scopes) &#123; return $this; &#125; $builder = clone $this; foreach ($this-&gt;scopes as $identifier =&gt; $scope) &#123; if (! isset($builder-&gt;scopes[$identifier])) &#123; continue; &#125; $builder-&gt;callScope(function (Builder $builder) use ($scope) &#123; if ($scope instanceof Closure) &#123; $scope($builder); &#125; if ($scope instanceof Scope) &#123; $scope-&gt;apply($builder, $this-&gt;getModel()); &#125; &#125;); &#125; return $builder;&#125; buildercallScope 1234567891011121314151617protected function callScope(callable $scope, $parameters = [])&#123; array_unshift($parameters, $this); $query = $this-&gt;getQuery(); $originalWhereCount = is_null($query-&gt;wheres) ? 0 : count($query-&gt;wheres); $result = $scope(...array_values($parameters)) ?? $this; if (count((array) $query-&gt;wheres) &gt; $originalWhereCount) &#123; $this-&gt;addNewWheresWithinGroup($query, $originalWhereCount); &#125; return $result;&#125; callScopeQuery\builderquery\bulidwhere addNewWheresWithinGroupQuery\buildernestwhere 123456789101112131415161718192021222324252627282930313233343536protected function addNewWheresWithinGroup(QueryBuilder $query, $originalWhereCount)&#123; $allWheres = $query-&gt;wheres; $query-&gt;wheres = []; $this-&gt;groupWhereSliceForScope( $query, array_slice($allWheres, 0, $originalWhereCount) ); $this-&gt;groupWhereSliceForScope( $query, array_slice($allWheres, $originalWhereCount) );&#125;protected function groupWhereSliceForScope(QueryBuilder $query, $whereSlice)&#123; $whereBooleans = collect($whereSlice)-&gt;pluck('boolean'); if ($whereBooleans-&gt;contains('or')) &#123; $query-&gt;wheres[] = $this-&gt;createNestedWhere( $whereSlice, $whereBooleans-&gt;first() ); &#125; else &#123; $query-&gt;wheres = array_merge($query-&gt;wheres, $whereSlice); &#125;&#125;protected function createNestedWhere($whereSlice, $boolean = 'and')&#123; $whereGroup = $this-&gt;getQuery()-&gt;forNestedWhere(); $whereGroup-&gt;wheres = $whereSlice; return ['type' =&gt; 'Nested', 'query' =&gt; $whereGroup, 'boolean' =&gt; $boolean];&#125; andwhere orWhereorWhereColumnorcreateNestedWherenestwherewhere Laravel Eloquentscope  123456789101112131415161718192021222324252627282930&lt;?phpnamespace App;use Illuminate\Database\Eloquent\Model;class User extends Model&#123; /** *  * * @param \Illuminate\Database\Eloquent\Builder $query * @return \Illuminate\Database\Eloquent\Builder */ public function scopePopular($query) &#123; return $query-&gt;where('votes', '&gt;', 100); &#125; /** * active * * @param \Illuminate\Database\Eloquent\Builder $query * @return \Illuminate\Database\Eloquent\Builder */ public function scopeActive($query) &#123; return $query-&gt;where('active', 1); &#125;&#125;  scope 1$users = App\User::popular()-&gt;active()-&gt;orderBy('created_at')-&gt;get(); orEloquent 123$users = App\User::popular()-&gt;orWhere(function (Builder $query) &#123; $query-&gt;active();&#125;)-&gt;get(); LaravelorWhere 1$users = App\User::popular()-&gt;orWhere-&gt;active()-&gt;get();  $query 1234567891011121314151617181920&lt;?phpnamespace App;use Illuminate\Database\Eloquent\Model;class User extends Model&#123; /** *  * * @param \Illuminate\Database\Eloquent\Builder $query * @param mixed $type * @return \Illuminate\Database\Eloquent\Builder */ public function scopeOfType($query, $type) &#123; return $query-&gt;where('type', $type); &#125;&#125;  1$users = App\User::ofType('admin')-&gt;get(); __call 12345678910111213141516public function __call($method, $parameters)&#123; ... if (method_exists($this-&gt;model, $scope = 'scope'.ucfirst($method))) &#123; return $this-&gt;callScope([$this-&gt;model, $scope], $parameters); &#125; if (in_array($method, $this-&gt;passthru)) &#123; return $this-&gt;toBase()-&gt;&#123;$method&#125;(...$parameters); &#125; $this-&gt;query-&gt;&#123;$method&#125;(...$parameters); return $this;&#125;  Laravel 1234567$scopes = [ 'published', 'category' =&gt; 'Laravel', 'framework' =&gt; ['Laravel', '5.3'],];(new EloquentModelStub)-&gt;scopes($scopes); $scopes 1234567891011121314151617181920212223242526272829303132333435363738394041public function scopes(array $scopes)&#123; $builder = $this; foreach ($scopes as $scope =&gt; $parameters) &#123; if (is_int($scope)) &#123; list($scope, $parameters) = [$parameters, []]; &#125; $builder = $builder-&gt;callScope( [$this-&gt;model, 'scope'.ucfirst($scope)], (array) $parameters ); &#125; return $builder;&#125;``` fillEloquent ModelLaravelfillfill```phppublic function fill(array $attributes)&#123; $totallyGuarded = $this-&gt;totallyGuarded(); foreach ($this-&gt;fillableFromArray($attributes) as $key =&gt; $value) &#123; $key = $this-&gt;removeTableFromKey($key); if ($this-&gt;isFillable($key)) &#123; $this-&gt;setAttribute($key, $value); &#125; elseif ($totallyGuarded) &#123; throw new MassAssignmentException($key); &#125; &#125; return $this;&#125; fillattributesfillableguardedfillableguarded  12345678910111213protected function fillableFromArray(array $attributes)&#123; if (count($this-&gt;getFillable()) &gt; 0 &amp;&amp; ! static::$unguarded) &#123; return array_intersect_key($attributes, array_flip($this-&gt;getFillable())); &#125; return $attributes;&#125;public function getFillable()&#123; return $this-&gt;fillable;&#125; fillable LaravelmorphfillattributesremoveTableFromKey 1234protected function removeTableFromKey($key)&#123; return Str::contains($key, '.') ? last(explode('.', $key)) : $key;&#125; fillable 1234567891011121314151617public function isFillable($key)&#123; if (static::$unguarded) &#123; return true; &#125; if (in_array($key, $this-&gt;getFillable())) &#123; return true; &#125; if ($this-&gt;isGuarded($key)) &#123; return false; &#125; return empty($this-&gt;getFillable()) &amp;&amp; ! Str::startsWith($key, '_');&#125; unguardedtruefillabletrueguardedfalsefillabletrue forceFillfillableguardedforceFill 123456789101112131415161718192021public function forceFill(array $attributes)&#123; return static::unguarded(function () use ($attributes) &#123; return $this-&gt;fill($attributes); &#125;);&#125;public static function unguarded(callable $callback)&#123; if (static::$unguarded) &#123; return $callback(); &#125; static::unguard(); try &#123; return $callback(); &#125; finally &#123; static::reguard(); &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[11 ]]></title>
    <url>%2F2020%2F06%2F03%2F%E7%AC%AC11%E7%AB%A0-%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%A6%82%E4%BD%95%E5%81%9A%2F</url>
    <content type="text"><![CDATA[  10  FacebookFacebookbinary search tree   Maggie MaggieDavid MaggieManning MaggieO(log n)O(n)O(log n) O(log n)  B B   hihi ABhithereACinverted index Better Explained MP3 JPGDNA Shazam  O(n log n)O(n)O(n)  1000500 105A10B150BA  MapReduceMapReduceApache Hadoop SQLMySQLHadoopMapReduce 10010 100 MapReducemapreduce  123&gt;&gt;&gt; arr1 = [1, 2, 3, 4, 5]&gt;&gt;&gt; arr2 = map(lambda x: 2 * x, arr1)[2, 4, 6, 8, 10] arr2[2, 4, 6, 8, 10]arr1 12&gt;&gt;&gt; arr1 = # A list of URLs&gt;&gt;&gt; arr2 = map(download_page, arr1) URLURLarr2URL1000URL 100 map 100MapReduce    123&gt;&gt;&gt; arr1 = [1, 2, 3, 4, 5]&gt;&gt;&gt; reduce(lambda x,y: x+y, arr1)15 1 + 2 + 3 + 4 + 5 = 15 MapReduceMapReduce HyperLogLogReddit Google bit.lyURLURL  Google adit.io adit.ioO(1) GoogleRedditbit.ly  Google  GoogleURLbit.ly HyperLogLogHyperLogLogGoogleAmazonGoogleGoogle HyperLogLog  SHA5   O(1)  secure hash algorithmSHASHA SHASHA SHA   SHA SHA4GBSHA SHAGmailGoogleSHAGoogle GoogleSHA  GmailSHA SHASHA-0SHA-1SHA-2SHA-3SHA-0SHA-1SHASHA-2SHA-3 bcrypt SHA   SimhashSimhash GoogleSimhash Simhash ScribdSimhash Simhash Diffie-HellmanDiffie-Hellman a1b24,15,7d,o,g 9,6,13,13,16 24,16,19,13,5a = 1b = 2 a = 2b = 3 Diffie-Hellman   Diffie-Hellman Diffie-HellmanRSADiffie-Hellman  2153221120  121.51500300501500   Simplex 10]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[10 K]]></title>
    <url>%2F2020%2F06%2F02%2F%E7%AC%AC10%E7%AB%A0-K%E6%9C%80%E8%BF%91%E9%82%BB%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[  K   K     Kk-nearest neighboursKNN KNN Netflix  Priyanka JustinJCJoeyLanceChrisPriyankaPriyanka JustinPriyanka    AB AB AB1 AB Netflix   PriyankaJustinMorpheus25  52 5 PriyankaJustin PriyankaJustinPriyankaMorpheus PriyankaMorpheus24PriyankaJustinMorpheus PriyankaJustinPriyanka NetflixNetflixNetflix  1NetflixYogiPinkyYogi5Pinky5 2NetflixQuentin TarantinoWes AndersonNetflix Priyanka5 5521010 000K5 PriyankaPitch PerfectJustinJCJoeyLanceChris 4.2regressionKNN    1515 10 10  KNNK44 ABDE 218.75  cosine similarityManmohan DesaiAmar Akbar AnthonyPaul5Rowan4 KNN  23KNN   The WireHouse HuntersHouse HuntersNetflix    3Netflix5 KNN OCROCRoptical character recognitionGoogleOCROCR KNN (1)  (2)  OCR  OCRKNNFacebook OCRtraining Naive Bayes classifier collect your million dollars now!millionKNN   KNN KNN    KNN 10.1 normalizationPinky3Yogi3.5Pinky3.5 10.2 KNN3JoeDaveWes AndersonCaddyshack345 (3 + 4 + 5) / 3 = 4Wes Anderson(3 + 4 + 5 + 5 + 5) / 5 = 4.4 10.3 Nsqrt(N)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[9 ]]></title>
    <url>%2F2020%2F06%2F02%2F%E7%AC%AC9%E7%AB%A0-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%2F</url>
    <content type="text"><![CDATA[    84 3     3000 4  2000 3  1500 1   38416O(2n) 8       14  1.   111500   2  412  41500  2. 111500  111500 231500  415003000 43000 3. 3121500 3150020002000 430002000 31 1 11500 3500  3500   FAQ 20001iPhone  43500iPhone  iPhone11500iPhone2000iPhone iPhone iPhone 3500iPhone3 32000iPhone20004000      1.MP311000     0.510003.53.512343.5              34.5 133.514.5 11.5    3.5100 0.5  2.6 310 13 29 25 16         dictionary.com Alexfishhish  Alexhishfishvista     hishfishhishvista  hishfishhisfis  hishfishish Feynman algorithm (1) (2) (3)     (3,3)2 (3, 4)0     1234if word_a[i] == word_b[j]: #  cell[i][j] = cell[i-1][j-1] + 1else: #  cell[i][j] = 0 hishvista  hishhishfishhishvista Alexfish Alexfoshfishfort  foshfish  fishfosh     1234if word_a[i] == word_b[j]: #  cell[i][j] = cell[i-1][j-1] + 1else: #  cell[i][j] = max(cell[i-1][j], cell[i][j-1])  DNA git diff levenshtein distance Microsoft Word  3.blueclues        9.1 MP3iPhone4500 9.2  9.3]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[8 ]]></title>
    <url>%2F2020%2F06%2F02%2F%E7%AC%AC8%E7%AB%A0-%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[  /NP  NP NP NP      (1)  (2)  10:00 a.m. 10:00 a.m.     3510.45   (1)  (2)   35 30003500    1. 2.7  50  50 (1) power set2n (2) 50 2nO(2n)51010    (1)  (2)  approximation algorithm   O(n2)n  1.   1states_needed = set(["mt", "wa", "or", "id", "nv", "ut", "ca", "az"]) #  1&gt;&gt;&gt; arr = [1, 2, 2, 3, 3, 3]  12&gt;&gt;&gt; set(arr)set([1, 2, 3]) 123  123456stations = &#123;&#125;stations["kone"] = set(["id", "nv", "ut"])stations["ktwo"] = set(["wa", "id", "mt"])stations["kthree"] = set(["or", "nv", "ca"])stations["kfour"] = set(["nv", "ut"])stations["kfive"] = set(["ca", "az"]) kone  1final_stations = set() 2.  best_station 123best_station = Nonestates_covered = set()for station, states_for_station in stations.items(): states_coveredforfor 1234covered = states_needed &amp; states_for_stationif len(covered) &gt; len(states_covered): #  best_station = station states_covered = covered  1covered = states_needed &amp; states_for_station  3.         123456789&gt;&gt;&gt; fruits = set(["avocado", "tomato", "banana"])&gt;&gt;&gt; vegetables = set(["beets", "carrots", "tomato"])&gt;&gt;&gt; fruits | vegetables # set(["avocado", "beets", "carrots", "tomato", "banana"])&gt;&gt;&gt; fruits &amp; vegetables # set(["tomato"])&gt;&gt;&gt; fruits  vegetables # set(["avocado", "banana"])&gt;&gt;&gt; vegetables  fruits #     4.   1covered = states_needed &amp; states_for_station covered states_neededstates_for_stationbest_station 123if len(covered) &gt; len(states_covered): best_station = station states_covered = covered best_stationforbest_station 1final_stations.add(best_station) states_needed 1states_needed -= states_covered states_needed 12345678910111213while states_needed: best_station = None states_covered = set() for station, states in stations.items(): covered = states_needed &amp; states if len(covered) &gt; len(states_covered): best_station = station states_covered = coveredstates_needed -= states_coveredfinal_stations.add(best_station) final_stations 12&gt;&gt;&gt; print final_stationsset(['ktwo', 'kthree', 'kone', 'kfive']) 23451235   3. 4. 5. NP 15 5 5    4 50   13   6 36 24  6364336 6 464  6 = 24  672075040840 320 factorial function35! = 1201010! = 3 628 80010300 /NP    71 NP NPJonah JonahJonah Jonah (1)  (2)  NPNPNPNPAB NPNP  NP NP NP NP NP  6.2020NP 7.NP 8.NP   NP NP  8.1  8.2  8.3 8.4 8.5 8.6 8.7 8.8 ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[7 ]]></title>
    <url>%2F2020%2F06%2F01%2F%E7%AC%AC7%E7%AB%A0-%E7%8B%84%E5%85%8B%E6%96%AF%E7%89%B9%E6%8B%89%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[   X  AB  Dijkstras algorithm    74 (1)  (2)  (3)  (4)  AB A6B2 B2 B AA6 BA5 B A65 7  BBA A 6  B2 A5 6  3  4 (1)  (2)  (3)  (4)   weight weighted graphunweighted graph      8 6  directed acyclic graphDAG Rama AlexDestroyer5Rick AstleyAmy BeethovenAmy Rama 3015Rama    RamaRama 2622     5     RamaRama35 35 Rama   Rama Rama Rama Alex AlexSarahSarah7AlexRamaSarah7 Rama7Rama Rama2Rama 2Rama  35    3533Bellman-Ford algorithm   costsparents6 1graph = &#123;&#125;  1graph["you"] = ["alice", "bob", "claire"] AB  123graph["start"] = &#123;&#125;graph["start"]["a"] = 6graph["start"]["b"] = 2  graph[start]  12&gt;&gt;&gt; print graph["start"].keys()["a", "b"] AB 1234&gt;&gt;&gt; print graph["start"]["a"]2&gt;&gt;&gt; print graph["start"]["b"]6  123456graph["a"] = &#123;&#125;graph["a"]["fin"] = 1graph["b"] = &#123;&#125;graph["b"]["a"] = 3graph["b"]["fin"] = 5graph["fin"] = &#123;&#125; #    B2A6Python 1infinity = float("inf")  12345infinity = float("inf")costs = &#123;&#125;costs["a"] = 6costs["b"] = 2costs["fin"] = infinity   1234parents = &#123;&#125;parents["a"] = "start"parents["b"] = "start"parents["fin"] = None  1processed = []   123456789101112node = find_lowest_cost_node(costs) # while node is not None: # while cost = costs[node] neighbors = graph[node] for n in neighbors.keys(): #  new_cost = cost + neighbors[n] if costs[n] &gt; new_cost: #  costs[n] = new_cost #  parents[n] = node #  processed.append(node) #  node = find_lowest_cost_node(costs) #  Pythonfind_lowest_cost_node    BAA  AA BAB for B 77  BB  A A 7A A  find_lowest_cost_node 12345678910def find_lowest_cost_node(costs): lowest_cost = float("inf") lowest_cost_node = None for node in costs: #  cost = costs[node] if cost &lt; lowest_cost and node not in processed: #  lowest_cost = cost #  lowest_cost_node = node return lowest_cost_node  1.      7.1 A8B60C]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[6 ]]></title>
    <url>%2F2020%2F06%2F01%2F%E7%AC%AC6%E7%AB%A0-%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2%2F</url>
    <content type="text"><![CDATA[   X   XYbreadth-first searchBFS  AI READEDREADER         shorterst-path problem  (1)  (2)   AlexRama   AlexRamaTomAditnodeedge RamaAlexAditAlexAditRamaTom  1 AB AB  Facebook     Alice  AB AB  ClaireAnujClaireAnujClaireAnuj  AB ClaireAnujClaireAnujClaireAnujAnujClaireAnujClairequeue   First In First OutFIFOLast In First OutLIFO    1. 2.cabbat  Bob  Python 12graph = &#123;&#125;graph["you"] = ["alice", "bob", "claire"] graph[you] Python Python 123456789graph = &#123;&#125;graph["you"] = ["alice", "bob", "claire"]graph["bob"] = ["anuj", "peggy"]graph["alice"] = ["peggy"]graph["claire"] = ["thom", "jonny"]graph["anuj"] = []graph["peggy"] = []graph["thom"] = []graph["jonny"] = []    12graph["claire"] = ["thom", "jonny"]graph["anuj"] = []  12graph["anuj"] = []graph["claire"] = ["thom", "jonny"]     AnujPeggyThomJonnydirected graphAnujBobBobAnujundirected graph     Pythondeque 1234from collections import dequesearch_queue = deque() # search_queue += graph["you"] #  graph[you][alice,bob,claire]   123456789while search_queue: # person = search_queue.popleft() #  if person_is_seller(person): #  print person + " is a mango seller!" #  return True else: search_queue += graph[person] # return False #   person_is_seller  12def person_is_seller(name): return name[-1] == 'm' m    PeggyAliceBobAliceBobPeggy Peggy   Peggy  Peggy   1234567891011121314151617def search(name): search_queue = deque() search_queue += graph[name] searched = [] #  while search_queue: person = search_queue.popleft() if not person in searched: #  if person_is_seller(person): print person + " is a mango seller!" return True else: search_queue += graph[person] searched.append(person) #  return Falsesearch("you") person_is_seller  O() O(1)O()O( + )O(V + E)VverticeE     (1) (2) (3) (4)   (1) (2) (3) (4)  1. 2. ABAB    3.  AB   ramaaditramaadit ross - rachelrossrachelrachelross FIFO LIFO   6.1 2 6.2 2 6.3 ABC 6.4 1234567 6.5 ABCC]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[5 ]]></title>
    <url>%2F2020%2F06%2F01%2F%E7%AC%AC5%E7%AB%A0-%E6%95%A3%E5%88%97%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[    apple1O(n)O(log n) O(n)O(log n)10  MaggieO(1)   O(log n)O(1)Maggie   apple4apple4 1 Maggie  apple 33 milkmilk 00  avocadoavocado 4  avocado avocado4milk0 5100 Maggiehash table 2 Pythondict 1&gt;&gt;&gt; book = dict() #  book 12345&gt;&gt;&gt; book["apple"] = 0.67 &gt;&gt;&gt; book["milk"] = 1.49&gt;&gt;&gt; book["avocado"] = 1.49&gt;&gt;&gt; print book&#123;'avocado': 1.49, 'apple': 0.67, 'milk': 1.49&#125;  12&gt;&gt;&gt; print book["avocado"]1.49 book     1.f(x) = 1 &lt;-1 2.f(x) = rand() &lt;- 3.f(x) = next_empty_slot() &lt;- 4.f(x) = len(x) &lt;-          1&gt;&gt;&gt; phone_book = dict() Python 1&gt;&gt;&gt; phone_book = &#123;&#125; # phone_book = dict()  12&gt;&gt;&gt; phone_book["jenny"] = 8675309&gt;&gt;&gt; phone_book["emergency"] = 911 Jenny 12&gt;&gt;&gt; print phone_book["jenny"]8675309 # Jenny  http://adit.ioadit.ioIP IP IPDNSDNS resolution     1&gt;&gt;&gt; voted = &#123;&#125;  1&gt;&gt;&gt; value = voted.get("tom") tomgetNone  12345678voted = &#123;&#125;def check_voter(name): if voted.get(name): print "kick them out!" else: voted[name] = True print "let them vote!"  123456&gt;&gt;&gt; check_voter("tom")let them vote!&gt;&gt;&gt; check_voter("mike")let them vote!&gt;&gt;&gt; check_voter("mike")kick them out! Tomlet them vote!Mikelet them vote!Mikekick them out!  facebook.com (1) Facebook (2)  (3)  FacebookFacebookFacebookFacebookFacebookFacebook Google238 900Google Facebookfacebook.comFacebook  Google Facebook  FacebookAboutContactTerms and ConditionsURL Facebook  123456789cache = &#123;&#125;def get_page(url): if cache.get(url): return cache[url] #  else: data = get_data_from_server(url) cache[url] = data #  return data URLURL    /   26     collision appleavocadoappleA       O(1)O(1)   10 O(n)        2/50.4  1/3 100100 15021resizing   hash  3/80.7 O(1)   SHA    A. 1 B.  C. a D. a = 2b = 3c = 5d = 7e = 1110 bag (3 + 2 + 17) % 10 = 22 % 10 = 2 10 5.EstherBenBobDan 6.AAAAAAAAAA 6.MausFun HomeWatchmen Python       0.7 Web  5.1 5.2 5.3 5.4 5.5 CD5.6 BD5.7 BCD]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[4 ]]></title>
    <url>%2F2020%2F05%2F31%2F%E7%AC%AC4%E7%AB%A0-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[    divide and conquerD&amp;C D&amp;C D&amp;C2 D&amp;CD&amp;C   D&amp;CD&amp;CD&amp;C (1)  (2)  D&amp;C  25m50m25m25m D&amp;CD&amp;C 640m640m 1680m640m640m400m1680m640m640m400m   640m400m400m400m 400m240m 240m160m  16080 80m80m D&amp;C (1)  (2)  D&amp;C   1234567def sum(arr): total = 0 for x in arr: total += x return totalprint sum([1, 2, 3, 4])      12sum sum       HaskellHaskellsum 12sum [] = 0 # sum (x:xs) = x + (sum xs) #  Haskellif 123sum arr = if arr == [] then 0 else (head arr) + (sum (tail arr)) HaskellHaskell  1.sum 2. 3. 4.1 CqsortD&amp;C   123def quicksort(array): if len(array) &lt; 2: return array   D&amp;Cpivot   partitioning      +  +[10, 15] + [33] + [][10, 15, 33]  12quicksort([15, 10]) + [33] + quicksort([])&gt; [10, 15, 33] #  15  (1)  (2)  (3)   33    0404 3 5    D&C  123456789101112def quicksort(array): if len(array) &lt; 2: return array #  else: pivot = array[0] #  less = [i for i in array[1:] if i &lt;= pivot] #  greater = [i for i in array[1:] if i &gt; pivot] #  return quicksort(less) + [pivot] + quicksort(greater)print quicksort([10, 5, 2, 3]) OO 1010 2O(n2) merge sortO(n log n)O(n2) O(n log n)  O(n log n)O(n log n)  123def print_items(list): for item in list: print item O(n)1 123456from time import sleepdef print_items2(list): for item in list: sleep(1) print item 15 O(n)print_items1Oprint_itemsOO(n)n cprint_items10*nprint_items21*n O 10140  O(n log n)     O(n)O(log n) 8O(n)8O(n) O(n) O(n) O(log n)O(log n)O(n)O(n) * O(log n) = O(n log n) O(n)O(n) * O(n) = O(n2) O(n log n)D&amp;C  5.O 6. 7.2 8.2 9.[2, 3, 7, 8, 10]237  D&amp;CD&amp;C O(n log n) O O(log n)O(n) 4.1 1234def sum(list): if list == []: return 0 return list[0] + sum(list[1:]) 4.2 1234def count(list): if list == []: return 0 return 1 + count(list[1:]) 4.3 12345def max(list): if len(list) == 2: return list[0] if list[0] &gt; list[1] else list[1] sub_max = max(list[1:]) return list[0] if list[0] &gt; sub_max else sub_max 4.4   4.5 O(n)4.6 O(n)4.7 O(1)4.8 O(n2)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[3 ]]></title>
    <url>%2F2020%2F05%2F31%2F%E7%AC%AC3%E7%AB%A0-%E9%80%92%E5%BD%92%2F</url>
    <content type="text"><![CDATA[    4   (1)  (2)  (3)  (4)  (5)   (1)  (2)  (3)  while 123456789def look_for_key(main_box): pile = main_box.make_a_pile_to_look_through() while pile is not empty: box = pile.grab_a_box() for item in box: if item.is_a_box(): pile.append(item) elif item.is_a_key(): print "found the key!"  123456def look_for_key(box): for item in box: if item.is_a_box(): look_for_key(item) #  elif item.is_a_key(): print "found the key!" Stack Overflow  1&gt; 3...2...1  123def countdown(i): print i countdown(i-1) Ctrl+C 1&gt; 3...2...1...0...-1...-2... base caserecursive case  countdown  123456def countdown(i): print i if i &lt;= 0: #  return else: #  countdown(i-1)  call stack      12345def greet(name): print "hello, " + name + "!" greet2(name) print "getting ready to say bye..." bye()  12345def greet2(name): print "how are you, " + name + "?"def bye(): print "ok bye!"    Pythonprint greet(maggie) namemaggie hello,maggie!greet2(maggie) how are you, maggie? greetgreetgreet2greetgreet2greetgetting ready to say byebye byeok bye! greetgreet  1.  factorialfactorial(5)5!5! = 5 * 4 * 3 * 2 * 1 factorial(3) 3 * 2 * 1 12345def fact(x): if x == 1: return 1 else: return x * fact(x-1) fact(3) factxx           2.       3.1  greetnamemaggie greetgreet2 namemaggie greet greet2 greet 3.2 ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2 ]]></title>
    <url>%2F2020%2F05%2F31%2F%E7%AC%AC2%E7%AB%A0-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[     1   fe0ffeeb     4 31010  10     123123847 10 00010 000  NextNewmanNextGustavo Fring10Next #1#2#2#3 00#5 04 01201 10000 201201  O(n)  1.          O(1)O(1)O(n)   2.  3.FacebookFacebookFacebookFacebook 4.Facebook 5.FacebookFacebook26AB Adit BFacebookAdit BZakhir H26zZakhir H O O      O(n) O(n)O(n)n O(nn)O(n2)      O(n2)O4 nnn-1, n-2, , 211/2nO(n 1/2n)O1/24O(nn)O(n2) O(n log n)   123456789def findSmallest(arr): smallest = arr[0] #  smallest_index = 0 #  for i in range(1, len(arr)): if arr[i] &lt; smallest: smallest = arr[i] smallest_index = i return smallest_index  12345678def selectionSort(arr): #  newArr = [] for i in range(len(arr)): smallest = findSmallest(arr) #  newArr.append(arr.pop(smallest))return newArrprint selectionSort([5, 3, 6, 2, 10])        intdouble 2.1  2.2  2.3  2.4 Adit BFacebook 2.5  FacebookB]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Kernel]]></title>
    <url>%2F2020%2F05%2F28%2FLaravel-Kernel%2F</url>
    <content type="text"><![CDATA[  \Illuminate\Contracts\Http\Kernel.php 1234567891011121314151617181920212223242526272829303132333435namespace Illuminate\Contracts\Http;interface Kernel&#123; /** * Bootstrap the application for HTTP requests. * * @return void */ public function bootstrap(); /** * Handle an incoming HTTP request. * * @param \Symfony\Component\HttpFoundation\Request $request * @return \Symfony\Component\HttpFoundation\Response */ public function handle($request); /** *  * * @param \Symfony\Component\HttpFoundation\Request $request * @param \Symfony\Component\HttpFoundation\Response $response * @return void */ public function terminate($request, $response); /** * Get the Laravel application instance. * * @return \Illuminate\Contracts\Foundation\Application */ public function getApplication();&#125; KernelFoundation  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051namespace Illuminate\Foundation\Http;use Illuminate\Contracts\Debug\ExceptionHandler;use Illuminate\Contracts\Foundation\Application;use Illuminate\Contracts\Http\Kernel as KernelContract;use Illuminate\Foundation\Http\Events\RequestHandled;use Illuminate\Routing\Pipeline;use Illuminate\Routing\Router;use Illuminate\Support\Facades\Facade;use InvalidArgumentException;use Throwable;class Kernel implements KernelContract&#123; protected $app; protected $route; protected $bootstrappers = [ \Illuminate\Foundation\Bootstrap\LoadEnvironmentVariables::class, \Illuminate\Foundation\Bootstrap\LoadConfiguration::class, \Illuminate\Foundation\Bootstrap\HandleExceptions::class, \Illuminate\Foundation\Bootstrap\RegisterFacades::class, \Illuminate\Foundation\Bootstrap\RegisterProviders::class, \Illuminate\Foundation\Bootstrap\BootProviders::class, ]; protected $middleware = []; protected $middlewareGroups = []; protected $routeMiddleware = []; protected $middlewarePriority = [ \Illuminate\Session\Middleware\StartSession::class, \Illuminate\View\Middleware\ShareErrorsFromSession::class, \Illuminate\Contracts\Auth\Middleware\AuthenticatesRequests::class, \Illuminate\Routing\Middleware\ThrottleRequests::class, \Illuminate\Session\Middleware\AuthenticateSession::class, \Illuminate\Routing\Middleware\SubstituteBindings::class, \Illuminate\Auth\Middleware\Authorize::class, ]; public function __construct(Application $app, Router $router) &#123; $this-&gt;app = $app; $this-&gt;router = $router; $this-&gt;syncMiddlewareToRouter(); &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Database-Eloquent Model]]></title>
    <url>%2F2020%2F05%2F28%2FLaravel-Database-Eloquent-Model%E6%A8%A1%E5%9E%8B%E5%85%B3%E7%B3%BB%E5%8A%A0%E8%BD%BD%E4%B8%8E%E6%9F%A5%E8%AF%A2%2F</url>
    <content type="text"><![CDATA[ Laravelwhere  12345678910class User extends Model&#123; /** *  */ public function phone() &#123; $this-&gt;hasOne('App\Phone', 'user_id', 'id'); &#125;&#125;  123456$user = App\User::find(1);foreach ($user-&gt;posts as $post) &#123; //&#125;  12345678910public function getAttribute($key)&#123; if (! $key) &#123; return; &#125; ... return $this-&gt;getRelationValue($key);&#125; getRelationValue 123456789101112131415161718192021222324252627282930313233/** * Get a relationship. * * @param string $key * @return mixed */public function getRelationValue($key)&#123; // If the key already exists in the relationships array, it just means the // relationship has already been loaded, so we'll just return it out of // here because there is no need to query within the relations twice. if ($this-&gt;relationLoaded($key)) &#123; return $this-&gt;relations[$key]; &#125; // If the "attribute" exists as a method on the model, we will just assume // it is a relationship and will load and return results from the query // and hydrate the relationship's value on the "relationships" array. if (method_exists($this, $key)) &#123; return $this-&gt;getRelationshipFromMethod($key); &#125;&#125;/** * Determine if the given relation is loaded. * * @param string $key * @return bool */public function relationLoaded($key)&#123; return array_key_exists($key, $this-&gt;relations);&#125; Laravel 12345678910111213141516171819202122232425262728/** * Get a relationship value from a method. * * @param string $method * @return mixed * * @throws \LogicException */protected function getRelationshipFromMethod($method)&#123; $relation = $this-&gt;$method(); if (! $relation instanceof Relation) &#123; if (is_null($relation)) &#123; throw new LogicException(sprintf( '%s::%s must return a relationship instance, but "null" was returned. Was the "return" keyword used?', static::class, $method )); &#125; throw new LogicException(sprintf( '%s::%s must return a relationship instance.', static::class, $method )); &#125; return tap($relation-&gt;getResults(), function ($results) use ($method) &#123; $this-&gt;setRelation($method, $results); &#125;);&#125; $user-&gt;postsLaravelpostshasOnegetResults 12345678910111213/** * Get the results of the relationship. * * @return mixed */public function getResults()&#123; if (is_null($this-&gt;getParentKey())) &#123; return $this-&gt;getDefaultFor($this-&gt;parent); &#125; return $this-&gt;query-&gt;first() ?: $this-&gt;getDefaultFor($this-&gt;parent);&#125; getDefaultFor 12345678910111213141516public function user()&#123; return $this-&gt;belongsTo('App\User')-&gt;withDefault();&#125;public function user()&#123; return $this-&gt;belongsTo('App\User')-&gt;withDefault(['name' =&gt; '',]);&#125;public function user()&#123; return $this-&gt;belongsTo('App\User')-&gt;withDefault(function ($user) &#123; $user-&gt;name = ''; &#125;);&#125; withDefaultgetDefaultFor 12345678910111213141516171819202122232425262728293031323334353637/** * Return a new model instance in case the relationship does not exist. * * @param \Closure|array|bool $callback * @return $this */public function withDefault($callback = true)&#123; $this-&gt;withDefault = $callback; return $this;&#125;/** * Get the default value for this relation. * * @param \Illuminate\Database\Eloquent\Model $parent * @return \Illuminate\Database\Eloquent\Model|null */protected function getDefaultFor(Model $parent)&#123; if (! $this-&gt;withDefault) &#123; return; &#125; $instance = $this-&gt;newRelatedInstanceFor($parent); if (is_callable($this-&gt;withDefault)) &#123; return call_user_func($this-&gt;withDefault, $instance, $parent) ?: $instance; &#125; if (is_array($this-&gt;withDefault)) &#123; $instance-&gt;forceFill($this-&gt;withDefault); &#125; return $instance;&#125;  12345678910111213/** * Set the given relationship on the model. * * @param string $relation * @param mixed $value * @return $this */public function setRelation($relation, $value)&#123; $this-&gt;relations[$relation] = $value; return $this;&#125; related 123456789101112131415161718192021222324252627282930313233343536373839404142/** * Get the results of the relationship. * * @return mixed */public function getResults()&#123; return ! is_null($this-&gt;parent-&gt;&#123;$this-&gt;parentKey&#125;) ? $this-&gt;get() : $this-&gt;related-&gt;newCollection();&#125;/** * Execute the query as a "select" statement. * * @param array $columns * @return \Illuminate\Database\Eloquent\Collection */public function get($columns = ['*'])&#123; // First we'll add the proper select columns onto the query so it is run with // the proper columns. Then, we will get the results and hydrate out pivot // models with the result of those columns as a separate model relation. $builder = $this-&gt;query-&gt;applyScopes(); $columns = $builder-&gt;getQuery()-&gt;columns ? [] : $columns; $models = $builder-&gt;addSelect( $this-&gt;shouldSelect($columns) )-&gt;getModels(); $this-&gt;hydratePivotRelation($models); // If we actually found models we will also eager load any relationships that // have been specified as needing to be eager loaded. This will solve the // n + 1 query problem for the developer and also increase performance. if (count($models) &gt; 0) &#123; $models = $builder-&gt;eagerLoadRelations($models); &#125; return $this-&gt;related-&gt;newCollection($models);&#125; shouldSelect 123456789101112131415161718192021222324252627282930/** * Set the select clause for the relation query. * * @param array $columns * @return array */protected function shouldSelect(array $columns = ['*'])&#123; if ($columns == ['*']) &#123; $columns = [$this-&gt;related-&gt;getTable().'.*']; &#125; return array_merge($columns, [$this-&gt;getQualifiedFirstKeyName().' as laravel_through_key']);&#125;/** * Get the pivot columns for the relation. * * "pivot_" is prefixed ot each column for easy removal later. * * @return array */protected function aliasedPivotColumns()&#123; $defaults = [$this-&gt;foreignPivotKey, $this-&gt;relatedPivotKey]; return collect(array_merge($defaults, $this-&gt;pivotColumns))-&gt;map(function ($column) &#123; return $this-&gt;table.'.'.$column.' as pivot_'.$column; &#125;)-&gt;unique()-&gt;all();&#125; relatedpivot_ hydratePivotRelation 1234567891011121314151617181920212223242526272829303132333435363738394041/** * Hydrate the pivot table relationship on the models. * * @param array $models * @return void */protected function hydratePivotRelation(array $models)&#123; // To hydrate the pivot relationship, we will just gather the pivot attributes // and create a new Pivot model, which is basically a dynamic model that we // will set the attributes, table, and connections on it so it will work. foreach ($models as $model) &#123; $model-&gt;setRelation($this-&gt;accessor, $this-&gt;newExistingPivot( $this-&gt;migratePivotAttributes($model) )); &#125;&#125;/** * Get the pivot attributes from a model. * * @param \Illuminate\Database\Eloquent\Model $model * @return array */protected function migratePivotAttributes(Model $model)&#123; $values = []; foreach ($model-&gt;getAttributes() as $key =&gt; $value) &#123; // To get the pivots attributes we will just take any of the attributes which // begin with "pivot_" and add those to this arrays, as well as unsetting // them from the parent's models since they exist in a different table. if (strpos($key, 'pivot_') === 0) &#123; $values[substr($key, 6)] = $value; unset($model-&gt;$key); &#125; &#125; return $values;&#125; accessorpivotas 1return $this-&gt;belongsToMany('App\Role')-&gt;as(role_user);  123456789101112/** * Specify the custom pivot accessor to use for the relationship. * * @param string $accessor * @return $this */public function as($accessor)&#123; $this-&gt;accessor = $accessor; return $this;&#125; withEloquentEloquentN + 1 select 1234567$books = App\Book::with(['author:id,name'])-&gt;get();$books = App\Book::with(['author', 'publisher'])-&gt;get();$books = App\Book::with('author.contacts')-&gt;get();$users = App\User::with(['posts' =&gt; function ($query) &#123; $query-&gt;where('title', 'like', '%first%');&#125;])-&gt;get(); with 123456789101112/** * Begin querying a model with eager loading. * * @param array|string $relations * @return \Illuminate\Database\Eloquent\Builder */public static function with($relations)&#123; return static::query()-&gt;with( is_string($relations) ? func_get_args() : $relations );&#125; Eloquent/builderwith 1234567891011121314/** * Set the relationships that should be eager loaded. * * @param mixed $relations * @return $this */public function with($relations)&#123; $eagerLoad = $this-&gt;parseWithRelations(is_string($relations) ? func_get_args() : $relations); $this-&gt;eagerLoad = array_merge($this-&gt;eagerLoad, $eagerLoad); return $this;&#125; eagerLoadparseWithRelations 12345678910111213141516171819202122232425262728293031323334/** * Parse a list of relations into individuals. * * @param array $relations * @return array */protected function parseWithRelations(array $relations)&#123; $results = []; foreach ($relations as $name =&gt; $constraints) &#123; // If the "name" value is a numeric key, we can assume that no constraints // have been specified. We will just put an empty Closure there so that // we can treat these all the same while we are looping through them. if (is_numeric($name)) &#123; $name = $constraints; [$name, $constraints] = Str::contains($name, ':') ? $this-&gt;createSelectWithConstraint($name) : [$name, static function () &#123; // &#125;]; &#125; // We need to separate out any nested includes, which allows the developers // to load deep relationships using "dots" without stating each level of // the relationship with its own key in the array of eager-load names. $results = $this-&gt;addNestedWiths($name, $results); $results[$name] = $constraints; &#125; return $results;&#125; :select *createSelectWithConstraint 123456789101112/** * Create a constraint to select the given columns for the relation. * * @param string $name * @return array */protected function createSelectWithConstraint($name)&#123; return [explode(':', $name)[0], static function ($query) use ($name) &#123; $query-&gt;select(explode(',', explode(':', $name)[1])); &#125;];&#125; select .addNestedWiths 1234567891011121314151617181920212223242526/** * Parse the nested relationships in a relation. * * @param string $name * @param array $results * @return array */protected function addNestedWiths($name, $results)&#123; $progress = []; // If the relation has already been set on the result array, we will not set it // again, since that would override any constraints that were already placed // on the relationships. We will only set the ones that are not specified. foreach (explode('.', $name) as $segment) &#123; $progress[] = $segment; if (! isset($results[$last = implode('.', $progress)])) &#123; $results[$last] = static function () &#123; // &#125;; &#125; &#125; return $results;&#125; addNestedWithsa.b.caddNestedWithsresults:aa.ba.b.c parseWithRelationsa.b.ca.b.c getwithLaravelget 12345678public function get($columns = ['*'])&#123;$builder = $this-&gt;applyScopes();if (count($models = $builder-&gt;getModels($columns)) &gt; 0) &#123;$models = $builder-&gt;eagerLoadRelations($models);&#125;return $builder-&gt;getModel()-&gt;newCollection($models);&#125; eagerLoadRelations 12345678910111213141516public function eagerLoadRelations(array $models)&#123;foreach ($this-&gt;eagerLoad as $name =&gt; $constraints) &#123;// For nested eager loads we'll skip loading them here and they will be set as an// eager load on the query to retrieve the relation so that they will be eager// loaded on that query, because that is where they gethydrated as models.if (strpos($name, '.') === false) &#123;$models = $this-&gt;eagerLoadRelation($models, $name, $constraints);&#125;&#125;return $models;&#125; ifa.b.ceagerLoadRelations a  123// For nested eager loads we&apos;ll skip loading them here and they will be set asan eager load on the query to retrieve the relation so that they will be eagerloaded on that query, because that is where they get hydrated as models.  a  a  b  c  1234567891011protected function eagerLoadRelation(array $models, $name, Closure $constraints)&#123;$relation = $this-&gt;getRelation($name);$relation-&gt;addEagerConstraints($models);$constraints($relation);return $relation-&gt;match($relation-&gt;initRelation($models, $name),$relation-&gt;getEager(), $name);&#125; eagerLoadRelation  hasOne  relation models  with  getRelation getRelation 1234567891011121314151617public function getRelation($name)&#123;$relation = Relation::noConstraints(function () use ($name)&#123;try &#123;return $this-&gt;getModel()-&gt;&#123;$name&#125;();&#125; catch (BadMethodCallException $e) &#123;throw RelationNotFoundException::make($this-&gt;getModel(), $name);&#125;&#125;);$nested = $this-&gt;relationsNestedUnder($name);if (count($nested) &gt; 0) &#123;$relation-&gt;getQuery()-&gt;with($nested);&#125;return $relation;&#125;  hasOne select phone where phone.user_id = user.id noConstraints : 12345678910public static function noConstraints(Closure $callback)&#123;$previous = static::$constraints;static::$constraints = false;try &#123;return call_user_func($callback);&#125; finally &#123;static::$constraints = $previous;&#125;&#125; return $this-&gt;getModel()-&gt;{$name}(); relationsNestedUnder  12345678910111213141516protected function relationsNestedUnder($relation)&#123;$nested = [];foreach ($this-&gt;eagerLoad as $name =&gt; $constraints) &#123;if ($this-&gt;isNestedUnder($relation, $name)) &#123;$nested[substr($name, strlen($relation.'.'))] = $constraints;&#125;&#125;return $nested;&#125;protected function isNestedUnder($relation, $name)&#123;return Str::contains($name, '.') &amp;&amp; Str::startsWith($name, $relation.'.');&#125;  a  relationsNestedUnder a.b  a.b.c  nested  nested[b]nested[b.c]  123if (count($nested) &gt; 0) &#123;$relation-&gt;getQuery()-&gt;with($nested);&#125;  1234567public function addEagerConstraints(array $models)&#123;$this-&gt;query-&gt;whereIn($this-&gt;foreignKey, $this-&gt;getKeys($models, $this-&gt;localKey));&#125;  where with  with  $constraints($relation); 12345678$relation-&gt;match($relation-&gt;initRelation($models, $name),$relation-&gt;getEager(), $name);public function getEager()&#123;return $this-&gt;get();&#125; initRelation  12345678public function initRelation(array $models, $relation)&#123;foreach ($models as $model) &#123;$model-&gt;setRelation($relation, $this-&gt;getDefaultFor($model));&#125;return $models;&#125;  1234567891011121314151617181920212223242526public function match(array $models, Collection $results, $relation)&#123;return $this-&gt;matchOne($models, $results, $relation);&#125;public function matchOne(array $models, Collection $results, $relation)&#123;return $this-&gt;matchOneOrMany($models, $results, $relation, 'one');&#125;protected function matchOneOrMany(array $models, Collection $results, $relation, $type)&#123;$dictionary = $this-&gt;buildDictionary($results);foreach ($models as $model) &#123;if (isset($dictionary[$key = $model-&gt;getAttribute($this-&gt;localKey)])) &#123;$model-&gt;setRelation($relation, $this-&gt;getRelationValue($dictionary,$key, $type));&#125;&#125;return $models;&#125;  buildDictionary setRelation  123456789protected function buildDictionary(Collection $results)&#123;$dictionary = [];$foreign = $this-&gt;getForeignKeyName();foreach ($results as $result) &#123;$dictionary[$result-&gt;&#123;$foreign&#125;][] = $result;&#125;return $dictionary;&#125; buildDictionaryforeign 12345678910111213141516foreach ($models as $model) &#123;if (isset($dictionary[$key = $model-&gt;getAttribute($this-&gt;localKey)])) &#123;$model-&gt;setRelation($relation, $this-&gt;getRelationValue($dictionary, $key, $type));&#125;&#125;protected function getRelationValue(array $dictionary, $key, $type)&#123;$value = $dictionary[$key];return $type == 'one' ? reset($value) : $this-&gt;related-&gt;newCollection($value);&#125; dictionarysetRelation  12345678910// ...$posts = App\Post::has('comments')-&gt;get();// ...$posts = Post::has('comments', '&gt;=', 3)-&gt;get();// ...$posts = Post::has('comments.votes')-&gt;get();//  foo% $posts = Post::whereHas('comments', function ($query) &#123;$query-&gt;where('content', 'like', 'foo%');&#125;)-&gt;get(); has  12345678910111213141516171819202122public function has($relation, $operator = '&gt;=', $count = 1, $boolean = 'and', Closure $callback = null)&#123;if (strpos($relation, '.') !== false) &#123;return $this-&gt;hasNested($relation, $operator, $count, $boolean, $callback);&#125;$relation = $this-&gt;getRelationWithoutConstraints($relation);$method = $this-&gt;canUseExistsForExistenceCheck($operator, $count)? 'getRelationExistenceQuery': 'getRelationExistenceCountQuery';$hasQuery = $relation-&gt;&#123;$method&#125;($relation-&gt;getRelated()-&gt;newQuery(), $this);if ($callback) &#123;$hasQuery-&gt;callScope($callback);&#125;return $this-&gt;addHasWhere($hasQuery, $relation, $operator, $count, $boolean);&#125; has  existence has where 123456protected function getRelationWithoutConstraints($relation)&#123;return Relation::noConstraints(function () use ($relation) &#123;return $this-&gt;getModel()-&gt;&#123;$relation&#125;();&#125;);&#125; existence  existence select * from post where user.id = post.user_idLaravel  hash  1select * from user as wedfklk where user.id = wedfklk.foreignKey  12345678910111213141516171819202122232425262728293031323334public function getRelationExistenceQuery(Builder $query, Builder $parentQuery, $columns = ['*'])&#123;if ($query-&gt;getQuery()-&gt;from == $parentQuery-&gt;getQuery()-&gt;from) &#123;return $this-&gt;getRelationExistenceQueryForSelfRelation($query, $parentQuery, $columns);&#125;return parent::getRelationExistenceQuery($query, $parentQuery, $columns);&#125;public function getRelationExistenceQueryForSelfRelation(Builder$query, Builder $parentQuery, $columns = ['*'])&#123;$query-&gt;from($query-&gt;getModel()-&gt;getTable().' as '.$hash = $this-&gt;getRelationCountHash());$query-&gt;getModel()-&gt;setTable($hash);return $query-&gt;select($columns)-&gt;whereColumn($this-&gt;getQualifiedParentKeyName(), '=', $hash.'.'.$this-&gt;getForeignKeyName());&#125;public function getRelationExistenceQuery(Builder $query, Builder $parentQuery, $columns = ['*'])&#123;return $query-&gt;select($columns)-&gt;whereColumn($this-&gt;getQualifiedParentKeyName(), '=', $this-&gt;getExistenceCompareKey());&#125;public function getExistenceCompareKey()&#123;return $this-&gt;getQualifiedForeignKeyName();&#125; ExistenceCount ExistenceCount  select *  select count(*) :select count(*) from post where user.id = post.user_id 1234567public function getRelationExistenceCountQuery(Builder $query, Builder $parentQuery)&#123;return $this-&gt;getRelationExistenceQuery($query, $parentQuery, new Expression('count(*)'));&#125;  where    where  12345678910111213141516171819202122232425262728293031protected function addHasWhere(Builder $hasQuery, Relation $relation, $operator, $count, $boolean)&#123;$hasQuery-&gt;mergeConstraintsFrom($relation-&gt;getQuery());return $this-&gt;canUseExistsForExistenceCheck($operator, $count)? $this-&gt;addWhereExistsQuery($hasQuery-&gt;toBase(), $boolean, $operator === '&lt;' &amp;&amp; $count === 1): $this-&gt;addWhereCountQuery($hasQuery-&gt;toBase(), $operator, $count, $boolean);&#125;public function addWhereExistsQuery(Builder $query, $boolean = 'and', $not = false)&#123;$type = $not ? 'NotExists' : 'Exists';$this-&gt;wheres[] = compact('type', 'operator', 'query', 'boolean');$this-&gt;addBinding($query-&gt;getBindings(), 'where');return $this;&#125;protected function addWhereCountQuery(QueryBuilder $query, $operator = '&gt;=', $count = 1, $boolean = 'and')&#123;$this-&gt;query-&gt;addBinding($query-&gt;getBindings(), 'where');return $this-&gt;where(new Expression('('.$query-&gt;toSql().')'),$operator,is_numeric($count) ? new Expression($count) : $count,$boolean);&#125; existence  12select * from user where exists (select * from phone where phone.user_id=user.id) ExistenceCount : 12select * from user where (select count(*) from phone where phone.user_id=user.id) &gt;= 3 has 1234567891011121314151617181920protected function hasNested($relations, $operator = '&gt;=', $count = 1, $boolean = 'and', $callback = null)&#123;$relations = explode('.', $relations);$closure = function ($q) use (&amp;$closure, &amp;$relations, $operator, $count, $callback) &#123;count($relations) &gt; 1? $q-&gt;whereHas(array_shift($relations), $closure): $q-&gt;has(array_shift($relations), $operator, $count, 'and', $callback);&#125;;return $this-&gt;has(array_shift($relations), '&gt;=', 1, $boolean, $closure);&#125;public function whereHas($relation, Closure $callback = null, $operator = '&gt;=', $count = 1)&#123;return $this-&gt;has($relation, $operator, $count, 'and', $callback);&#125;  1$posts = Post::has('comments.votes')-&gt;get();  hasNested  12345$this-&gt;has('comments', '&gt;=', 1, 'and', function ($q) use (&amp;$closure, votes, '&gt;=', 1, $callback) &#123;$q-&gt;has(votes, '&gt;=', 1, 'and', $callback);&#125;); sql 1select * from post where exist (select * from comment where comment.post_id=post.id and where exist (select * from vote where vote.comment_id=comment.id))  123456789101112131415161718192021222324/** * Add a relationship count / exists condition to the query. * * @param string $relation * @param string $boolean * @param \Closure|null $callback * @return \Illuminate\Database\Eloquent\Builder|static */public function doesntHave($relation, $boolean = 'and', Closure $callback = null)&#123; return $this-&gt;has($relation, '&lt;', 1, $boolean, $callback);&#125;/** * Add a relationship count / exists condition to the query with where clauses. * * @param string $relation * @param \Closure|null $callback * @return \Illuminate\Database\Eloquent\Builder|static */public function whereDoesntHave($relation, Closure $callback = null)&#123; return $this-&gt;doesntHave($relation, 'and', $callback);&#125;   withCount  {}_count  1234567891011121314151617181920212223$posts = App\Post::withCount('comments')-&gt;get();//select *,(select count(*) from comment where comment.post_id=post.id) as comments_count from postforeach ($posts as $post) &#123; echo $post-&gt;comments_count;&#125;//$posts = Post::withCount(['votes', 'comments' =&gt; function ($query) &#123; $query-&gt;where('content', 'like', 'foo%');&#125;])-&gt;get();//select *,(select count(*) from comment where comment.post_id=post.id and content like 'foo%') as comments_count,(select count(*) from votes where vote.post_id=post.id) as votes_count from postecho $posts[0]-&gt;votes_count;echo $posts[0]-&gt;comments_count;//$posts = Post::withCount(['comments','comments as pending_comments_count' =&gt; function ($query) &#123; $query-&gt;where('approved', false);&#125;])-&gt;get();//select *,(select count(*) from comment where comment.post_id=post.id) as comments_count,(select count(*) from comment where comment.post_id=post.id and approved=false) as pending_comments_count from postecho $posts[0]-&gt;comments_count;echo $posts[0]-&gt;pending_comments_count; withCounthas 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263/** * Add subselect queries to count the relations. * * @param mixed $relations * @return $this */public function withCount($relations)&#123; if (empty($relations)) &#123; return $this; &#125; if (is_null($this-&gt;query-&gt;columns)) &#123; $this-&gt;query-&gt;select([$this-&gt;query-&gt;from.'.*']); &#125; $relations = is_array($relations) ? $relations : func_get_args(); foreach ($this-&gt;parseWithRelations($relations) as $name =&gt; $constraints) &#123; // First we will determine if the name has been aliased using an "as" clause on the name // and if it has we will extract the actual relationship name and the desired name of // the resulting column. This allows multiple counts on the same relationship name. $segments = explode(' ', $name); unset($alias); if (count($segments) === 3 &amp;&amp; Str::lower($segments[1]) === 'as') &#123; [$name, $alias] = [$segments[0], $segments[2]]; &#125; $relation = $this-&gt;getRelationWithoutConstraints($name); // Here we will get the relationship count query and prepare to add it to the main query // as a sub-select. First, we'll get the "has" query and use that to get the relation // count query. We will normalize the relation name then append _count as the name. $query = $relation-&gt;getRelationExistenceCountQuery( $relation-&gt;getRelated()-&gt;newQuery(), $this ); $query-&gt;callScope($constraints); $query = $query-&gt;mergeConstraintsFrom($relation-&gt;getQuery())-&gt;toBase(); $query-&gt;orders = null; $query-&gt;setBindings([], 'order'); if (count($query-&gt;columns) &gt; 1) &#123; $query-&gt;columns = [$query-&gt;columns[0]]; $query-&gt;bindings['select'] = []; &#125; // Finally we will add the proper result column alias to the query and run the subselect // statement against the query builder. Then we will return the builder instance back // to the developer for further constraint chaining that needs to take place on it. $column = $alias ?? Str::snake($name.'_count'); $this-&gt;selectSub($query, $column); &#125; return $this;&#125;   existenceCount with where alias select 12345678910111213141516171819202122232425262728293031323334return $this-&gt;belongsToMany('App\Role')-&gt;wherePivot('approved', 1);return $this-&gt;belongsToMany('App\Role')-&gt;wherePivotIn('priority', [1, 2]);/** * Set a where clause for a pivot table column. * * @param string $column * @param string|null $operator * @param mixed $value * @param string $boolean * @return $this */public function wherePivot($column, $operator = null, $value = null, $boolean = 'and')&#123; $this-&gt;pivotWheres[] = func_get_args(); return $this-&gt;where($this-&gt;table.'.'.$column, $operator, $value, $boolean);&#125;/** * Set a "where in" clause for a pivot table column. * * @param string $column * @param mixed $values * @param string $boolean * @param bool $not * @return $this */public function wherePivotIn($column, $values, $boolean = 'and', $not = false)&#123; $this-&gt;pivotWhereIns[] = func_get_args(); return $this-&gt;whereIn($this-&gt;table.'.'.$column, $values, $boolean, $not);&#125; pivotWherespivotWheres 12345678910111213141516171819/** * Create a new query builder for the pivot table. * * @return \Illuminate\Database\Query\Builder */public function newPivotQuery()&#123; $query = $this-&gt;newPivotStatement(); foreach ($this-&gt;pivotWheres as $arguments) &#123; call_user_func_array([$query, 'where'], $arguments); &#125; foreach ($this-&gt;pivotWhereIns as $arguments) &#123; call_user_func_array([$query, 'whereIn'], $arguments); &#125; return $query-&gt;where($this-&gt;foreignPivotKey, $this-&gt;parent-&gt;&#123;$this-&gt;parentKey&#125;);&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLB+]]></title>
    <url>%2F2020%2F05%2F28%2FMySQL%E7%9A%84B-%E6%A0%91%E7%B4%A2%E5%BC%95%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%81%E4%BD%BF%E7%94%A8%E3%80%81%E4%BC%98%E5%8C%96%E5%8F%8A%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%2F</url>
    <content type="text"><![CDATA[  SHOW INDEX SHOW INDEXtable_index 1SHOW INDEX FROM table_index\G;    Table  Non_unique 001 Key_name PRIMARY Seq_in_index 1 Collation ANULLB+A Sub_part 100100NULL Packed NULL Index_type InnoDBB+BTREE CardinalityCardinalityB+ Cardinality1 ANALYZE TABLE 1analyze table table_index; 0 InoDBCardinality InnoDBinsertupdate 1/16 InnoDBstat_modified_conter&gt;2000000000 InnoDB8 B+A B+8p1-p8 Cardinality(p1+p2+p3++p8)*A/8 Cardinality88 Fast Index CreationMySQL5.5 InnoDB1.0.xFast Index Creation S MySQL5.6insertupdatedeleteDM  123ALTER TABLE table_name ADD [UNIQUE|FULLLTEXT] INDEX index_name (column(length))[ALGORITHM = &#123;DEFAULT|INPLACE|COPY&#125;][LOCK = &#123;DEFAULT|NONE|SHARED|EXLUSIVE&#125;] ALGORITHM COPY INPLACE DEFAULT old_alter_table OFF, INPLACE LOCK NONE SHARES EXCLUSIVEX DEFAULTNONESHAREEXCLUSIVE B+  123456create table t_index(a char(2) not null default '',b char(2) not null default '',c char(2) not null default '',d char(2) not null default '')engine myisam charset utf8;  1alter table t_index add index abcd(a,b,c,d);  123456insert into t_index values('a','b','c','d'),('a2','b2','c2','d2'),('a3','b3','c3','d3'),('a4','b4','c4','d4'),('a5','b5','c5','d5'),('a6','b6','c6','d6');       1EXPLAIN SELECT * FROM t_index WHERE a = 'a' \G; akey_lenutf83 char(2)2*36 1EXPLAIN SELECT * FROM t_index WHERE b = 'b2' \G; possible_keys rows66 1EXPLAIN SELECT * FROM t_index WHERE a = 'a2' AND b = 'b2' ORDER BY d \G; key_len122abExtraUsing filesortabdadbdcdc 1EXPLAIN SELECT * FROM t_index WHERE a = 'a2' AND b = 'b2' ORDER BY c \G; cabcfilesort  Q1    Q2 (col1,col2,col3)(col1),(col1,col2),(col1,col2,col3) (col1,col2,col3)sql: select col1,col2,col3 from test where col1=1 and col2=2MySQLioioiodba 1000Wsql:select from table where col1=1 and col2=2 and col3=3,10%1000W10%=100w100wcol2=2 and col3= 31000w10% 10% *10%=1w IO 1explain select count(*) from t_index \G; myisamExtra Select tables optimized awaymyisam InnoDBExtra Using indexInnoDB MySQLINDEX HINT MySQLSQL SQLSQL t_index 123alter table t_index add index a (a);alter table t_index add index b (b);alter table t_index add index c (c);  1EXPLAIN SELECT * FROM t_index WHERE a = 'a' AND b = 'b' AND c = 'c' \G; a 1EXPLAIN SELECT * FROM t_index USE INDEX(a) WHERE a = 'a' AND b = 'b' AND c = 'c' \G; a FORCE INDEX 1EXPLAIN SELECT * FROM t_index FORCE INDEX(a) WHERE a = 'a' AND b = 'b' AND c = 'c' \G;  Multi-Range Read MySQL5.6rangerefeq_ref Multi-Range Read      optimizer_switchMulti-Range Read 1SET @@optimizer_switch='mrr=on,mrr_cost_based=off'; Index Condition PushdownICP MySQL5.6whereICPMySQLwherewhereSQL ICPrangerefeq_refref_or_nullMyISAMInnoDB ICP 1set @@optimizer_switch = "index_condition_pushdown=on"  1set @@optimizer_switch = "index_condition_pushdown=off" ICPExtra Using index condition                       col1 + col2 + col3  col1(col1 + col2)col1 + col2 + col3 col2col2col3 MySQL  B-Tree    select *     column_name is null  1explain select * from t_index where a is null \G order bygroup bydistinct union    %likeB-Treekeynull where age+10=30    leftmost MySQL oror not not in not like &lt;&gt; ,!= ,!&gt; ,!&lt; ]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2020%2F05%2F28%2FMySQL%E4%BA%8B%E5%8A%A1%EF%BC%8C%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86%2F</url>
    <content type="text"><![CDATA[ Transaction ACIDOracleREAD COMMITTED MySQL ACID  Atomicity    1i++; i+1i++i = i + 1i  consistency  500 500  isolation MySQL durability    1234567BEGIN WORKOperation 1Operation 2Operation 3...Operation NCOMMIT WORK  1234567begin work;select * from user;update user set name = 'sihai' where id = 1;commit work;    1234567891011begin work;select * from user;savepoint t1;update user set name = 'sihai' where id = 1;savepoint t2;commit work; t1t2ROLLBACK TO SAVEPOINT t1t1    1234567891011begin work;select * from user;savepoint t1;update user set name = 'sihai' where id = 1;savepoint t2;commit work; rollbackt1t2commit   123456789101112131415BEGIN WORK SubTransaction1: BEGIN WORK SubOperationX COMMIT WORK SubTransaction2: BEGIN WORK SubOperationY COMMIT WORK ... SubTransactionN: BEGIN WORK SubOperationN COMMIT WORKCOMMIT WORK    COMMITCOMMIT WORKCOMMIT WORKCHAINRELEASECHAIN completion_type completion_type = 1   1234567SET @@completion_type = 1;BEGIN WORK;INSERT INTO lock_test SELECT 10;COMMIT WORK;  12345INSERT INTO lock_test SELECT 115;ROLLBACK;SELECT * FROM lock_test; 115115 115COMMIT WORK completion_type = 2   1234567SET @@completion_type = 2;BEGIN WORK;INSERT INTO lock_test SELECT 5;COMMIT WORK; lock_test 1SELECT * FROM lock_test;  READ UNCOMMITTED READ COMMITTED REPEATABLE READ SERIALIZABLE MySQL-MySQL MySQL ]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Database-CURD]]></title>
    <url>%2F2020%2F05%2F25%2FLaravel-Database-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84CURD%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[ Exception::getPrevious ConnectionDBCURDCreateUpdateRetrieveDeleteLaravelPDO runLaravelrun Illuminate\Database\Connection.php 123456789101112131415161718192021222324252627282930313233343536373839/** * SQL * * @param string $query * @param array $bindings * @param \Closure $callback * @return mixed * * @throws \Illuminate\Database\QueryException */protected function run($query, $bindings, Closure $callback)&#123; $this-&gt;reconnectIfMissingConnection(); $start = microtime(true); //  //  //  try &#123; $result = $this-&gt;runQueryCallback($query, $bindings, $callback); &#125; catch (QueryException $e) &#123; $result = $this-&gt;handleQueryException( $e, $query, $bindings, $callback ); &#125; //  //  //  $this-&gt;logQuery( $query, $bindings, $this-&gt;getElapsedTime($start) ); return $result;&#125; reconnectpdoreconnector 12345678910111213141516171819202122232425262728293031/** * PDO * * @return void */protected function reconnectIfMissingConnection()&#123; if (is_null($this-&gt;pdo)) &#123; $this-&gt;reconnect(); &#125;&#125;/** *  * * @return void * * @throws \LogicException */public function reconnect()&#123; if (is_callable($this-&gt;reconnector)) &#123; $this-&gt;doctrineConnection = null; return call_user_func($this-&gt;reconnector, $this); &#125; throw new LogicException('Lost connection and no reconnector available.');&#125; CURDrunQueryCallbackQueryException 123456789101112131415161718192021222324252627282930/** * SQL * * @param string $query * @param array $bindings * @param \Closure $callback * @return mixed * * @throws \Illuminate\Database\QueryException */protected function runQueryCallback($query, $bindings, Closure $callback)&#123; // PDOSQL // SQL try &#123; $result = $callback($query, $bindings); &#125; // SQL //  catch (Exception $e) &#123; throw new QueryException( $query, $this-&gt;prepareBindings($bindings), $e ); &#125; return $result;&#125; pdo  1234567891011121314151617181920212223242526272829/** *  * * @var int */protected $transactions = 0;/** *  * * @param \Illuminate\Database\QueryException $e * @param string $query * @param array $bindings * @param \Closure $callback * @return mixed * * @throws \Illuminate\Database\QueryException */protected function handleQueryException(QueryException $e, $query, $bindings, Closure $callback)&#123; if ($this-&gt;transactions &gt;= 1) &#123; throw $e; &#125; return $this-&gt;tryAgainIfCausedByLostConnection( $e, $query, $bindings, $callback );&#125;  12345678910111213141516171819202122/** *  * * @param \Illuminate\Database\QueryException $e * @param string $query * @param array $bindings * @param \Closure $callback * @return mixed * * @throws \Illuminate\Database\QueryException */protected function tryAgainIfCausedByLostConnection(QueryException $e, $query, $bindings, Closure $callback)&#123; if ($this-&gt;causedByLostConnection($e-&gt;getPrevious())) &#123; $this-&gt;reconnect(); return $this-&gt;runQueryCallback($query, $bindings, $callback); &#125; throw $e;&#125; Illuminate\Database\DetectsLostConnections.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?phpnamespace Illuminate\Database;use Illuminate\Support\Str;use Throwable;trait DetectsLostConnections&#123; /** *  * * @param \Throwable $e * @return bool */ protected function causedByLostConnection(Throwable $e) &#123; $message = $e-&gt;getMessage(); return Str::contains($message, [ 'server has gone away', 'no connection to the server', 'Lost connection', 'is dead or not enabled', 'Error while sending', 'decryption failed or bad record mac', 'server closed the connection unexpectedly', 'SSL connection has been closed unexpectedly', 'Error writing data to the connection', 'Resource deadlock avoided', 'Transaction() on null', 'child connection forced to terminate due to client_idle_limit', 'query_wait_timeout', 'reset by peer', 'Physical connection is not usable', 'TCP Provider: Error code 0x68', 'ORA-03114', 'Packets out of order. Expected', 'Adaptive Server connection failed', 'Communication link failure', 'connection is no longer usable', 'Login timeout expired', 'Connection refused', 'running with the --read-only option so it cannot execute this statement', ]); &#125;&#125; 123456789101112131415161718192021222324/** * All of the queries run against the connection. * * @var array */protected $queryLog = [];/** *  * * @param string $query * @param array $bindings * @param float|null $time * @return void */public function logQuery($query, $bindings, $time = null)&#123; $this-&gt;event(new QueryExecuted($query, $bindings, $time, $this)); if ($this-&gt;loggingQueries) &#123; $this-&gt;queryLog[] = compact('query', 'bindings', 'time'); &#125;&#125;  1234567891011121314151617181920212223242526/** *  * * @var bool */protected $loggingQueries = false;/** *  * * @return void */public function enableQueryLog()&#123; $this-&gt;loggingQueries = true;&#125;/** *  * * @return void */public function disableQueryLog()&#123; $this-&gt;loggingQueries = false;&#125; Select12345678910111213141516171819202122232425262728/** * select * * @param string $query * @param array $bindings * @param bool $useReadPdo * @return array */public function select($query, $bindings = [], $useReadPdo = true)&#123; return $this-&gt;run($query, $bindings, function ($query, $bindings) use ($useReadPdo) &#123; if ($this-&gt;pretending()) &#123; return []; &#125; // select //  $statement = $this-&gt;prepared($this-&gt;getPdoForSelect($useReadPdo) -&gt;prepare($query)); $this-&gt;bindValues($statement, $this-&gt;prepareBindings($bindings)); $statement-&gt;execute(); return $statement-&gt;fetchAll(); &#125;);&#125;  $this-&gt;pdopdo pdofetch pdosql pdosql getPdoForSelectpdo1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * PDO * * @param bool $useReadPdo * @return \PDO */protected function getPdoForSelect($useReadPdo = true)&#123; return $useReadPdo ? $this-&gt;getReadPdo() : $this-&gt;getPdo();&#125;/** * PDO * * @return \PDO */public function getPdo()&#123; if ($this-&gt;pdo instanceof Closure) &#123; return $this-&gt;pdo = call_user_func($this-&gt;pdo); &#125; return $this-&gt;pdo;&#125;/** * PDO * * @return \PDO */public function getReadPdo()&#123; if ($this-&gt;transactions &gt; 0) &#123; return $this-&gt;getPdo(); &#125; if ($this-&gt;recordsModified &amp;&amp; $this-&gt;getConfig('sticky')) &#123; return $this-&gt;getPdo(); &#125; if ($this-&gt;readPdo instanceof Closure) &#123; return $this-&gt;readPdo = call_user_func($this-&gt;readPdo); &#125; return $this-&gt;readPdo ?: $this-&gt;getPdo();&#125; getPdogetReadPdoLaravelstickystickygetReadPdo  prepared1234567891011121314151617181920212223/** * fetchMode * * @var int */protected $fetchMode = PDO::FETCH_OBJ;/** * PDO * * @param \PDOStatement $statement * @return \PDOStatement */protected function prepared(PDOStatement $statement)&#123; $statement-&gt;setFetchMode($this-&gt;fetchMode); $this-&gt;event(new StatementPrepared( $this, $statement )); return $statement;&#125; pdosetFetchMode- PDO::FETCH_ASSOC  PDO::FETCH_NUM  PDO::FETCH_BOTH  PDO::FETCH_OBJ  PDO::FETCH_BOUND fetch()TRUEbindParm() PDO::FETCH_LAZY  pdopreparepreparePDOStatement::execute()SQL SQL:name?SQL SQL:name? SQLPDOStatement::execute() prepareSQLSQLWebSQL. pdobindValuespdoLaravelgrammerfalse0 pdobindValue:name1 12345678910111213141516171819202122232425262728293031323334353637383940414243/** *  * * @param array $bindings * @return array */public function prepareBindings(array $bindings)&#123; $grammar = $this-&gt;getQueryGrammar(); foreach ($bindings as $key =&gt; $value) &#123; // DateTimeInterface //  if ($value instanceof DateTimeInterface) &#123; $bindings[$key] = $value-&gt;format($grammar-&gt;getDateFormat()); &#125; elseif (is_bool($value)) &#123; $bindings[$key] = (int) $value; &#125; &#125; return $bindings;&#125;/** *  * * @param \PDOStatement $statement * @param array $bindings * @return void */public function bindValues($statement, $bindings)&#123; foreach ($bindings as $key =&gt; $value) &#123; $statement-&gt;bindValue( is_string($key) ? $key : $key + 1, $value, is_int($value) ? PDO::PARAM_INT : PDO::PARAM_STR ); &#125;&#125; insert123456789101112131415161718192021222324252627282930313233343536/** * insert * * @param string $query * @param array $bindings * @return bool */public function insert($query, $bindings = [])&#123; return $this-&gt;statement($query, $bindings);&#125;/** * SQL * * @param string $query * @param array $bindings * @return bool */public function statement($query, $bindings = [])&#123; return $this-&gt;run($query, $bindings, function ($query, $bindings) &#123; if ($this-&gt;pretending()) &#123; return true; &#125; $statement = $this-&gt;getPdo()-&gt;prepare($query); $this-&gt;bindValues($statement, $this-&gt;prepareBindings($bindings)); $this-&gt;recordsHaveBeenModified(); return $statement-&gt;execute(); &#125;);&#125; select  fetchMode recordsHaveBeenModified fetchAll 12345678910111213/** *  * * @param bool $value * @return void */public function recordsHaveBeenModified($value = true)&#123; if (! $this-&gt;recordsModified) &#123; $this-&gt;recordsModified = $value; &#125;&#125; updatedeleteaffectingStatementstatement 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * update * * @param string $query * @param array $bindings * @return int */public function update($query, $bindings = [])&#123; return $this-&gt;affectingStatement($query, $bindings);&#125;/** * delete * * @param string $query * @param array $bindings * @return int */public function delete($query, $bindings = [])&#123; return $this-&gt;affectingStatement($query, $bindings);&#125;/** * SQL * * @param string $query * @param array $bindings * @return int */public function affectingStatement($query, $bindings = [])&#123; return $this-&gt;run($query, $bindings, function ($query, $bindings) &#123; if ($this-&gt;pretending()) &#123; return 0; &#125; // updatedelete // PDO $statement = $this-&gt;getPdo()-&gt;prepare($query); $this-&gt;bindValues($statement, $this-&gt;prepareBindings($bindings)); $statement-&gt;execute(); $this-&gt;recordsHaveBeenModified( ($count = $statement-&gt;rowCount()) &gt; 0 ); return $count; &#125;);&#125; transactiontransaction 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;?phpnamespace Illuminate\Database\Concerns;use Closure;use Throwable;trait ManagesTransactions&#123; /** *  * * @param \Closure $callback * @param int $attempts * @return mixed * * @throws \Throwable */ public function transaction(Closure $callback, $attempts = 1) &#123; for ($currentAttempt = 1; $currentAttempt &lt;= $attempts; $currentAttempt++) &#123; $this-&gt;beginTransaction(); // try/catch //  try &#123; $callbackResult = $callback($this); &#125; //  //  catch (Throwable $e) &#123; $this-&gt;handleTransactionException( $e, $currentAttempt, $attempts ); continue; &#125; try &#123; $this-&gt;commit(); &#125; catch (Throwable $e) &#123; $this-&gt;handleCommitTransactionException( $e, $currentAttempt, $attempts ); continue; &#125; return $callbackResult; &#125; &#125;&#125; $this-&gt;transactions 123456789101112131415/** *  * * @return void * * @throws \Throwable */public function beginTransaction()&#123; $this-&gt;createTransaction(); $this-&gt;transactions++; $this-&gt;fireConnectionEvent('beganTransaction');&#125; $this-&gt;transactionsevent 123456789101112131415161718192021222324252627/** *  * * @return void * * @throws \Throwable */protected function createTransaction()&#123; if ($this-&gt;transactions == 0) &#123; $this-&gt;reconnectIfMissingConnection(); try &#123; $this-&gt;getPdo()-&gt;beginTransaction(); &#125; catch (Throwable $e) &#123; $this-&gt;handleBeginTransactionException($e); &#125; &#125; elseif ($this-&gt;transactions &gt;= 1 &amp;&amp; $this-&gt;queryGrammar-&gt;supportsSavepoints()) &#123; $this-&gt;createSavepoint(); &#125;&#125; pdo SAVEPOINT 12345678910111213/** *  * * @return void * * @throws \Throwable */protected function createSavepoint()&#123; $this-&gt;getPdo()-&gt;exec( $this-&gt;queryGrammar-&gt;compileSavepoint('trans'.($this-&gt;transactions + 1)) );&#125; 1234567891011121314151617&lt;?phpnamespace Illuminate\Database\Query\Grammars;class Grammar extends BaseGrammar&#123; /** * SQL * * @param string $name * @return string */ public function compileSavepoint($name) &#123; return 'SAVEPOINT '.$name; &#125;&#125; handleBeginTransactionException 123456789101112131415161718192021/** *  * * @param \Throwable $e * @return void * * @throws \Throwable */protected function handleBeginTransactionException(Throwable $e)&#123; if ($this-&gt;causedByLostConnection($e)) &#123; $this-&gt;reconnect(); $this-&gt;getPdo()-&gt;beginTransaction(); &#125; else &#123; throw $e; &#125;&#125;   1234567891011121314151617181920212223242526272829303132333435/** *  * * @param \Throwable $e * @param int $currentAttempt * @param int $maxAttempts * @return void * * @throws \Throwable */protected function handleTransactionException(Throwable $e, $currentAttempt, $maxAttempts)&#123; // MySQL //  // transactions if ($this-&gt;causedByConcurrencyError($e) &amp;&amp; $this-&gt;transactions &gt; 1) &#123; $this-&gt;transactions--; throw $e; &#125; //  //  $this-&gt;rollBack(); if ($this-&gt;causedByConcurrencyError($e) &amp;&amp; $currentAttempt &lt; $maxAttempts) &#123; return; &#125; throw $e;&#125; 1234567891011121314151617181920212223242526272829303132333435363738&lt;?phpnamespace Illuminate\Database;use Illuminate\Support\Str;use PDOException;use Throwable;trait DetectsConcurrencyErrors&#123; /** *  * * @param \Throwable $e * @return bool */ protected function causedByConcurrencyError(Throwable $e) &#123; if ($e instanceof PDOException &amp;&amp; $e-&gt;getCode() === '40001') &#123; return true; &#125; $message = $e-&gt;getMessage(); return Str::contains($message, [ 'Deadlock found when trying to get lock', 'deadlock detected', 'The database file is locked', 'database is locked', 'database table is locked', 'A table in the database is locked', 'has been chosen as the deadlock victim', 'Lock wait timeout exceeded; try restarting transaction', 'WSREP detected deadlock/conflict and aborted the transaction. Try restarting the transaction', ]); &#125;&#125;   sqlhandleTransactionException 123456789101112131415try &#123; return tap($callback($this), function ($result) &#123; $this-&gt;commit(); &#125;);&#125;catch (Exception $e) &#123; $this-&gt;handleTransactionException($e, $currentAttempt, $attempts);&#125; catch (Throwable $e) &#123; $this-&gt;rollBack(); throw $e;&#125; $this-&gt;transactions0  maxAttempts   123456789\DB::transaction(function()&#123; ... //  \DB::transaction(function() &#123; ... ... &#125;, 2);//attempt twice &#125;, 2);//attempt twice    mysqlInnoDB Error Handling$this-&gt;transactions  12345678910111213141516171819202122232425262728293031323334353637/** *  * * @param int|null $toLevel * @return void * * @throws \Throwable */public function rollBack($toLevel = null)&#123; //  //  //  $toLevel = is_null($toLevel) ? $this-&gt;transactions - 1 : $toLevel; if ($toLevel &lt; 0 || $toLevel &gt;= $this-&gt;transactions) &#123; return; &#125; //  //  try &#123; $this-&gt;performRollBack($toLevel); &#125; catch (Throwable $e) &#123; $this-&gt;handleRollBackException($e); &#125; $this-&gt;transactions = $toLevel; $this-&gt;fireConnectionEvent('rollingBack');&#125; $this-&gt;transactions SAVEPOINT 1234567891011121314151617181920212223242526272829303132/** *  * * @param int $toLevel * @return void * * @throws \Throwable */protected function performRollBack($toLevel)&#123; if ($toLevel == 0) &#123; $this-&gt;getPdo()-&gt;rollBack(); &#125; elseif ($this-&gt;queryGrammar-&gt;supportsSavepoints()) &#123; $this-&gt;getPdo()-&gt;exec( $this-&gt;queryGrammar-&gt;compileSavepointRollBack('trans'.($toLevel + 1)) ); &#125;&#125;/** * SQL * * @param string $name * @return string */public function compileSavepointRollBack($name)&#123; return 'ROLLBACK TO SAVEPOINT '.$name;&#125; pdocommitcommit$this-&gt;transactionsmysql 123456789101112131415161718/** *  * * @return void * * @throws \Throwable */public function commit()&#123; if ($this-&gt;transactions == 1) &#123; $this-&gt;getPdo()-&gt;commit(); &#125; $this-&gt;transactions = max(0, $this-&gt;transactions - 1); $this-&gt;fireConnectionEvent('committed');&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Database-Eloquent Model]]></title>
    <url>%2F2020%2F05%2F24%2FLaravel-Database-Eloquent-Model%E5%85%B3%E8%81%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ Laravel ModelModeluserposts 1$user-&gt;posts()-&gt;where('active', 1)-&gt;get(); $useractive1postsuser   hasOneUserPhone 12345678910class User extends Model&#123; /** *  */ public function phone() &#123; $this-&gt;hasOne('App\Phone', 'user_id', 'id'); &#125;&#125; hasOne 1234567891011121314151617181920212223namespace Illuminate\Database\Eloquent\Concerns;trait HasRelationships&#123; /** * Define a one-to-one relationship. * * @param string $related * @param string|null $foreignKey * @param string|null $localKey * @return \Illuminate\Database\Eloquent\Relations\HasOne */ public function hasOne($related, $foreignKey = null, $localKey = null) &#123; $instance = $this-&gt;newRelatedInstance($related); $foreignKey = $foreignKey ?: $this-&gt;getForeignKey(); $localKey = $localKey ?: $this-&gt;getKeyName(); return $this-&gt;newHasOne($instance-&gt;newQuery(), $this, $instance-&gt;getTable().'.'.$foreignKey, $localKey); &#125;&#125; newRelatedInstance 1234567891011121314/** * Create a new model instance for a related model. * * @param string $class * @return mixed */protected function newRelatedInstance($class)&#123; return tap(new $class, function ($instance) &#123; if (! $instance-&gt;getConnectionName()) &#123; $instance-&gt;setConnection($this-&gt;connection); &#125; &#125;);&#125; foreignKeylocalKey 1234567891011121314namespace Illuminate\Database\Eloquent;abstract class Model implements Arrayable, ArrayAccess, Jsonable, JsonSerializable, QueueableEntity, UrlRoutable&#123; /** * Get the default foreign key name for the model. * * @return string */ public function getForeignKey() &#123; return Str::snake(class_basename($this)).'_'.$this-&gt;getKeyName(); &#125;&#125; hasOneHasOneOrMany 123456789101112131415161718192021namespace Illuminate\Database\Eloquent\Relations;abstract class HasOneOrMany extends Relation&#123; /** * Create a new has one or many relationship instance. * * @param \Illuminate\Database\Eloquent\Builder $query * @param \Illuminate\Database\Eloquent\Model $parent * @param string $foreignKey * @param string $localKey * @return void */ public function __construct(Builder $query, Model $parent, $foreignKey, $localKey) &#123; $this-&gt;localKey = $localKey; $this-&gt;foreignKey = $foreignKey; parent::__construct($query, $parent); &#125;&#125; HasOneOrManyRelationparent 1234567891011121314151617181920212223namespace Illuminate\Database\Eloquent\Relations;/** * @mixin \Illuminate\Database\Eloquent\Builder */abstract class Relation&#123; /** * Create a new relation instance. * * @param \Illuminate\Database\Eloquent\Builder $query * @param \Illuminate\Database\Eloquent\Model $parent * @return void */ public function __construct(Builder $query, Model $parent) &#123; $this-&gt;query = $query; $this-&gt;parent = $parent; $this-&gt;related = $query-&gt;getModel(); $this-&gt;addConstraints(); &#125;&#125; hasOne parent 123456789101112131415161718192021222324/** * Set the base constraints on the relation query. * * @return void */public function addConstraints()&#123; if (static::$constraints) &#123; $this-&gt;query-&gt;where($this-&gt;foreignKey, '=', $this-&gt;getParentKey()); $this-&gt;query-&gt;whereNotNull($this-&gt;foreignKey); &#125;&#125;/** * Get the key value of the parent's local key. * * @return mixed */public function getParentKey()&#123; return $this-&gt;parent-&gt;getAttribute($this-&gt;localKey);&#125;  1select phone where phone.user_id = 1 (user.id) hasMany 12345678910111213141516171819202122232425namespace Illuminate\Database\Eloquent\Concerns;trait HasRelationships&#123; /** * Define a one-to-many relationship. * * @param string $related * @param string|null $foreignKey * @param string|null $localKey * @return \Illuminate\Database\Eloquent\Relations\HasMany */ public function hasMany($related, $foreignKey = null, $localKey = null) &#123; $instance = $this-&gt;newRelatedInstance($related); $foreignKey = $foreignKey ?: $this-&gt;getForeignKey(); $localKey = $localKey ?: $this-&gt;getKeyName(); return $this-&gt;newHasMany( $instance-&gt;newQuery(), $this, $instance-&gt;getTable().'.'.$foreignKey, $localKey ); &#125;&#125; hasMany  1select phone where phone.user_id = 1 (user.id) belongsTo 1234public function user()&#123; return $this-&gt;belongsTo('App\User', 'foreign_key', 'other_key');&#125; belongsTo 12345678910111213141516171819202122232425262728293031323334353637383940414243namespace Illuminate\Database\Eloquent\Concerns;trait HasRelationships&#123; /** * Define an inverse one-to-one or many relationship. * * @param string $related * @param string|null $foreignKey * @param string|null $ownerKey * @param string|null $relation * @return \Illuminate\Database\Eloquent\Relations\BelongsTo */ public function belongsTo($related, $foreignKey = null, $ownerKey = null, $relation = null) &#123; // If no relation name was given, we will use this debug backtrace to extract // the calling method's name and use that as the relationship name as most // of the time this will be what we desire to use for the relationships. if (is_null($relation)) &#123; $relation = $this-&gt;guessBelongsToRelation(); &#125; $instance = $this-&gt;newRelatedInstance($related); // If no foreign key was supplied, we can use a backtrace to guess the proper // foreign key name by using the name of the relationship function, which // when combined with an "_id" should conventionally match the columns. if (is_null($foreignKey)) &#123; $foreignKey = Str::snake($relation).'_'.$instance-&gt;getKeyName(); &#125; // Once we have the foreign key names, we'll just create a new Eloquent query // for the related models and returns the relationship instance which will // actually be responsible for retrieving and hydrating every relations. $ownerKey = $ownerKey ?: $instance-&gt;getKeyName(); return $this-&gt;newBelongsTo( $instance-&gt;newQuery(), $this, $foreignKey, $ownerKey, $relation ); &#125;&#125; relationdebug_backtrace 1234567891011/** * Guess the "belongs to" relationship name. * * @return string */protected function guessBelongsToRelation()&#123; [$one, $two, $caller] = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS, 3); return $caller['function'];&#125; userbelongsTo ++ 1234if (is_null($foreignKey)) &#123; $foreignKey = Str::snake($relation).'_'.$instance-&gt;getKeyName();&#125; belongsTo 123456789101112131415161718namespace Illuminate\Database\Eloquent\Relations;class BelongsTo extends Relation&#123; public function __construct(Builder $query, Model $child, $foreignKey, $ownerKey, $relationName) &#123; $this-&gt;ownerKey = $ownerKey; $this-&gt;relationName = $relationName; $this-&gt;foreignKey = $foreignKey; // In the underlying base relationship class, this variable is referred to as // the "parent" since most relationships are not inversed. But, since this // one is we will create a "child" variable for much better readability. $this-&gt;child = $child; parent::__construct($query, $child); &#125;&#125; relatedparent hasMany  12345678public function addConstraints()&#123;if (static::$constraints) &#123;$table = $this-&gt;related-&gt;getTable();$this-&gt;query-&gt;where($table.'.'.$this-&gt;ownerKey, '=', $this-&gt;child-&gt;&#123;$this-&gt;foreignKey&#125;);&#125;&#125;  1select user where user.id = 1 (post.user_id) belongsMany 12345678910class User extends Model&#123; /** *  */ public function roles() &#123; return $this-&gt;belongsToMany('App\Role', 'role_user', 'user_id', 'role_id'); &#125;&#125; Userroleuser_rolerelatedtableforeignPivotKeyrelatedPivotKeyparentKeyrelatedKeyrelation 123456789101112131415161718192021public function belongsToMany($related, $table = null, $foreignPivotKey = null, $relatedPivotKey = null, $parentKey = null, $relatedKey = null, $relation = null)&#123;if (is_null($relation)) &#123;$relation = $this-&gt;guessBelongsToManyRelation();&#125;$instance = $this-&gt;newRelatedInstance($related);$foreignPivotKey = $foreignPivotKey ?: $this-&gt;getForeignKey();$relatedPivotKey = $relatedPivotKey ?: $instance-&gt;getForeignKey();if (is_null($table)) &#123;$table = $this-&gt;joiningTable($related);&#125;return new BelongsToMany($instance-&gt;newQuery(), $this, $table, $foreignPivotKey,$relatedPivotKey, $parentKey ?: $this-&gt;getKeyName(),$relatedKey ?: $instance-&gt;getKeyName(), $relation);&#125; debug_backtraceguessBelongsToRelation belongsToguessBelongsToManyRelationmorphedByMany 1234567891011121314public static $manyMethods = ['belongsToMany', 'morphToMany', 'morphedByMany','guessBelongsToManyRelation', 'findFirstMethodThatIsntRelation',];protected function guessBelongsToManyRelation()&#123;$caller = Arr::first(debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS), function ($trace) &#123;return ! in_array($trace['function'], Model::$manyMethods);&#125;);return ! is_null($caller) ? $caller['function'] : null;&#125;  123456789public function joiningTable($related)&#123;$models = [Str::snake(class_basename($related)),Str::snake(class_basename($this)),];sort($models);return strtolower(implode('_', $models));&#125; BelongsToMany 12345678910111213public function __construct(Builder $query, Model $parent, $table, $foreignPivotKey,$relatedPivotKey, $parentKey, $relatedKey, $relationName = null)&#123;$this-&gt;table = $table;$this-&gt;parentKey = $parentKey;$this-&gt;relatedKey = $relatedKey;$this-&gt;relationName = $relationName;$this-&gt;relatedPivotKey = $relatedPivotKey;$this-&gt;foreignPivotKey = $foreignPivotKey;parent::__construct($query, $parent);&#125; belongsToMany   123456789101112131415161718192021222324public function addConstraints()&#123;$this-&gt;performJoin();if (static::$constraints) &#123;$this-&gt;addWhereConstraints();&#125;&#125;protected function performJoin($query = null)&#123;$query = $query ?: $this-&gt;query;$baseTable = $this-&gt;related-&gt;getTable();$key = $baseTable.'.'.$this-&gt;relatedKey;$query-&gt;join($this-&gt;table, $key, '=', $this-&gt;getQualifiedRelatedPivotKeyName());return $this;&#125;protected function addWhereConstraints()&#123;$this-&gt;query-&gt;where($this-&gt;getQualifiedForeignPivotKeyName(), '=', $this-&gt;parent-&gt;&#123;$this-&gt;parentKey&#125;);return $this;&#125; wher 12select role join role_user on role_user.role_id = 1 (role.id)select role where role_user.user_id = 1 (user.id) hasManyThrough 1234567891011121314class Country extends Model&#123; public function posts() &#123; return $this-&gt;hasManyThrough( 'App\Post', 'App\User', 'country_id', // ... 'user_id', // ... 'id', // ... 'id' // ... ); &#125;&#125; relatedthroughfirstKeysecondKeylocalKeysecondLocalKey 123456789101112public function hasManyThrough($related, $through, $firstKey = null, $secondKey = null, $localKey = null, $secondLocalKey = null)&#123;$through = new $through;$firstKey = $firstKey ?: $this-&gt;getForeignKey();$secondKey = $secondKey ?: $through-&gt;getForeignKey();$localKey = $localKey ?: $this-&gt;getKeyName();$secondLocalKey = $secondLocalKey ?: $through-&gt;getKeyName();$instance = $this-&gt;newRelatedInstance($related);return new HasManyThrough($instance-&gt;newQuery(), $this, $through, $firstKey, $secondKey, $localKey, $secondLocalKey);&#125; HasManyThrough 123456789101112public function __construct(Builder $query, Model $farParent, Model $throughParent, $firstKey, $secondKey, $localKey, $secondLocalKey)&#123;$this-&gt;localKey = $localKey;$this-&gt;firstKey = $firstKey;$this-&gt;secondKey = $secondKey;$this-&gt;farParent = $farParent;$this-&gt;throughParent = $throughParent;$this-&gt;secondLocalKey = $secondLocalKey;parent::__construct($query, $throughParent);&#125; hasManyThrough  12345678910111213141516171819202122232425262728293031323334353637public function addConstraints()&#123;$localValue = $this-&gt;farParent[$this-&gt;localKey];$this-&gt;performJoin();if (static::$constraints) &#123;$this-&gt;query-&gt;where($this-&gt;getQualifiedFirstKeyName(), '=', $localValue);&#125;&#125;protected function performJoin(Builder $query = null)&#123;$query = $query ?: $this-&gt;query;$farKey = $this-&gt;getQualifiedFarKeyName();$query-&gt;join($this-&gt;throughParent-&gt;getTable(), $this-&gt;getQualifiedParentKeyName(), '=', $farKey);if ($this-&gt;throughParentSoftDeletes()) &#123;$query-&gt;whereNull($this-&gt;throughParent-&gt;getQualifiedDeletedAtColumn());&#125;&#125;public function getQualifiedParentKeyName()&#123;return $this-&gt;parent-&gt;getTable().'.'.$this-&gt;secondLocalKey;&#125;public function getQualifiedFarKeyName()&#123;return $this-&gt;getQualifiedForeignKeyName();&#125;public function getQualifiedForeignKeyName()&#123;return $this-&gt;related-&gt;getTable().'.'.$this-&gt;secondKey;&#125;public function getQualifiedFirstKeyName()&#123;return $this-&gt;throughParent-&gt;getTable().'.'.$this-&gt;firstKey;&#125;  123select post join user on user.id = post.user_idselect post where user.delete_at is nullselect post where user.country_id = 1 (country.id) morphOne/morphMany  comments 1234567891011121314151617181920class Post extends Model&#123;/*** */public function comments()&#123;return $this-&gt;morphMany('App\Comment', 'commentable');&#125;&#125;class Video extends Model&#123;/*** */public function comments()&#123;return $this-&gt;morphMany('App\Comment', 'commentable');&#125;&#125;  comments   commentable_type commentable_id  id  type id related  comments type(commentable_type) id (commentable_id)nametypeidlocalKey 123456789101112131415161718192021222324public function morphOne($related, $name, $type = null, $id = null, $localKey = null)&#123;$instance = $this-&gt;newRelatedInstance($related);list($type, $id) = $this-&gt;getMorphs($name, $type, $id);$table = $instance-&gt;getTable();$localKey = $localKey ?: $this-&gt;getKeyName();return new MorphOne($instance-&gt;newQuery(), $this, $table.'.'.$type, $table.'.'.$id, $localKey);&#125;public function morphMany($related, $name, $type = null, $id = null, $localKey = null)&#123;$instance = $this-&gt;newRelatedInstance($related);list($type, $id) = $this-&gt;getMorphs($name, $type, $id);$table = $instance-&gt;getTable();$localKey = $localKey ?: $this-&gt;getKeyName();return new MorphMany($instance-&gt;newQuery(), $this, $table.'.'.$type, $table.'.'.$id, $localKey);&#125;protected function getMorphs($name, $type, $id)&#123;return [$type ?: $name.'_type', $id ?: $name.'_id'];&#125; ( App\Post  App\Video ) 12345678910111213141516public function __construct(Builder $query, Model $parent, $type, $id, $localKey)&#123;$this-&gt;morphType = $type;$this-&gt;morphClass = $parent-&gt;getMorphClass();parent::__construct($query, $parent, $id, $localKey);&#125;public function getMorphClass()&#123;$morphMap = Relation::morphMap();if (! empty($morphMap) &amp;&amp; in_array(static::class, $morphMap)) &#123;return array_search(static::class, $morphMap, true);&#125;return static::class;&#125;  1234Relation::morphMap(['posts' =&gt; 'App\Post','videos' =&gt; 'App\Video',]); App\Postposts App\Videovideos 1234567891011121314151617181920public static function morphMap(array $map = null, $merge = true)&#123;$map = static::buildMorphMapFromModels($map);if (is_array($map)) &#123;static::$morphMap = $merge &amp;&amp; static::$morphMap? array_merge(static::$morphMap, $map) :$map;&#125;return static::$morphMap;&#125;protected static function buildMorphMapFromModels(array $models= null)&#123;if (is_null($models) || Arr::isAssoc($models)) &#123;return $models;&#125;return array_combine(array_map(function ($model) &#123;return (new $model)-&gt;getTable();&#125;, $models), $models);&#125;  buildMorphMapFromModels App\Postmodelarray_combine morphOne morphMany 12345678910111213141516public function addConstraints()&#123;if (static::$constraints) &#123;parent::addConstraints();$this-&gt;query-&gt;where($this-&gt;morphType, $this-&gt;morphClass);&#125;&#125;public function addConstraints()&#123;if (static::$constraints) &#123;$this-&gt;query-&gt;where($this-&gt;foreignKey, '=', $this-&gt;getParentKey());$this-&gt;query-&gt;whereNotNull($this-&gt;foreignKey);&#125;&#125;  123select comments where comment.commentable_id = post.idselect comments where comment.commentable_id is not nullselect comments where comment.commentable_type = 'App\Post' morphTo   belongsTo morphTo : 12345678910class Comment extends Model&#123;/*** */public function commentable()&#123;return $this-&gt;morphTo();&#125;&#125;  belongsTo  morphTo  debug_backtrace  Comment $this-&gt;{$type} 12345678910111213141516171819202122232425262728public function morphTo($name = null, $type = null, $id = null)&#123;$name = $name ?: $this-&gt;guessBelongsToRelation();list($type, $id) = $this-&gt;getMorphs(Str::snake($name), $type, $id);return empty($class = $this-&gt;&#123;$type&#125;)? $this-&gt;morphEagerTo($name, $type, $id): $this-&gt;morphInstanceTo($class, $name, $type, $id);&#125;protected function morphEagerTo($name, $type, $id)&#123;return new MorphTo($this-&gt;newQuery()-&gt;setEagerLoads([]), $this, $id, null,$type, $name);&#125;protected function morphInstanceTo($target, $name, $type, $id)&#123;$instance = $this-&gt;newRelatedInstance(static::getActualClassNameForMorph($target));return new MorphTo($instance-&gt;newQuery(), $this, $id, $instance-&gt;getKeyName(), $type, $name);&#125;  morphType  morphClass MorphTo morphType : 1234567public function __construct(Builder $query, Model $parent, $foreignKey, $ownerKey, $type, $relation)&#123;$this-&gt;morphType = $type;parent::__construct($query, $parent, $foreignKey, $ownerKey,$relation);&#125; morphTo  belongsTo  12345678public function addConstraints()&#123;if (static::$constraints) &#123;$table = $this-&gt;related-&gt;getTable();$this-&gt;query-&gt;where($table.'.'.$this-&gt;ownerKey, '=', $this-&gt;child-&gt;&#123;$this-&gt;foreignKey&#125;);&#125;&#125;  1select post where post.id = comments.commentable_id PostVideo Tag   12345678910class Post extends Model&#123;/*** */public function tags()&#123;return $this-&gt;morphToMany('App\Tag', 'taggable');&#125;&#125; nameforeignPivotKeypostvideotaggable_idrelatedPivotKey tag  tag_id : 123456789101112131415161718192021public function morphToMany($related, $name, $table = null, $foreignPivotKey = null,$relatedPivotKey = null, $parentKey = null,$relatedKey = null, $inverse = false)&#123;$caller = $this-&gt;guessBelongsToManyRelation();$instance = $this-&gt;newRelatedInstance($related);$foreignPivotKey = $foreignPivotKey ?: $name.'_id';$relatedPivotKey = $relatedPivotKey ?: $instance-&gt;getForeignKey();$table = $table ?: Str::plural($name);return new MorphToMany($instance-&gt;newQuery(), $this, $name, $table,$foreignPivotKey, $relatedPivotKey, $parentKey ?: $this-&gt;getKeyName(),$relatedKey ?: $instance-&gt;getKeyName(), $caller, $inverse);&#125; MorphToManymorphTypemorphClassmorphTypePostvideosmorphClassPostvideos inversefalseinversetrue  1234567891011121314public function __construct(Builder $query, Model $parent, $name, $table, $foreignPivotKey,$relatedPivotKey, $parentKey, $relatedKey, $relationName = null, $inverse = false)&#123;$this-&gt;inverse = $inverse;$this-&gt;morphType = $name.'_type';$this-&gt;morphClass = $inverse ? $query-&gt;getModel()-&gt;getMorphClass() : $parent-&gt;getMorphClass();parent::__construct($query, $parent, $table, $foreignPivotKey,$relatedPivotKey, $parentKey, $relatedKey, $relationName);&#125;  parent  Post  videos related  Post  videos  12345678910111213141516171819protected function addWhereConstraints()&#123;parent::addWhereConstraints();$this-&gt;query-&gt;where($this-&gt;table.'.'.$this-&gt;morphType, $this-&gt;morphClass);return $this;&#125;protected function addWhereConstraints()&#123;$this-&gt;query-&gt;where($this-&gt;getQualifiedForeignPivotKeyName(), '=', $this-&gt;parent-&gt;&#123;$this-&gt;parentKey&#125;);return $this;&#125;public function getQualifiedForeignPivotKeyName()&#123;return $this-&gt;table.'.'.$this-&gt;foreignPivotKey;&#125;  sql ( Post  1)  12where taggables.taggable_id = 1;where taggables.taggable_type = 'App\Post' morphToMany   12345678910111213141516171819202122232425262728293031public function addConstraints()&#123;$this-&gt;performJoin();if (static::$constraints) &#123;$this-&gt;addWhereConstraints();&#125;&#125;protected function performJoin($query = null)&#123;$query = $query ?: $this-&gt;query;$baseTable = $this-&gt;related-&gt;getTable();$key = $baseTable.'.'.$this-&gt;relatedKey;$query-&gt;join($this-&gt;table, $key, '=', $this-&gt;getQualifiedRelatedPivotKeyName());return $this;&#125;protected function addWhereConstraints()&#123;parent::addWhereConstraints();$this-&gt;query-&gt;where($this-&gt;table.'.'.$this-&gt;morphType, $this-&gt;morphClass);return $this;&#125;protected function addWhereConstraints()&#123;$this-&gt;query-&gt;where($this-&gt;getQualifiedForeignPivotKeyName(), '=', $this-&gt;parent-&gt;&#123;$this-&gt;parentKey&#125;);return $this;&#125;  123select tag join tagable on tagable.tag_id = tag.idselect tags where tagable.tagables_id = post.idselect tags where tagable.tagables_type = 'App\Tag'  12345678910class Tag extends Model&#123;/*** */public function posts()&#123;return $this-&gt;morphedByMany('App\Post', 'taggable');&#125;&#125; relatedPivotKeyrelatedpostvideotaggable_id foreignPivotKeytagtag_id 12345678910111213public function morphedByMany($related, $name, $table = null, $foreignPivotKey = null,$relatedPivotKey = null, $parentKey = null, $relatedKey = null)&#123;$foreignPivotKey = $foreignPivotKey ?: $this-&gt;getForeignKey();$relatedPivotKey = $relatedPivotKey ?: $name.'_id';return $this-&gt;morphToMany($related, $name, $table, $foreignPivotKey,$relatedPivotKey, $parentKey, $relatedKey, true);&#125;  sql ( Tag  1)  12where taggables.tag_id = 1;where taggables.taggable_type = 'App\Post' morphedByMany  morphToMany  1234567891011121314151617181920212223242526272829303132public function addConstraints()&#123;$this-&gt;performJoin();if (static::$constraints) &#123;$this-&gt;addWhereConstraints();&#125;&#125;protected function performJoin($query = null)&#123;$query = $query ?: $this-&gt;query;$baseTable = $this-&gt;related-&gt;getTable();$key = $baseTable.'.'.$this-&gt;relatedKey;$query-&gt;join($this-&gt;table, $key, '=', $this-&gt;getQualifiedRelatedPivotKeyName());return $this;&#125;protected function addWhereConstraints()&#123;parent::addWhereConstraints();$this-&gt;query-&gt;where($this-&gt;table.'.'.$this-&gt;morphType, $this-&gt;morphClass);return $this;&#125;protected function addWhereConstraints()&#123;$this-&gt;query-&gt;where($this-&gt;getQualifiedForeignPivotKeyName(), '=', $this-&gt;parent-&gt;&#123;$this-&gt;parentKey&#125;);return $this;&#125;  123select post join post on post.id = tagables.tagable_idselect post where tagables.tag_id = tag.idselect post where tagables.tagable_type = 'App\Post']]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel HTTP-]]></title>
    <url>%2F2020%2F05%2F24%2FLaravel-HTTP-%E6%8E%A7%E5%88%B6%E5%99%A8%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%82%E6%95%B0%E6%9E%84%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C%2F</url>
    <content type="text"><![CDATA[ Laravel pipelinerun 1234567891011121314151617181920212223242526272829namespace Illuminate\Routing;class Router implements BindingRegistrar, RegistrarContract&#123; /** * Run the given route within a Stack "onion" instance. * * @param \Illuminate\Routing\Route $route * @param \Illuminate\Http\Request $request * @return mixed */ protected function runRouteWithinStack(Route $route, Request $request) &#123; $shouldSkipMiddleware = $this-&gt;container-&gt;bound('middleware.disable') &amp;&amp; $this-&gt;container-&gt;make('middleware.disable') === true; $middleware = $shouldSkipMiddleware ? [] : $this-&gt;gatherRouteMiddleware($route); return (new Pipeline($this-&gt;container)) -&gt;send($request) -&gt;through($middleware) -&gt;then(function ($request) use ($route) &#123; return $this-&gt;prepareResponse( $request, $route-&gt;run() ); &#125;); &#125;&#125; run 123456789101112131415161718192021222324namespace Illuminate\Routing;class Route&#123; /** * Run the route action and return the response. * * @return mixed */ public function run() &#123; $this-&gt;container = $this-&gt;container ?: new Container; try &#123; if ($this-&gt;isControllerAction()) &#123; return $this-&gt;runController(); &#125; return $this-&gt;runCallable(); &#125; catch (HttpResponseException $e) &#123; return $e-&gt;getResponse(); &#125; &#125;&#125; ControllerDispatcher 1234567891011121314151617181920212223242526class Route&#123; /** * Checks whether the route's action is a controller. * * @return bool */ protected function isControllerAction() &#123; return is_string($this-&gt;action['uses']); &#125; /** * Run the route action and return the response. * * @return mixed * * @throws \Symfony\Component\HttpKernel\Exception\NotFoundHttpException */ protected function runController() &#123; return $this-&gt;controllerDispatcher()-&gt;dispatch( $this, $this-&gt;getController(), $this-&gt;getControllerMethod() ); &#125;&#125; 123456789101112131415161718192021222324252627282930namespace Illuminate\Routing;use Illuminate\Container\Container;use Illuminate\Routing\Contracts\ControllerDispatcher as ControllerDispatcherContract;class ControllerDispatcher implements ControllerDispatcherContract&#123; use RouteDependencyResolverTrait; /** * Dispatch a request to a given controller and method. * * @param \Illuminate\Routing\Route $route * @param mixed $controller * @param string $method * @return mixed */ public function dispatch(Route $route, $controller, $method) &#123; $parameters = $this-&gt;resolveClassMethodDependencies( $route-&gt;parametersWithoutNulls(), $controller, $method ); if (method_exists($controller, 'callAction')) &#123; return $controller-&gt;callAction($method, $parameters); &#125; return $controller-&gt;&#123;$method&#125;(...array_values($parameters)); &#125;&#125; callAction ControllerDispatcherRouteDependencyResolverTraittrait 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&lt;?phpnamespace Illuminate\Routing;use Illuminate\Support\Arr;use ReflectionFunctionAbstract;use ReflectionMethod;use ReflectionParameter;trait RouteDependencyResolverTrait&#123; /** * Resolve the object method's type-hinted dependencies. * * @param array $parameters * @param object $instance * @param string $method * @return array */ protected function resolveClassMethodDependencies(array $parameters, $instance, $method) &#123; if (! method_exists($instance, $method)) &#123; return $parameters; &#125; return $this-&gt;resolveMethodDependencies( $parameters, new ReflectionMethod($instance, $method) ); &#125; /** * Resolve the given method's type-hinted dependencies. * * @param array $parameters * @param \ReflectionFunctionAbstract $reflector * @return array */ public function resolveMethodDependencies(array $parameters, ReflectionFunctionAbstract $reflector) &#123; $instanceCount = 0; $values = array_values($parameters); foreach ($reflector-&gt;getParameters() as $key =&gt; $parameter) &#123; $instance = $this-&gt;transformDependency( $parameter, $parameters ); if (! is_null($instance)) &#123; $instanceCount++; $this-&gt;spliceIntoParameters($parameters, $key, $instance); &#125; elseif (! isset($values[$key - $instanceCount]) &amp;&amp; $parameter-&gt;isDefaultValueAvailable()) &#123; $this-&gt;spliceIntoParameters($parameters, $key, $parameter-&gt;getDefaultValue()); &#125; &#125; return $parameters; &#125;&#125;   IoC  IoC 1234567891011121314151617181920/** * Attempt to transform the given parameter into a class instance. * * @param \ReflectionParameter $parameter * @param array $parameters * @return mixed */protected function transformDependency(ReflectionParameter $parameter, $parameters)&#123; $class = $parameter-&gt;getClass(); // If the parameter has a type-hinted class, we will check to see if it is already in // the list of parameters. If it is we will just skip it as it is probably a model // binding and we do not want to mess with those; otherwise, we resolve it here. if ($class &amp;&amp; ! $this-&gt;alreadyInParameters($class-&gt;name, $parameters)) &#123; return $parameter-&gt;isDefaultValueAvailable() ? $parameter-&gt;getDefaultValue() : $this-&gt;container-&gt;make($class-&gt;name); &#125;&#125; IoC 123456789101112131415161718192021if (! is_null($instance)) &#123; $instanceCount++; $this-&gt;spliceIntoParameters($parameters, $key, $instance);&#125;/** * Splice the given value into the parameter list. * * @param array $parameters * @param string $offset * @param mixed $value * @return void */protected function spliceIntoParameters(array &amp;$parameters, $offset, $value)&#123; array_splice( $parameters, $offset, 0, [$value] );&#125; IoC 1234elseif (! isset($values[$key - $instanceCount]) &amp;&amp; $parameter-&gt;isDefaultValueAvailable()) &#123; $this-&gt;spliceIntoParameters($parameters, $key, $parameter-&gt;getDefaultValue());&#125; callActioncallAction__call() : 12345678910111213141516171819202122232425262728293031323334namespace Illuminate\Routing;use BadMethodCallException;abstract class Controller&#123; /** * Execute an action on the controller. * * @param string $method * @param array $parameters * @return \Symfony\Component\HttpFoundation\Response */ public function callAction($method, $parameters) &#123; return call_user_func_array([$this, $method], $parameters); &#125; /** * Handle calls to missing methods on the controller. * * @param string $method * @param array $parameters * @return mixed * * @throws \BadMethodCallException */ public function __call($method, $parameters) &#123; throw new BadMethodCallException(sprintf( 'Method %s::%s does not exist.', static::class, $method )); &#125;&#125;  1234567891011121314151617class Route&#123; /** * Run the route action and return the response. * * @return mixed */ protected function runCallable() &#123; $callable = $this-&gt;action['uses']; return $callable(...array_values($this-&gt;resolveMethodDependencies( $this-&gt;parametersWithoutNulls(), new ReflectionFunction($this-&gt;action['uses']) ))); &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Database-]]></title>
    <url>%2F2020%2F05%2F23%2FLaravel-Database-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%90%AF%E5%8A%A8%E4%B8%8E%E8%BF%9E%E6%8E%A5%2F</url>
    <content type="text"><![CDATA[ LaravelDBEloquent ModelEloquentORMSQLDBPDOEloquentDBDB Laravel DBDatabaseManagerDBPDO API ConnectionFactoryDBConnectorConnection ConnectorLaravelConnection ConnectionPDO API  Illuminate\Database\DatabaseServiceProvider.php 123456789101112131415namespace Illuminate\Database;class DatabaseServiceProvider extends ServiceProvider&#123; public function register() &#123; Model::clearBootedModels(); $this-&gt;registerConnectionServices(); $this-&gt;registerEloquentFactory(); $this-&gt;registerQueueableEntityResolver(); &#125;&#125; Model::clearBootedModels()EloquentEloquent Model$bootedmodelEloquent$booted Illuminate\Database\Eloquent\Model.php 123456789101112131415161718192021222324252627282930namespace Illuminate\Database\Eloquent;abstract class Model implements Arrayable, ArrayAccess, Jsonable, JsonSerializable, QueueableEntity, UrlRoutable&#123; /** *  * * @var array */ protected static $booted = []; /** * The array of global scopes on the model. * * @var array */ protected static $globalScopes = []; /** *  * * @return void */ public static function clearBootedModels() &#123; static::$booted = []; static::$globalScopes = []; &#125;&#125; ConnectionServicesEloquent ConnectionServices Illuminate\Database\DatabaseServiceProvider.php 12345678910111213141516171819202122232425262728namespace Illuminate\Database;class DatabaseServiceProvider extends ServiceProvider&#123; /** *  * * @return void */ protected function registerConnectionServices() &#123; // ConnectionFactory // manager $this-&gt;app-&gt;singleton('db.factory', function ($app) &#123; return new ConnectionFactory($app); &#125;); // DatabaseManager //  $this-&gt;app-&gt;singleton('db', function ($app) &#123; return new DatabaseManager($app, $app['db.factory']); &#125;); $this-&gt;app-&gt;bind('db.connection', function ($app) &#123; return $app['db']-&gt;connection(); &#125;); &#125;&#125; IoCdbdb.factorydb.connection dbFacadeDBDB::connection()DB::select()DB db.factoryDBconnectorDBconnection db.connectionLaravelpdo Eloquent12345678910111213141516171819202122namespace Illuminate\Database;class DatabaseServiceProvider extends ServiceProvider&#123; /** * Eloquent * * @return void */ protected function registerEloquentFactory() &#123; $this-&gt;app-&gt;singleton(FakerGenerator::class, function ($app, $parameters) &#123; return FakerFactory::create($parameters['locale'] ?? $app['config']-&gt;get('app.faker_locale', 'en_US')); &#125;); $this-&gt;app-&gt;singleton(EloquentFactory::class, function ($app) &#123; return EloquentFactory::construct( $app-&gt;make(FakerGenerator::class), $this-&gt;app-&gt;databasePath('factories') ); &#125;); &#125;&#125; EloquentFactoryEloquent Modelfactory() 1234567891011/** *  * * @return void */public function boot()&#123; Model::setConnectionResolver($this-&gt;app['db']); Model::setEventDispatcher($this-&gt;app['events']);&#125; Eloquent Modelconnection resolvermodeldbdispatcher DatabaseManager-Laravel.envnginxDBpdopdo DBIlluminate\Database\DatabaseManager 1234567891011121314namespace Illuminate\Database;class DatabaseManager implements ConnectionResolverInterface&#123; public function __construct($app, ConnectionFactory $factory) &#123; $this-&gt;app = $app; $this-&gt;factory = $factory; $this-&gt;reconnector = function ($connection) &#123; $this-&gt;reconnect($connection-&gt;getName()); &#125;; &#125;&#125; DBDBIlluminate\Database\Connectors\ConnectorIlluminate\Database\ConnectionconnectorconnectionDB DBconnectorconnectionConnectionFactoryDBconnectionDB$connectionsconnectionconnector 12345678910111213namespace Illuminate\Database;class DatabaseManager implements ConnectionResolverInterface&#123; protected $app; protected $factory; protected $connections = []; public function __call($method, $parameters) &#123; return $this-&gt;connection()-&gt;$method(...$parameters); &#125;&#125; DBconnectionDB::select()DB::table(user)-&gt;save()connection connection-123456789101112131415161718192021222324252627282930313233343536373839namespace Illuminate\Database;use Illuminate\Database\Connectors\ConnectionFactory;use Illuminate\Support\Arr;use Illuminate\Support\ConfigurationUrlParser;use Illuminate\Support\Str;use InvalidArgumentException;use PDO;/** * @mixin \Illuminate\Database\Connection */class DatabaseManager implements ConnectionResolverInterface&#123; /** *  * * @param string|null $name * @return \Illuminate\Database\Connection */ public function connection($name = null) &#123; [$database, $type] = $this-&gt;parseConnectionName($name); $name = $name ?: $database; //  // PDOfetch mode if (! isset($this-&gt;connections[$name])) &#123; $this-&gt;connections[$name] = $this-&gt;configure( $this-&gt;makeConnection($database), $type ); &#125; return $this-&gt;connections[$name]; &#125;&#125;  DBconnectionconfig/database connection   Connection 123456789101112131415161718192021222324252627282930313233343536373839namespace Illuminate\Database;use Illuminate\Database\Connectors\ConnectionFactory;use Illuminate\Support\Arr;use Illuminate\Support\ConfigurationUrlParser;use Illuminate\Support\Str;use InvalidArgumentException;use PDO;/** * @mixin \Illuminate\Database\Connection */class DatabaseManager implements ConnectionResolverInterface&#123; /** * / * * @param string $name * @return array */ protected function parseConnectionName($name) &#123; $name = $name ?: $this-&gt;getDefaultConnection(); return Str::endsWith($name, ['::read', '::write']) ? explode('::', $name, 2) : [$name, null]; &#125; /** *  * * @return string */ public function getDefaultConnection() &#123; return $this-&gt;app['config']['database.default']; &#125;&#125; config/databasedefaultmysql::read makeConnection-makeConnection 123456789101112131415161718192021222324252627/** * make * * @param string $name * @return \Illuminate\Database\Connection */protected function makeConnection($name)&#123; $config = $this-&gt;configuration($name); //  // Closure if (isset($this-&gt;extensions[$name])) &#123; return call_user_func($this-&gt;extensions[$name], $config, $name); &#125; //  // Closure // if (isset($this-&gt;extensions[$driver = $config['driver']])) &#123; return call_user_func($this-&gt;extensions[$driver], $config, $name); &#125; return $this-&gt;factory-&gt;make($config, $name);&#125; connection factoryconnection  123456789101112131415161718192021222324/** *  * * @param string $name * @return array * * @throws \InvalidArgumentException */protected function configuration($name)&#123; $name = $name ?: $this-&gt;getDefaultConnection(); //  //  $connections = $this-&gt;app['config']['database.connections']; if (is_null($config = Arr::get($connections, $name))) &#123; throw new InvalidArgumentException("Database connection [&#123;$name&#125;] not configured."); &#125; return (new ConfigurationUrlParser) -&gt;parseConfiguration($config);&#125;  123456789101112131415161718192021'connections' =&gt; [ 'mysql' =&gt; [ 'driver' =&gt; 'mysql', 'host' =&gt; env('DB_HOST', '127.0.0.1'), 'port' =&gt; env('DB_PORT', '3306'), 'database' =&gt; env('DB_DATABASE', 'forge'), 'username' =&gt; env('DB_USERNAME', 'forge'), 'password' =&gt; env('DB_PASSWORD', ''), 'charset' =&gt; 'utf8mb4', 'collation' =&gt; 'utf8mb4_unicode_ci', 'prefix' =&gt; '', 'strict' =&gt; true, 'engine' =&gt; null, 'read' =&gt; [ 'database' =&gt; env('DB_DATABASE', 'forge'), ], 'write' =&gt; [ 'database' =&gt; env('DB_DATABASE', 'forge'), ], ],], $this-&gt;factory-&gt;make($config, $name) configure-connection factoryconnection 1234567891011121314151617181920212223242526/** *  * * @param \Illuminate\Database\Connection $connection * @param string $type * @return \Illuminate\Database\Connection */protected function configure(Connection $connection, $type)&#123; $connection = $this-&gt;setPdoForType($connection, $type); //  //  //  if ($this-&gt;app-&gt;bound('events')) &#123; $connection-&gt;setEventDispatcher($this-&gt;app['events']); &#125; // reconnector //  // Closure //  $connection-&gt;setReconnector($this-&gt;reconnector); return $connection;&#125; setPdoForTypetype readread-pdopdowritepdowrite-pdo 1234567891011121314151617181920/** * / * * @param \Illuminate\Database\Connection $connection * @param string|null $type * @return \Illuminate\Database\Connection */protected function setPdoForType(Connection $connection, $type = null)&#123; if ($type === 'read') &#123; $connection-&gt;setPdo($connection-&gt;getReadPdo()); &#125; elseif ($type === 'write') &#123; $connection-&gt;setReadPdo($connection-&gt;getPdo()); &#125; return $connection;&#125; ConnectionFactory- make-ConnectionFactoryconnection 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?phpnamespace Illuminate\Database\Connectors;use Illuminate\Contracts\Container\Container;use Illuminate\Database\Connection;use Illuminate\Database\MySqlConnection;use Illuminate\Database\PostgresConnection;use Illuminate\Database\SQLiteConnection;use Illuminate\Database\SqlServerConnection;use Illuminate\Support\Arr;use InvalidArgumentException;use PDOException;class ConnectionFactory&#123; /** * PDO * * @param array $config * @param string|null $name * @return \Illuminate\Database\Connection */ public function make(array $config, $name = null) &#123; $config = $this-&gt;parseConfig($config, $name); if (isset($config['read'])) &#123; return $this-&gt;createReadWriteConnection($config); &#125; return $this-&gt;createSingleConnection($config); &#125; /** *  * * @param array $config * @param string $name * @return array */ protected function parseConfig(array $config, $name) &#123; return Arr::add(Arr::add($config, 'prefix', ''), 'name', $name); &#125;&#125; prefixname createReadWriteConnectionconnectioncreateSingleConnection createSingleConnection-createSingleConnectionConnectionFactory 1234567891011121314/** *  * * @param array $config * @return \Illuminate\Database\Connection */protected function createSingleConnection(array $config)&#123; $pdo = $this-&gt;createPdoResolver($config); return $this-&gt;createConnection( $config['driver'], $pdo, $config['database'], $config['prefix'], $config );&#125; ConnectionFactorypdoconnection createPdoResolver-host 123456789101112/** * ClosurePDO * * @param array $config * @return \Closure */protected function createPdoResolver(array $config)&#123; return array_key_exists('host', $config) ? $this-&gt;createPdoResolverWithHosts($config) : $this-&gt;createPdoResolverWithoutHosts($config);&#125; hostpdo 123456789101112/** * ClosurePDO * * @param array $config * @return \Closure */protected function createPdoResolverWithoutHosts(array $config)&#123; return function () use ($config) &#123; return $this-&gt;createConnector($config)-&gt;connect($config); &#125;;&#125; pdoconnectorconnector hostpdo 12345678910111213141516171819202122232425262728293031323334353637383940414243444546/** * ClosurePDO * * @param array $config * @return \Closure */protected function createPdoResolverWithHosts(array $config)&#123; return function () use ($config) &#123; foreach (Arr::shuffle($hosts = $this-&gt;parseHosts($config)) as $key =&gt; $host) &#123; $config['host'] = $host; try &#123; return $this-&gt;createConnector($config)-&gt;connect($config); &#125; catch (PDOException $e) &#123; continue; &#125; &#125; throw $e; &#125;;&#125;/** *  * * @param array $config * @return array * * @throws \InvalidArgumentException */protected function parseHosts(array $config)&#123; $hosts = Arr::wrap($config['host']); if (empty($hosts)) &#123; throw new InvalidArgumentException('Database hosts array is empty.'); &#125; return $hosts;&#125; host createConnector-driverconnector 12345678910111213141516171819202122232425262728293031323334/** *  * * @param array $config * @return \Illuminate\Database\Connectors\ConnectorInterface * * @throws \InvalidArgumentException */public function createConnector(array $config)&#123; if (! isset($config['driver'])) &#123; throw new InvalidArgumentException('A driver must be specified.'); &#125; if ($this-&gt;container-&gt;bound($key = "db.connector.&#123;$config['driver']&#125;")) &#123; return $this-&gt;container-&gt;make($key); &#125; switch ($config['driver']) &#123; case 'mysql': return new MySqlConnector; case 'pgsql': return new PostgresConnector; case 'sqlite': return new SQLiteConnector; case 'sqlsrv': return new SqlServerConnector; &#125; throw new InvalidArgumentException("Unsupported driver [&#123;$config['driver']&#125;]");&#125; createConnection-123456789101112131415161718192021222324252627282930313233/** *  * * @param string $driver * @param \PDO|\Closure $connection * @param string $database * @param string $prefix * @param array $config * @return \Illuminate\Database\Connection * * @throws \InvalidArgumentException */protected function createConnection($driver, $connection, $database, $prefix = '', array $config = [])&#123; if ($resolver = Connection::getResolver($driver)) &#123; return $resolver($connection, $database, $prefix, $config); &#125; switch ($driver) &#123; case 'mysql': return new MySqlConnection($connection, $database, $prefix, $config); case 'pgsql': return new PostgresConnection($connection, $database, $prefix, $config); case 'sqlite': return new SQLiteConnection($connection, $database, $prefix, $config); case 'sqlsrv': return new SqlServerConnection($connection, $database, $prefix, $config); &#125; throw new InvalidArgumentException("Unsupported driver [&#123;$driver&#125;]");&#125; pdoconnectionconnection createReadWriteConnection-readwrite 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** *  * * @param array $config * @return \Illuminate\Database\Connection */protected function createReadWriteConnection(array $config)&#123; $connection = $this-&gt;createSingleConnection($this-&gt;getWriteConfig($config)); return $connection-&gt;setReadPdo($this-&gt;createReadPdo($config));&#125;/** * / * * @param array $config * @return array */protected function getWriteConfig(array $config)&#123; return $this-&gt;mergeReadWriteConfig( $config, $this-&gt;getReadWriteConfig($config, 'write') );&#125;/** * / * * @param array $config * @param string $type * @return array */protected function getReadWriteConfig(array $config, $type)&#123; return isset($config[$type][0]) ? Arr::random($config[$type]) : $config[$type];&#125;/** * / * * @param array $config * @param array $merge * @return array */protected function mergeReadWriteConfig(array $config, array $merge)&#123; return Arr::except(array_merge($config, $merge), ['read', 'write']);&#125; writereadcreateSingleConnection readreadpdosetReadPdopdo 1234567891011121314151617181920212223/** * PDO * * @param array $config * @return \Closure */protected function createReadPdo(array $config)&#123; return $this-&gt;createPdoResolver($this-&gt;getReadConfig($config));&#125;/** * / * * @param array $config * @return array */protected function getReadConfig(array $config)&#123; return $this-&gt;mergeReadWriteConfig( $config, $this-&gt;getReadWriteConfig($config, 'read') );&#125; ConnectorMySQL 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpnamespace Illuminate\Database\Connectors;use PDO;class MySqlConnector extends Connector implements ConnectorInterface&#123; /** *  * * @param array $config * @return \PDO */ public function connect(array $config) &#123; $dsn = $this-&gt;getDsn($config); $options = $this-&gt;getOptions($config); // PDO // PDO $connection = $this-&gt;createConnection($dsn, $config, $options); if (! empty($config['database'])) &#123; $connection-&gt;exec("use `&#123;$config['database']&#125;`;"); &#125; $this-&gt;configureEncoding($connection, $config); //  //  //  $this-&gt;configureTimezone($connection, $config); $this-&gt;setModes($connection, $config); return $connection; &#125;&#125; getDsn-DSN123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * DSN * *  unix_socketsockethost/port * * @param array $config * @return string */protected function getDsn(array $config)&#123; return $this-&gt;hasSocket($config) ? $this-&gt;getSocketDsn($config) : $this-&gt;getHostDsn($config);&#125;/** * UNIX * * @param array $config * @return bool */protected function hasSocket(array $config)&#123; return isset($config['unix_socket']) &amp;&amp; ! empty($config['unix_socket']);&#125;/** * DSN * * @param array $config * @return string */protected function getSocketDsn(array $config)&#123; return "mysql:unix_socket=&#123;$config['unix_socket']&#125;;dbname=&#123;$config['database']&#125;";&#125;/** * /DSN * * @param array $config * @return string */protected function getHostDsn(array $config)&#123; extract($config, EXTR_SKIP); return isset($port) ? "mysql:host=&#123;$host&#125;;port=&#123;$port&#125;;dbname=&#123;$database&#125;" : "mysql:host=&#123;$host&#125;;dbname=&#123;$database&#125;";&#125; mysqltcpsocket sockettcpsockettcp getOptions-pdo12345678910111213141516171819202122232425/** * PDO * * @var array */protected $options = [ PDO::ATTR_CASE =&gt; PDO::CASE_NATURAL, PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION, PDO::ATTR_ORACLE_NULLS =&gt; PDO::NULL_NATURAL, PDO::ATTR_STRINGIFY_FETCHES =&gt; false, PDO::ATTR_EMULATE_PREPARES =&gt; false,];/** * PDO * * @param array $config * @return array */public function getOptions(array $config)&#123; $options = $config['options'] ?? []; return array_diff_key($this-&gt;options, $options) + $options;&#125; pdo PDO::ATTR_CASE$value PDO::CASE_LOWER PDO::CASE_NATURAL PDO::CASE_UPPER PDO::ATTR_ERRMODE$value PDO::ERRMODE_SILENT PDO::ERRMODE_WARNINGE_WARNING PDO::ERRMODE_EXCEPTIONexceptions PDO::ATTR_ORACLE_NULLSOracleNULL$value: PDO::NULL_NATURAL PDO::NULL_EMPTY_STRINGNULL PDO::NULL_TO_STRINGNULL PDO::ATTR_STRINGIFY_FETCHES PDO::ATTR_EMULATE_PREPARES PDOTRUEFALSE bool PDO::ATTR_AUTOCOMMITMySQLSQL PDO::ATTR_PERSISTENTMySQL. createConnection-12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/** * PDO * * @param string $dsn * @param array $config * @param array $options * @return \PDO * * @throws \Exception */public function createConnection($dsn, array $config, array $options)&#123; [ $username, $password ] = [ $config['username'] ?? null, $config['password'] ?? null, ]; try &#123; return $this-&gt;createPdoConnection( $dsn, $username, $password, $options ); &#125; catch (Exception $e) &#123; return $this-&gt;tryAgainIfCausedByLostConnection( $e, $dsn, $username, $password, $options ); &#125;&#125;/** * PDO * * @param string $dsn * @param string $username * @param string $password * @param array $options * @return \PDO */protected function createPdoConnection($dsn, $username, $password, $options)&#123; if (class_exists(PDOConnection::class) &amp;&amp; ! $this-&gt;isPersistentConnection($options)) &#123; return new PDOConnection($dsn, $username, $password, $options); &#125; return new PDO($dsn, $username, $password, $options);&#125; pdopdo pdo 12345678910111213141516171819202122/** *  * * @param \Illuminate\Database\QueryException $e * @param string $query * @param array $bindings * @param \Closure $callback * @return mixed * * @throws \Illuminate\Database\QueryException */protected function tryAgainIfCausedByLostConnection(QueryException $e, $query, $bindings, Closure $callback)&#123; if ($this-&gt;causedByLostConnection($e-&gt;getPrevious())) &#123; $this-&gt;reconnect(); return $this-&gt;runQueryCallback($query, $bindings, $callback); &#125; throw $e;&#125; Illuminate\Database\DetectsLostConnections.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?phpnamespace Illuminate\Database;use Illuminate\Support\Str;use Throwable;trait DetectsLostConnections&#123; /** *  * * @param \Throwable $e * @return bool */ protected function causedByLostConnection(Throwable $e) &#123; $message = $e-&gt;getMessage(); return Str::contains($message, [ 'server has gone away', 'no connection to the server', 'Lost connection', 'is dead or not enabled', 'Error while sending', 'decryption failed or bad record mac', 'server closed the connection unexpectedly', 'SSL connection has been closed unexpectedly', 'Error writing data to the connection', 'Resource deadlock avoided', 'Transaction() on null', 'child connection forced to terminate due to client_idle_limit', 'query_wait_timeout', 'reset by peer', 'Physical connection is not usable', 'TCP Provider: Error code 0x68', 'ORA-03114', 'Packets out of order. Expected', 'Adaptive Server connection failed', 'Communication link failure', 'connection is no longer usable', 'Login timeout expired', 'Connection refused', 'running with the --read-only option so it cannot execute this statement', ]); &#125;&#125;  configureEncoding-123456789101112131415161718192021222324252627/** *  * * @param \PDO $connection * @param array $config * @return void */protected function configureEncoding($connection, $config)&#123; if (! isset($config['charset'])) &#123; return; &#125; $connection-&gt;prepare("set names '&#123;$config['charset']&#125;'")-&gt;execute();&#125;/** *  * * @param array $config * @return string */protected function getCollation(array $config)&#123; return isset($config['collation']) ? " collate '&#123;$config['collation']&#125;'" : '';&#125;  mysqlcharacter setcollation configureTimezone-12345678910111213/** *  * * @param \PDO $connection * @param array $config * @return void */protected function configureTimezone($connection, array $config)&#123; if (isset($config['timezone'])) &#123; $connection-&gt;prepare('set time_zone="'.$config['timezone'].'"')-&gt;execute(); &#125;&#125; setModes-SQL_MODE12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/** *  * * @param \PDO $connection * @param array $config * @return void */protected function setModes(PDO $connection, array $config)&#123; if (isset($config['modes'])) &#123; $this-&gt;setCustomModes($connection, $config); &#125; elseif (isset($config['strict'])) &#123; if ($config['strict']) &#123; $connection-&gt;prepare($this-&gt;strictMode($connection))-&gt;execute(); &#125; else &#123; $connection-&gt;prepare("set session sql_mode='NO_ENGINE_SUBSTITUTION'")-&gt;execute(); &#125; &#125;&#125;/** *  * * @param \PDO $connection * @param array $config * @return void */protected function setCustomModes(PDO $connection, array $config)&#123; $modes = implode(',', $config['modes']); $connection-&gt;prepare("set session sql_mode='&#123;$modes&#125;'")-&gt;execute();&#125;/** *  * * @param \PDO $connection * @return string */protected function strictMode(PDO $connection)&#123; if (version_compare($connection-&gt;getAttribute(PDO::ATTR_SERVER_VERSION), '8.0.11') &gt;= 0) &#123; return "set session sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'"; &#125; return "set session sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'";&#125; mysqlsql_mode: SQL_MODEsqlsql_modesqlMySQL sql_mode MySQLsql-mode=modes MySQLmy.cnfmy.inisql-mode=modes SQL mode12SET GLOBAL sql_mode = &apos;modes&apos;;SET SESSION sql_mode = &apos;modes&apos;; mode ONLY_FULL_GROUP_BYselectHAVINGORDER BYGROUP BYGROUP BY NO_AUTO_VALUE_ON_ZERO0NULL0 STRICT_TRANS_TABLES NO_ZERO_IN_DATE02016-01-000000-02-01strict mode1 NO_ZERO_DATEmysqlstrict mode ERROR_FOR_DIVISION_BY_ZEROINSERTUPDATEMySQLNULL NO_AUTO_CREATE_USERGRANT NO_ENGINE_SUBSTITUTION PIPES_AS_CONCAT||OracleConcat ANSI_QUOTESANSI_QUOTES]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel HTTP-]]></title>
    <url>%2F2020%2F05%2F22%2FLaravel-HTTP-%E8%B7%AF%E7%94%B1%E5%8A%A0%E8%BD%BD%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ Laravelrouterequestroute routeLaravelhttprequest route-RoutingServiceProvidercontainer route-RouteServiceProviderrequest route-RoutingServiceProviderLaravelindex.php 123require __DIR__.'/../vendor/autoload.php';$app = require_once __DIR__.'/../bootstrap/app.php'; PSR0PSR4Container 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;?php/*|--------------------------------------------------------------------------| Create The Application|--------------------------------------------------------------------------|| The first thing we will do is create a new Laravel application instance| which serves as the "glue" for all the components of Laravel, and is| the IoC container for the system binding all of the various parts.|*/$app = new Illuminate\Foundation\Application( $_ENV['APP_BASE_PATH'] ?? dirname(__DIR__));/*|--------------------------------------------------------------------------| Bind Important Interfaces|--------------------------------------------------------------------------|| Next, we need to bind some important interfaces into the container so| we will be able to resolve them when needed. The kernels serve the| incoming requests to this application from both the web and CLI.|*/$app-&gt;singleton( Illuminate\Contracts\Http\Kernel::class, App\Http\Kernel::class);$app-&gt;singleton( Illuminate\Contracts\Console\Kernel::class, App\Console\Kernel::class);$app-&gt;singleton( Illuminate\Contracts\Debug\ExceptionHandler::class, App\Exceptions\Handler::class);/*|--------------------------------------------------------------------------| Return The Application|--------------------------------------------------------------------------|| This script returns the application instance. The instance is given to| the calling script so we can separate the building of the instances| from the actual running of the application and sending responses.|*/return $app; Application 123456789101112131415161718192021namespace Illuminate\Foundation;class Application extends Container implements ApplicationContract, CachesConfiguration, CachesRoutes, HttpKernelInterface&#123; /** * Create a new Illuminate application instance. * * @param string|null $basePath * @return void */ public function __construct($basePath = null) &#123; if ($basePath) &#123; $this-&gt;setBasePath($basePath); &#125; $this-&gt;registerBaseBindings(); $this-&gt;registerBaseServiceProviders(); $this-&gt;registerCoreContainerAliases(); &#125;&#125; registerBaseServiceProviders() 1234567891011/** * Register all of the base service providers. * * @return void */protected function registerBaseServiceProviders()&#123; $this-&gt;register(new EventServiceProvider($this)); $this-&gt;register(new LogServiceProvider($this)); $this-&gt;register(new RoutingServiceProvider($this));&#125; RoutingServiceProvider 123456789101112131415161718192021222324namespace Illuminate\Routing;class RoutingServiceProvider extends ServiceProvider&#123; public function register() &#123; $this-&gt;registerRouter(); ... &#125; /** * Register the router instance. * * @return void */ protected function registerRouter() &#123; $this-&gt;app-&gt;singleton('router', function ($app) &#123; return new Router($app['events'], $app); &#125;); &#125; ...&#125; RoutingServiceProviderrouter route-RouteServiceProviderLaravelApplicationhttp/Kernel 12345$kernel = $app-&gt;make(Illuminate\Contracts\Http\Kernel::class);$response = $kernel-&gt;handle( $request = Illuminate\Http\Request::capture()); handleLaravelrequest 1234567891011121314151617181920public function handle($request)&#123; try &#123; $request-&gt;enableHttpMethodParameterOverride(); $response = $this-&gt;sendRequestThroughRouter($request); &#125; return $response;&#125;protected function sendRequestThroughRouter($request)&#123; $this-&gt;app-&gt;instance('request', $request); Facade::clearResolvedInstance('request'); $this-&gt;bootstrap();// return (new Pipeline($this-&gt;app))// -&gt;send($request) -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [ ] : $this-&gt;middleware) -&gt;then($this-&gt;dispatchToRouter());&#125; bootstrap RouteServiceProvider-register-boot routeRoutingServiceProviderRouteServiceProviderregisterboot 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849namespace Illuminate\Foundation\Support\Providers;class RouteServiceProvider extends ServiceProvider&#123; /** * Bootstrap any application services. * * @return void */ public function boot() &#123; $this-&gt;setRootControllerNamespace(); if ($this-&gt;routesAreCached()) &#123; $this-&gt;loadCachedRoutes(); &#125; else &#123; $this-&gt;loadRoutes(); $this-&gt;app-&gt;booted(function () &#123; $this-&gt;app['router']-&gt;getRoutes()-&gt;refreshNameLookups(); $this-&gt;app['router']-&gt;getRoutes()-&gt;refreshActionLookups(); &#125;); &#125; &#125; /** * Load the cached routes for the application. * * @return void */ protected function loadCachedRoutes() &#123; $this-&gt;app-&gt;booted(function () &#123; require $this-&gt;app-&gt;getCachedRoutesPath(); &#125;); &#125; /** * Load the application routes. * * @return void */ protected function loadRoutes() &#123; if (method_exists($this, 'map')) &#123; $this-&gt;app-&gt;call([$this, 'map']); &#125; &#125;&#125; 12345678910111213141516171819202122class Application extends Container implements ApplicationContract, CachesConfiguration, CachesRoutes, HttpKernelInterface&#123; /** * Determine if the application routes are cached. * * @return bool */ public function routesAreCached() &#123; return $this['files']-&gt;exists($this-&gt;getCachedRoutesPath()); &#125; /** * Get the path to the routes cache file. * * @return string */ public function getCachedRoutesPath() &#123; return $this-&gt;normalizeCachePath('APP_ROUTES_CACHE', 'cache/routes-v7.php'); &#125;&#125; bootLaravelbootstrap/cache/routes.php mapApp\Providers\RouteServiceProviderIlluminate\Foundation\Support\Providers\RouteServiceProvider 1234567891011121314151617181920212223242526use Illuminate\Foundation\Support\Providers\RouteServiceProvider as ServiceProvider;class RouteServiceProvider extends ServiceProvider&#123; public function map() &#123; $this-&gt;mapApiRoutes(); $this-&gt;mapWebRoutes(); // &#125; protected function mapWebRoutes() &#123; Route::middleware('web') -&gt;namespace($this-&gt;namespace) -&gt;group(base_path('routes/web.php')); &#125; protected function mapApiRoutes() &#123; Route::prefix('api') -&gt;middleware('api') -&gt;namespace($this-&gt;namespace) -&gt;group(base_path('routes/api.php')); &#125;&#125; Laravelapiwebroutes/web.phproutes/api.php namedomainscheme Laravel 123Route::domain('route.domain.name')-&gt;group(function() &#123; Route::get('foo','controller@method');&#125;)  123Route::group('domain' =&gt; 'group.domain.name',function() &#123; Route::get('foo','controller@method');&#125;) method 1Route::domain('route.domain.name')-&gt;get('foo','controller@method'); method 1Route::get('foo', ['domain' =&gt; 'route.domain.name','use' =&gt; 'controller@method']); method 1Route::get('&#123;one&#125;', 'use' =&gt; 'controller@method')-&gt;where('one', '(.+)');  Illuminate\Routing\RouterIlluminate\Routing\RouteIlluminate\Routing\RouteRegistrar RouterRouteRegistrargroupmethodroutegroupmethod RouteRegistrarRoutedomain()name()router__call() 123456789101112131415161718192021222324namespace Illuminate\Routing;class Router implements BindingRegistrar, RegistrarContract&#123; /** * Dynamically handle calls into the router instance. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; if (static::hasMacro($method)) &#123; return $this-&gt;macroCall($method, $parameters); &#125; if ($method === 'middleware') &#123; return (new RouteRegistrar($this))-&gt;attribute($method, is_array($parameters[0]) ? $parameters[0] : $parameters); &#125; return (new RouteRegistrar($this))-&gt;attribute($method, $parameters[0]); &#125;&#125; RouteRegistrar 12345678910111213141516171819202122232425262728293031class RouteRegistrar&#123; /** * The attributes that can be set through this class. * * @var array */ protected $allowedAttributes = [ 'as', 'domain', 'middleware', 'name', 'namespace', 'prefix', 'where', ]; /** * Set the value for a given attribute. * * @param string $key * @param mixed $value * @return $this * * @throws \InvalidArgumentException */ public function attribute($key, $value) &#123; if (! in_array($key, $this-&gt;allowedAttributes)) &#123; throw new InvalidArgumentException("Attribute [&#123;$key&#125;] does not exist."); &#125; $this-&gt;attributes[Arr::get($this-&gt;aliases, $key, $key)] = $value; return $this; &#125;&#125; uriuriuriuri 123456789Route::as('Foo')-&gt;namespace('Namespace\\Example\\')-&gt;get('foo/bar'); // uriRoute::as('Foo')-&gt;namespace('Namespace\\Example\\')-&gt;get('foo/bar', function () &#123;&#125;); // uriRoute::as('Foo')-&gt;namespace('Namespace\\Example\\')-&gt;get('foo/bar', 'controller@method');// uriRoute::as('Foo')-&gt;namespace('Namespace\\Example\\')-&gt;get('foo/bar', ['as'=&gt; 'foo','use' =&gt;'controller@method']) ;// uri getpostRouteRegistrar__call() Illuminate\Routing\RouteRegistrar.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576class RouteRegistrar&#123; /** * The methods to dynamically pass through to the router. * * @var array */ protected $passthru = [ 'get', 'post', 'put', 'patch', 'delete', 'options', 'any', ]; /** * Dynamically handle calls into the route registrar. * * @param string $method * @param array $parameters * @return \Illuminate\Routing\Route|$this * * @throws \BadMethodCallException */ public function __call($method, $parameters) &#123; if (in_array($method, $this-&gt;passthru)) &#123; return $this-&gt;registerRoute($method, ...$parameters); &#125; if (in_array($method, $this-&gt;allowedAttributes)) &#123; if ($method === 'middleware') &#123; return $this-&gt;attribute($method, is_array($parameters[0]) ? $parameters[0] : $parameters); &#125; return $this-&gt;attribute($method, $parameters[0]); &#125; throw new BadMethodCallException(sprintf( 'Method %s::%s does not exist.', static::class, $method )); &#125; /** * Register a new route with the router. * * @param string $method * @param string $uri * @param \Closure|array|string|null $action * @return \Illuminate\Routing\Route */ protected function registerRoute($method, $uri, $action = null) &#123; if (! is_array($action)) &#123; $action = array_merge($this-&gt;attributes, $action ? ['uses' =&gt; $action] : []); &#125; return $this-&gt;router-&gt;&#123;$method&#125;($uri, $this-&gt;compileAction($action)); &#125; /** * Compile the action into an array including the attributes. * * @param \Closure|array|string|null $action * @return array */ protected function compileAction($action) &#123; if (is_null($action)) &#123; return $this-&gt;attributes; &#125; if (is_string($action) || $action instanceof Closure) &#123; $action = ['uses' =&gt; $action]; &#125; return array_merge($this-&gt;attributes, $action); &#125;&#125; RouteRegistraractionuserouter action 12345678910111213class RouteRegistrar&#123; /** * Create a route group with shared attributes. * * @param \Closure|string $callback * @return void */ public function group($callback) &#123; $this-&gt;router-&gt;group($this-&gt;attributes, $callback); &#125;&#125; Routergroupgroup Illuminate\Routing\Router.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;?phpnamespace Illuminate\Routing;/** * @mixin \Illuminate\Routing\RouteRegistrar */class Router implements BindingRegistrar, RegistrarContract&#123; /** * Create a route group with shared attributes. * * @param array $attributes * @param \Closure|string $routes * @return void */ public function group(array $attributes, $routes) &#123; $this-&gt;updateGroupStack($attributes); // Once we have updated the group stack, we'll load the provided routes and // merge in the group's attributes when the routes are created. After we // have created the routes, we will pop the attributes off the stack. $this-&gt;loadRoutes($routes); array_pop($this-&gt;groupStack); &#125; /** * Update the group stack with the given attributes. * * @param array $attributes * @return void */ protected function updateGroupStack(array $attributes) &#123; if ($this-&gt;hasGroupStack()) &#123; $attributes = $this-&gt;mergeWithLastGroup($attributes); &#125; $this-&gt;groupStack[] = $attributes; &#125; /** * Determine if the router currently has a group stack. * * @return bool */ public function hasGroupStack() &#123; return ! empty($this-&gt;groupStack); &#125; /** * Merge the given array with the last group stack. * * @param array $new * @param bool $prependExistingPrefix * @return array */ public function mergeWithLastGroup($new, $prependExistingPrefix = true) &#123; return RouteGroup::merge($new, end($this-&gt;groupStack), $prependExistingPrefix); &#125;&#125;  prefixasnamespaceprefix1/prefix2/prefix3 where domain middleware 123456789101112131415161718192021222324252627282930313233&lt;?phpnamespace Illuminate\Routing;use Illuminate\Support\Arr;class RouteGroup&#123; /** * Merge route groups into a new array. * * @param array $new * @param array $old * @param bool $prependExistingPrefix * @return array */ public static function merge($new, $old, $prependExistingPrefix = true) &#123; if (isset($new['domain'])) &#123; unset($old['domain']); &#125; $new = array_merge(static::formatAs($new, $old), [ 'namespace' =&gt; static::formatNamespace($new, $old), 'prefix' =&gt; static::formatPrefix($new, $old, $prependExistingPrefix), 'where' =&gt; static::formatWhere($new, $old), ]); return array_merge_recursive(Arr::except( $old, ['namespace', 'prefix', 'where', 'as'] ), $new); &#125;&#125; Router 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960class Router implements BindingRegistrar, RegistrarContract&#123; /** * Register a new GET route with the router. * * @param string $uri * @param array|string|callable|null $action * @return \Illuminate\Routing\Route */ public function get($uri, $action = null) &#123; return $this-&gt;addRoute(['GET', 'HEAD'], $uri, $action); &#125; /** * Add a route to the underlying route collection. * * @param array|string $methods * @param string $uri * @param array|string|callable|null $action * @return \Illuminate\Routing\Route */ public function addRoute($methods, $uri, $action) &#123; return $this-&gt;routes-&gt;add($this-&gt;createRoute($methods, $uri, $action)); &#125; /** * Create a new route instance. * * @param array|string $methods * @param string $uri * @param mixed $action * @return \Illuminate\Routing\Route */ protected function createRoute($methods, $uri, $action) &#123; // If the route is routing to a controller we will parse the route action into // an acceptable array format before registering it and creating this route // instance itself. We need to build the Closure that will call this out. if ($this-&gt;actionReferencesController($action)) &#123; $action = $this-&gt;convertToControllerAction($action); &#125; $route = $this-&gt;newRoute( $methods, $this-&gt;prefix($uri), $action ); // If we have groups that need to be merged, we will merge them now after this // route has already been created and is ready to go. After we're done with // the merge we will be ready to return the route back out to the caller. if ($this-&gt;hasGroupStack()) &#123; $this-&gt;mergeGroupAttributesIntoRoute($route); &#125; $this-&gt;addWhereClausesToRoute($route); return $route; &#125;&#125;  groupnamespace urigroupprefix   router-pattern RouteCollection namespace\App\Http\Controllers 123456789101112131415161718192021222324252627protected function actionReferencesController($action)&#123;if (! $action instanceof Closure) &#123;return is_string($action) || (isset($action['uses']) &amp;&amp;is_string($action['uses']));&#125;return false;&#125;protected function convertToControllerAction($action)&#123;if (is_string($action)) &#123;$action = ['uses' =&gt; $action];&#125;if (! empty($this-&gt;groupStack)) &#123;$action['uses'] = $this-&gt;prependGroupNamespace($action['uses']);&#125;$action['controller'] = $action['uses'];return $action;&#125;protected function prependGroupNamespace($class)&#123;$group = end($this-&gt;groupStack);return isset($group['namespace']) &amp;&amp; strpos($class, '\\') !== 0? $group['namespace'].'\\'.$class : $class;&#125; uriprefixuri 12345678910111213protected function prefix($uri)&#123;return trim(trim($this-&gt;getLastGroupPrefix(), '/').'/'.trim($uri, '/'), '/') ?: '/';&#125;public function getLastGroupPrefix()&#123;if (! empty($this-&gt;groupStack)) &#123;$last = end($this-&gt;groupStack);return isset($last['prefix']) ? $last['prefix'] : '';&#125;return '';&#125; Route 123456protected function newRoute($methods, $uri, $action)&#123;return (new Route($methods, $uri, $action))-&gt;setRouter($this)-&gt;setContainer($this-&gt;container);&#125; Router action 12345678public function hasGroupStack()&#123;return ! empty($this-&gt;groupStack);&#125;protected function mergeGroupAttributesIntoRoute($route)&#123;$route-&gt;setAction($this-&gt;mergeWithLastGroup($route-&gt;getAction()));&#125; pattern 1234567891011public function pattern($key, $pattern)&#123;$this-&gt;patterns[$key] = $pattern;&#125;protected function addWhereClausesToRoute($route)&#123;$route-&gt;where(array_merge($this-&gt;patterns, isset($route-&gt;getAction()['where']) ? $route-&gt;getAction()['where'] : []));return $route;&#125; RouteRoute 12345678910111213public function __construct($methods, $uri, $action)&#123;$this-&gt;uri = $uri;$this-&gt;methods = (array) $methods;$this-&gt;action = $this-&gt;parseAction($action);if (in_array('GET', $this-&gt;methods) &amp;&amp; ! in_array('HEAD', $this-&gt;methods)) &#123;$this-&gt;methods[] = 'HEAD';&#125;if (isset($this-&gt;action['prefix'])) &#123;$this-&gt;prefix($this-&gt;action['prefix']);&#125;&#125; actionprefix action 1234protected function parseAction($action)&#123;return RouteAction::parse($this-&gt;uri, $action);&#125; actionRouteAction 12345678910111213141516171819202122232425262728293031323334class RouteAction&#123;public static function parse($uri, $action)&#123;if (is_null($action)) &#123;return static::missingAction($uri);&#125;if (is_callable($action)) &#123;return ['uses' =&gt; $action];&#125;elseif (! isset($action['uses'])) &#123;$action['uses'] = static::findCallable($action);&#125;if (is_string($action['uses']) &amp;&amp; ! Str::contains($action['uses'], '@')) &#123;$action['uses'] = static::makeInvokable($action['uses']);&#125;return $action;&#125;protected static function findCallable(array $action)&#123;return Arr::first($action, function ($value, $key) &#123;return is_callable($value) &amp;&amp; is_numeric($key);&#125;);&#125;protected static function makeInvokable($action)&#123;if (! method_exists($action, '__invoke')) &#123;throw new UnexpectedValueException("Invalid route action: [&#123;$action&#125;].");&#125;return $action.'@__invoke';&#125;&#125;  123456789$router-&gt;get('foo/bar2', [domain =&gt; 'www.example.com', 'Illuminate\Tests\Routing\ActionStub']);class ActionStub&#123;public function __invoke()&#123;return 'hello';&#125;&#125; action useuseRouteruseuseactionuse __invoke use@makeInvokable__invoke prefixprefixprefixuri 123456public function prefix($prefix)&#123;$uri = rtrim($prefix, '/').'/'.ltrim($this-&gt;uri, '/');$this-&gt;uri = trim($uri, '/');return $this;&#125; RouteRouteRegistrarRoute prefix123456public function prefix($prefix)&#123;$uri = rtrim($prefix, '/').'/'.ltrim($this-&gt;uri, '/');$this-&gt;uri = trim($uri, '/');return $this;&#125; where123456789101112public function where($name, $expression = null)&#123;foreach ($this-&gt;parseWhere($name, $expression) as $name =&gt; $expression) &#123;$this-&gt;wheres[$name] = $expression;&#125;return $this;&#125;protected function parseWhere($name, $expression)&#123;return is_array($name) ? $name : [$name =&gt; $expression];&#125; middleware1234567891011121314public function middleware($middleware = null)&#123;if (is_null($middleware)) &#123;return (array) Arr::get($this-&gt;action, 'middleware', []);&#125;if (is_string($middleware)) &#123;$middleware = func_get_args();&#125;$this-&gt;action['middleware'] = array_merge((array) Arr::get($this-&gt;action, 'middleware', []), $middleware);return $this;&#125; uses1234567891011121314public function uses($action)&#123; $action = is_string($action) ? $this-&gt;addGroupNamespaceToStringUses($action) : $action; return $this-&gt;setAction( array_merge( $this-&gt;action, $this-&gt;parseAction([ 'uses' =&gt; $action, 'controller' =&gt; $action, ]) ) );&#125; name123456public function name($name)&#123; $this-&gt;action['as'] = isset($this-&gt;action['as']) ? $this-&gt;action['as'].$name : $name; return $this;&#125; RouteCollection 1234protected function addRoute($methods, $uri, $action)&#123; return $this-&gt;routes-&gt;add($this-&gt;createRoute($methods, $uri,$action));&#125; RouteCollectionroutesallRoutesnameListactionList 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&lt;?phpnamespace Illuminate\Routing;use Illuminate\Container\Container;use Illuminate\Http\Request;use Illuminate\Support\Arr;class RouteCollection extends AbstractRouteCollection&#123; /** * Add a Route instance to the collection. * * @param \Illuminate\Routing\Route $route * @return \Illuminate\Routing\Route */ public function add(Route $route) &#123; $this-&gt;addToCollections($route); $this-&gt;addLookups($route); return $route; &#125; /** * Add the given route to the arrays of routes. * * @param \Illuminate\Routing\Route $route * @return void */ protected function addToCollections($route) &#123; $domainAndUri = $route-&gt;getDomain().$route-&gt;uri(); foreach ($route-&gt;methods() as $method) &#123; $this-&gt;routes[$method][$domainAndUri] = $route; &#125; $this-&gt;allRoutes[$method.$domainAndUri] = $route; &#125; /** * Add the route to any look-up tables if necessary. * * @param \Illuminate\Routing\Route $route * @return void */ protected function addLookups($route) &#123; // If the route has a name, we will add it to the name look-up table so that we // will quickly be able to find any route associate with a name and not have // to iterate through every route every time we need to perform a look-up. if ($name = $route-&gt;getName()) &#123; $this-&gt;nameList[$name] = $route; &#125; // When the route is routing to a controller we will also store the action that // is used by the route. This will let us reverse route to controllers while // processing a request and easily generate URLs to the given controllers. $action = $route-&gt;getAction(); if (isset($action['controller'])) &#123; $this-&gt;addToActionList($action, $route); &#125; &#125; /** * Add a route to the controller action dictionary. * * @param array $action * @param \Illuminate\Routing\Route $route * @return void */ protected function addToActionList($action, $route) &#123; $this-&gt;actionList[trim($action['controller'], '\\')] = $route; &#125;&#125; namespace Illuminate\Foundation\Support\Providers\RouteServiceProviderboot 123456789101112public function boot()&#123;$this-&gt;setRootControllerNamespace();if ($this-&gt;app-&gt;routesAreCached()) &#123;$this-&gt;loadCachedRoutes();&#125; else &#123;$this-&gt;loadRoutes();$this-&gt;app-&gt;booted(function () &#123;$this-&gt;app['router']-&gt;getRoutes()-&gt;refreshNameLookups();&#125;);&#125;&#125; refreshNameLookupsnameRouteCollection: 1234567891011121314151617181920212223242526272829class RouteCollection extends AbstractRouteCollection&#123; /** * A flattened array of all of the routes. * * @var \Illuminate\Routing\Route[] */ protected $allRoutes = []; /** * Refresh the name look-up table. * * This is done in case any names are fluently defined or if routes are overwritten. * * @return void */ public function refreshNameLookups() &#123; $this-&gt;nameList = []; foreach ($this-&gt;allRoutes as $route) &#123; if ($route-&gt;getName()) &#123; $this-&gt;nameList[$route-&gt;getName()] = $route; &#125; &#125; &#125;&#125;  1234567891011121314public function testRouteCollectionCanRefreshNameLookups()&#123; $routeIndex = new Route('GET', 'foo/index', ['uses' =&gt; 'FooController@index',]); $this-&gt;assertNull($routeIndex-&gt;getName()); $this-&gt;routeCollection-&gt;add($routeIndex)-&gt;name('route_name'); $this-&gt;assertNull($this-&gt;routeCollection-&gt;getByName('route_name')); $this-&gt;routeCollection-&gt;refreshNameLookups(); $this-&gt;assertEquals($routeIndex, $this-&gt;routeCollection-&gt;getByName('route_name'));&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel HTTP-]]></title>
    <url>%2F2020%2F05%2F22%2FLaravel-HTTP-%E8%B7%AF%E7%94%B1%2F</url>
    <content type="text"><![CDATA[ web      RESTful routeapiLaravelrouteLaravel Laravelroutesroutes/web.phpwebwebsessioncsrfroutes/api.phpapi routes/web.php methodHTTP 123456Route::get($uri, $callback);Route::post($uri, $callback);Route::put($uri, $callback);Route::patch($uri, $callback);Route::delete($uri, $callback);Route::options($uri, $callback); HTTPmatchanyHTTP 1234567Route::match(['get', 'post'], '/', function () &#123; //&#125;);Route::any('foo', function () &#123; //&#125;); HTMLgetpostputpatchdelete_methodHTTP 1&lt;input type="hidden" name="_method" value="PUT"&gt; webPUTPOSTDELETEHTMLCSRFCSRFCSRF 1234&lt;form method="POST" action="/profile"&gt;&#123;&#123; csrf_field() &#125;&#125;...&lt;/form&gt; schemewebschemehttphttps 1234567Route::get('foo/&#123;bar&#125;', ['http', function () &#123;&#125;]);Route::get('foo/&#123;bar&#125;', ['https', function () &#123;&#125;]); domainURIdomain 1234567Route::domain('api.name.bar')-&gt;get('foo/bar', function ($name) &#123; return $name;&#125;);Route::get('foo/bar', ['domain' =&gt; 'api.name.bar', function ($name) &#123; return $name;&#125;]); prefixURIprefix 1234567891011Route::prefix('pre')-&gt;get('foo/bar', function () &#123;&#125;);Route::get('foo/bar', ['prefix' =&gt; 'pre', function () &#123;&#125;]);Route::get('foo/bar', function () &#123;&#125;)-&gt;prefix('pre'); whereURI 1234567Route::get('&#123;one&#125;', ['where' =&gt; ['one' =&gt; '(.+)'], function () &#123;&#125;]);Route::get('&#123;one&#125;', function () &#123;&#125;)-&gt;where('one', '(.+)'); patternRouteServiceProviderboot 12345public function boot()&#123; Route::pattern('one', '(.+)'); parent::boot();&#125; middlewaremiddleware 1234567891011Route::middleware('web')-&gt;get('foo/bar', function () &#123;&#125;);Route::get('foo/bar', ['middleware' =&gt; 'web', function () &#123;&#125;]);Route::get('foo/bar', function () &#123;&#125;)-&gt;middleware('web'); namespacenamespace 1234567Route::namespace('Namespace\\Example\\')-&gt;get('foo/bar', function () &#123;&#125;);Route::get('foo/bar', ['namespace' =&gt; 'Namespace\\Example\\', function () &#123;&#125;]); usesURI 123456789101112Route::get('foo/bar', ['uses' =&gt; function () &#123;&#125;]);Route::get('foo/bar', ['uses' =&gt; 'Illuminate\Tests\Routing\RouteTestControllerStub@index']);Route::get('foo/bar')-&gt;uses(function () &#123;&#125;);Route::get('foo/bar')-&gt;uses('Illuminate\Tests\Routing\RouteTestControllerStub@index'); asas 123456789101112131415Route::as('Foo')-&gt;get('foo/bar', function () &#123;&#125;);Route::name('Foo')-&gt;get('foo/bar', function () &#123;&#125;);Route::get('foo/bar', ['as' =&gt; 'Foo', function () &#123;&#125;]);Route::get('foo/bar', function () &#123;&#125;)-&gt;name('Foo'); groupgroup 12345678910111213141516171819202122232425262728293031323334353637383940414243Route::group( [ 'domain' =&gt; 'group.domain.name', 'prefix' =&gt; 'grouppre', 'where' =&gt; ['one' =&gt; '(.+)'], 'middleware' =&gt; 'groupMiddleware', 'namespace' =&gt; 'Namespace\\Group\\', 'as' =&gt; 'Group::', ],function () &#123; Route::get('/replace','domain' =&gt; 'route.domain.name','uses' =&gt; function ()&#123; return 'replace'; &#125;); Route::get('additional/&#123;one&#125;/&#123;two&#125;', 'prefix' =&gt; 'routepre','where' =&gt; ['one' =&gt; '([0-9]+)', 'two' =&gt; '(.+)'], 'middleware' =&gt; 'routeMiddleware', 'namespace' =&gt; 'Namespace\\Group\\', 'as' =&gt; 'Route', 'use' =&gt; function () &#123; return 'additional'; &#125;);&#125;);$this-&gt;assertEquals('replace', $router-&gt;dispatch(Request::create('http://route.domain.name/grouppre/replace', 'GET'))-&gt;getContent());$this-&gt;assertEquals('additional', $router-&gt;dispatch(Request::create('http://group.domain.name/routepre/grouppre/additional/111/add', 'GET'))-&gt;getContent());$routes = $router-&gt;getRoutes()-&gt;getRoutes();$action = $routes[0]-&gt;getAction();$this-&gt;assertEquals('Namespace\\Group\\', $action['namespace']);$this-&gt;assertEquals('Group::', $action['as']);$routes = $router-&gt;getRoutes()-&gt;getRoutes();$action = $routes[1]-&gt;getAction();$this-&gt;assertEquals(['groupMiddleware', 'routeMiddleware'], $action['middleware']);$this-&gt;assertEquals('Namespace\\Group\\Namespace\\Group\\', $action['namespace']);$this-&gt;assertEquals('Group::Route', $action['as']); group  domain prefixmiddlewarenamespaceaswhere  prefixuriroutepre/grouppre/additional/111/addgrouppre/routepre/additional/111/add wherewhereonetwo LaravelURIdomain URI: 123456789101112131415$router = $this-&gt;getRouter();$router-&gt;get('foo/bar/', function () &#123; return 'hello';&#125;);$this-&gt;assertEquals('hello', $router-&gt;dispatch(Request::create('foo/bar/%C3%A5%CE%B1%D1%84', 'GET'))-&gt;getContent());$router = $this-&gt;getRouter();$route = $router-&gt;get('foo/&#123;file&#125;', function ($file) &#123; return $file;&#125;);$this-&gt;assertEquals('oxygen%20', $router-&gt;dispatch(Request::create('http://test.com/foo/oxygen%2520', 'GET'))-&gt;getContent()); -_ 12345678910111213141516171819202122$router = $this-&gt;getRouter();$route = $router-&gt;get('foo/&#123;age&#125;', ['domain' =&gt; 'api.&#123;name&#125;.bar', function ($name, $age)&#123; return $name.$age;&#125;]);$this-&gt;assertEquals('taylor25', $router-&gt;dispatch(Request::create('http://api.taylor.bar/foo/25', 'GET'))-&gt;getContent());$route = new Route('GET', 'images/&#123;id&#125;.&#123;ext&#125;', function () &#123;&#125;);$request1 = Request::create('images/1.png', 'GET');$this-&gt;assertTrue($route-&gt;matches($request1));$route-&gt;bind($request1);$this-&gt;assertTrue($route-&gt;hasParameter('id'));$this-&gt;assertFalse($route-&gt;hasParameter('foo'));$this-&gt;assertEquals('1', $route-&gt;parameter('id'));$this-&gt;assertEquals('png', $route-&gt;parameter('ext')); ? 12345678910111213$router = $this-&gt;getRouter();$router-&gt;get('&#123;foo?&#125;/&#123;baz?&#125;', function ($name = 'taylor', $age = 25) &#123; return $name.$age;&#125;);$this-&gt;assertEquals('fred25', $router-&gt;dispatch(Request::create('fred', 'GET'))-&gt;getContent());$router-&gt;get('default/&#123;foo?&#125;/&#123;baz?&#125;', function ($name, $age = 25)&#123; return $name.$age;&#125;)-&gt;default('name', 'taylor');$this-&gt;assertEquals('fred25', $router-&gt;dispatch(Request::create('fred', 'GET'))-&gt;getContent()); wherewhere 123Route::get('user/&#123;name&#125;', function ($name) &#123; //&#125;)-&gt;where('name', '[A-Za-z]+'); patternRouteServiceProviderboot: 12345public function boot()&#123; Route::pattern('id', '[0-9]+'); parent::boot();&#125; / 1234567$router-&gt;get('&#123;one?&#125;', ['uses' =&gt; function ($one = null)&#123; return $one;&#125;]);$request2 = Request::create('foo/bar/baz', 'GET');$this-&gt;assertFalse($route-&gt;matches($request2)); onefoofoo/bar/bazone 123456789101112131415161718public function testLeadingParamDoesntReceiveForwardSlashOnEmptyPath()&#123; $router = $this-&gt;getRouter(); $router-&gt;get( '&#123;one?&#125;', [ 'uses' =&gt; function ($one = null)&#123; return $one; &#125;, 'where' =&gt; ['one' =&gt; '(.+)'], ] ); $this-&gt;assertEquals('foo', $router-&gt;dispatch(Request::create('/foo', 'GET'))-&gt;getContent()); $this-&gt;assertEquals('foo/bar/baz', $router-&gt;dispatch(Request::create('/foo/bar/baz', 'GET'))-&gt;getContent());&#125; HTTPHTTPLaravel LaravelCSRFapp/Http/Middleware // 123456789101112131415161718class BeforeMiddleware&#123; public function handle($request, Closure $next) &#123; //  return $next($request); &#125;&#125;class AfterMiddleware&#123; public function handle($request, Closure $next) &#123; $response = $next($request); //  return $response; &#125;&#125; HTTPLaravelsessionSessionterminate 123456789101112class StartSession&#123; public function handle($request, Closure $next) &#123; return $next($request); &#125; public function terminate($request, $response) &#123; // session... &#125;&#125; HTTPapp/Http/Kernel.php$middleware 1234567protected $middleware = [ \Illuminate\Foundation\Http\Middleware\CheckForMaintenanceMode::class, \Illuminate\Foundation\Http\Middleware\ValidatePostSize::class, \App\Http\Middleware\TrimStrings::class, \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class,];  12345use App\Http\Middleware\CheckAge;Route::get('admin/profile', function () &#123; //&#125;)-&gt;middleware(CheckAge::class);  1234567891011121314public function testDefinedClosureMiddleware()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/bar', ['middleware' =&gt; 'foo', function ()&#123; return 'hello'; &#125;]); $router-&gt;aliasMiddleware('foo', function ($request, $next) &#123; return 'caught'; &#125;); $this-&gt;assertEquals('caught', $router-&gt;dispatch(Request::create('foo/bar', 'GET'))-&gt;getContent());&#125; app/Http/Kernel.phpkey$routeMiddlewareLaravelkey 12345678910111213protected $routeMiddleware = [ 'auth' =&gt; \Illuminate\Auth\Middleware\Authenticate::class, 'auth.basic' =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class, 'bindings' =&gt; \Illuminate\Routing\Middleware\SubstituteBindings::class, 'can' =&gt; \Illuminate\Auth\Middleware\Authorize::class, 'guest' =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class, 'throttle' =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,];Route::get('admin/profile', function () &#123; //&#125;)-&gt;middleware('auth');  123Route::get('/', function () &#123; //&#125;)-&gt;middleware('first', 'second'); HTTP Kernel$middlewareGroups LaravelwebapiWeb UIAPI 12345678910111213141516171819protected $middlewareGroups = [ 'web' =&gt; [ \App\Http\Middleware\EncryptCookies::class, \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class, \Illuminate\Session\Middleware\StartSession::class, \Illuminate\View\Middleware\ShareErrorsFromSession::class, \App\Http\Middleware\VerifyCsrfToken::class, \Illuminate\Routing\Middleware\SubstituteBindings::class, ], 'api' =&gt; [ 'throttle:60,1', 'auth:api', ],];Route::get('/', function () &#123;//&#125;)-&gt;middleware('web');  12345678910111213141516171819202122public function testMiddlewareGroupsCanReferenceOtherGroups()&#123; unset($_SERVER['__middleware.group']); $router = $this-&gt;getRouter(); $router-&gt;get('foo/bar', ['middleware' =&gt; 'web', function ()&#123; return 'hello'; &#125;]); $router-&gt;aliasMiddleware('two', 'Illuminate\Tests\Routing\RoutingTestMiddlewareGroupTwo'); $router-&gt;middlewareGroup('first', ['two:abigail']); $router-&gt;middlewareGroup('web', ['Illuminate\Tests\Routing\RoutingTestMiddlewareGroupOne', 'first']); $this-&gt;assertEquals('caught abigail', $router-&gt;dispatch(Request::create('foo/bar', 'GET'))-&gt;getContent()); $this-&gt;assertTrue($_SERVER['__middleware.group']); unset($_SERVER['__middleware.group']);&#125; CheckRole $next 1234567891011121314151617181920namespace App\Http\Middleware;use Closure;class CheckRole&#123; public function handle($request, Closure $next, $role) &#123; if (! $request-&gt;user()-&gt;hasRole($role)) &#123; // Redirect... &#125; return $next($request); &#125;&#125;Route::put('post/&#123;id&#125;', function ($id) &#123; //&#125;)-&gt;middleware('role:editor'); router$middlewarePriority 123456789protected $middlewarePriority = [ \Illuminate\Session\Middleware\StartSession::class, \Illuminate\View\Middleware\ShareErrorsFromSession::class, \Illuminate\Auth\Middleware\Authenticate::class, \Illuminate\Session\Middleware\AuthenticateSession::class, \Illuminate\Routing\Middleware\SubstituteBindings::class, \Illuminate\Auth\Middleware\Authorize::class,];  1234567891011121314151617181920212223242526public function testMiddlewarePrioritySorting()&#123; $middleware = [ Placeholder1::class, SubstituteBindings::class, Placeholder2::class, Authenticate::class, Placeholder3::class, ]; $router = $this-&gt;getRouter(); $router-&gt;middlewarePriority = [Authenticate::class, SubstituteBindings::class, Authorize::class]; $route = $router-&gt;get('foo', ['middleware' =&gt; $middleware, 'uses' =&gt; function ($name) &#123; return $name; &#125;]); $this-&gt;assertEquals([ Placeholder1::class, Authenticate::class, SubstituteBindings::class, Placeholder2::class, Placeholder3::class, ], $router-&gt;gatherRouteMiddleware($route));&#125; HTTPapp/Http/Controllers. LaravelLaravelControllermiddleware 1234567class UserController extends Controller&#123; public function show($id) &#123; return view('user.profile', ['user' =&gt; User::findOrFail($id)]); &#125;&#125; 1Route::get('user/&#123;id&#125;', 'UserController@show'); __invoke 12345678910111213141516171819202122public function testDispatchingCallableActionClasses()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/bar', 'Illuminate\Tests\Routing\ActionStub'); $this-&gt;assertEquals('hello', $router-&gt;dispatch(Request::create('foo/bar', 'GET'))-&gt;getContent()); $router-&gt;get('foo/bar2', [ 'uses' =&gt; 'Illuminate\Tests\Routing\ActionStub@func', ]); $this-&gt;assertEquals('hello2', $router-&gt;dispatch(Request::create('foo/bar2', 'GET'))-&gt;getContent());&#125;class ActionStub extends Controller&#123; public function __invoke() &#123; return 'hello'; &#125;&#125; middleware 123456789class UserController extends Controller&#123; public function __construct() &#123; $this-&gt;middleware('auth'); $this-&gt;middleware('log')-&gt;only('index'); $this-&gt;middleware('subscribed')-&gt;except('store'); &#125;&#125; callActioncallAction 1234public function callAction($method, $parameters)&#123; return call_user_func_array([$this, $method], $parameters);&#125;  12345678910111213141516171819unset($_SERVER['__test.controller_callAction_parameters']);$router-&gt;get(($str = str_random()).'/&#123;one&#125;/&#123;two&#125;', 'Illuminate\Tests\Routing\RouteTestAnotherControllerWithParameterStub@oneArgument');$router-&gt;dispatch(Request::create($str.'/one/two', 'GET'));$this-&gt;assertEquals(['one' =&gt; 'one', 'two' =&gt; 'two'], $_SERVER['__test.controller_callAction_parameters']);class RouteTestAnotherControllerWithParameterStub extends Controller&#123; public function callAction($method, $parameters) &#123; $_SERVER['__test.controller_callAction_parameters'] = $parameters; &#125; public function oneArgument($one) &#123; &#125;&#125; __callclassname@methodmethod__call 1234567891011121314151617181920public function testCallableControllerRouting()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/bar', 'Illuminate\Tests\Routing\RouteTestControllerCallableStub@bar'); $router-&gt;get('foo/baz', 'Illuminate\Tests\Routing\RouteTestControllerCallableStub@baz'); $this-&gt;assertEquals('bar', $router-&gt;dispatch(Request::create('foo/bar', 'GET'))-&gt;getContent()); $this-&gt;assertEquals('baz', $router-&gt;dispatch(Request::create('foo/baz', 'GET'))-&gt;getContent());&#125;class RouteTestControllerCallableStub extends Controller&#123; public function __call($method, $arguments = []) &#123; return $method; &#125;&#125; LaravelLaravel  12345678Route::put('user/&#123;id&#125;', 'UserController@update');class UserController extends Controller&#123; public function update(Request $request, $id) &#123; &#125;&#125; Illuminate\Http\Request 1234567class UserController extends Controller&#123; public function store(Request $request) &#123; $name = $request-&gt;input('name'); &#125;&#125; routeuseriduserid 12345678910Route::put('user/&#123;userid&#125;', 'UserController@update');class UserController extends Controller&#123; public function update(UserModel $userid) &#123; $userid-&gt;name = 'taylor'; $userid-&gt;update(); &#125;&#125;  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374public function testImplicitBindingsWithOptionalParameter()&#123; unset($_SERVER['__test.controller_callAction_parameters']); $router-&gt;get(($str = str_random()).'/&#123;user&#125;/&#123;defaultNull?&#125;/&#123;team?&#125;', [ 'middleware' =&gt; SubstituteBindings::class,'uses' =&gt; 'Illuminate\Tests\Routing\RouteTestAnotherControllerWithParameterStub@withModels', ]); $router-&gt;dispatch(Request::create($str.'/1', 'GET')); $values = array_values($_SERVER['__test.controller_callAction_parameters']); $this-&gt;assertInstanceOf('Illuminate\Http\Request', $values[0]); $this-&gt;assertEquals(1, $values[1]-&gt;value); $this-&gt;assertNull($values[2]); $this-&gt;assertInstanceOf('Illuminate\Tests\Routing\RoutingTestTeamModel', $values[3]);&#125;class RouteTestAnotherControllerWithParameterStub extends Controller&#123; public function callAction($method, $parameters) &#123; $_SERVER['__test.controller_callAction_parameters'] = $parameters; &#125; public function withModels(Request $request, RoutingTestUserModel $user, $defaultNull = null, RoutingTestTeamModel $team = null) &#123; &#125;&#125;class RoutingTestUserModel extends Model&#123; public function getRouteKeyName() &#123; return 'id'; &#125; public function where($key, $value) &#123; $this-&gt;value = $value; return $this; &#125; public function first() &#123; return $this; &#125; public function firstOrFail() &#123; return $this; &#125;&#125;class RoutingTestTeamModel extends Model&#123; public function getRouteKeyName() &#123; return 'id'; &#125; public function where($key, $value) &#123; $this-&gt;value = $value; return $this; &#125; public function first() &#123; return $this; &#125; public function firstOrFail() &#123; return $this; &#125;&#125; bindmodel bind 1234567891011121314public function testRouteBinding()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/&#123;bar&#125;', ['middleware' =&gt; SubstituteBindings::class, 'uses' =&gt; function ($name) &#123; return $name; &#125;]); $router-&gt;bind('bar', function ($value) &#123; return strtoupper($value); &#125;); $this-&gt;assertEquals('TAYLOR', $router-&gt;dispatch(Request::create('foo/taylor', 'GET'))-&gt;getContent());&#125; bindclassname@methodbind 1234567891011121314151617181920212223242526272829303132333435363738public function testRouteClassBinding()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/&#123;bar&#125;', ['middleware' =&gt; SubstituteBindings::class, 'uses' =&gt; function ($name) &#123; return $name; &#125;]); $router-&gt;bind('bar', 'Illuminate\Tests\Routing\RouteBindingStub'); $this-&gt;assertEquals('TAYLOR', $router-&gt;dispatch(Request::create('foo/taylor', 'GET'))-&gt;getContent());&#125;public function testRouteClassMethodBinding()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/&#123;bar&#125;', ['middleware' =&gt; SubstituteBindings::class, 'uses' =&gt; function ($name) &#123; return $name; &#125;]); $router-&gt;bind('bar', 'Illuminate\Tests\Routing\RouteBindingStub@find'); $this-&gt;assertEquals('dragon', $router-&gt;dispatch(Request::create('foo/Dragon', 'GET'))-&gt;getContent());&#125;class RouteBindingStub&#123; public function bind($value, $route) &#123; return strtoupper($value); &#125; public function find($value, $route) &#123; return strtolower($value); &#125;&#125; modelLaravelwhere 123if ($model = $instance-&gt;where($instance-&gt;getRouteKeyName(), $value)-&gt;first()) &#123; return $model;&#125;  12345678910111213141516171819202122232425262728293031public function testModelBinding()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/&#123;bar&#125;', ['middleware' =&gt; SubstituteBindings::class, 'uses' =&gt; function($name) &#123; return $name; &#125;]); $router-&gt;model('bar', 'Illuminate\Tests\Routing\RouteModelBindingStub'); $this-&gt;assertEquals('TAYLOR', $router-&gt;dispatch(Request::create('foo/taylor', 'GET'))-&gt;getContent());&#125;class RouteModelBindingStub&#123; public function getRouteKeyName() &#123; return 'id'; &#125; public function where($key, $value) &#123; $this-&gt;value = $value; return $this; &#125; public function first() &#123; return strtoupper($this-&gt;value); &#125;&#125; modelmodel 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public function testModelBindingWithCustomNullReturn()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/&#123;bar&#125;', ['middleware' =&gt; SubstituteBindings::class, 'uses' =&gt; function ($name) &#123; return $name; &#125;]); $router-&gt;model('bar', 'Illuminate\Tests\Routing\RouteModelBindingNullStub', function () &#123; return 'missing'; &#125;); $this-&gt;assertEquals('missing', $router-&gt;dispatch(Request::create('foo/taylor', 'GET'))-&gt;getContent());&#125;public function testModelBindingWithBindingClosure()&#123; $router = $this-&gt;getRouter(); $router-&gt;get('foo/&#123;bar&#125;', ['middleware' =&gt; SubstituteBindings::class, 'uses' =&gt; function ($name) &#123; return $name; &#125;]); $router-&gt;model('bar', 'Illuminate\Tests\Routing\RouteModelBindingNullStub', function ($value) &#123; return (new RouteModelBindingClosureStub())-&gt;findAlternate($value); &#125;); $this-&gt;assertEquals('tayloralt', $router-&gt;dispatch(Request::create('foo/TAYLOR', 'GET'))-&gt;getContent());&#125;class RouteModelBindingNullStub&#123; public function getRouteKeyName() &#123; return 'id'; &#125; public function where($key, $value) &#123; return $this; &#125; public function first() &#123; &#125;&#125;class RouteModelBindingClosureStub&#123; public function findAlternate($value) &#123; return strtolower($value).'alt'; &#125;&#125; routerroutermacro 12345678910111213141516public function testMacro()&#123; $router = $this-&gt;getRouter(); $router-&gt;macro('webhook', function () use ($router) &#123; $router-&gt;match(['GET', 'POST'], 'webhook', function () &#123; return 'OK'; &#125;); &#125;); $router-&gt;webhook(); $this-&gt;assertEquals('OK', $router-&gt;dispatch(Request::create('webhook', 'GET'))-&gt;getContent()); $this-&gt;assertEquals('OK', $router-&gt;dispatch(Request::create('webhook', 'POST'))-&gt;getContent());&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP Composer]]></title>
    <url>%2F2020%2F05%2F19%2FPHP-Composer%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD%2F</url>
    <content type="text"><![CDATA[ __autoload() __autoload() PHPPHPClassincluderequireClassPHPrequire/includerequire_once PHP5autoloadautoloadPHPincludeLazy Loading  1.include/require 2.include/requireLazy Loadinginclude/require 3. PHP__autoload()PHP5__autoload() 123456&lt;?phpfunction __autoload($classname)&#123; require_once ($classname . ".class.php");&#125; .class.phprequire_once __autoload 1. 2.PHP 3. include/require __autoload()Lazy Loading__autoload() __autoload()__autoload()__autoload()__autoload() __autoload()__autoload__autoloadPHP5SPL Autoload SPL AutoloadSPLStandard PHP LibraryPHPPHP5autoloadIteratorSPL Autoload 1.spl_autoload_register__autoload() 2.spl_autoload_unregister 3.spl_autoload_functions 4.spl_autoload_call 5.spl_autoload__autoload() 6.spl_autoload_extionsionsspl_autoload spl_autoloadSPL__autoload()set_include_path$classname.php/.inc(spl_autoload_extionsions) splautoload_register()__autoload__autoload()PHPPHP__autoload()spl_autoload() PHPPHPPSRPSR0PSR4 PSR0PSR4PHP PHP Namespacefoo.txt/home/greg/home/otherfoo.txt/home/gregfoo.txt/home/greg/foo.txt PHP 1.PHP//// 2. PHP PHP a_b_c_d_e_f  a/b/c/d/e/f PHP5/  PSRPSR0PSR4      PSRPSRProposing a Standards Recommendation5PSR PSR-0 (Autoloading Standard) PSR-1 (Basic Coding Standard)PSR-2 (Coding Style Guide) PSR-3 (Logger Interface) PSR-4 (Improved Autoloading) PSR-0 PSR0 PRS-01Autoloading StandardPSR-0 1.namespaceclass 1&lt;VendorName&gt;[&lt;Namespace&gt;]*&lt;Class Name&gt; 2.namespacenamespaceVendor Name 3.namespacenamespace 4.namespace(/)DIRECTORY_SEPARATOR() 5.(_) DIRECTORY_SEPARATOR() namespace  _  6. namespace  class .php 7.verdor name , namespaces , class   PSR01237456 PSR   +  =  PSR0, PSR045spl_register() 1237  PSR0PSR0PSR0PSR0require PSR0 LaravelSymfony /Symfony/Core/RequestPSR0 namespaceclass 1&lt;VendorName&gt;[&lt;Namespace&gt;]*&lt;Class Name&gt; /SymfonyVendor Name/CoreNamespace(requestSymfony)Request 2 . namespacenamespaceVendor Name /SymfonyPSR0/Symfony/Core/Request/Symfonynamespace/Symfony/Core/Transport/Request/Symfony/Core/Transport/Request1,Request2Request3/SymfonyPSR 3.namespacenamespace Request/Symfony/Core/Request/Symfony/Core/Transport/Request/Core 4.namespace(/)DIRECTORY_SEPARATOR() //Symfony/Core/Request\Symfony\Core\Request 5._DIRECTORYSEPARATOR()namespace\ /Symfony/Core/Request_a\Symfony\Core\Request\aPHP5Symfony_Core_Request_aPSR0 Symfony/Core/Request /path/to/project/vendor/Symfony/Core/Request.php/path/to/project/path/to/project/vendor/path/to/project/vendor/Symfony/SymfonyPSR0/Symfony/Core/Request =&gt; /Symfony/Core/Request.php  PSR0/A/B/C/D/E/F/A/B/C/D/E/F PSR4 20135PSR-4 PSR-4PSR-0PSR-4PHP 5.3PSR-0PSR-4PSR-0PSR-0PSR-4PSR-0PSR-4PSR-0 PSR4PSR0   (Composer) Foo/classFooFoo/ =&gt; src/ PSR0:src/Foo/class.phpPSR4:src/class.php ,PSR-4PHP PSR-0 1234567891011-vendor/| -vendor_name/| | -package_name/| | | -src/| | | | -Vendor_Name/| | | | | -Package_Name/| | | | | | -ClassName.php # Vendor_Name\Package_Name\ClassName| | | -tests/| | | | -Vendor_Name/| | | | | -Package_Name/| | | | | | -ClassNameTest.php # Vendor_Name\Package_Name\ClassName PSR-4 1234567-vendor/| -vendor_name/| | -package_name/| | | -src/| | | | -ClassName.php # Vendor_Name\Package_Name\ClassName| | | -tests/| | | | -ClassNameTest.php # Vendor_Name\Package_Name\ClassNameTest PSR-4 PHPPHPPSR0/PSR4PSR4Composer ComposerComposer PSR0/PSR4__autoload()spl_register() PSR4composercomposer  composer  use   Laravel composerPSR0/PSR4Composer Composer autoload_real.php: composer () (spl_autoload_register()) ClassLoader.php: composercomposer autoload_static.php:  autoload_classmap.php:  autoload_files.php:  autoload_namespaces.php: PSR0 autoload_psr4.php: PSR4 LaravelComposerLaravelcomposerLaravelindex.phpcomposer 12345&lt;?phpdefine('LARAVEL_START', microtime(true));require __DIR__.'/../vendor/autoload.php'; vendorautoload.php 1234&lt;?phprequire_once __DIR__ . '/composer/autoload_real.php';return ComposerAutoloaderInit41730e5b8bc2247776726758bb07e21b::getLoader(); Composerautoload_real.php autoload_realComposerAutoloaderInit832ea71bfb9a4128da8660baedaac82ehashhash LaravelComposer-autoload_realvendorautoload.phpgetLoader() 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public static function getLoader()&#123; if (null !== self::$loader) &#123; return self::$loader; &#125; spl_autoload_register(array('ComposerAutoloaderInit41730e5b8bc2247776726758bb07e21b', 'loadClassLoader'), true, true); self::$loader = $loader = new \Composer\Autoload\ClassLoader(); spl_autoload_unregister(array('ComposerAutoloaderInit41730e5b8bc2247776726758bb07e21b', 'loadClassLoader')); $useStaticLoader = PHP_VERSION_ID &gt;= 50600 &amp;&amp; !defined('HHVM_VERSION') &amp;&amp; (!function_exists('zend_loader_file_encoded') || !zend_loader_file_encoded()); if ($useStaticLoader) &#123; require_once __DIR__ . '/autoload_static.php'; call_user_func(\Composer\Autoload\ComposerStaticInit41730e5b8bc2247776726758bb07e21b::getInitializer($loader)); &#125; else &#123; $map = require __DIR__ . '/autoload_namespaces.php'; foreach ($map as $namespace =&gt; $path) &#123; $loader-&gt;set($namespace, $path); &#125; $map = require __DIR__ . '/autoload_psr4.php'; foreach ($map as $namespace =&gt; $path) &#123; $loader-&gt;setPsr4($namespace, $path); &#125; $classMap = require __DIR__ . '/autoload_classmap.php'; if ($classMap) &#123; $loader-&gt;addClassMap($classMap); &#125; &#125; $loader-&gt;register(true); if ($useStaticLoader) &#123; $includeFiles = Composer\Autoload\ComposerStaticInit41730e5b8bc2247776726758bb07e21b::$files; &#125; else &#123; $includeFiles = require __DIR__ . '/autoload_files.php'; &#125; foreach ($includeFiles as $fileIdentifier =&gt; $file) &#123; composerRequire41730e5b8bc2247776726758bb07e21b($fileIdentifier, $file); &#125; return $loader;&#125; 5  12345&lt;?phpif (null !== self::$loader) &#123; return self::$loader;&#125; ClassLoader new 123456789101112&lt;?php/*******************************************/spl_autoload_register(array('ComposerAutoloaderInit832ea71bfb9a4128da8660baedaac82e', 'loadClassLoader'), true, true);self::$loader = $loader = new \Composer\Autoload\ClassLoader();spl_autoload_unregister(array('ComposerAutoloaderInit832ea71bfb9a4128da8660baedaac82e', 'loadClassLoader')); loadClassLoader() 1234567&lt;?phppublic static function loadClassLoader($class)&#123;if ('Composer\Autoload\ClassLoader' === $class) &#123;require __DIR__ . '/ClassLoader.php';&#125;&#125; composerPHPrequire ClassLoader newClassLoader() require\Composer\Autoload\ClassLoaderhash - 12345678910111213141516171819202122232425&lt;?php/*******************************************/$useStaticLoader = PHP_VERSION_ID &gt;= 50600 &amp;&amp; !defined('HHVM_VERSION');if ($useStaticLoader) &#123;require_once __DIR__ . '/autoload_static.php';call_user_func(\Composer\Autoload\ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::getInitializer($loader));&#125; else &#123;$map = require __DIR__ . '/autoload_namespaces.php';foreach ($map as $namespace =&gt; $path) &#123;$loader-&gt;set($namespace, $path);&#125;$map = require __DIR__ . '/autoload_psr4.php';foreach ($map as $namespace =&gt; $path) &#123;$loader-&gt;setPsr4($namespace, $path);&#125;$classMap = require __DIR__ . '/autoload_classmap.php';if ($classMap) &#123;$loader-&gt;addClassMap($classMap);&#125;&#125;  autoload_static  autoload_static  PHP5.6  HHVM autoload_static.php ComposerStaticInit832ea71bfb9a4128da8660baedaac82e  hash  123456789101112131415161718192021222324&lt;?phpclass ComposerStaticInit832ea71bfb9a4128da8660baedaac82e&#123;public static $files = array(...);public static $prefixLengthsPsr4 = array(...);public static $prefixDirsPsr4 = array(...);public static $prefixesPsr0 = array(...);public static $classMap = array (...);public static function getInitializer(ClassLoader $loader)&#123;return \Closure::bind(function () use ($loader) &#123;$loader-&gt;prefixLengthsPsr4= ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::$prefixLengthsPsr4;$loader-&gt;prefixDirsPsr4= ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::$prefixDirsPsr4;$loader-&gt;prefixesPsr0= ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::$prefixesPsr0;$loader-&gt;classMap= ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::$classMap;&#125;, null, ClassLoader::class);&#125;  getInitializer() ClassLoaderClassLoaderprefixLengthsPsr4prefixDirsPsr4privateprivateClassLoader     classMap: 1234567891011121314151617&lt;?phppublic static $classMap = array ('App\\Console\\Kernel'=&gt; __DIR__ . '/../..' . '/app/Console/Kernel.php','App\\Exceptions\\Handler'=&gt; __DIR__ . '/../..' . '/app/Exceptions/Handler.php','App\\Http\\Controllers\\Auth\\ForgotPasswordController'=&gt; __DIR__ . '/../..' . '/app/Http/Controllers/Auth/ForgotPasswordController.php','App\\Http\\Controllers\\Auth\\LoginController'=&gt; __DIR__ . '/../..' . '/app/Http/Controllers/Auth/LoginController.php','App\\Http\\Controllers\\Auth\\RegisterController'=&gt; __DIR__ . '/../..' . '/app/Http/Controllers/Auth/RegisterController.php',...)  PSR0  12345678910111213141516171819202122232425262728293031&lt;?phppublic static $prefixesPsr0 = array ('P' =&gt; array ('Prophecy\\' =&gt; array (0 =&gt; __DIR__ . '/..' . '/phpspec/prophecy/src',),'Parsedown' =&gt; array (0 =&gt; __DIR__ . '/..' . '/erusev/parsedown',),),'M' =&gt; array ('Mockery' =&gt; array (0 =&gt; __DIR__ . '/..' . '/mockery/mockery/library',),),'J' =&gt; array ('JakubOnderka\\PhpConsoleHighlighter' =&gt; array (0 =&gt; __DIR__ . '/..' . '/jakub-onderka/php-console-highlighter/src',),'JakubOnderka\\PhpConsoleColor' =&gt; array (0 =&gt; __DIR__ . '/..' . '/jakub-onderka/php-console-color/src',),),'D' =&gt; array ('Doctrine\\Common\\Inflector\\' =&gt; array (0 =&gt; __DIR__ . '/..' . '/doctrine/inflector/lib',),),); Parsedown/exampleP 123456789&lt;?php'P' =&gt; array ('Prophecy\\' =&gt; array (0 =&gt; __DIR__ . '/..' . '/phpspec/prophecy/src',),'Parsedown' =&gt; array (0 =&gt; __DIR__ . '/..' . '/erusev/parsedown',),),  Parsedown/example  Prophecy  Parsedown () 12&lt;?phparray (0 =&gt; __DIR__ . '/..' . '/erusev/parsedown',)  DIR . /.. ./erusev/parsedown/Parsedown/example.php () PSR4 12345678910111213141516171819202122232425262728&lt;?phppublic static $prefixLengthsPsr4 = array('p' =&gt; array ('phpDocumentor\\Reflection\\' =&gt; 25,),'S' =&gt; array ('Symfony\\Polyfill\\Mbstring\\' =&gt; 26,'Symfony\\Component\\Yaml\\' =&gt; 23,'Symfony\\Component\\VarDumper\\' =&gt; 28,...),...);public static $prefixDirsPsr4 = array ('phpDocumentor\\Reflection\\' =&gt; array (0 =&gt; __DIR__ . '/..' . '/phpdocumentor/reflection-common/src',1 =&gt; __DIR__ . '/..' . '/phpdocumentor/type-resolver/src',2 =&gt; __DIR__ . '/..' . '/phpdocumentor/reflection-docblock/src',),'Symfony\\Polyfill\\Mbstring\\' =&gt; array (0 =&gt; __DIR__ . '/..' . '/symfony/polyfill-mbstring',),'Symfony\\Component\\Yaml\\' =&gt; array (0 =&gt; __DIR__ . '/..' . '/symfony/yaml',),...) PSR4 PSR0 PSR4  PSR0  Parsedown/example =&gt; DIR . /.. . /erusev/parsedown/Parsedown/example.phpPSR4Parsedown/example =&gt; DIR . /.. . /erusev/parsedown/example.phpSymfony\Polyfill\Mbstring\examplePSR0 12&lt;?php'Symfony\\Polyfill\\Mbstring\\' =&gt; 26, $prefixDirsPsr4 () 12345&lt;?php'Symfony\\Polyfill\\Mbstring\\' =&gt; array (0 =&gt; __DIR__ . '/..' . '/symfony/polyfill-mbstring',)  Symfony\Polyfill\Mbstring\example26 DIR . /.. . /symfony/polyfill-mbstring  DIR . /.. . /symfony/polyfill-mbstring/example.php ClassLoader ClassLoader PHP5.6 HHVM  123456789101112131415&lt;?php//PSR0$map = require __DIR__ . '/autoload_namespaces.php';foreach ($map as $namespace =&gt; $path) &#123;$loader-&gt;set($namespace, $path);&#125;//PSR4$map = require __DIR__ . '/autoload_psr4.php';foreach ($map as $namespace =&gt; $path) &#123;$loader-&gt;setPsr4($namespace, $path);&#125;$classMap = require __DIR__ . '/autoload_classmap.php';if ($classMap) &#123;$loader-&gt;addClassMap($classMap);&#125; PSR0autoload_namespaces 1234567891011121314151617&lt;?phpreturn array('Prophecy\\'=&gt; array($vendorDir . '/phpspec/prophecy/src'),'Parsedown'=&gt; array($vendorDir . '/erusev/parsedown'),'Mockery'=&gt; array($vendorDir . '/mockery/mockery/library'),'JakubOnderka\\PhpConsoleHighlighter'=&gt; array($vendorDir . '/jakub-onderka/php-console-highlighter/src'),'JakubOnderka\\PhpConsoleColor'=&gt; array($vendorDir . '/jakub-onderka/php-console-color/src'),'Doctrine\\Common\\Inflector\\'=&gt; array($vendorDir . '/doctrine/inflector/lib'),); PSR0 12345678910&lt;?phppublic function set($prefix, $paths)&#123;if (!$prefix) &#123;$this-&gt;fallbackDirsPsr0 = (array) $paths;&#125; else &#123;$this-&gt;prefixesPsr0[$prefix[0]][$prefix] = (array) $paths;&#125;&#125; PSR0autoload_static$prefixesPsr0PSR4autoload_psr4 123456789101112131415&lt;?phpreturn array('XdgBaseDir\\'=&gt; array($vendorDir . '/dnoegel/php-xdg-base-dir/src'),'Webmozart\\Assert\\'=&gt; array($vendorDir . '/webmozart/assert/src'),'TijsVerkoyen\\CssToInlineStyles\\'=&gt; array($vendorDir . '/tijsverkoyen/css-to-inline-styles/src'),'Tests\\'=&gt; array($baseDir . '/tests'),'Symfony\\Polyfill\\Mbstring\\'=&gt; array($vendorDir . '/symfony/polyfill-mbstring'),...) PSR4: 123456789101112131415161718&lt;?phppublic function setPsr4($prefix, $paths)&#123;if (!$prefix) &#123;$this-&gt;fallbackDirsPsr4 = (array) $paths;&#125; else &#123;$length = strlen($prefix);if ('\\' !== $prefix[$length - 1]) &#123;throw new \InvalidArgumentException("A non-empty PSR-4 prefix must end with a namespace separator.");&#125;$this-&gt;prefixLengthsPsr4[$prefix[0]][$prefix] = $length;$this-&gt;prefixDirsPsr4[$prefix] = (array) $paths;&#125;&#125; PSR4 \ (  -&gt;  -&gt;  )(  -&gt;  )autoload_staticprefixLengthsPsr4$prefixDirsPsr4 autoload_classmap 12345678&lt;?phppublic static $classMap = array ('App\\Console\\Kernel'=&gt; __DIR__ . '/../..' . '/app/Console/Kernel.php','App\\Exceptions\\Handler'=&gt; __DIR__ . '/../..' . '/app/Exceptions/Handler.php',...) addClassMap: 12345678910&lt;?phppublic function addClassMap(array $classMap)&#123;if ($this-&gt;classMap) &#123;$this-&gt;classMap = array_merge($this-&gt;classMap, $classMap);&#125; else &#123;$this-&gt;classMap = $classMap;&#125;&#125;   1.composer;2.composer5 5 ComposerApp\Console\KernelApp\\Console\Kernel Composer  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public static function getLoader()&#123;/***********************************************/if (null !== self::$loader) &#123;return self::$loader;&#125;/*******************************************/spl_autoload_register(array('ComposerAutoloaderInit832ea71bfb9a4128da8660baedaac82e', 'loadClassLoader'), true,true);self::$loader = $loader = new \Composer\Autoload\ClassLoader();spl_autoload_unregister(array('ComposerAutoloaderInit832ea71bfb9a4128da8660baedaac82e', 'loadClassLoader'));/*******************************************/$useStaticLoader = PHP_VERSION_ID &gt;= 50600 &amp;&amp;!defined('HHVM_VERSION');if ($useStaticLoader) &#123;require_once __DIR__ . '/autoload_static.php';call_user_func(\Composer\Autoload\ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::getInitializer($loader));&#125; else &#123;$map = require __DIR__ . '/autoload_namespaces.php';foreach ($map as $namespace =&gt; $path) &#123;$loader-&gt;set($namespace, $path);&#125;$map = require __DIR__ . '/autoload_psr4.php';foreach ($map as $namespace =&gt; $path) &#123;$loader-&gt;setPsr4($namespace, $path);&#125;$classMap = require __DIR__ . '/autoload_classmap.php';if ($classMap) &#123;$loader-&gt;addClassMap($classMap);&#125;&#125;/*******************************************/$loader-&gt;register(true);/*******************************************/if ($useStaticLoader) &#123;$includeFiles = Composer\Autoload\ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::$files;&#125; else &#123;$includeFiles = require __DIR__ . '/autoload_files.php';&#125;foreach ($includeFiles as $fileIdentifier =&gt; $file) &#123; composerRequire832ea71bfb9a4128da8660baedaac82e($fileIdentifier, $file);&#125;return $loader;&#125; register() 12345public function register($prepend = false)&#123;spl_autoload_register(array($this, 'loadClass'), true, $prepend);&#125; ClassLoaderloadClass()PSRApp\Console\KernelConsole\KernelComposerClassLoaderloadClass()PHP SPLspl_autoload_register()PHPPHPspl_autoload_register Composer Composerrequirecomposer 12345678910if ($useStaticLoader) &#123;$includeFiles = Composer\Autoload\ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::$files;&#125; else &#123;$includeFiles = require __DIR__ . '/autoload_files.php';&#125;foreach ($includeFiles as $fileIdentifier =&gt; $file) &#123;composerRequire832ea71bfb9a4128da8660baedaac82e($fileIdentifier, $file);&#125; PHP5.6HHVM  ComposerStaticInit832ea71bfb9a4128da8660baedaac82e::$files 1234567public static $files = array ('0e6d7bf4a5811bfa5cf40c5ccd6fae6a' =&gt; __DIR__ . '/..' . '/symfony/polyfill-mbstring/bootstrap.php','667aeda72477189d0494fecd327c3641' =&gt; __DIR__ . '/..' . '/symfony/var-dumper/Resources/functions/dump.php',...); hash  autoload_files: 123456789$vendorDir = dirname(dirname(__FILE__));$baseDir = dirname($vendorDir);return array('0e6d7bf4a5811bfa5cf40c5ccd6fae6a' =&gt; $vendorDir . '/symfony/polyfill-mbstring/bootstrap.php','667aeda72477189d0494fecd327c3641' =&gt; $vendorDir . '/symfony/var-dumper/Resources/functions/dump.php',....);   1234567891011121314151617181920class ComposerAutoloaderInit832ea71bfb9a4128da8660baedaac82e&#123;public static function getLoader()&#123;...foreach ($includeFiles as $fileIdentifier =&gt; $file) &#123;composerRequire832ea71bfb9a4128da8660baedaac82e($fileIdentifier, $file);&#125;...&#125;&#125;function composerRequire832ea71bfb9a4128da8660baedaac82e($fileIdentifier, $file)&#123;if (empty(\$GLOBALS['__composer_autoload_files'][\$fileIdentifier])) &#123;require $file;$GLOBALS['__composer_autoload_files'][$fileIdentifier] =true;&#125;&#125; getLoader()require $includeFilescomposerRequire832ea71bfb9a4128da8660baedaac82e0(hash)$thisself $includeFilesapp/helper.phphelper.php$this-&gt;foo()getLoader()require($file)foo()helper.php$thisselffoo()foo();foo()foo()require$thisself$thisself  hash$fileIdentifierrequirerequire_oncerequire_oncerequire$GLOBALSrequire_oncecomposerrequire_once Composer composercomposer ClassLoaderregister()loadClass()PHPSPLPHPloadClass()  loadClass(): 12345678910111213141516171819202122232425262728293031323334public function loadClass($class)&#123;if ($file = $this-&gt;findFile($class)) &#123;includeFile($file);return true;&#125;&#125;public function findFile($class)&#123;// work around for PHP 5.3.0 - 5.3.2 https://bugs.php.net/50731if ('\\' == $class[0]) &#123;$class = substr($class, 1);&#125;// class map lookupif (isset($this-&gt;classMap[$class])) &#123;return $this-&gt;classMap[$class];&#125;if ($this-&gt;classMapAuthoritative) &#123;return false;PHP Composer--41&#125;$file = $this-&gt;findFileWithExtension($class, '.php');// Search for Hack files if we are running on HHVMif ($file === null &amp;&amp; defined('HHVM_VERSION')) &#123;$file = $this-&gt;findFileWithExtension($class, '.hh');&#125;if ($file === null) &#123;// Remember that this class does not exist.return $this-&gt;classMap[$class] = false;&#125;return $file;&#125; loadClass()findFile()findFile()classMapfindFileWithExtension()classMapfindFileWithExtension()PSR0PSR4includeFile()ClassLoader$thisself\\ findFileWithExtension 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364private function findFileWithExtension($class, $ext)&#123;// PSR-4 lookup$logicalPathPsr4 = strtr($class, '\\', DIRECTORY_SEPARATOR). $ext;$first = $class[0];if (isset($this-&gt;prefixLengthsPsr4[$first])) &#123;foreach ($this-&gt;prefixLengthsPsr4[$first] as $prefix =&gt;$length) &#123;if (0 === strpos($class, $prefix)) &#123;foreach ($this-&gt;prefixDirsPsr4[$prefix] as $dir)&#123;if (file_exists($file = $dir . DIRECTORY_SEPARATOR . substr($logicalPathPsr4, $length))) &#123;return $file;&#125;&#125;&#125;&#125;&#125;// PSR-4 fallback dirsforeach ($this-&gt;fallbackDirsPsr4 as $dir) &#123;if (file_exists($file = $dir . DIRECTORY_SEPARATOR . $logicalPathPsr4)) &#123;return $file;&#125;&#125;// PSR-0 lookupif (false !== $pos = strrpos($class, '\\')) &#123;// namespaced class name$logicalPathPsr0 = substr($logicalPathPsr4, 0, $pos + 1). strtr(substr($logicalPathPsr4, $pos + 1), '_', DIRECTORY_SEPARATOR);&#125; else &#123;// PEAR-like class name$logicalPathPsr0 = strtr($class, '_', DIRECTORY_SEPARATOR) . $ext;&#125;if (isset($this-&gt;prefixesPsr0[$first])) &#123;foreach ($this-&gt;prefixesPsr0[$first] as $prefix =&gt; $dirs) &#123;if (0 === strpos($class, $prefix)) &#123;foreach ($dirs as $dir) &#123;if (file_exists($file = $dir . DIRECTORY_SEPARATOR . $logicalPathPsr0)) &#123;return $file;&#125;&#125;&#125;&#125;&#125;// PSR-0 fallback dirsforeach ($this-&gt;fallbackDirsPsr0 as $dir) &#123;if (file_exists($file = $dir . DIRECTORY_SEPARATOR . $logicalPathPsr0)) &#123;return $file;&#125;&#125;// PSR-0 include paths.if ($this-&gt;useIncludePath &amp;&amp; $file = stream_resolve_include_path($logicalPathPsr0)) &#123;return $file;&#125;&#125;  phpDocumentor\Reflection\examplePHPSPLloadClass-&gt;findFile-&gt;findFileWithExtensionphpfindFileWithExtensionPSR4PSR0HHVMhhfindFileWithExtensionclassMapfalse phpDocumentor\Reflection\examplePSR4 PSR4\/phphh$logicalPathPsr4phpDocumentor//Reflection//example.php(hh);pprefixLengthsPsr4 12345p' =&gt;array ('phpDocumentor\\Reflection\\' =&gt; 25,'phpDocumentor\\Fake\\' =&gt; 19,) phpDocumentor\Reflection\phpDocumentor\FakephpDocumentor\Reflection\example_ephpDocumentor\Reflection\prefixLengthsPsr4phpDocumentor\Reflection\25 prefixDirsPsr4phpDocumentor\Reflection\ 123456789'phpDocumentor\\Reflection\\' =&gt;array (0 =&gt; __DIR__ . '/..' . '/phpdocumentor/reflection-common/src',1 =&gt; __DIR__ . '/..' . '/phpdocumentor/type-resolver/src',2 =&gt; __DIR__ . '/..' . '/phpdocumentor/reflection-docblock/src',), +//+substr($logicalPathPsr4, $length)DIR/../phpdocumentor/reflection-common/src + /+substr(phpDocumentor/Reflection/example_e.php(hh),25)fallbackDirsPsr4+//+$logicalPathPsr4 PSR0 PSR4PSR0 phpDocumentor\Reflection\examplee\/,$logicalPathPsr0phpDocumentor/Reflection/example/e.php(hh) pprefixLengthsPsr4 1234567891011'P' =&gt;array ('Prophecy\\' =&gt;array (0 =&gt; __DIR__ . '/..' . '/phpspec/prophecy/src',),'phpDocumentor' =&gt;array (0 =&gt; __DIR__ . '/..' . '/erusev/parsedown',),), phpDocumentorProphecyphpDocumentor\Reflection\example_ephpDocumentorphpDocumentorDIR . /.. ./erusev/parsedown+//+$logicalPathPsr0 DIR . /.. . /erusev/parsedown + //+phpDocumentor//Reflection//example/e.php(hh)fallbackDirsPsr0+//+$logicalPathPsr0stream_resolve_include_path()include]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Facade-Facade]]></title>
    <url>%2F2020%2F05%2F18%2FLaravel-Facade-Facade%E9%97%A8%E9%9D%A2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ __callStaticRoute::get()  FacadesLaravelFacadesLaravelLaravel FacadesFacades LaravelIoCLaravelIoCLaravelmakeFacadeRoutermake 123App::make('router')-&gt;get('/', function () &#123; return view('welcome');&#125;);  123Route::get('/', function () &#123; return view('welcome');&#125;); make FacadeRouteFacadeRoute Illuminate\Support\Facades\Route.php 123456789101112class Route extends Facade&#123; /** * Get the registered name of the component. * * @return string */ protected static function getFacadeAccessor() &#123; return 'router'; &#125;&#125; getFacadeAccessorroutermakeApp::make(router) Route::get()Facade Illuminate\Support\Facades\Facade.php 1234567891011121314151617181920212223abstract class Facade&#123; /** * Handle dynamic, static calls to the object. * * @param string $method * @param array $args * @return mixed * * @throws \RuntimeException */ public static function __callStatic($method, $args) &#123; $instance = static::getFacadeRoot(); if (! $instance) &#123; throw new RuntimeException('A facade root has not been set.'); &#125; return $instance-&gt;$method(...$args); &#125;&#125; Route::get()Routeget()PHP__callStaticget() 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * The application instance being facaded. * * @var \Illuminate\Contracts\Foundation\Application */protected static $app;/** * The resolved object instances. * * @var array */protected static $resolvedInstance;/** * Get the root object behind the facade. * * @return mixed */public static function getFacadeRoot()&#123; return static::resolveFacadeInstance(static::getFacadeAccessor());&#125;/** * Get the registered name of the component. * * @return string * * @throws \RuntimeException */protected static function getFacadeAccessor()&#123; throw new RuntimeException('Facade does not implement getFacadeAccessor method.');&#125;/** * Resolve the facade root instance from the container. * * @param object|string $name * @return mixed */protected static function resolveFacadeInstance($name)&#123; if (is_object($name)) &#123; return $name; &#125; if (isset(static::$resolvedInstance[$name])) &#123; return static::$resolvedInstance[$name]; &#125; if (static::$app) &#123; return static::$resolvedInstance[$name] = static::$app[$name]; &#125;&#125; getFacadeRoot()getFacadeAccessor()getFacadeAccessorgetFacadeAccessor()routergetFacadeRoot()resolveFacadeInstance() 1return static::$resolvedInstance[$name] = static::$app[$name]; $approuter$resolvedInstance AliasesLaravelRouteuse Illuminate\Support\Facades\RoutePHPclass_aliasLaravelclass_aliasconfigapp 123456'aliases' =&gt; [ 'App' =&gt; Illuminate\Support\Facades\App::class, 'Artisan' =&gt; Illuminate\Support\Facades\Artisan::class, 'Auth' =&gt; Illuminate\Support\Facades\Auth::class, ...] Laravel AliasesLaravelindex.php 123456789require __DIR__.'/../vendor/autoload.php';$app = require_once __DIR__.'/../bootstrap/app.php';$kernel = $app-&gt;make(Illuminate\Contracts\Http\Kernel::class);$response = $kernel-&gt;handle( $request = Illuminate\Http\Request::capture()); composerLaravelIoCHttpLaravelHttp 1$request = Illuminate\Http\Request::capture() Laravel$_SERVERHttpHttphandle Illuminate\Foundation\Http\Kernel.php 123456789101112131415161718192021222324252627class Kernel implements KernelContract&#123; /** * Handle an incoming HTTP request. * * @param \Illuminate\Http\Request $request * @return \Illuminate\Http\Response */ public function handle($request) &#123; try &#123; $request-&gt;enableHttpMethodParameterOverride(); $response = $this-&gt;sendRequestThroughRouter($request); &#125; catch (Throwable $e) &#123; $this-&gt;reportException($e); $response = $this-&gt;renderException($request, $e); &#125; $this-&gt;app['events']-&gt;dispatch( new RequestHandled($request, $response) ); return $response; &#125;&#125; handleenableHttpMethodParameterOverridedeleteputsendRequestThroughRouter 12345678910111213141516171819/** * Send the given request through the middleware / router. * * @param \Illuminate\Http\Request $request * @return \Illuminate\Http\Response */protected function sendRequestThroughRouter($request)&#123; $this-&gt;app-&gt;instance('request', $request); Facade::clearResolvedInstance('request'); $this-&gt;bootstrap(); return (new Pipeline($this-&gt;app)) -&gt;send($request) -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [] : $this-&gt;middleware) -&gt;then($this-&gt;dispatchToRouter());&#125; LaravelIoCrequestFacaderequestbootstrap 12345678910111213141516171819202122232425/** * The bootstrap classes for the application. * * @var array */protected $bootstrappers = [ \Illuminate\Foundation\Bootstrap\LoadEnvironmentVariables::class, \Illuminate\Foundation\Bootstrap\LoadConfiguration::class, \Illuminate\Foundation\Bootstrap\HandleExceptions::class, \Illuminate\Foundation\Bootstrap\RegisterFacades::class, \Illuminate\Foundation\Bootstrap\RegisterProviders::class, \Illuminate\Foundation\Bootstrap\BootProviders::class,];/** * Bootstrap the application for HTTP requests. * * @return void */public function bootstrap()&#123; if (! $this-&gt;app-&gt;hasBeenBootstrapped()) &#123; $this-&gt;app-&gt;bootstrapWith($this-&gt;bootstrappers()); &#125;&#125; $bootstrappersHttpbootstrapIoCbootstrapWithapp-&gt;bootstrapWith 12345678910111213141516171819/** * Run the given array of bootstrap classes. * * @param string[] $bootstrappers * @return void */public function bootstrapWith(array $bootstrappers)&#123; $this-&gt;hasBeenBootstrapped = true; foreach ($bootstrappers as $bootstrapper) &#123; $this['events']-&gt;dispatch('bootstrapping: '.$bootstrapper, [$this]); $this-&gt;make($bootstrapper)-&gt;bootstrap($this); $this['events']-&gt;dispatch('bootstrapped: '.$bootstrapper, [$this]); &#125;&#125; bootstrapWithIoCbootstrapFacade Illuminate\Foundation\Bootstrap\RegisterFacades.php 1234567891011121314151617181920212223242526272829&lt;?phpnamespace Illuminate\Foundation\Bootstrap;use Illuminate\Contracts\Foundation\Application;use Illuminate\Foundation\AliasLoader;use Illuminate\Foundation\PackageManifest;use Illuminate\Support\Facades\Facade;class RegisterFacades&#123; /** * Bootstrap the given application. * * @param \Illuminate\Contracts\Foundation\Application $app * @return void */ public function bootstrap(Application $app) &#123; Facade::clearResolvedInstances(); Facade::setFacadeApplication($app); AliasLoader::getInstance(array_merge( $app-&gt;make('config')-&gt;get('app.aliases', []), $app-&gt;make(PackageManifest::class)-&gt;aliases() ))-&gt;register(); &#125;&#125; bootstrap 1.Facade 2.FacadeIoC 3.configappaliases 4.aliasesAliasLoader 5.AliasLoader-&gt;register() Illuminate\Foundation\AliasLoader.php 1234567891011121314151617181920212223242526272829303132&lt;?phpnamespace Illuminate\Foundation;class AliasLoader&#123; /** * Register the loader on the auto-loader stack. * * @return void */ public function register() &#123; if (! $this-&gt;registered) &#123; $this-&gt;prependToLoaderStack(); $this-&gt;registered = true; &#125; &#125; /** * Prepend the load method to the auto-loader stack. * * @return void */ protected function prependToLoaderStack() &#123; spl_autoload_register([$this, 'load'], true, true); &#125;&#125; spl_autoload_register Aliasesspl_autoload_registerload 123456789101112131415161718/** * Load a class alias if it is registered. * * @param string $alias * @return bool|null */public function load($alias)&#123; if (static::$facadeNamespace &amp;&amp; strpos($alias, static::$facadeNamespace) === 0) &#123; $this-&gt;loadFacade($alias); return true; &#125; if (isset($this-&gt;aliases[$alias])) &#123; return class_alias($this-&gt;aliases[$alias], $alias); &#125;&#125; class_alias?Laravel5.4 FacadeLaravel5.4  1234567891011namespace App\Services;class PaymentGateway&#123; protected $tax; public function __construct(TaxCalculator $tax) &#123; $this-&gt;tax = $tax; &#125;&#125; Laravel5.4 1234567use Facades\ &#123; App\Services\PaymentGateway&#125;;Route::get('/pay/&#123;amount&#125;', function ($amount) &#123; PaymentGateway::pay($amount);&#125;); aliasPaymentGateway =&gt; use Facades\App\Services\PaymentGateway  1234567protected static $facadeNamespace = 'Facades\\';if (static::$facadeNamespace &amp;&amp; strpos($alias, static::$facadeNamespace) === 0)&#123; $this-&gt;loadFacade($alias); return true;&#125; Facades\loadFacade 123456protected function loadFacade($alias)&#123; tap($this-&gt;ensureFacadeExists($alias), function ($path) &#123; require $path; &#125;);&#125; tapLaravelensureFacadeExistsloadFacade 1234567891011121314protected function ensureFacadeExists($alias)&#123; if (file_exists($path = storage_path('framework/cache/facade-'.sha1($alias).'.php'))) &#123; return $path; &#125; file_put_contents( $path, $this-&gt;formatFacadeStub($alias, file_get_contents(__DIR__.'/stubs/facade.stub') )); return $path;&#125; Laravelstroge/framework/cache/facadefile_put_contentsformatFacadeStub 1234567891011121314protected function formatFacadeStub($alias, $stub)&#123; $replacements = [ str_replace('/', '\\', dirname(str_replace('\\', '/', $alias))), class_basename($alias), substr($alias, strlen(static::$facadeNamespace)), ]; return str_replace( ['DummyNamespace', 'DummyClass', 'DummyTarget'], $replacements, $stub );&#125; Facades\App\Services\PaymentGateway$replacementsFacades\App\Services\PaymentGatewayFacades/App/Services/PaymentGatewayFacades/App/Services/Facades\App\Services\PaymentGatewayApp\Services\PaymentGateway 12345678910111213141516171819&lt;?phpnamespace DummyNamespace;use Illuminate\Support\Facades\Facade;/*** @see \DummyTarget*/class DummyClass extends Facade&#123; /** * Get the registered name of the component. * * @return string */ protected static function getFacadeAccessor() &#123; return 'DummyTarget'; &#125;&#125;  12345678910111213141516171819&lt;?phpnamespace Facades\App\Services\;use Illuminate\Support\Facades\Facade;/*** @see \DummyTarget*/class PaymentGateway extends Facade&#123; /** * Get the registered name of the component. * * @return string */ protected static function getFacadeAccessor() &#123; return 'App\Services\PaymentGateway'; &#125;&#125;  ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel ENV/Config-/]]></title>
    <url>%2F2020%2F05%2F18%2FLaravel-ENV-Config-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%8A%A0%E8%BD%BD%E4%B8%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ ENVENVENVENVenv .env.development .env.staging .env.production  APP_ENV nginx 1fastcgi_param APP_ENV production; Laravelenv(APP_ENV)APP_ENVAPP_ENVproductionLaravel.env.production ENVLaravelENVenvbootstrapapp.php 12345$app = new Illuminate\Foundation\Application( realpath(__DIR__.'/../'));$app-&gt;useEnvironmentPath('/customer/path') envbootstrapapp.php 12345$app = new Illuminate\Foundation\Application( realpath(__DIR__.'/../'));$app-&gt;loadEnvironmentFrom('customer.env') ENVLaravelENVENV\Illuminate\Foundation\Bootstrap\LoadEnvironmentVariables::class 123456789101112131415161718public function bootstrap(Application $app)&#123; if ($app-&gt;configurationIsCached()) &#123; return; &#125; $this-&gt;checkForSpecificEnvironmentFile($app); try &#123; $this-&gt;createDotenv($app)-&gt;safeLoad(); &#125; catch (InvalidFileException $e) &#123; $this-&gt;writeErrorAndDie($e); &#125;&#125; APP_ENVcheckForSpecificEnvironmentFileenv 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * Detect if a custom environment file matching the APP_ENV exists. * * @param \Illuminate\Contracts\Foundation\Application $app * @return void */protected function checkForSpecificEnvironmentFile($app)&#123; if ($app-&gt;runningInConsole() &amp;&amp; ($input = new ArgvInput)-&gt;hasParameterOption('--env')) &#123; if ($this-&gt;setEnvironmentFilePath( $app, $app-&gt;environmentFile().'.'.$input-&gt;getParameterOption('--env') )) &#123; return; &#125; &#125; $environment = Env::get('APP_ENV'); if (! $environment) &#123; return; &#125; $this-&gt;setEnvironmentFilePath( $app, $app-&gt;environmentFile().'.'.$environment );&#125;/** * Load a custom environment file. * * @param \Illuminate\Contracts\Foundation\Application $app * @param string $file * @return bool */protected function setEnvironmentFilePath($app, $file)&#123; if (file_exists($app-&gt;environmentPath().'/'.$file)) &#123; $app-&gt;loadEnvironmentFrom($file); return true; &#125; return false;&#125; vlucas/phpdotenv Laravelenvvlucas/phpdotenv 1234567891011121314151617181920class Dotenv&#123; public function __construct($path, $file = '.env') &#123; $this-&gt;filePath = $this-&gt;getFilePath($path, $file); $this-&gt;loader = new Loader($this-&gt;filePath, true); &#125; public function load() &#123; return $this-&gt;loadData(); &#125; protected function loadData($overload = false) &#123; $this-&gt;loader = new Loader($this-&gt;filePath, !$overload); return $this-&gt;loader-&gt;load(); &#125;&#125; env /Dotenv/Loader 1234567891011121314151617181920class Loader&#123; public function load() &#123; $this-&gt;ensureFileIsReadable(); $filePath = $this-&gt;filePath; $lines = $this-&gt;readLinesFromFile($filePath); foreach ($lines as $line) &#123; if (!$this-&gt;isComment($line) &amp;&amp; $this-&gt;looksLikeSetter($line)) &#123; $this-&gt;setEnvironmentVariable($line); &#125; &#125; return $lines; &#125;&#125; env env env   12345678910111213141516171819202122232425262728293031protected function ensureFileIsReadable()&#123; if (!is_readable($this-&gt;filePath) || !is_file($this-&gt;filePath)) &#123; throw new InvalidPathException(sprintf('Unable to read the environment file at %s.', $this-&gt;filePath)); &#125;&#125;protected function readLinesFromFile($filePath)&#123; // Read file into an array of lines with auto-detected lineendings $autodetect = ini_get('auto_detect_line_endings'); ini_set('auto_detect_line_endings', '1'); $lines = file($filePath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES); ini_set('auto_detect_line_endings', $autodetect); return $lines;&#125;protected function isComment($line)&#123; return strpos(ltrim($line), '#') === 0;&#125;protected function looksLikeSetter($line)&#123; return strpos($line, '=') !== false;&#125; envsetEnvironmentVariable 12345678910111213141516171819202122public function setEnvironmentVariable($name, $value = null)&#123; list($name, $value) = $this-&gt;normaliseEnvironmentVariable($name, $value); if ($this-&gt;immutable &amp;&amp; $this-&gt;getEnvironmentVariable($name) !== null) &#123; return; &#125; if (function_exists('apache_getenv') &amp;&amp; function_exists('apache_setenv') &amp;&amp; apache_getenv($name)) &#123; apache_setenv($name, $value); &#125; if (function_exists('putenv')) &#123; putenv("$name=$value"); &#125; $_ENV[$name] = $value; $_SERVER[$name] = $value;&#125; normaliseEnvironmentVariable 123456789101112protected function normaliseEnvironmentVariable($name, $value)&#123; list($name, $value) = $this-&gt;splitCompoundStringIntoParts($name, $value); list($name, $value) = $this-&gt;sanitiseVariableName($name, $value); list($name, $value) = $this-&gt;sanitiseVariableValue($name, $value); $value = $this-&gt;resolveNestedVariables($value); return array($name, $value);&#125; splitCompoundStringIntoPartsnamevalue 12345678protected function splitCompoundStringIntoParts($name, $value)&#123; if (strpos($name, '=') !== false) &#123; list($name, $value) = array_map('trim', explode('=', $name, 2)); &#125; return array($name, $value);&#125; sanitiseVariableName 123456protected function sanitiseVariableName($name, $value)&#123; $name = trim(str_replace(array('export ', '\'', '"'), '', $name)); return array($name, $value);&#125; sanitiseVariableValue 123456789101112131415161718192021222324252627282930313233343536protected function sanitiseVariableValue($name, $value)&#123;$value = trim($value);if (!$value) &#123;return array($name, $value);&#125;if ($this-&gt;beginsWithAQuote($value)) &#123; // value starts witha quote$quote = $value[0];$regexPattern = sprintf('/^%1$s # match a quote at the start of the value( # capturing sub-pattern used(?: # we do not need to capture this|\\\\\\\\ # or two backslashes together|\\\\%1$s # or an escaped quote e.g \")* # as many characters that match the previous rules) # end of the capturing sub-pattern%1$s # and the closing quote.*$ # and discard any string after the closing quote/mx',$quote);$value = preg_replace($regexPattern, '$1', $value);$value = str_replace("\\$quote", $quote, $value);$value = str_replace('\\\\', '\\', $value);&#125; else &#123;$parts = explode(' #', $value, 2);$value = trim($parts[0]);// Unquoted values cannot contain whitespaceif (preg_match('/\s+/', $value) &gt; 0) &#123;throw new InvalidFileException('Dotenv values containing spaces must be surrounded by quotes.');&#125;&#125;return array($name, trim($value));&#125; env # 1/^"((?:[^"\\]|\\\\|\\"))".*$/mx   dfd(dfd)fdf dfd( &quot;  dfd&quot;dfd&quot;fdf,dfd&quot;dfd&quot;fdf \  \ Configconfigconfig\Illuminate\Foundation\Bootstrap\LoadConfiguration::class 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?phpnamespace Illuminate\Foundation\Bootstrap;use Exception;use Illuminate\Config\Repository;use Illuminate\Contracts\Config\Repository as RepositoryContract;use Illuminate\Contracts\Foundation\Application;use SplFileInfo;use Symfony\Component\Finder\Finder;class LoadConfiguration&#123; /** *  * * @param \Illuminate\Contracts\Foundation\Application $app * @return void */ public function bootstrap(Application $app) &#123; $items = []; //  //  if (file_exists($cached = $app-&gt;getCachedConfigPath())) &#123; $items = require $cached; $loadedFromCache = true; &#125; $app-&gt;instance('config', $config = new Repository($items)); //  //  if (! isset($loadedFromCache)) &#123; $this-&gt;loadConfigurationFiles($app, $config); &#125; //  // --envWeb $app-&gt;detectEnvironment(function () use ($config) &#123; return $config-&gt;get('app.env', 'production'); &#125;); date_default_timezone_set($config-&gt;get('app.timezone', 'UTC')); mb_internal_encoding('UTF-8'); &#125;&#125;   loadConfigurationFiles  loadConfigurationFiles 1234567891011121314151617181920212223/** *  * * @param \Illuminate\Contracts\Foundation\Application $app * @param \Illuminate\Contracts\Config\Repository $repository * @return void * * @throws \Exception */protected function loadConfigurationFiles(Application $app, RepositoryContract $repository)&#123; $files = $this-&gt;getConfigurationFiles($app); if (! isset($files['app'])) &#123; throw new Exception('Unable to load the "app" configuration file.'); &#125; foreach ($files as $key =&gt; $path) &#123; $repository-&gt;set($key, require $path); &#125;&#125;  getConfigurationFilesphpfileskey.value 123456789101112131415161718192021222324252627282930313233343536373839404142/** *  * * @param \Illuminate\Contracts\Foundation\Application $app * @return array */protected function getConfigurationFiles(Application $app)&#123; $files = []; $configPath = realpath($app-&gt;configPath()); foreach (Finder::create()-&gt;files()-&gt;name('*.php')-&gt;in($configPath) as $file) &#123; $directory = $this-&gt;getNestedDirectory($file, $configPath); $files[$directory.basename($file-&gt;getRealPath(), '.php')] = $file-&gt;getRealPath(); &#125; ksort($files, SORT_NATURAL); return $files;&#125;/** *  * * @param \SplFileInfo $file * @param string $configPath * @return string */protected function getNestedDirectory(SplFileInfo $file, $configPath)&#123; $directory = $file-&gt;getPath(); if ($nested = trim(str_replace($configPath, '', $directory), DIRECTORY_SEPARATOR)) &#123; $nested = str_replace(DIRECTORY_SEPARATOR, '.', $nested).'.'; &#125; return $nested;&#125; Illuminate\Config\Repository\LoadConfiguration 123456789101112131415161718192021222324252627&lt;?phpnamespace Illuminate\Config;use ArrayAccess;use Illuminate\Contracts\Config\Repository as ConfigContract;use Illuminate\Support\Arr;class Repository implements ArrayAccess, ConfigContract&#123; /** * Set a given configuration value. * * @param array|string $key * @param mixed $value * @return void */ public function set($key, $value = null) &#123; $keys = is_array($key) ? $key : [$key =&gt; $value]; foreach ($keys as $key =&gt; $value) &#123; Arr::set($this-&gt;items, $key, $value); &#125; &#125;&#125; Illuminate\Support\Arr 1234567891011121314151617181920212223242526272829303132333435363738394041class Arr&#123; /** * Set an array item to a given value using "dot" notation. * * If no key is given to the method, the entire array will be replaced. * * @param array $array * @param string|null $key * @param mixed $value * @return array */ public static function set(&amp;$array, $key, $value) &#123; if (is_null($key)) &#123; return $array = $value; &#125; $keys = explode('.', $key); while (count($keys) &gt; 1) &#123; $key = array_shift($keys); // If the key doesn't exist at this depth, we will just create an empty array // to hold the next value, allowing us to create the arrays to hold final // values at the correct depth. Then we'll keep digging into the array. if (! isset($array[$key]) || ! is_array($array[$key])) &#123; $array[$key] = []; &#125; $array = &amp;$array[$key]; &#125; $array[array_shift($keys)] = $value; return $array; &#125;&#125; dir1.dir2.app$array[dir1][dir2][app] config 1234567891011121314151617181920212223242526if (! function_exists('config')) &#123; /** * Get / set the specified configuration value. * * If an array is passed as the key, we will assume you want to set an array of values. * * @param array|string|null $key * @param mixed $default * @return mixed|\Illuminate\Config\Repository */ function config($key = null, $default = null) &#123; if (is_null($key)) &#123; return app('config'); &#125; if (is_array($key)) &#123; return app('config')-&gt;set($key); &#125; return app('config')-&gt;get($key, $default); &#125;&#125;  1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * Get an item from an array using "dot" notation. * * @param \ArrayAccess|array $array * @param string|int|null $key * @param mixed $default * @return mixed */public static function get($array, $key, $default = null)&#123; if (! static::accessible($array)) &#123; return value($default); &#125; if (is_null($key)) &#123; return $array; &#125; if (static::exists($array, $key)) &#123; return $array[$key]; &#125; if (strpos($key, '.') === false) &#123; return $array[$key] ?? value($default); &#125; foreach (explode('.', $key) as $segment) &#123; if (static::accessible($array) &amp;&amp; static::exists($array, $segment)) &#123; $array = $array[$segment]; &#125; else &#123; return value($default); &#125; &#125; return $array;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Event-]]></title>
    <url>%2F2020%2F05%2F17%2FLaravel-Event-%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%90%AF%E5%8A%A8%E4%B8%8E%E8%BF%90%E8%A1%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ LaravelLaravelevent.emailApp\Events\OrderShippedListenerApp\Listeners\SendShipmentNotification ApplicationregisterBaseServiceProviders Illuminate\Foundation\Application.php 1234567891011/** * Register all of the base service providers. * * @return void */protected function registerBaseServiceProviders()&#123; $this-&gt;register(new EventServiceProvider($this)); $this-&gt;register(new LogServiceProvider($this)); $this-&gt;register(new RoutingServiceProvider($this));&#125; EventServiceProvider/Illuminate/Events/EventServiceProvider Illuminate\Support\ServiceProvider.php 1234567891011121314151617181920abstract class ServiceProvider&#123; /** * The application instance. * * @var \Illuminate\Contracts\Foundation\Application */ protected $app; /** * Create a new service provider instance. * * @param \Illuminate\Contracts\Foundation\Application $app * @return void */ public function __construct($app) &#123; $this-&gt;app = $app; &#125;&#125; Illuminate\Events\EventServiceProvider.php 1234567891011121314151617181920212223&lt;?phpnamespace Illuminate\Events;use Illuminate\Contracts\Queue\Factory as QueueFactoryContract;use Illuminate\Support\ServiceProvider;class EventServiceProvider extends ServiceProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton('events', function ($app) &#123; return (new Dispatcher($app))-&gt;setQueueResolver(function () use ($app) &#123; return $app-&gt;make(QueueFactoryContract::class); &#125;); &#125;); &#125;&#125; IoCeventsDispatchereventsQueueResolver /app/Providers/EventServiceProvider 12345678910111213141516171819202122232425class EventServiceProvider extends ServiceProvider&#123; /** * The event listener mappings for the application. * * @var array */ protected $listen = [ 'App\Events\SomeEvent' =&gt; [ 'App\Listeners\EventListener', ], ]; /** * Register any events for your application. * * @return void */ public function boot() &#123; parent::boot(); // &#125;&#125; /Illuminate/Foundation/Support/Providers/EventServiceProvider 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?phpnamespace Illuminate\Foundation\Support\Providers;use Illuminate\Foundation\Events\DiscoverEvents;use Illuminate\Support\Facades\Event;use Illuminate\Support\ServiceProvider;class EventServiceProvider extends ServiceProvider&#123; /** * The event handler mappings for the application. * * @var array */ protected $listen = []; /** * The subscriber classes to register. * * @var array */ protected $subscribe = []; /** * Register the application's event listeners. * * @return void */ public function boot() &#123; $events = $this-&gt;getEvents(); foreach ($events as $event =&gt; $listeners) &#123; foreach (array_unique($listeners) as $listener) &#123; Event::listen($event, $listener); &#125; &#125; foreach ($this-&gt;subscribe as $subscriber) &#123; Event::subscribe($subscriber); &#125; &#125;&#125;  Listen 1234567891011121314151617181920212223242526272829303132333435/** * Register an event listener with the dispatcher. * * @param string|array $events * @param \Closure|string $listener * @return void */public function listen($events, $listener)&#123; foreach ((array) $events as $event) &#123; if (Str::contains($event, '*')) &#123; $this-&gt;setupWildcardListen($event, $listener); &#125; else &#123; $this-&gt;listeners[$event][] = $this-&gt;makeListener($listener); &#125; &#125;&#125;/** * Setup a wildcard listener callback. * * @param string $event * @param \Closure|string $listener * @return void */protected function setupWildcardListen($event, $listener)&#123; $this-&gt;wildcards[$event][] = $this-&gt;makeListener($listener, true); $this-&gt;wildcardsCache = [];&#125; wildcardsmakeListener 12345678910111213141516171819202122232425/** * Register an event listener with the dispatcher. * * @param \Closure|string $listener * @param bool $wildcard * @return \Closure */public function makeListener($listener, $wildcard = false)&#123; if (is_string($listener)) &#123; return $this-&gt;createClassListener($listener, $wildcard); &#125; if (is_array($listener) &amp;&amp; isset($listener[0]) &amp;&amp; is_string($listener[0])) &#123; return $this-&gt;createClassListener($listener, $wildcard); &#125; return function ($event, $payload) use ($listener, $wildcard) &#123; if ($wildcard) &#123; return $listener($event, $payload); &#125; return $listener(...array_values($payload)); &#125;;&#125;  makeListener createClassListener 1234567891011121314151617181920212223242526272829303132333435363738/** * Create a class based listener using the IoC container. * * @param string $listener * @param bool $wildcard * @return \Closure */public function createClassListener($listener, $wildcard = false)&#123; return function ($event, $payload) use ($listener, $wildcard) &#123; if ($wildcard) &#123; return call_user_func($this-&gt;createClassCallable($listener), $event, $payload); &#125; return call_user_func_array( $this-&gt;createClassCallable($listener), $payload ); &#125;;&#125;/** * Create the class based event callable. * * @param array|string $listener * @return callable */protected function createClassCallable($listener)&#123; [$class, $method] = is_array($listener) ? $listener : $this-&gt;parseClassCallable($listener); if ($this-&gt;handlerShouldBeQueued($class)) &#123; return $this-&gt;createQueuedHandlerCallable($class, $method); &#125; return [$this-&gt;container-&gt;make($class), $method];&#125;  12345678910/** * Parse the class listener into class and method. * * @param string $listener * @return array */protected function parseClassCallable($listener)&#123; return Str::parseCallback($listener, 'handle');&#125; handle   12345678910111213141516171819202122232425262728293031323334353637383940414243444546/** *  * * @param string|object $event * @param mixed $payload * @param bool $halt * @return array|null */public function dispatch($event, $payload = [], $halt = false)&#123; //  //  [$event, $payload] = $this-&gt;parseEventAndPayload( $event, $payload ); if ($this-&gt;shouldBroadcast($payload)) &#123; $this-&gt;broadcastEvent($payload[0]); &#125; $responses = []; foreach ($this-&gt;getListeners($event) as $listener) &#123; $response = $listener($event, $payload); //  //  if ($halt &amp;&amp; ! is_null($response)) &#123; return $response; &#125; // false //  if ($response === false) &#123; break; &#125; $responses[] = $response; &#125; return $halt ? null : $responses;&#125; parseEventAndPayload 12345678910111213141516/** *  * * @param mixed $event * @param mixed $payload * @return array */protected function parseEventAndPayload($event, $payload)&#123; if (is_object($event)) &#123; [$payload, $event] = [[$event], get_class($event)]; &#125; return [$event, Arr::wrap($payload)];&#125;   12345678910111213141516171819/** * Get all of the listeners for a given event name. * * @param string $eventName * @return array */public function getListeners($eventName)&#123; $listeners = $this-&gt;listeners[$eventName] ?? []; $listeners = array_merge( $listeners, $this-&gt;wildcardsCache[$eventName] ?? $this-&gt;getWildcardListeners($eventName) ); return class_exists($eventName, false) ? $this-&gt;addInterfaceListeners($eventName, $listeners) : $listeners;&#125;  1234567891011121314protected function getWildcardListeners($eventName)&#123; $wildcards = []; foreach ($this-&gt;wildcards as $key =&gt; $listeners) &#123; if (Str::is($key, $eventName)) &#123; $wildcards = array_merge($wildcards, $listeners); &#125; &#125; return $wildcards;&#125;   halttrue 1234567891011121314151617public function testHaltingEventExecution()&#123; unset($_SERVER['__event.test']); $d = new Dispatcher; $d-&gt;listen('foo', function ($foo) &#123; $this-&gt;assertTrue(true); return 'here'; &#125;); $d-&gt;listen('foo', function ($foo) &#123; throw new Exception('should not be called'); &#125;); $d-&gt;until('foo', ['bar']);&#125; false pushpush 123456789101112131415161718public function testQueuedEventsAreFired()&#123; unset($_SERVER['__event.test']); $d = new Dispatcher; $d-&gt;push('update', ['name' =&gt; 'taylor']); $d-&gt;listen('update', function ($name) &#123; $_SERVER['__event.test'] = $name; &#125;); $this-&gt;assertFalse(isset($_SERVER['__event.test'])); $d-&gt;flush('update'); $this-&gt;assertEquals('taylor', $_SERVER['__event.test']);&#125;  123456789101112131415161718192021222324/** * Register an event and payload to be fired later. * * @param string $event * @param array $payload * @return void */public function push($event, $payload = [])&#123; $this-&gt;listen($event.'_pushed', function () use ($event, $payload) &#123; $this-&gt;dispatch($event, $payload); &#125;);&#125;/** * Flush a set of pushed events. * * @param string $event * @return void */public function flush($event)&#123; $this-&gt;dispatch($event.'_pushed');&#125; EloquentLaravel  12345678910111213class EventServiceProvider extends ServiceProvider&#123; public function boot() &#123; parent::boot(); User::saved(function(User$user) &#123; &#125;); User::saved('UserSavedListener@saved'); &#125;&#125;  123456789101112class UserObserver&#123; public function created(User $user) &#123; &#125; public function saved(User $user) &#123; &#125;&#125; boot 123456789101112class AppServiceProvider extends ServiceProvider&#123; public function boot() &#123; User::observe(UserObserver::class); &#125; public function register() &#123; &#125;&#125; eloquent.{$event}:{static::class}  123456789101112131415161718192021222324252627/** * Register a saved model event with the dispatcher. * * @param \Closure|string $callback * @return void */public static function saved($callback)&#123; static::registerModelEvent('saved', $callback);&#125; /** * Register a model event with the dispatcher. * * @param string $event * @param \Closure|string $callback * @return void */protected static function registerModelEvent($event, $callback)&#123; if (isset(static::$dispatcher)) &#123; $name = static::class; static::$dispatcher-&gt;listen("eloquent.&#123;$event&#125;: &#123;$name&#125;", $callback); &#125;&#125;  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * Register observers with the model. * * @param object|array|string $classes * @return void * * @throws \RuntimeException */public static function observe($classes)&#123; $instance = new static; foreach (Arr::wrap($classes) as $class) &#123; $instance-&gt;registerObserver($class); &#125;&#125;/** * Register a single observer with the model. * * @param object|string $class * @return void * * @throws \RuntimeException */protected function registerObserver($class)&#123; $className = $this-&gt;resolveObserverClassName($class); //  //  foreach ($this-&gt;getObservableEvents() as $event) &#123; if (method_exists($class, $event)) &#123; static::registerModelEvent($event, $className.'@'.$event); &#125; &#125;&#125;/** * Get the observable event names. * * @return array */public function getObservableEvents()&#123; return array_merge( [ 'retrieved', 'creating', 'created', 'updating', 'updated', 'saving', 'saved', 'restoring', 'restored', 'replicating', 'deleting', 'deleted', 'forceDeleted', ], $this-&gt;observables );&#125; fireModelEvent 12345678910111213141516171819202122232425262728293031/** * Fire the given event for the model. * * @param string $event * @param bool $halt * @return mixed */protected function fireModelEvent($event, $halt = true)&#123; if (! isset(static::$dispatcher)) &#123; return true; &#125; //  //  $method = $halt ? 'until' : 'dispatch'; $result = $this-&gt;filterModelEventResults( $this-&gt;fireCustomModelEvent($event, $method) ); if ($result === false) &#123; return false; &#125; return ! empty($result) ? $result : static::$dispatcher-&gt;&#123;$method&#125;( "eloquent.&#123;$event&#125;: ".static::class, $this );&#125; fireCustomModelEvent 123456789101112131415161718192021/** * Fire a custom model event for the given event. * * @param string $event * @param string $method * @return mixed|null */protected function fireCustomModelEvent($event, $method)&#123; if (! isset($this-&gt;dispatchesEvents[$event])) &#123; return; &#125; $result = static::$dispatcher-&gt;$method(new $this-&gt;dispatchesEvents[$event]($this)); if (! is_null($result)) &#123; return $result; &#125;&#125;  until]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Container-IoC]]></title>
    <url>%2F2020%2F05%2F14%2FLaravel-Container-IoC%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%2F</url>
    <content type="text"><![CDATA[ IoCIoC Laravel LaravelIoC __constructnewDI   LaravelLaravel  PHP  bindbind  1234567891011121314151617181920212223242526272829$this-&gt;app-&gt;bind('App\Services\RedisEventPusher', null);$this-&gt;app-&gt;bind('name', function () &#123; return 'Taylor';&#125;); // $this-&gt;app-&gt;bind('HelpSpot\API', function () &#123; return HelpSpot\API::class;&#125;); // public function testSharedClosureResolution()&#123; $container = new Container; $class = new stdClass; $container-&gt;bind('class', function () use ($class) &#123; return $class; &#125;); $this-&gt;assertSame($class, $container-&gt;make('class'));&#125; // $this-&gt;app-&gt;bind('HelpSpot\API', function () &#123; return new HelpSpot\API();&#125;);// $this-&gt;app-&gt;bind('HelpSpot\API', function ($app) &#123; return new HelpSpot\API($app-&gt;make('HttpClient'));&#125;);//   1234567891011121314151617181920212223242526272829public function testCanBuildWithoutParameterStackWithConstructors()&#123; $container = new Container; $container-&gt;bind('Illuminate\Tests\Container\IContainerContractStub', 'Illuminate\Tests\Container\ContainerImplementationStub'); $this-&gt;assertInstanceOf( ContainerDependentStub::class, $container-&gt;build(ContainerDependentStub::class) );&#125;interface IContainerContractStub&#123;&#125;class ContainerImplementationStub implements IContainerContractStub&#123;&#125;class ContainerDependentStub&#123; public $impl; public function __construct(IContainerContractStub $impl) &#123; $this-&gt;impl = $impl; &#125;&#125;  bindif 1234567891011121314public function testBindIfDoesntRegisterIfServiceAlreadyRegistered()&#123; $container = new Container; $container-&gt;bind('name', function ()&#123; return 'Taylor'; &#125;); $container-&gt;bindIf('name', function () &#123; return 'Dayle'; &#125;); $this-&gt;assertEquals('Taylor', $container-&gt;make('name'));&#125; singleton singleton 123$this-&gt;app-&gt;singleton('HelpSpot\API', function ($app) &#123; return new HelpSpot\API($app-&gt;make('HttpClient'));&#125;); singleton 123456789101112public function testSingletonBindingsNotRespectedWithMakeParameters()&#123; $container = new Container; $container-&gt;singleton('foo', function ($app, $config) &#123; return $config; &#125;); $this-&gt;assertEquals(['name' =&gt; 'taylor'], $container-&gt;makeWith('foo', ['name' =&gt; 'taylor'])); $this-&gt;assertEquals(['name' =&gt; 'abigail'], $container-&gt;makeWith('foo', ['name' =&gt; 'abigail']));&#125; instance instance 12$api = new HelpSpot\API(new HttpClient);$this-&gt;app-&gt;instance('HelpSpot\Api', $api); Context Illuminate\Contracts\Filesystem\FilesystemLaravel 12345678910111213141516171819202122use Illuminate\Support\Facades\Storage;use App\Http\Controllers\VideoController;use App\Http\Controllers\PhotoControllers;use Illuminate\Contracts\Filesystem\Filesystem;$this-&gt;app-&gt;when(StorageController::class) -&gt;needs(Filesystem::class) -&gt;give(function () &#123; Storage::class &#125;); // $this-&gt;app-&gt;when(PhotoController::class) -&gt;needs(Filesystem::class) -&gt;give(function () &#123; return new Storage(); &#125;); // $this-&gt;app-&gt;when(VideoController::class) -&gt;needs(Filesystem::class) -&gt;give(function () &#123; return new Storage($app-&gt;make(Disk::class)); &#125;); //    123$this-&gt;app-&gt;when('App\Http\Controllers\UserController') -&gt;needs('$variableName') -&gt;give($value);  , 1234567891011121314151617public function testArrayAccess()&#123; $container = new Container; $container[IContainerContractStub::class] = ContainerImplementationStub::class; $this-&gt;assertTrue(isset($container[IContainerContractStub::class])); $this-&gt;assertEquals( ContainerImplementationStub::class, $container[IContainerContractStub::class] ); unset($container['something']); $this-&gt;assertFalse(isset($container['something']));&#125;  ReportReporttag 123456789$this-&gt;app-&gt;bind('SpeedReport', function () &#123;//&#125;);$this-&gt;app-&gt;bind('MemoryReport', function () &#123;//&#125;);$this-&gt;app-&gt;tag(['SpeedReport', 'MemoryReport'], 'reports'); tagged 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061$this-&gt;app-&gt;bind('ReportAggregator', function ($app) &#123; return new ReportAggregator($app-&gt;tagged('reports'));&#125;);public function testContainerTags()&#123; $container = new Container; $container-&gt;tag( 'Illuminate\Tests\Container\ContainerImplementationStub', 'foo', 'bar' ); $container-&gt;tag( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', ['foo'] ); $this-&gt;assertCount(1, $container-&gt;tagged('bar')); $this-&gt;assertCount(2, $container-&gt;tagged('foo')); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStub', $container-&gt;tagged('foo')[0] ); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStub', $container-&gt;tagged('bar')[0] ); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', $container-&gt;tagged('foo')[1] ); $container = new Container; $container-&gt;tag( [ 'Illuminate\Tests\Container\ContainerImplementationStub', 'Illuminate\Tests\Container\ContainerImplementationStubTwo' ], ['foo'] ); $this-&gt;assertCount(2, $container-&gt;tagged('foo')); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStub', $container-&gt;tagged('foo')[0] ); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', $container-&gt;tagged('foo')[1] ); $this-&gt;assertEmpty($container-&gt;tagged('this_tag_does_not_exist'));&#125; extend extend 123456789101112131415161718192021222324252627282930public function testExtendInstancesArePreserved()&#123; $container = new Container; $container-&gt;bind('foo', function () &#123; $obj = new StdClass; $obj-&gt;foo = 'bar'; return $obj; &#125;); $obj = new StdClass; $obj-&gt;foo = 'foo'; $container-&gt;instance('foo', $obj); $container-&gt;extend('foo', function ($obj, $container) &#123; $obj-&gt;bar = 'baz'; return $obj; &#125;); $container-&gt;extend('foo', function ($obj, $container) &#123; $obj-&gt;baz = 'foo'; return $obj; &#125;); $this-&gt;assertEquals('foo', $container-&gt;make('foo')-&gt;foo); $this-&gt;assertEquals('baz', $container-&gt;make('foo')-&gt;bar); $this-&gt;assertEquals('foo', $container-&gt;make('foo')-&gt;baz);&#125; ReboundsRebindingrebinding 1234567891011121314151617181920212223242526272829303132333435abstract class Car&#123; public function __construct(Fuel $fuel) &#123; $this-&gt;fuel = $fuel; &#125; public function refuel($litres) &#123; return $litres * $this-&gt;fuel-&gt;getPrice(); &#125; public function setFuel(Fuel $fuel) &#123; $this-&gt;fuel = $fuel; &#125;&#125;class JeepWrangler extends Car&#123;//&#125;interface Fuel&#123; public function getPrice();&#125;class Petrol implements Fuel&#123; public function getPrice() &#123; return 130.7; &#125;&#125; carfuel 123456789$this-&gt;app-&gt;bind('fuel', function ($app) &#123; return new Petrol;&#125;);$this-&gt;app-&gt;bind('car', function ($app) &#123; return new JeepWrangler($app['fuel']);&#125;);$this-&gt;app-&gt;make('car'); carfuelPetrol PremiumPetrol 123$this-&gt;app-&gt;bind('fuel', function ($app) &#123; return new PremiumPetrol;&#125;); carcarcarfuelfuelfuelcarfuelrebinding 12345678910$this-&gt;app-&gt;bindShared('car', function ($app) &#123; return new JeepWrangler( $app-&gt;rebinding( 'fuel', function ($app, $fuel) &#123; $app['car']-&gt;setFuel($fuel); &#125; ) );&#125;); Facade(config/app) auth 1$this-&gt;app-&gt;make('auth')  1$this-&gt;app-&gt;make('\Illuminate\Auth\AuthManager::class')  1$this-&gt;app-&gt;make('\Illuminate\Contracts\Auth\Factory::class') authauth  123app()-&gt;alias('service', 'alias_a');app()-&gt;alias('alias_a', 'alias_b');app()-&gt;alias('alias_b', 'alias_c');  123'alias_a' =&gt; 'service''alias_b' =&gt; 'alias_a''alias_c' =&gt; 'alias_b' aliases 12345678910111213141516171819202122$aliases = [ 'app' =&gt; [ \Illuminate\Foundation\Application::class, \Illuminate\Contracts\Container\Container::class, \Illuminate\Contracts\Foundation\Application::class ], 'auth' =&gt; [ \Illuminate\Auth\AuthManager::class, \Illuminate\Contracts\Auth\Factory::class ], 'auth.driver' =&gt; [ \Illuminate\Contracts\Auth\Guard::class ], 'blade.compiler' =&gt; [ \Illuminate\View\Compilers\BladeCompiler::class ], 'cache' =&gt; [ \Illuminate\Cache\CacheManager::class, \Illuminate\Contracts\Cache\Factory::class ], ...]  12345678910111213141516public function registerCoreContainerAliases()&#123; foreach ($aliases as $key =&gt; $aliases) &#123; foreach ($aliases as $alias) &#123; $this-&gt;alias($key, $alias); &#125; &#125;&#125;public function alias($abstract, $alias)&#123; $this-&gt;aliases[$alias] = $abstract; $this-&gt;abstractAliases[$abstract][] = $alias;&#125; aliasesabstractAliases 123456789101112131415161718192021222324252627282930$aliases = [ 'Illuminate\Foundation\Application' = "app" 'Illuminate\Contracts\Container\Container' = "app" 'Illuminate\Contracts\Foundation\Application' = "app" 'Illuminate\Auth\AuthManager' = "auth" 'Illuminate\Contracts\Auth\Factory' = "auth" 'Illuminate\Contracts\Auth\Guard' = "auth.driver" 'Illuminate\View\Compilers\BladeCompiler' = "blade.compiler" 'Illuminate\Cache\CacheManager' = "cache" 'Illuminate\Contracts\Cache\Factory' = "cache" ...$abstractAliases = [ app = &#123;array&#125; [3] 0 = "Illuminate\Foundation\Application" 1 = "Illuminate\Contracts\Container\Container" 2 = "Illuminate\Contracts\Foundation\Application" auth = &#123;array&#125; [2] 0 = "Illuminate\Auth\AuthManager" 1 = "Illuminate\Contracts\Auth\Factory" auth.driver = &#123;array&#125; [1] 0 = "Illuminate\Contracts\Auth\Guard" blade.compiler = &#123;array&#125; [1] 0 = "Illuminate\View\Compilers\BladeCompiler" cache = &#123;array&#125; [2] 0 = "Illuminate\Cache\CacheManager" 1 = "Illuminate\Contracts\Cache\Factory" ...] makemake 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115public function testAutoConcreteResolution()&#123; $container = new Container; $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerConcreteStub', $container-&gt;make('Illuminate\Tests\Container\ContainerConcreteStub') );&#125;// public function testResolutionOfDefaultParameters()&#123; $container = new Container; $instance = $container-&gt;make( 'Illuminate\Tests\Container\ContainerDefaultValueStub' ); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerConcreteStub', $instance-&gt;stub ); $this-&gt;assertEquals('taylor', $instance-&gt;default);&#125;//public function testResolvingWithArrayOfParameters()&#123; $container = new Container; $instance = $container-&gt;makeWith( ContainerDefaultValueStub::class, ['default' =&gt; 'adam'] ); $this-&gt;assertEquals('adam', $instance-&gt;default); $instance = $container-&gt;make(ContainerDefaultValueStub::class); $this-&gt;assertEquals('taylor', $instance-&gt;default); $container-&gt;bind('foo', function ($app, $config) &#123; return $config; &#125;); $this-&gt;assertEquals( [1, 2, 3], $container-&gt;makeWith('foo', [1, 2, 3]) );&#125;public function testNestedDependencyResolution()&#123; $container = new Container; $container-&gt;bind( 'Illuminate\Tests\Container\IContainerContractStub', 'Illuminate\Tests\Container\ContainerImplementationStub' ); $class = $container-&gt;make( 'Illuminate\Tests\Container\ContainerNestedDependentStub'); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerDependentStub', $class-&gt;inner ); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStub', $class-&gt;inner-&gt;impl );&#125;class ContainerDefaultValueStub&#123; public $stub; public $default; public function __construct(ContainerConcreteStub $stub, $default = 'taylor') &#123; $this-&gt;stub = $stub; $this-&gt;default = $default; &#125;&#125;class ContainerConcreteStub&#123;&#125;class ContainerImplementationStub implements IContainerContractStub&#123;&#125;class ContainerDependentStub&#123; public $impl; public function __construct(IContainerContractStub $impl) &#123; $this-&gt;impl = $impl; &#125;&#125;class ContainerNestedDependentStub&#123; public $inner; public function __construct(ContainerDependentStub $inner) &#123; $this-&gt;inner = $inner; &#125;&#125; $appresolve 1$api = resolve('HelpSpot\API'); 12345678910111213141516171819202122namespace App\Http\Controllers;use App\Users\Repository as UserRepository;class UserController extends Controller&#123; /** *  */ protected $users; /** *  * * @param UserRepository $users  * @return void */ public function __construct(UserRepository $users) &#123; $this-&gt;users = $users; &#125;&#125; callmakemakecall 123456789101112131415161718192021222324class TaskRepository&#123; public function testContainerCall(User $user,Task $task) &#123; $this-&gt;assertInstanceOf(User::class, $user); $this-&gt;assertInstanceOf(Task::class, $task); &#125; public static function testContainerCallStatic(User $user,Task $task) &#123; $this-&gt;assertInstanceOf(User::class, $user); $this-&gt;assertInstanceOf(Task::class, $task); &#125; public function testCallback() &#123; echo 'call callback successfully!'; &#125; public function testDefaultMethod() &#123; echo 'default Method successfully!'; &#125;&#125; 12345678910111213141516171819public function testCallWithDependencies()&#123; $container = new Container; $result = $container-&gt;call(function (StdClass $foo, $bar =[]) &#123; return func_get_args(); &#125;); $this-&gt;assertInstanceOf('stdClass', $result[0]); $this-&gt;assertEquals([], $result[1]); $result = $container-&gt;call(function (StdClass $foo, $bar =[]) &#123; return func_get_args(); &#125;, ['bar' =&gt; 'taylor']); $this-&gt;assertInstanceOf('stdClass', $result[0]); $this-&gt;assertEquals('taylor', $result[1]);&#125; 12345678910111213public function testCallWithGlobalMethodName()&#123; $container = new Container; $result = $container-&gt;call('Illuminate\Tests\Container\containerTestInject'); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerConcreteStub', $result[0] ); $this-&gt;assertEquals('taylor', $result[1]);&#125; callcall_user_func_array()LaravelCallback Type -  123456789class ContainerCallTest&#123; public function testContainerCallStatic() &#123; App::call(TaskRepository::class.'@testContainerCallStatic'); App::call(TaskRepository::class.'::testContainerCallStatic'); App::call([TaskRepository::class,'testContainerCallStatic']); &#125;&#125;  TaskRepository::class  123456789class ContainerCallTest&#123; public function testContainerCall() &#123; $taskRepo = new TaskRepository(); App::call(TaskRepository::class.'@testContainerCall'); App::call([$taskRepo,'testContainerCall']); &#125;&#125;  call_user_func_array bindmethodbindmethod 1234567891011121314151617181920212223public function testContainCallMethodBind()&#123; App::bindMethod(TaskRepository::class.'@testContainerCallStatic',function () &#123; $taskRepo = new TaskRepository(); $taskRepo-&gt;testCallback(); &#125;); App::call(TaskRepository::class.'@testContainerCallStatic'); App::call(TaskRepository::class.'::testContainerCallStatic'); App::call([TaskRepository::class,'testContainerCallStatic']); App::bindMethod( TaskRepository::class.'@testContainerCall', function (TaskRepository $taskRepo) &#123; $taskRepo-&gt;testCallback(); &#125; ); $taskRepo = new TaskRepository(); App::call(TaskRepository::class.'@testContainerCall'); App::call([$taskRepo,'testContainerCall']);&#125; bindmethod:: 1234567891011121314151617181920212223242526272829303132333435363738public function testCallWithBoundMethod()&#123; $container = new Container; $container-&gt;bindMethod( 'Illuminate\Tests\Container\ContainerTestCallStub@unresolvable', function ($stub) &#123; return $stub-&gt;unresolvable('foo', 'bar'); &#125; ); $result = $container-&gt;call( 'Illuminate\Tests\Container\ContainerTestCallStub@unresolvable' ); $this-&gt;assertEquals(['foo', 'bar'], $result); $container = new Container; $container-&gt;bindMethod( 'Illuminate\Tests\Container\ContainerTestCallStub@unresolvable', function ($stub) &#123; return $stub-&gt;unresolvable('foo', 'bar'); &#125; ); $result = $container-&gt;call([new ContainerTestCallStub, 'unresolvable']); $this-&gt;assertEquals(['foo', 'bar'], $result);&#125;class ContainerTestCallStub&#123; public function unresolvable($foo, $bar) &#123; return func_get_args(); &#125;&#125; 1234567891011121314151617181920212223public function testContainCallDefultMethod()&#123; App::call(TaskRepository::class,[],'testContainerCall'); App::call(TaskRepository::class,[],'testContainerCallStatic'); App::bindMethod( TaskRepository::class.'@testContainerCallStatic', function () &#123; $taskRepo = new TaskRepository(); $taskRepo-&gt;testCallback(); &#125; ); App::bindMethod( TaskRepository::class.'@testContainerCall', function (TaskRepository $taskRepo) &#123; $taskRepo-&gt;testCallback(); &#125; ); App::call(TaskRepository::class,[],'testContainerCall'); App::call(TaskRepository::class,[],'testContainerCallStatic');&#125; bindmethod app()[service];app($service)app(service); resolving 123456789101112131415$this-&gt;app-&gt;resolving(function ($object, $app) &#123; // ...&#125;);$this-&gt;app-&gt;resolving(HelpSpot\API::class, function ($api, $app)&#123; // HelpSpot\API...&#125;);$this-&gt;app-&gt;afterResolving(function ($object, $app) &#123; // ...&#125;);$this-&gt;app-&gt;afterResolving(HelpSpot\API::class, function ($api, $app) &#123; // HelpSpot\API...&#125;); resolvingafterResolving  123456789101112131415161718192021222324252627282930313233343536373839public function testResolvingCallbacksAreCalled()&#123;$container = new Container;$container-&gt;resolving(function ($object) &#123;return $object-&gt;name = 'taylor';&#125;);$container-&gt;bind('foo', function () &#123;return new StdClass;&#125;);$instance = $container-&gt;make('foo');$this-&gt;assertEquals('taylor', $instance-&gt;name);&#125;public function testResolvingCallbacksAreCalledForType()&#123;$container = new Container;$container-&gt;resolving('StdClass', function ($object) &#123;return $object-&gt;name = 'taylor';&#125;);$container-&gt;bind('foo', function () &#123;return new StdClass;&#125;);$instance = $container-&gt;make('foo');$this-&gt;assertEquals('taylor', $instance-&gt;name);&#125;public function testResolvingCallbacksShouldBeFiredWhenCalledWithAliases()&#123;$container = new Container;$container-&gt;alias('StdClass', 'std');$container-&gt;resolving('std', function ($object) &#123;return $object-&gt;name = 'taylor';&#125;);$container-&gt;bind('foo', function () &#123;return new StdClass;&#125;);$instance = $container-&gt;make('foo');$this-&gt;assertEquals('taylor', $instance-&gt;name);&#125; wrapcallfactorymake 1234567891011121314151617181920212223242526public function testContainerWrap()&#123; $result = $container-&gt;wrap(function (StdClass $foo, $bar =[]) &#123; return func_get_args(); &#125;, ['bar' =&gt; 'taylor']); $this-&gt;assertInstanceOf('Closure', $result); $result = $result(); $this-&gt;assertInstanceOf('stdClass', $result[0]); $this-&gt;assertEquals('taylor', $result[1]);&#125;public function testContainerGetFactory()&#123; $container = new Container; $container-&gt;bind('name', function () &#123; return 'Taylor'; &#125;); $factory = $container-&gt;factory('name'); $this-&gt;assertEquals($container-&gt;make('name'), $factory());&#125; flushflushaliasesabstractAliasesresolvedbindingsinstances 123456789101112131415161718192021222324252627public function testContainerFlushFlushesAllBindingsAliasesAndResolvedInstances()&#123; $container = new Container; $container-&gt;bind('ConcreteStub', function () &#123; return new ContainerConcreteStub; &#125;, true); $container-&gt;alias('ConcreteStub', 'ContainerConcreteStub'); $concreteStubInstance = $container-&gt;make('ConcreteStub'); $this-&gt;assertTrue($container-&gt;resolved('ConcreteStub')); $this-&gt;assertTrue($container-&gt;isAlias('ContainerConcreteStub')); $this-&gt;assertArrayHasKey('ConcreteStub', $container-&gt;getBindings()); $this-&gt;assertTrue($container-&gt;isShared('ConcreteStub')); $container-&gt;flush(); $this-&gt;assertFalse($container-&gt;resolved('ConcreteStub')); $this-&gt;assertFalse($container-&gt;isAlias('ContainerConcreteStub')); $this-&gt;assertEmpty($container-&gt;getBindings()); $this-&gt;assertFalse($container-&gt;isShared('ConcreteStub'));&#125; IoCIoc Laravelsrc/illuminate/tests/Container/ContainerTest.php rebind rebindinstancebindrebindbindrebind 12345678910111213141516171819202122public function testReboundListeners()&#123; unset($_SERVER['__test.rebind']); $container = new Container; $container-&gt;rebinding('foo', function () &#123; $_SERVER['__test.rebind'] = true; &#125;); $container-&gt;bind('foo', function () &#123; &#125;); $container-&gt;make('foo'); $container-&gt;bind('foo', function () &#123; &#125;); $this-&gt;assertTrue($_SERVER['__test.rebind']);&#125; rebinding 1234567891011121314151617181920public function testReboundListeners()&#123; unset($_SERVER['__test.rebind']); $container = new Container; $container-&gt;rebinding('foo', function () &#123; $_SERVER['__test.rebind'] = true; &#125;); $container-&gt;bind('foo', function () &#123; &#125;); $container-&gt;bind('foo', function () &#123; &#125;); $this-&gt;assertFalse(isset($_SERVER['__test.rebind']));&#125; instance 1234567891011121314151617181920public function testReboundListeners()&#123; unset($_SERVER['__test.rebind']); $container = new Container; $container-&gt;rebinding('foo', function () &#123; $_SERVER['__test.rebind'] = true; &#125;); $container-&gt;bind('foo', function () &#123; &#125;); $container-&gt;instance('foo', function () &#123; &#125;); $this-&gt;assertTrue(isset($_SERVER['__test.rebind']));&#125; rebinding instance  rebinding  rebound  bind  rebinding  resolved .  instance  bind  rebind rebindrebind 12345678public function rebinding($abstract, Closure $callback)&#123; $this-&gt;reboundCallbacks[$abstract = $this-&gt;getAlias($abstract)][] = $callback; if ($this-&gt;bound($abstract)) &#123; return $this-&gt;make($abstract); &#125;&#125;  12345678910111213141516171819202122232425public function testReboundListeners1()&#123; unset($_SERVER['__test.rebind']); $container = new Container; $container-&gt;bind('foo', function () &#123; return 'foo'; &#125;); $container-&gt;resolving('foo', function () &#123; $_SERVER['__test.rebind'] = true; &#125;); $container-&gt;rebinding('foo', function ($container,$object) &#123; //  $container['foobar'] = $object.'bar'; &#125;); $this-&gt;assertTrue($_SERVER['__test.rebind']); $container-&gt;bind('foo', function () &#123; &#125;); $this-&gt;assertEquals('bar', $container['foobar']);&#125; resolvingresolving resolving 1234567891011121314151617181920212223242526272829303132333435public function testResolvingCallbacksAreCalledForType()&#123; $container = new Container; $container-&gt;resolving('StdClass', function ($object) &#123; return $object-&gt;name = 'taylor'; &#125;); $container-&gt;bind('foo', function () &#123; return new StdClass; &#125;); $instance = $container-&gt;make('foo'); $this-&gt;assertEquals('taylor', $instance-&gt;name);&#125;public function testResolvingCallbacksShouldBeFiredWhenCalledWithAliases()&#123; $container = new Container; $container-&gt;alias('StdClass', 'std'); $container-&gt;resolving('std', function ($object) &#123; return $object-&gt;name = 'taylor'; &#125;); $container-&gt;bind('foo', function () &#123; return new StdClass; &#125;); $instance = $container-&gt;make('foo'); $this-&gt;assertEquals('taylor', $instance-&gt;name);&#125; resolvinginstancesingletonresolvingsingleton instanceresolving 1234567891011121314public function testResolvingCallbacksAreCalledForSpecificAbstracts()&#123; $container = new Container; $container-&gt;resolving('foo', function ($object) &#123; return $object-&gt;name = 'taylor'; &#125;); $obj = new StdClass; $container-&gt;instance('foo', $obj); $instance = $container-&gt;make('foo'); $this-&gt;assertFalse(isset($instance-&gt;name));&#125; extendextend 12345678910111213141516171819202122public function testExtendIsLazyInitialized()&#123; ContainerLazyExtendStub::$initialized = false; $container = new Container; $container-&gt;extend( 'Illuminate\Tests\Container\ContainerLazyExtendStub', function ($obj, $container) &#123; $obj-&gt;init(); return $obj; &#125; ); $container-&gt;bind('Illuminate\Tests\Container\ContainerLazyExtendStub'); $this-&gt;assertFalse(ContainerLazyExtendStub::$initialized); $container-&gt;make('Illuminate\Tests\Container\ContainerLazyExtendStub'); $this-&gt;assertTrue(ContainerLazyExtendStub::$initialized);&#125;  1234567891011121314151617181920public function testExtendIsLazyInitialized()&#123; ContainerLazyExtendStub::$initialized = false; $container = new Container; $container-&gt;bind('Illuminate\Tests\Container\ContainerLazyExtendStub'); $container-&gt;extend( 'Illuminate\Tests\Container\ContainerLazyExtendStub', function ($obj, $container) &#123; $obj-&gt;init(); return $obj; &#125; ); $this-&gt;assertFalse(ContainerLazyExtendStub::$initialized); $container-&gt;make('Illuminate\Tests\Container\ContainerLazyExtendStub'); $this-&gt;assertTrue(ContainerLazyExtendStub::$initialized);&#125;  1234567891011121314151617181920212223public function testExtendIsLazyInitialized()&#123; ContainerLazyExtendStub::$initialized = false; $container = new Container; $container-&gt;bind('Illuminate\Tests\Container\ContainerLazyExtendStub'); $container-&gt;make('Illuminate\Tests\Container\ContainerLazyExtendStub'); $this-&gt;assertFalse(ContainerLazyExtendStub::$initialized); $container-&gt;extend( 'Illuminate\Tests\Container\ContainerLazyExtendStub', function ($obj, $container) &#123; $obj-&gt;init(); return $obj; &#125; ); $this-&gt;assertFalse(ContainerLazyExtendStub::$initialized); $container-&gt;make('Illuminate\Tests\Container\ContainerLazyExtendStub'); $this-&gt;assertTrue(ContainerLazyExtendStub::$initialized);&#125; extendlazyextendmake extendinstanceinstanceextendinstancelazy 123456789101112131415161718192021public function testExtendInstancesArePreserved()&#123; $container = new Container; $obj = new StdClass; $obj-&gt;foo = 'foo'; $container-&gt;instance('foo', $obj); $container-&gt;extend( 'foo', function ($obj, $container) &#123; $obj-&gt;bar = 'baz'; return $obj; &#125; ); $this-&gt;assertEquals('foo', $container-&gt;make('foo')-&gt;foo); $this-&gt;assertEquals('baz', $container-&gt;make('foo')-&gt;bar);&#125; extendrebindinstancebindextendrebind 1234567891011121314151617181920212223242526272829303132333435363738394041424344public function testExtendReBindingInstance()&#123; $_SERVER['_test_rebind'] = false; $container = new Container; $container-&gt;rebinding('foo',function ()&#123; $_SERVER['_test_rebind'] = true; &#125;); $obj = new StdClass; $container-&gt;instance('foo',$obj); $container-&gt;make('foo'); $container-&gt;extend('foo', function ($obj, $container) &#123; return $obj; &#125;); $this-&gt;assertTrue($_SERVER['_test_rebind']);&#125;public function testExtendReBinding()&#123; $_SERVER['_test_rebind'] = false; $container = new Container; $container-&gt;rebinding('foo',function ()&#123; $_SERVER['_test_rebind'] = true; &#125;); $container-&gt;bind('foo',function ()&#123; $obj = new StdClass; return $obj; &#125;); $container-&gt;make('foo'); $container-&gt;extend('foo', function ($obj, $container) &#123; return $obj; &#125;); $this-&gt;assertFalse($_SERVER['_test_rebind']);&#125; contextualcontextual contextualbindinstanceinstancecontextualcontextual 123456789101112131415public function testContextualBindingWorksForExistingInstancedBindings()&#123; $container = new Container; $container-&gt;instance('Illuminate\Tests\Container\IContainerContractStub', new ContainerImplementationStub); $container-&gt;when('Illuminate\Tests\Container\ContainerTestContextInjectOne') -&gt;needs('Illuminate\Tests\Container\IContainerContractStub') -&gt;give('Illuminate\Tests\Container\ContainerImplementationStubTwo'); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', $container-&gt;make('Illuminate\Tests\Container\ContainerTestContextInjectOne')-&gt;impl );&#125; contextual 123456789101112131415161718public function testContextualBindingWorksForNewlyInstancedBindings()&#123; $container = new Container; $container-&gt;when('Illuminate\Tests\Container\ContainerTestContextInjectOne') -&gt;needs('Illuminate\Tests\Container\IContainerContractStub') -&gt;give('Illuminate\Tests\Container\ContainerImplementationStubTwo'); $container-&gt;instance( 'Illuminate\Tests\Container\IContainerContractStub', new ContainerImplementationStub ); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', $container-&gt;make('Illuminate\Tests\Container\ContainerTestContextInjectOne')-&gt;impl );&#125; contextualcontextualcontextual 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public function testContextualBindingDoesntOverrideNonContextualResolution()&#123; $container = new Container; $container-&gt;instance('stub', new ContainerImplementationStub); $container-&gt;alias( 'stub', 'Illuminate\Tests\Container\IContainerContractStub' ); $container-&gt;when('Illuminate\Tests\Container\ContainerTestContextInjectTwo') -&gt;needs('Illuminate\Tests\Container\IContainerContractStub') -&gt;give('Illuminate\Tests\Container\ContainerImplementationStubTwo'); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', $container-&gt;make('Illuminate\Tests\Container\ContainerTestContextInjectTwo')-&gt;impl ); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStub', $container-&gt;make('Illuminate\Tests\Container\ContainerTestContextInjectOne')-&gt;impl );&#125;public function testContextualBindingWorksOnNewAliasedBindings()&#123; $container = new Container; $container-&gt;when('Illuminate\Tests\Container\ContainerTestContextInjectOne') -&gt;needs('Illuminate\Tests\Container\IContainerContractStub') -&gt;give('Illuminate\Tests\Container\ContainerImplementationStubTwo'); $container-&gt;bind('stub', ContainerImplementationStub::class); $container-&gt;alias( 'stub', 'Illuminate\Tests\Container\IContainerContractStub' ); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', $container-&gt;make('Illuminate\Tests\Container\ContainerTestContextInjectOne')-&gt;impl );&#125;   1234567891011121314151617public function testContextualBindingWorksOnExistingAliasedInstances()&#123; $container = new Container; $container-&gt;alias('Illuminate\Tests\Container\IContainerContractStub', 'stub'); $container-&gt;instance('stub', new ContainerImplementationStub); $container-&gt;when('Illuminate\Tests\Container\ContainerTestContextInjectOne') -&gt;needs('stub') -&gt;give('Illuminate\Tests\Container\ContainerImplementationStubTwo'); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', $container-&gt;make('Illuminate\Tests\Container\ContainerTestContextInjectOne')-&gt;impl );&#125; instancestubIlluminate\Tests\Container\IContainerContractStubstub  1234567891011121314151617public function testContextualBindingWorksOnBoundAlias()&#123; $container = new Container; $container-&gt;alias('Illuminate\Tests\Container\IContainerContractStub', 'stub'); $container-&gt;bind('stub', ContainerImplementationStub::class); $container-&gt;when('Illuminate\Tests\Container\ContainerTestContextInjectOne') -&gt;needs('stub') -&gt;give('Illuminate\Tests\Container\ContainerImplementationStubTwo'); $this-&gt;assertInstanceOf( 'Illuminate\Tests\Container\ContainerImplementationStubTwo', $container-&gt;make('Illuminate\Tests\Container\ContainerTestContextInjectOne')-&gt;impl );&#125;  instance bindbindaliasabstractAlias Taylor Otwell  PR Im not making any of these changes to the container on a patch release.(5.5)   bind 123456789101112public function testAliasesWithArrayOfParameters()&#123; $container = new Container; $container-&gt;bind('foo', function ($app, $config) &#123; return $config; &#125;); $container-&gt;alias('foo', 'baz'); $this-&gt;assertEquals([1, 2, 3], $container-&gt;makeWith('baz', [1, 2, 3]));&#125; extend 1234567891011121314151617181920212223242526272829public function testExtendedBindings()&#123; $container = new Container; $container['foo'] = 'foo'; $container-&gt;extend('foo', function ($old, $container) &#123; return $old.'bar'; &#125;); $this-&gt;assertEquals('foobar', $container-&gt;make('foo')); $container = new Container; $container-&gt;singleton('foo', function () &#123; return (object) ['name' =&gt; 'taylor']; &#125;); $container-&gt;extend('foo', function ($old, $container) &#123; $old-&gt;age = 26; return $old; &#125;); $result = $container-&gt;make('foo'); $this-&gt;assertEquals('taylor', $result-&gt;name); $this-&gt;assertEquals(26, $result-&gt;age); $this-&gt;assertSame($result, $container-&gt;make('foo'));&#125; bindmethod 1234567891011121314public function testCallWithBoundMethod()&#123; $container = new Container; $container-&gt;bindMethod('Illuminate\Tests\Container\ContainerTestCallStub@unresolvable', function ($stub, $container) &#123; $container['foo'] = 'foo'; return $stub-&gt;unresolvable('foo', 'bar'); &#125;); $result = $container-&gt;call('Illuminate\Tests\Container\ContainerTestCallStub@unresolvable'); $this-&gt;assertEquals(['foo', 'bar'], $result); $this-&gt;assertEquals('foo',$container['foo']);&#125; resolve 12345678910111213141516public function testResolvingCallbacksAreCalledForSpecificAbstracts()&#123; $container = new Container; $container-&gt;resolving('foo', function ($object$container)&#123; return $object-&gt;name = 'taylor'; &#125;); $container-&gt;bind('foo', function () &#123; return new StdClass; &#125;); $instance = $container-&gt;make('foo'); $this-&gt;assertEquals('taylor', $instance-&gt;name);&#125; rebinding 123456789101112131415161718public function testReboundListeners()&#123; $container = new Container; $container-&gt;bind('foo', function () &#123; return 'foo'; &#125;); $container-&gt;rebinding('foo', function ($container, $object) &#123; $container['bar'] = $object.'bar'; &#125;); $container-&gt;bind('foo', function () &#123; &#125;); $this-&gt;assertEquals('bar', $container['foobar']);&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel HTTP-Pipeline]]></title>
    <url>%2F2020%2F05%2F13%2FLaravel-HTTP-Pipeline%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%A4%84%E7%90%86%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ url Laravel  - DecafEspressoMochaWhip331  Coffee2  DecafEspresso3  MochaWhip 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public interface Coffee&#123; public double cost();&#125;public class Espresso implements Coffee&#123; public double cost() &#123; return 2.5; &#125;&#125;public class Dressing implements Coffee&#123; private Coffee coffee; public Dressing(Coffee coffee) &#123; this.coffee = coffee; &#125; public double cost() &#123; return coffee.cost(); &#125;&#125;public class Whip extends Dressing &#123; public Whip(Coffee coffee) &#123; super(coffee); &#125; public double cost() &#123; return super.cost() + 0.1; &#125;&#125;public class Mocha extends Dressing&#123; public Mocha(Coffee coffee) &#123; super(coffee); &#125; public double cost() &#123; return super.cost() + 0.5; &#125;&#125;  123456789101112public class Test &#123; public static void main(String[] args) &#123; Coffee coffee = new Espresso(); coffee = new Mocha(coffee); coffee = new Mocha(coffee); coffee = new Whip(coffee); //3.6(2.5 + 0.5 + 0.5 + 0.1) System.out.println(coffee.cost()); &#125;&#125; EspressoMochaEspressoWhipEspressocost+0.1+0.5   123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class Espresso&#123; double cost; public double cost() &#123; $this-&gt; cost = 2.5; &#125;&#125;public class Dressing&#123; public double cost(Espresso $espresso) &#123; return ($espresso); &#125;&#125;public class Whip extends Dressing&#123; public double cost(Espresso $espresso) &#123; $espresso-&gt;cost = espresso-&gt;cost() + 0.1; return ($espresso); &#125;&#125;public class Mocha extends Dressing&#123; public double cost(Espresso $espresso) &#123; $espresso-&gt;cost = espresso-&gt;cost() + 0.5; return ($espresso); &#125;&#125;public class Test &#123; public static void main(String[] args) &#123; Coffee $coffee = new Espresso(); $coffee = (new Mocha())-&gt;cost($coffee); $coffee = (new Mocha())-&gt;cost($coffee); $coffee = (new Whip())-&gt;cost($coffee); //3.6(2.5 + 0.5 + 0.5 + 0.1) System.out.println(coffee.cost()); &#125;&#125; costcaffeecost1010  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public class Espresso&#123; double cost; public double cost() &#123; $this-&gt; cost = 2.5; &#125;&#125;public class Dressing&#123; public double cost(Espresso $espresso, Closure $closure) &#123; return ($espresso); &#125;&#125;public class Whip extends Dressing&#123; public double cost(Espresso $espresso, Closure $closure) &#123; $espresso-&gt;cost = espresso-&gt;cost() + 0.1; return $closure($espresso); &#125;&#125;public class Mocha extends Dressing&#123; public double cost(Espresso $espresso, Closure $closure) &#123; $espresso-&gt;cost = espresso-&gt;cost() + 0.5; return $closure($espresso); &#125;&#125;public class Test &#123; public static void main(String[] args) &#123; Coffee $coffee = new Espresso(); $fun = function($coffee$fuc$dressing) &#123; $dressing-&gt;cost($coffee, $fuc); &#125; $fuc0 = function($coffee) &#123; return $coffee; &#125;; $fuc1 = function($coffee) use ($fuc0, $dressing = (new Mocha()$fun)) &#123; return $fun($coffee, $fuc0, $dressing); &#125; $fuc2 = function($coffee) use ($fuc1, $dressing = (new Mocha()$fun)) &#123; return $fuc($coffee, $fun1, $dressing); &#125; $fuc3 = function($coffee) use ($fuc2, $dressing = (new Whip()$fun)) &#123; return $fuc($coffee, $fun2, $dressing); &#125; $coffee = $fun3($coffee); //3.6(2.5 + 0.5 + 0.5 + 0.1) System.out.println(coffee.cost()); &#125;&#125; $fun3($coffee) ,  $fuc1$fuc2$fuc3$fuc$dressing$coffee 1234567891011121314151617181920212223242526public class Test &#123; public static void main(String[] args) &#123; Coffee $coffee = new Espresso(); $fun = function($coffee) use ($fuc$dressing) &#123; $dressing-&gt;cost($coffee, $fuc); &#125; $fuc = function($fuc$dressing) use ($fun) &#123; return $fun; &#125;; $fuc0 = function($coffee) &#123; return $coffee; &#125;; $fuc1 = $fuc($fuc0, (new Mocha()); $fuc2 = $fuc($fuc1, (new Mocha()); $fuc3 = $fuc($fuc2, (new Whip()); $coffee = $fun3($coffee); //3.6(2.5 + 0.5 + 0.5 + 0.1) System.out.println(coffee.cost()); &#125;&#125; $fun$fuc$fun3  $fuc1$fuc2$fuc3 1234567891011121314151617181920212223242526272829public class Test &#123; public static void main(String[] args) &#123; Coffee $coffee = new Espresso(); $fun = function($coffee) use ($fuc$dressing) &#123; $dressing-&gt;cost($coffee, $fuc); &#125; $fuc = function($fuc$dressing) use ($fun) &#123; return $fun; &#125;; $fuc0 = function($coffee) &#123; return $coffee; &#125;; $fucn = array_reduce( [(new Mocha(),(new Mocha(),(new Whip()], $fuc, $fuc0 ); $coffee = $fucn($coffee); //3.6(2.5 + 0.5 + 0.5 + 0.1) System.out.println(coffee.cost()); &#125;&#125; LaravelPipeline bootstrap() 123456789101112131415161718protected function sendRequestThroughRouter($request)&#123; $this-&gt;app-&gt;instance('request', $request); Facade::clearResolvedInstance('request'); $this-&gt;bootstrap(); return (new Pipeline($this-&gt;app)) -&gt;send($request) -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [] : $this-&gt;middleware) -&gt;then($this-&gt;dispatchToRouter());&#125;public function shouldSkipMiddleware()&#123; return $this-&gt;bound('middleware.disable') &amp;&amp; $this-&gt;make('middleware.disable') === true;&#125; LaravelPipelinerequestcaffeemiddlewaredressing 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455class Pipeline implements PipelineContract&#123; public function __construct(Container $container = null) &#123; $this-&gt;container = $container; &#125; public function send($passable) &#123; $this-&gt;passable = $passable; return $this; &#125; public function through($pipes) &#123; $this-&gt;pipes = is_array($pipes) ? $pipes : func_get_args(); return $this; &#125; public function then(Closure $destination) &#123; $pipeline = array_reduce( array_reverse($this-&gt;pipes), $this-&gt;carry(), $this-&gt;prepareDestination($destination) ); return $pipeline($this-&gt;passable); &#125; protected function prepareDestination(Closure $destination) &#123; return function ($passable) use ($destination) &#123; return $destination($passable); &#125;; &#125; protected function carry() &#123; return function ($stack, $pipe) &#123; return function ($passable) use ($stack, $pipe) &#123; if ($pipe instanceof Closure) &#123; return $pipe($passable, $stack); &#125; elseif (! is_object($pipe)) &#123; list($name, $parameters) = $this-&gt;parsePipeString($pipe); $pipe = $this-&gt;getContainer()-&gt;make($name); $parameters = array_merge([$passable, $stack], $parameters); &#125; else &#123; $parameters = [$passable, $stack]; &#125; return $pipe-&gt;&#123;$this-&gt;method&#125;(...$parameters); &#125;; &#125;; &#125;&#125; pipeline carry() 123function ($stack, $pipe) &#123;...&#125;  $fuc , 123function ($passable) use ($stack, $pipe) &#123;...&#125; $funprepareDestination$fuc0 , 123456789101112131415if ($pipe instanceof Closure) &#123; return $pipe($passable, $stack);&#125; elseif (! is_object($pipe)) &#123; list($name, $parameters) = $this-&gt;parsePipeString($pipe); $pipe = $this-&gt;getContainer()-&gt;make($name); $parameters = array_merge([$passable, $stack], $parameters);&#125; else &#123; $parameters = [$passable, $stack];&#125;return $pipe-&gt;&#123;$this-&gt;method&#125;(...$parameters); $dressing-&gt;cost($coffee, $fuc);handle() 12345678910111213141516public function via($method)&#123; $this-&gt;method = $method; return $this;&#125;protected function parsePipeString($pipe)&#123; list($name, $parameters) = array_pad(explode(':', $pipe, 2),2, []); if (is_string($parameters)) &#123; $parameters = explode(',', $parameters); &#125; return [$name, $parameters];&#125; Laravelrequest]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Queue]]></title>
    <url>%2F2020%2F05%2F12%2FLaravel-Queue%2F</url>
    <content type="text"><![CDATA[  Opis ClosureOpis ClosurePHP 1composer require opis/closure  1Fatal error: Uncaught exception &apos;Exception&apos; with message &apos;Serialization of &apos;Closure&apos; is not allowed&apos; Opis\Closure\SerializableClosureserialize 1234567891011use Opis\Closure\SerializableClosure;// Recursive factorial closure$factorial = function ($n) use (&amp;$factorial) &#123; return $n &lt;= 1 ? 1 : $factorial($n - 1) * $n;&#125;;// Wrap the closure$wrapper = new SerializableClosure($factorial);// Now it can be serialized$serialized = serialize($wrapper); unserializegetClosure 12345678910// Unserialize the closure$wrapper = unserialize($serialized);// You can directly invoke the wrapper...echo $wrapper(5); //&gt; 120// Or, the recommended way, extract the closure object$closure = $wrapper-&gt;getClosure();echo $closure(5); //&gt; 120 Opis Closure/eval 123456789// Once again, but this time using the previously unserialized closure$wrapper = new SerializableClosure($closure);$serialized = serialize($wrapper);$wrapper = unserialize($serialized);$closure = $wrapper-&gt;getClosure();// Now watch this...echo $closure(5); //&gt; 120// It worked! /Opis ClosureOpis\Closure\serializeOpis\Closure\unserialize 1234567891011121314151617181920212223use function Opis\Closure\&#123;serialize as s, unserialize as u&#125;class A&#123; private $closure; public function __construct() &#123; $this-&gt;closure = function()&#123; echo 'It works!'; &#125;; &#125; public function test() &#123; //call closure ($this-&gt;closure)(); &#125;&#125;$obj = new A();u(s($obj))-&gt;test(); // It works Job Illuminate\Queue\Jobs.php  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347namespace Illuminate\Queue\Jobs;use Illuminate\Contracts\Events\Dispatcher;use Illuminate\Queue\Events\JobFailed;use Illuminate\Queue\ManuallyFailedException;use Illuminate\Support\InteractsWithTime;abstract class Job&#123; use InteractsWithTime; /** * The job handler instance. * * @var mixed */ protected $instance; /** * The IoC container instance. * * @var \Illuminate\Container\Container */ protected $container; /** * Indicates if the job has been deleted. * * @var bool */ protected $deleted = false; /** * Indicates if the job has been released. * * @var bool */ protected $released = false; /** * Indicates if the job has failed. * * @var bool */ protected $failed = false; /** * The name of the connection the job belongs to. * * @var string */ protected $connectionName; /** * The name of the queue the job belongs to. * * @var string */ protected $queue; /** * Get the job identifier. * * @return string */ abstract public function getJobId(); /** * Get the raw body of the job. * * @return string */ abstract public function getRawBody(); /** * Get the UUID of the job. * * @return string|null */ public function uuid() &#123; return $this-&gt;payload()['uuid'] ?? null; &#125; /** * Fire the job. * * @return void */ public function fire() &#123; $payload = $this-&gt;payload(); [$class, $method] = JobName::parse($payload['job']); ($this-&gt;instance = $this-&gt;resolve($class))-&gt;&#123;$method&#125;($this, $payload['data']); &#125; /** * Delete the job from the queue. * * @return void */ public function delete() &#123; $this-&gt;deleted = true; &#125; /** * Determine if the job has been deleted. * * @return bool */ public function isDeleted() &#123; return $this-&gt;deleted; &#125; /** * Release the job back into the queue. * * @param int $delay * @return void */ public function release($delay = 0) &#123; $this-&gt;released = true; &#125; /** * Determine if the job was released back into the queue. * * @return bool */ public function isReleased() &#123; return $this-&gt;released; &#125; /** * Determine if the job has been deleted or released. * * @return bool */ public function isDeletedOrReleased() &#123; return $this-&gt;isDeleted() || $this-&gt;isReleased(); &#125; /** * Determine if the job has been marked as a failure. * * @return bool */ public function hasFailed() &#123; return $this-&gt;failed; &#125; /** * Mark the job as "failed". * * @return void */ public function markAsFailed() &#123; $this-&gt;failed = true; &#125; /** * Delete the job, call the "failed" method, and raise the failed job event. * * @param \Throwable|null $e * @return void */ public function fail($e = null) &#123; $this-&gt;markAsFailed(); if ($this-&gt;isDeleted()) &#123; return; &#125; try &#123; // If the job has failed, we will delete it, call the "failed" method and then call // an event indicating the job has failed so it can be logged if needed. This is // to allow every developer to better keep monitor of their failed queue jobs. $this-&gt;delete(); $this-&gt;failed($e); &#125; finally &#123; $this-&gt;resolve(Dispatcher::class)-&gt;dispatch(new JobFailed( $this-&gt;connectionName, $this, $e ?: new ManuallyFailedException )); &#125; &#125; /** * Process an exception that caused the job to fail. * * @param \Throwable|null $e * @return void */ protected function failed($e) &#123; $payload = $this-&gt;payload(); [$class, $method] = JobName::parse($payload['job']); if (method_exists($this-&gt;instance = $this-&gt;resolve($class), 'failed')) &#123; $this-&gt;instance-&gt;failed($payload['data'], $e); &#125; &#125; /** * Resolve the given class. * * @param string $class * @return mixed */ protected function resolve($class) &#123; return $this-&gt;container-&gt;make($class); &#125; /** * Get the resolved job handler instance. * * @return mixed */ public function getResolvedJob() &#123; return $this-&gt;instance; &#125; /** * Get the decoded body of the job. * * @return array */ public function payload() &#123; return json_decode($this-&gt;getRawBody(), true); &#125; /** * Get the number of times to attempt a job. * * @return int|null */ public function maxTries() &#123; return $this-&gt;payload()['maxTries'] ?? null; &#125; /** * Get the number of times to attempt a job after an exception. * * @return int|null */ public function maxExceptions() &#123; return $this-&gt;payload()['maxExceptions'] ?? null; &#125; /** * Get the number of seconds to delay a failed job before retrying it. * * @return int|null */ public function delaySeconds() &#123; return $this-&gt;payload()['delay'] ?? null; &#125; /** * Get the number of seconds the job can run. * * @return int|null */ public function timeout() &#123; return $this-&gt;payload()['timeout'] ?? null; &#125; /** * Get the timestamp indicating when the job should timeout. * * @return int|null */ public function timeoutAt() &#123; return $this-&gt;payload()['timeoutAt'] ?? null; &#125; /** * Get the name of the queued job class. * * @return string */ public function getName() &#123; return $this-&gt;payload()['job']; &#125; /** * Get the resolved name of the queued job class. * * Resolves the name of "wrapped" jobs such as class-based handlers. * * @return string */ public function resolveName() &#123; return JobName::resolve($this-&gt;getName(), $this-&gt;payload()); &#125; /** * Get the name of the connection the job belongs to. * * @return string */ public function getConnectionName() &#123; return $this-&gt;connectionName; &#125; /** * Get the name of the queue the job belongs to. * * @return string */ public function getQueue() &#123; return $this-&gt;queue; &#125; /** * Get the service container instance. * * @return \Illuminate\Container\Container */ public function getContainer() &#123; return $this-&gt;container; &#125;&#125; Illuminate\Queue\Jobs\RedisJob.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139&lt;?phpnamespace Illuminate\Queue\Jobs;use Illuminate\Container\Container;use Illuminate\Contracts\Queue\Job as JobContract;use Illuminate\Queue\RedisQueue;class RedisJob extends Job implements JobContract&#123; /** * The Redis queue instance. * * @var \Illuminate\Queue\RedisQueue */ protected $redis; /** * The Redis raw job payload. * * @var string */ protected $job; /** * The JSON decoded version of "$job". * * @var array */ protected $decoded; /** * The Redis job payload inside the reserved queue. * * @var string */ protected $reserved; /** * Create a new job instance. * * @param \Illuminate\Container\Container $container * @param \Illuminate\Queue\RedisQueue $redis * @param string $job * @param string $reserved * @param string $connectionName * @param string $queue * @return void */ public function __construct(Container $container, RedisQueue $redis, $job, $reserved, $connectionName, $queue) &#123; // The $job variable is the original job JSON as it existed in the ready queue while // the $reserved variable is the raw JSON in the reserved queue. The exact format // of the reserved job is required in order for us to properly delete its data. $this-&gt;job = $job; $this-&gt;redis = $redis; $this-&gt;queue = $queue; $this-&gt;reserved = $reserved; $this-&gt;container = $container; $this-&gt;connectionName = $connectionName; $this-&gt;decoded = $this-&gt;payload(); &#125; /** * Get the raw body string for the job. * * @return string */ public function getRawBody() &#123; return $this-&gt;job; &#125; /** * Delete the job from the queue. * * @return void */ public function delete() &#123; parent::delete(); $this-&gt;redis-&gt;deleteReserved($this-&gt;queue, $this); &#125; /** * Release the job back into the queue. * * @param int $delay * @return void */ public function release($delay = 0) &#123; parent::release($delay); $this-&gt;redis-&gt;deleteAndRelease($this-&gt;queue, $this, $delay); &#125; /** * Get the number of times the job has been attempted. * * @return int */ public function attempts() &#123; return ($this-&gt;decoded['attempts'] ?? null) + 1; &#125; /** * Get the job identifier. * * @return string|null */ public function getJobId() &#123; return $this-&gt;decoded['id'] ?? null; &#125; /** * Get the underlying Redis factory implementation. * * @return \Illuminate\Queue\RedisQueue */ public function getRedisQueue() &#123; return $this-&gt;redis; &#125; /** * Get the underlying reserved Redis job. * * @return string */ public function getReservedJob() &#123; return $this-&gt;reserved; &#125;&#125; Queue Illuminate\Contracts\Queue\Queue.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899&lt;?phpnamespace Illuminate\Contracts\Queue;interface Queue&#123; /** * Get the size of the queue. * * @param string|null $queue * @return int */ public function size($queue = null); /** * Push a new job onto the queue. * * @param string|object $job * @param mixed $data * @param string|null $queue * @return mixed */ public function push($job, $data = '', $queue = null); /** * Push a new job onto the queue. * * @param string $queue * @param string|object $job * @param mixed $data * @return mixed */ public function pushOn($queue, $job, $data = ''); /** * Push a raw payload onto the queue. * * @param string $payload * @param string|null $queue * @param array $options * @return mixed */ public function pushRaw($payload, $queue = null, array $options = []); /** * Push a new job onto the queue after a delay. * * @param \DateTimeInterface|\DateInterval|int $delay * @param string|object $job * @param mixed $data * @param string|null $queue * @return mixed */ public function later($delay, $job, $data = '', $queue = null); /** * Push a new job onto the queue after a delay. * * @param string $queue * @param \DateTimeInterface|\DateInterval|int $delay * @param string|object $job * @param mixed $data * @return mixed */ public function laterOn($queue, $delay, $job, $data = ''); /** * Push an array of jobs onto the queue. * * @param array $jobs * @param mixed $data * @param string|null $queue * @return mixed */ public function bulk($jobs, $data = '', $queue = null); /** * Pop the next job off of the queue. * * @param string|null $queue * @return \Illuminate\Contracts\Queue\Job|null */ public function pop($queue = null); /** * Get the connection name for the queue. * * @return string */ public function getConnectionName(); /** * Set the connection name for the queue. * * @param string $name * @return $this */ public function setConnectionName($name);&#125; Illuminate\Queue\SerializableClosure.php 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpnamespace Illuminate\Queue;use Opis\Closure\SerializableClosure as OpisSerializableClosure;class SerializableClosure extends OpisSerializableClosure&#123; use SerializesAndRestoresModelIdentifiers; /** * Transform the use variables before serialization. * * @param array $data The Closure's use variables * @return array */ protected function transformUseVariables($data) &#123; foreach ($data as $key =&gt; $value) &#123; $data[$key] = $this-&gt;getSerializedPropertyValue($value); &#125; return $data; &#125; /** * Resolve the use variables after unserialization. * * @param array $data The Closure's transformed use variables * @return array */ protected function resolveUseVariables($data) &#123; foreach ($data as $key =&gt; $value) &#123; $data[$key] = $this-&gt;getRestoredPropertyValue($value); &#125; return $data; &#125;&#125; Illuminate\Queue\Queue.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290&lt;?phpnamespace Illuminate\Queue;use Closure;use DateTimeInterface;use Illuminate\Container\Container;use Illuminate\Support\InteractsWithTime;use Illuminate\Support\Str;abstract class Queue&#123; use InteractsWithTime; /** * The IoC container instance. * * @var \Illuminate\Container\Container */ protected $container; /** * The connection name for the queue. * * @var string */ protected $connectionName; /** * The create payload callbacks. * * @var callable[] */ protected static $createPayloadCallbacks = []; /** * Push a new job onto the queue. * * @param string $queue * @param string $job * @param mixed $data * @return mixed */ public function pushOn($queue, $job, $data = '') &#123; return $this-&gt;push($job, $data, $queue); &#125; /** * Push a new job onto the queue after a delay. * * @param string $queue * @param \DateTimeInterface|\DateInterval|int $delay * @param string $job * @param mixed $data * @return mixed */ public function laterOn($queue, $delay, $job, $data = '') &#123; return $this-&gt;later($delay, $job, $data, $queue); &#125; /** * Push an array of jobs onto the queue. * * @param array $jobs * @param mixed $data * @param string|null $queue * @return void */ public function bulk($jobs, $data = '', $queue = null) &#123; foreach ((array) $jobs as $job) &#123; $this-&gt;push($job, $data, $queue); &#125; &#125; /** * Create a payload string from the given job and data. * * @param \Closure|string|object $job * @param string $queue * @param mixed $data * @return string * * @throws \Illuminate\Queue\InvalidPayloadException */ protected function createPayload($job, $queue, $data = '') &#123; if ($job instanceof Closure) &#123; $job = CallQueuedClosure::create($job); &#125; $payload = json_encode($this-&gt;createPayloadArray($job, $queue, $data)); if (JSON_ERROR_NONE !== json_last_error()) &#123; throw new InvalidPayloadException( 'Unable to JSON encode payload. Error code: '.json_last_error() ); &#125; return $payload; &#125; /** * Create a payload array from the given job and data. * * @param string|object $job * @param string $queue * @param mixed $data * @return array */ protected function createPayloadArray($job, $queue, $data = '') &#123; return is_object($job) ? $this-&gt;createObjectPayload($job, $queue) : $this-&gt;createStringPayload($job, $queue, $data); &#125; /** * Create a payload for an object-based queue handler. * * @param object $job * @param string $queue * @return array */ protected function createObjectPayload($job, $queue) &#123; $payload = $this-&gt;withCreatePayloadHooks($queue, [ 'uuid' =&gt; (string) Str::uuid(), 'displayName' =&gt; $this-&gt;getDisplayName($job), 'job' =&gt; 'Illuminate\Queue\CallQueuedHandler@call', 'maxTries' =&gt; $job-&gt;tries ?? null, 'maxExceptions' =&gt; $job-&gt;maxExceptions ?? null, 'delay' =&gt; $this-&gt;getJobRetryDelay($job), 'timeout' =&gt; $job-&gt;timeout ?? null, 'timeoutAt' =&gt; $this-&gt;getJobExpiration($job), 'data' =&gt; [ 'commandName' =&gt; $job, 'command' =&gt; $job, ], ]); return array_merge($payload, [ 'data' =&gt; [ 'commandName' =&gt; get_class($job), 'command' =&gt; serialize(clone $job), ], ]); &#125; /** * Get the display name for the given job. * * @param object $job * @return string */ protected function getDisplayName($job) &#123; return method_exists($job, 'displayName') ? $job-&gt;displayName() : get_class($job); &#125; /** * Get the retry delay for an object-based queue handler. * * @param mixed $job * @return mixed */ public function getJobRetryDelay($job) &#123; if (! method_exists($job, 'retryAfter') &amp;&amp; ! isset($job-&gt;retryAfter)) &#123; return; &#125; $delay = $job-&gt;retryAfter ?? $job-&gt;retryAfter(); return $delay instanceof DateTimeInterface ? $this-&gt;secondsUntil($delay) : $delay; &#125; /** * Get the expiration timestamp for an object-based queue handler. * * @param mixed $job * @return mixed */ public function getJobExpiration($job) &#123; if (! method_exists($job, 'retryUntil') &amp;&amp; ! isset($job-&gt;timeoutAt)) &#123; return; &#125; $expiration = $job-&gt;timeoutAt ?? $job-&gt;retryUntil(); return $expiration instanceof DateTimeInterface ? $expiration-&gt;getTimestamp() : $expiration; &#125; /** * Create a typical, string based queue payload array. * * @param string $job * @param string $queue * @param mixed $data * @return array */ protected function createStringPayload($job, $queue, $data) &#123; return $this-&gt;withCreatePayloadHooks($queue, [ 'uuid' =&gt; (string) Str::uuid(), 'displayName' =&gt; is_string($job) ? explode('@', $job)[0] : null, 'job' =&gt; $job, 'maxTries' =&gt; null, 'maxExceptions' =&gt; null, 'delay' =&gt; null, 'timeout' =&gt; null, 'data' =&gt; $data, ]); &#125; /** * Register a callback to be executed when creating job payloads. * * @param callable $callback * @return void */ public static function createPayloadUsing($callback) &#123; if (is_null($callback)) &#123; static::$createPayloadCallbacks = []; &#125; else &#123; static::$createPayloadCallbacks[] = $callback; &#125; &#125; /** * Create the given payload using any registered payload hooks. * * @param string $queue * @param array $payload * @return array */ protected function withCreatePayloadHooks($queue, array $payload) &#123; if (! empty(static::$createPayloadCallbacks)) &#123; foreach (static::$createPayloadCallbacks as $callback) &#123; $payload = array_merge($payload, call_user_func( $callback, $this-&gt;getConnectionName(), $queue, $payload )); &#125; &#125; return $payload; &#125; /** * Get the connection name for the queue. * * @return string */ public function getConnectionName() &#123; return $this-&gt;connectionName; &#125; /** * Set the connection name for the queue. * * @param string $name * @return $this */ public function setConnectionName($name) &#123; $this-&gt;connectionName = $name; return $this; &#125; /** * Set the IoC container instance. * * @param \Illuminate\Container\Container $container * @return void */ public function setContainer(Container $container) &#123; $this-&gt;container = $container; &#125;&#125; Illuminate\Queue\RedisQueue.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310&lt;?phpnamespace Illuminate\Queue;use Illuminate\Contracts\Queue\Queue as QueueContract;use Illuminate\Contracts\Redis\Factory as Redis;use Illuminate\Queue\Jobs\RedisJob;use Illuminate\Support\Str;class RedisQueue extends Queue implements QueueContract&#123; /** * The Redis factory implementation. * * @var \Illuminate\Contracts\Redis\Factory */ protected $redis; /** * The connection name. * * @var string */ protected $connection; /** * The name of the default queue. * * @var string */ protected $default; /** * The expiration time of a job. * * @var int|null */ protected $retryAfter = 60; /** * The maximum number of seconds to block for a job. * * @var int|null */ protected $blockFor = null; /** * Create a new Redis queue instance. * * @param \Illuminate\Contracts\Redis\Factory $redis * @param string $default * @param string|null $connection * @param int $retryAfter * @param int|null $blockFor * @return void */ public function __construct(Redis $redis, $default = 'default', $connection = null, $retryAfter = 60, $blockFor = null) &#123; $this-&gt;redis = $redis; $this-&gt;default = $default; $this-&gt;blockFor = $blockFor; $this-&gt;connection = $connection; $this-&gt;retryAfter = $retryAfter; &#125; /** * Get the size of the queue. * * @param string|null $queue * @return int */ public function size($queue = null) &#123; $queue = $this-&gt;getQueue($queue); return $this-&gt;getConnection()-&gt;eval( LuaScripts::size(), 3, $queue, $queue.':delayed', $queue.':reserved' ); &#125; /** * Push a new job onto the queue. * * @param object|string $job * @param mixed $data * @param string|null $queue * @return mixed */ public function push($job, $data = '', $queue = null) &#123; return $this-&gt;pushRaw($this-&gt;createPayload($job, $this-&gt;getQueue($queue), $data), $queue); &#125; /** * Push a raw payload onto the queue. * * @param string $payload * @param string|null $queue * @param array $options * @return mixed */ public function pushRaw($payload, $queue = null, array $options = []) &#123; $this-&gt;getConnection()-&gt;eval( LuaScripts::push(), 2, $this-&gt;getQueue($queue), $this-&gt;getQueue($queue).':notify', $payload ); return json_decode($payload, true)['id'] ?? null; &#125; /** * Push a new job onto the queue after a delay. * * @param \DateTimeInterface|\DateInterval|int $delay * @param object|string $job * @param mixed $data * @param string|null $queue * @return mixed */ public function later($delay, $job, $data = '', $queue = null) &#123; return $this-&gt;laterRaw($delay, $this-&gt;createPayload($job, $this-&gt;getQueue($queue), $data), $queue); &#125; /** * Push a raw job onto the queue after a delay. * * @param \DateTimeInterface|\DateInterval|int $delay * @param string $payload * @param string|null $queue * @return mixed */ protected function laterRaw($delay, $payload, $queue = null) &#123; $this-&gt;getConnection()-&gt;zadd( $this-&gt;getQueue($queue).':delayed', $this-&gt;availableAt($delay), $payload ); return json_decode($payload, true)['id'] ?? null; &#125; /** * Create a payload string from the given job and data. * * @param string $job * @param string $queue * @param mixed $data * @return array */ protected function createPayloadArray($job, $queue, $data = '') &#123; return array_merge(parent::createPayloadArray($job, $queue, $data), [ 'id' =&gt; $this-&gt;getRandomId(), 'attempts' =&gt; 0, ]); &#125; /** * Pop the next job off of the queue. * * @param string|null $queue * @return \Illuminate\Contracts\Queue\Job|null */ public function pop($queue = null) &#123; $this-&gt;migrate($prefixed = $this-&gt;getQueue($queue)); if (empty($nextJob = $this-&gt;retrieveNextJob($prefixed))) &#123; return; &#125; [$job, $reserved] = $nextJob; if ($reserved) &#123; return new RedisJob( $this-&gt;container, $this, $job, $reserved, $this-&gt;connectionName, $queue ?: $this-&gt;default ); &#125; &#125; /** * Migrate any delayed or expired jobs onto the primary queue. * * @param string $queue * @return void */ protected function migrate($queue) &#123; $this-&gt;migrateExpiredJobs($queue.':delayed', $queue); if (! is_null($this-&gt;retryAfter)) &#123; $this-&gt;migrateExpiredJobs($queue.':reserved', $queue); &#125; &#125; /** * Migrate the delayed jobs that are ready to the regular queue. * * @param string $from * @param string $to * @return array */ public function migrateExpiredJobs($from, $to) &#123; return $this-&gt;getConnection()-&gt;eval( LuaScripts::migrateExpiredJobs(), 3, $from, $to, $to.':notify', $this-&gt;currentTime() ); &#125; /** * Retrieve the next job from the queue. * * @param string $queue * @param bool $block * @return array */ protected function retrieveNextJob($queue, $block = true) &#123; $nextJob = $this-&gt;getConnection()-&gt;eval( LuaScripts::pop(), 3, $queue, $queue.':reserved', $queue.':notify', $this-&gt;availableAt($this-&gt;retryAfter) ); if (empty($nextJob)) &#123; return [null, null]; &#125; [$job, $reserved] = $nextJob; if (! $job &amp;&amp; ! is_null($this-&gt;blockFor) &amp;&amp; $block &amp;&amp; $this-&gt;getConnection()-&gt;blpop([$queue.':notify'], $this-&gt;blockFor)) &#123; return $this-&gt;retrieveNextJob($queue, false); &#125; return [$job, $reserved]; &#125; /** * Delete a reserved job from the queue. * * @param string $queue * @param \Illuminate\Queue\Jobs\RedisJob $job * @return void */ public function deleteReserved($queue, $job) &#123; $this-&gt;getConnection()-&gt;zrem($this-&gt;getQueue($queue).':reserved', $job-&gt;getReservedJob()); &#125; /** * Delete a reserved job from the reserved queue and release it. * * @param string $queue * @param \Illuminate\Queue\Jobs\RedisJob $job * @param int $delay * @return void */ public function deleteAndRelease($queue, $job, $delay) &#123; $queue = $this-&gt;getQueue($queue); $this-&gt;getConnection()-&gt;eval( LuaScripts::release(), 2, $queue.':delayed', $queue.':reserved', $job-&gt;getReservedJob(), $this-&gt;availableAt($delay) ); &#125; /** * Get a random ID string. * * @return string */ protected function getRandomId() &#123; return Str::random(32); &#125; /** * Get the queue or return the default. * * @param string|null $queue * @return string */ public function getQueue($queue) &#123; return 'queues:'.($queue ?: $this-&gt;default); &#125; /** * Get the connection for the queue. * * @return \Illuminate\Redis\Connections\Connection */ public function getConnection() &#123; return $this-&gt;redis-&gt;connection($this-&gt;connection); &#125; /** * Get the underlying Redis instance. * * @return \Illuminate\Contracts\Redis\Factory */ public function getRedis() &#123; return $this-&gt;redis; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Queue-]]></title>
    <url>%2F2020%2F05%2F12%2FLaravel-Queue-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86%E5%99%A8%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ Laravelqueue:workqueue:work 1php artisan queue:work  1php artisan queue:work redis  1php artisan queue:work redis --queue=emails --once 1php artisan queue:work --once --delay 1php artisan queue:work --delay=2 --memory : 1php artisan queue:work --memory=128 --sleep 1php artisan queue:work --sleep=3 Laravel 1php artisan queue:work --timeout=60 Laravel 1php artisan queue:work --tries=60 sleepdelaymemoryartisan WorkCommandIlluminate\Queue\Console\WorkCommandIlluminate\Queue\Worker 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364class WorkCommand extends Command&#123; /** * The console command name. * * @var string */ protected $signature = 'queue:work &#123;connection? : The name of the queue connection to work&#125; &#123;--queue= : The names of the queues to work&#125; &#123;--daemon : Run the worker in daemon mode (Deprecated)&#125; &#123;--once : Only process the next job on the queue&#125; &#123;--stop-when-empty : Stop when the queue is empty&#125; &#123;--delay=0 : The number of seconds to delay failed jobs&#125; &#123;--force : Force the worker to run even in maintenance mode&#125; &#123;--memory=128 : The memory limit in megabytes&#125; &#123;--sleep=3 : Number of seconds to sleep when no job is available&#125; &#123;--timeout=60 : The number of seconds a child process can run&#125; &#123;--tries=1 : Number of times to attempt a job before logging it failed&#125;'; /** * Create a new queue work command. * * @param \Illuminate\Queue\Worker $worker * @param \Illuminate\Contracts\Cache\Repository $cache * @return void */ public function __construct(Worker $worker, Cache $cache) &#123; parent::__construct(); $this-&gt;cache = $cache; $this-&gt;worker = $worker; &#125; /** * Execute the console command. * * @return void */ public function handle() &#123; if ($this-&gt;downForMaintenance() &amp;&amp; $this-&gt;option('once')) &#123; return $this-&gt;worker-&gt;sleep($this-&gt;option('sleep')); &#125; //  //  $this-&gt;listenForEvents(); $connection = $this-&gt;argument('connection') ?: $this-&gt;laravel['config']['queue.default']; //  //  $queue = $this-&gt;getQueue($connection); $this-&gt;runWorker( $connection, $queue ); &#125;&#125; handle 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273/** * Listen for the queue events in order to update the console output. * * @return void */protected function listenForEvents()&#123; $this-&gt;laravel['events']-&gt;listen(JobProcessing::class, function ($event) &#123; $this-&gt;writeOutput($event-&gt;job, 'starting'); &#125;); $this-&gt;laravel['events']-&gt;listen(JobProcessed::class, function ($event) &#123; $this-&gt;writeOutput($event-&gt;job, 'success'); &#125;); $this-&gt;laravel['events']-&gt;listen(JobFailed::class, function ($event) &#123; $this-&gt;writeOutput($event-&gt;job, 'failed'); $this-&gt;logFailedJob($event); &#125;);&#125;/** * Write the status output for the queue worker. * * @param \Illuminate\Contracts\Queue\Job $job * @param string $status * @return void */protected function writeOutput(Job $job, $status)&#123; switch ($status) &#123; case 'starting': return $this-&gt;writeStatus($job, 'Processing', 'comment'); case 'success': return $this-&gt;writeStatus($job, 'Processed', 'info'); case 'failed': return $this-&gt;writeStatus($job, 'Failed', 'error'); &#125;&#125;/** * Format the status output for the queue worker. * * @param \Illuminate\Contracts\Queue\Job $job * @param string $status * @param string $type * @return void */protected function writeStatus(Job $job, $status, $type)&#123; $this-&gt;output-&gt;writeln(sprintf( "&lt;&#123;$type&#125;&gt;[%s][%s] %s&lt;/&#123;$type&#125;&gt; %s", Carbon::now()-&gt;format('Y-m-d H:i:s'), $job-&gt;getJobId(), str_pad("&#123;$status&#125;:", 11), $job-&gt;resolveName() ));&#125;/** * Store a failed job event. * * @param \Illuminate\Queue\Events\JobFailed $event * @return void */protected function logFailedJob(JobFailed $event)&#123; $this-&gt;laravel['queue.failer']-&gt;log( $event-&gt;connectionName, $event-&gt;job-&gt;getQueue(), $event-&gt;job-&gt;getRawBody(), $event-&gt;exception );&#125; runWorkerIlluminate\Queue\Workerdaemon--oncerunNestJob 123456789101112131415/** * Run the worker instance. * * @param string $connection * @param string $queue * @return array */protected function runWorker($connection, $queue)&#123; $this-&gt;worker-&gt;setCache($this-&gt;cache); return $this-&gt;worker-&gt;&#123;$this-&gt;option('once') ? 'runNextJob' : 'daemon'&#125;( $connection, $queue, $this-&gt;gatherWorkerOptions() );&#125; Workerdaemon Illuminate\Queue\Worker.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263/** * Listen to the given queue in a loop. * * @param string $connectionName * @param string $queue * @param \Illuminate\Queue\WorkerOptions $options * @return void */public function daemon($connectionName, $queue, WorkerOptions $options)&#123; if ($this-&gt;supportsAsyncSignals()) &#123; $this-&gt;listenForSignals(); &#125; $lastRestart = $this-&gt;getTimestampOfLastQueueRestart(); while (true) &#123; // Before reserving any jobs, we will make sure this queue is not paused and // if it is we will just pause this worker for a given amount of time and // make sure we do not need to kill this worker process off completely. if (! $this-&gt;daemonShouldRun($options, $connectionName, $queue)) &#123; $this-&gt;pauseWorker($options, $lastRestart); continue; &#125; // First, we will attempt to get the next job off of the queue. We will also // register the timeout handler and reset the alarm for this job so it is // not stuck in a frozen state forever. Then, we can fire off this job. $job = $this-&gt;getNextJob( $this-&gt;manager-&gt;connection($connectionName), $queue ); if ($this-&gt;supportsAsyncSignals()) &#123; $this-&gt;registerTimeoutHandler($job, $options); &#125; // If the daemon should run (not in maintenance mode, etc.), then we can run // fire off this job for processing. Otherwise, we will need to sleep the // worker so no more jobs are processed until they should be processed. if ($job) &#123; $this-&gt;runJob($job, $connectionName, $options); &#125; else &#123; $this-&gt;sleep($options-&gt;sleep); &#125; if ($this-&gt;supportsAsyncSignals()) &#123; $this-&gt;resetTimeoutHandler(); &#125; // Finally, we will check to see if we have exceeded our memory limits or if // the queue should restart based on other indications. If so, we'll stop // this worker and let whatever is "monitoring" it restart the process. $this-&gt;stopIfNecessary($options, $lastRestart, $job); &#125;&#125; listenForSignalsPHP 7.1Process MonitorSupervisor 123456789101112131415161718192021222324protected function listenForSignals()&#123; if ($this-&gt;supportsAsyncSignals()) &#123; pcntl_async_signals(true); pcntl_signal(SIGTERM, function () &#123; $this-&gt;shouldQuit = true; &#125;); pcntl_signal(SIGUSR2, function () &#123; $this-&gt;paused = true; &#125;); pcntl_signal(SIGCONT, function () &#123; $this-&gt;paused = false; &#125;); &#125;&#125;protected function supportsAsyncSignals()&#123; return version_compare(PHP_VERSION, '7.1.0') &gt;= 0 &amp;&amp; extension_loaded('pcntl');&#125; pcntl_async_signals() SupervisorSIGTERM SIGUSR2Laravel SupervisorSIGCONT cache 1234567protected function getTimestampOfLastQueueRestart()&#123; if ($this-&gt;cache) &#123; return $this-&gt;cache-&gt;get('illuminate:queue:restart'); &#125;&#125; worker 12345678protected function daemonShouldRun(WorkerOptions $options)&#123; return ! ( ($this-&gt;manager-&gt;isDownForMaintenance() &amp;&amp; ! $options-&gt;force) || $this-&gt;paused || $this-&gt;events-&gt;until(new Events\Looping) === false );&#125;  --force supervisor loopingfalse loopingfalsepauseWorker 12345protected function pauseWorker(WorkerOptions $options, $lastRestart)&#123; $this-&gt;sleep($options-&gt;sleep &gt; 0 ? $options-&gt;sleep : 1); $this-&gt;stopIfNecessary($options, $lastRestart);&#125; sleepstop 1234567891011121314151617181920212223242526272829protected function stopIfNecessary(WorkerOptions $options, $lastRestart)&#123; if ($this-&gt;shouldQuit) &#123; $this-&gt;kill(); &#125; if ($this-&gt;memoryExceeded($options-&gt;memory)) &#123; $this-&gt;stop(12); &#125; elseif ($this-&gt;queueShouldRestart($lastRestart)) &#123; $this-&gt;stop(); &#125;&#125;protected function queueShouldRestart($lastRestart)&#123; return $this-&gt;getTimestampOfLastQueueRestart() != $lastRestart;&#125;protected function getTimestampOfLastQueueRestart()&#123; if ($this-&gt;cache) &#123; return $this-&gt;cache-&gt;get('illuminate:queue:restart'); &#125;&#125; stop supervisor   1234567891011121314public function kill($status = 0)&#123; if (extension_loaded('posix')) &#123; posix_kill(getmypid(), SIGKILL); &#125; exit($status);&#125;public function stop($status = 0)&#123; $this-&gt;events-&gt;fire(new Events\WorkerStopping); exit($status);&#125;  , 1234567891011121314151617181920protected function getNextJob($connection, $queue)&#123; try &#123; foreach (explode(',', $queue) as $queue) &#123; if (! is_null($job = $connection-&gt;pop($queue))) &#123; return $job; &#125; &#125; &#125; catch (Exception $e) &#123; $this-&gt;exceptions-&gt;report($e); &#125; catch (Throwable $e) &#123; $this-&gt;exceptions-&gt;report(new FatalThrowableError($e)); &#125;&#125; $connectionIlluminate\Queue\RedisQueue 12345678910111213141516171819202122232425262728293031323334353637class RedisQueue extends Queue implements QueueContract&#123; /** * Pop the next job off of the queue. * * @param string|null $queue * @return \Illuminate\Contracts\Queue\Job|null */ public function pop($queue = null) &#123; $this-&gt;migrate($prefixed = $this-&gt;getQueue($queue)); if (empty($nextJob = $this-&gt;retrieveNextJob($prefixed))) &#123; return; &#125; [$job, $reserved] = $nextJob; if ($reserved) &#123; return new RedisJob( $this-&gt;container, $this, $job, $reserved, $this-&gt;connectionName, $queue ?: $this-&gt;default ); &#125; &#125; /** * Get the queue or return the default. * * @param string|null $queue * @return string */ public function getQueue($queue) &#123; return 'queues:'.($queue ?: $this-&gt;default); &#125;&#125; delayreserved 1234567891011121314151617181920212223242526272829/** * Migrate any delayed or expired jobs onto the primary queue. * * @param string $queue * @return void */protected function migrate($queue)&#123; $this-&gt;migrateExpiredJobs($queue.':delayed', $queue); if (! is_null($this-&gt;retryAfter)) &#123; $this-&gt;migrateExpiredJobs($queue.':reserved', $queue); &#125;&#125;/** * Migrate the delayed jobs that are ready to the regular queue. * * @param string $from * @param string $to * @return array */public function migrateExpiredJobs($from, $to)&#123; return $this-&gt;getConnection()-&gt;eval( LuaScripts::migrateExpiredJobs(), 3, $from, $to, $to.':notify', $this-&gt;currentTime() );&#125; LUA 12345678910111213141516171819202122232425262728293031323334/** * Get the Lua script to migrate expired jobs back onto the queue. * * KEYS[1] - The queue we are removing jobs from, for example: queues:foo:reserved * KEYS[2] - The queue we are moving jobs to, for example: queues:foo * KEYS[3] - The notification list for the queue we are moving jobs to, for example queues:foo:notify * ARGV[1] - The current UNIX timestamp * * @return string */public static function migrateExpiredJobs()&#123; return &lt;&lt;&lt;'LUA'-- Get all of the jobs with an expired "score"...local val = redis.call('zrangebyscore', KEYS[1], '-inf', ARGV[1])-- If we have values in the array, we will remove them from the first queue-- and add them onto the destination queue in chunks of 100, which moves-- all of the appropriate jobs onto the destination queue very safely.if(next(val) ~= nil) then redis.call('zremrangebyrank', KEYS[1], 0, #val - 1) for i = 1, #val, 100 do redis.call('rpush', KEYS[2], unpack(val, i, math.min(i+99, #val))) -- Push a notification for every job that was migrated... for j = i, math.min(i+99, #val) do redis.call('rpush', KEYS[3], 1) end endendreturn valLUA;&#125; reserved 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * Retrieve the next job from the queue. * * @param string $queue * @param bool $block * @return array */protected function retrieveNextJob($queue, $block = true)&#123; $nextJob = $this-&gt;getConnection()-&gt;eval( LuaScripts::pop(), 3, $queue, $queue.':reserved', $queue.':notify', $this-&gt;availableAt($this-&gt;retryAfter) ); if (empty($nextJob)) &#123; return [null, null]; &#125; [$job, $reserved] = $nextJob; if (! $job &amp;&amp; ! is_null($this-&gt;blockFor) &amp;&amp; $block &amp;&amp; $this-&gt;getConnection()-&gt;blpop([$queue.':notify'], $this-&gt;blockFor)) &#123; return $this-&gt;retrieveNextJob($queue, false); &#125; return [$job, $reserved];&#125;/** * Get the Lua script for popping the next job off of the queue. * * KEYS[1] - The queue to pop jobs from, for example: queues:foo * KEYS[2] - The queue to place reserved jobs on, for example: queues:foo:reserved * KEYS[3] - The notify queue * ARGV[1] - The time at which the reserved job will expire * * @return string */public static function pop()&#123; return &lt;&lt;&lt;'LUA'-- Pop the first job off of the queue...local job = redis.call('lpop', KEYS[1])local reserved = falseif(job ~= false) then -- Increment the attempt count and place job on the reserved queue... reserved = cjson.decode(job) reserved['attempts'] = reserved['attempts'] + 1 reserved = cjson.encode(reserved) redis.call('zadd', KEYS[2], ARGV[1], reserved) redis.call('lpop', KEYS[3])endreturn &#123;job, reserved&#125;LUA;&#125; redisjobRedisJob 1234567891011121314151617181920public function __construct(Container $container, RedisQueue $redis, $job, $reserved, $connectionName, $queue)&#123; $this-&gt;job = $job; $this-&gt;redis = $redis; $this-&gt;queue = $queue; $this-&gt;reserved = $reserved; $this-&gt;container = $container; $this-&gt;connectionName = $connectionName; $this-&gt;decoded = $this-&gt;payload();&#125;public function payload()&#123; return json_decode($this-&gt;getRawBody(), true);&#125;public function getRawBody()&#123; return $this-&gt;job;&#125; pcntl_alarmworkwork 123456789101112131415161718protected function registerTimeoutHandler($job, WorkerOptions $options)&#123; if ($options-&gt;timeout &gt; 0 &amp;&amp; $this-&gt;supportsAsyncSignals()) &#123; pcntl_signal(SIGALRM, function () &#123; $this-&gt;kill(1); &#125;); pcntl_alarm($this-&gt;timeoutForJob($job, $options) + $options-&gt;sleep); &#125;&#125;protected function timeoutForJob($job, WorkerOptions $options)&#123; return $job &amp;&amp; ! is_null($job-&gt;timeout()) ? $job-&gt;timeout() : $options-&gt;timeout;&#125; JobProcessingJobProcessed 123456789101112131415161718192021222324252627282930313233343536373839404142434445protected function runJob($job, $connectionName, WorkerOptions $options)&#123; try &#123; return $this-&gt;process($connectionName, $job, $options); &#125; catch (Exception $e) &#123; $this-&gt;exceptions-&gt;report($e); &#125; catch (Throwable $e) &#123; $this-&gt;exceptions-&gt;report(new FatalThrowableError($e)); &#125;&#125;public function process($connectionName, $job, WorkerOptions $options)&#123; try &#123; $this-&gt;raiseBeforeJobEvent($connectionName, $job); $this-&gt;markJobAsFailedIfAlreadyExceedsMaxAttempts( $connectionName, $job, (int) $options-&gt;maxTries ); $job-&gt;fire(); $this-&gt;raiseAfterJobEvent($connectionName, $job); &#125; catch (Exception $e) &#123; $this-&gt;handleJobException($connectionName, $job, $options, $e); &#125; catch (Throwable $e) &#123; $this-&gt;handleJobException( $connectionName, $job, $options, new FatalThrowableError($e) ); &#125;&#125; raiseBeforeJobEventraiseAfterJobEvent 1234567891011121314151617protected function raiseBeforeJobEvent($connectionName, $job)&#123; $this-&gt;events-&gt;fire( new Events\JobProcessing( $connectionName, $job ) );&#125;protected function raiseAfterJobEvent($connectionName, $job)&#123; $this-&gt;events-&gt;fire( new Events\JobProcessed( $connectionName, $job ) );&#125; reserved markJobAsFailedIfAlreadyExceedsMaxAttempts 123456789101112131415161718192021222324252627282930313233343536protected function markJobAsFailedIfAlreadyExceedsMaxAttempts($connectionName, $job, $maxTries)&#123; $maxTries = ! is_null($job-&gt;maxTries()) ? $job-&gt;maxTries() : $maxTries; if ($maxTries === 0 || $job-&gt;attempts() &lt;= $maxTries) &#123; return; &#125; $this-&gt;failJob( $connectionName, $job, $e = new MaxAttemptsExceededException( 'A queued job has been attempted too many times. The job may have previously timed out.' ) ); throw $e;&#125;public function maxTries()&#123; return array_get($this-&gt;payload(), 'maxTries');&#125;public function attempts()&#123; return Arr::get($this-&gt;decoded, 'attempts') + 1;&#125;protected function failJob($connectionName, $job, $e)&#123; return FailingJob::handle($connectionName, $job, $e);&#125; workFailingJob 1234567891011121314151617181920212223242526272829303132333435363738394041424344protected function failJob($connectionName, $job, $e)&#123; return FailingJob::handle($connectionName, $job, $e);&#125;public static function handle($connectionName, $job, $e = null)&#123; $job-&gt;markAsFailed(); if ($job-&gt;isDeleted()) &#123; return; &#125; try &#123; $job-&gt;delete(); $job-&gt;failed($e); &#125; finally &#123; static::events()-&gt;fire( new JobFailed( $connectionName, $job, $e ? : new ManuallyFailedException ) ); &#125;&#125;public function markAsFailed()&#123; $this-&gt;failed = true;&#125;public function delete()&#123; parent::delete(); $this-&gt;redis-&gt;deleteReserved($this-&gt;queue, $this);&#125;public function isDeleted()&#123; return $this-&gt;deleted;&#125; FailingJobfaileddeletedreserved 1234567public function deleteReserved($queue, $job)&#123; $this-&gt;getConnection()-&gt;zrem( $this-&gt;getQueue($queue).':reserved', $job-&gt;getReservedJob() );&#125; FailingJobRedisJobfailedJobFailed 123456789101112public function failed($e)&#123; $this-&gt;markAsFailed(); $payload = $this-&gt;payload(); list($class, $method) = JobName::parse($payload['job']); if (method_exists($this-&gt;instance = $this-&gt;resolve($class),'failed')) &#123; $this-&gt;instance-&gt;failed($payload['data'], $e); &#125;&#125; jobredis 123456789[ 'job' =&gt; 'Illuminate\Queue\CallQueuedHandler@call', 'maxTries' =&gt; isset($job-&gt;tries) ? $job-&gt;tries : null, 'timeout' =&gt; isset($job-&gt;timeout) ? $job-&gt;timeout : null, 'data' =&gt; [ 'commandName' =&gt; get_class($job), 'command' =&gt; serialize(clone $job), ],]; failed 12345678public function failed(array $data, $e)&#123; $command = unserialize($data['command']); if (method_exists($command, 'failed')) &#123; $command-&gt;failed($e); &#125;&#125; failed  12345678910111213141516171819202122232425262728293031323334353637383940414243444546protected function handleJobException($connectionName, $job, WorkerOptions $options, $e)&#123; try &#123; $this-&gt;markJobAsFailedIfWillExceedMaxAttempts( $connectionName, $job, (int) $options-&gt;maxTries, $e ); $this-&gt;raiseExceptionOccurredJobEvent( $connectionName, $job, $e ); &#125; finally &#123; if (! $job-&gt;isDeleted()) &#123; $job-&gt;release($options-&gt;delay); &#125; &#125; throw $e;&#125;protected function markJobAsFailedIfWillExceedMaxAttempts($connectionName, $job, $maxTries, $e)&#123; $maxTries = ! is_null($job-&gt;maxTries()) ? $job-&gt;maxTries() : $maxTries; if ($maxTries &gt; 0 &amp;&amp; $job-&gt;attempts() &gt;= $maxTries) &#123; $this-&gt;failJob($connectionName, $job, $e); &#125;&#125;public function release($delay = 0)&#123; parent::release($delay); $this-&gt;redis-&gt;deleteAndRelease($this-&gt;queue, $this, $delay);&#125;public function deleteAndRelease($queue, $job, $delay)&#123; $queue = $this-&gt;getQueue($queue); $this-&gt;getConnection()-&gt;eval( LuaScripts::release(), 2, $queue.':delayed', $queue.':reserved', $job-&gt;getReservedJob(), $this-&gt;availableAt($delay) );&#125; reserveddelayed 12345678910public static function release()&#123; return &lt;&lt;&lt;'LUA'-- Remove the job from the current queue...redis.call('zrem', KEYS[2], ARGV[1])-- Add the job onto the "delayed" queue...redis.call('zadd', KEYS[1], ARGV[2], ARGV[1])return true LUA;&#125; CallQueuedHandlercall 123456789101112131415161718192021222324252627282930313233343536public function fire()&#123; $payload = $this-&gt;payload(); list($class, $method) = JobName::parse($payload['job']); with($this-&gt;instance = $this-&gt;resolve($class))-&gt;&#123;$method&#125;($this, $payload['data']);&#125;/** * Handle the queued job. * * @param \Illuminate\Contracts\Queue\Job $job * @param array $data * @return void */public function call(Job $job, array $data)&#123; try &#123; $command = $this-&gt;setJobInstanceIfNecessary( $job, unserialize($data['command']) ); &#125; catch (ModelNotFoundException $e) &#123; return $this-&gt;handleModelNotFound($job, $e); &#125; $this-&gt;dispatchThroughMiddleware($job, $command); if (! $job-&gt;hasFailed() &amp;&amp; ! $job-&gt;isReleased()) &#123; $this-&gt;ensureNextJobInChainIsDispatched($command); &#125; if (! $job-&gt;isDeletedOrReleased()) &#123; $job-&gt;delete(); &#125;&#125; setJobInstanceIfNecessarytrait:InteractsWithQueue 12345678910111213141516171819202122232425262728293031/** * Set the job instance of the given class if necessary. * * @param \Illuminate\Contracts\Queue\Job $job * @param mixed $instance * @return mixed */protected function setJobInstanceIfNecessary(Job $job, $instance)&#123; if (in_array(InteractsWithQueue::class, class_uses_recursive($instance))) &#123; $instance-&gt;setJob($job); &#125; return $instance;&#125;trait InteractsWithQueue&#123; /** * Set the base queue job instance. * * @param \Illuminate\Contracts\Queue\Job $job * @return $this */ public function setJob(JobContract $job) &#123; $this-&gt;job = $job; return $this; &#125;&#125; dispatch 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/** * Dispatch a command to its appropriate handler in the current process. * * @param mixed $command * @param mixed $handler * @return mixed */public function dispatchNow($command, $handler = null)&#123; if ($handler || $handler = $this-&gt;getCommandHandler($command)) &#123; $callback = function ($command) use ($handler) &#123; return $handler-&gt;handle($command); &#125;; &#125; else &#123; $callback = function ($command) &#123; return $this-&gt;container-&gt;call([$command, 'handle']); &#125;; &#125; return $this-&gt;pipeline-&gt;send($command)-&gt;through($this-&gt;pipes)-&gt;then($callback);&#125;/** * Retrieve the handler for a command. * * @param mixed $command * @return bool|mixed */public function getCommandHandler($command)&#123; if ($this-&gt;hasCommandHandler($command)) &#123; return $this-&gt;container-&gt;make($this-&gt;handlers[get_class($command)]); &#125; return false;&#125;/** * Determine if the given command has a handler. * * @param mixed $command * @return bool */public function hasCommandHandler($command)&#123; return array_key_exists(get_class($command), $this-&gt;handlers);&#125; dispatchermapgetCommandHandlernullhandle delete 1234567891011121314151617181920212223/** * Delete the job from the queue. * * @return void */public function delete()&#123; parent::delete(); $this-&gt;redis-&gt;deleteReserved($this-&gt;queue, $this);&#125;/** * Delete a reserved job from the queue. * * @param string $queue * @param \Illuminate\Queue\Jobs\RedisJob $job * @return void */public function deleteReserved($queue, $job)&#123; $this-&gt;getConnection()-&gt;zrem($this-&gt;getQueue($queue).':reserved', $job-&gt;getReservedJob());&#125; reserved]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Queue-]]></title>
    <url>%2F2020%2F05%2F11%2FLaravel-Queue-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%88%86%E5%8F%91%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ Laravel ZSetscore ZSet ListZSet KafkaRabbitMQRedisBeanstalkdAmazon SQSLaravelAPIRedis LaravelRedisRedis RedisList RedisFIFOList  1lpush/rpop 2rpush/lpop  ZSet ListRedis RedisRedisscore score   (1) ZADD  (2) ZRANGEBYSCORE  (3) ZREMRANGEBYRANK  Laravel LaravelRedisListZSet Redisqueue:defaultqueue:default:delayed queue:default:reservedqueue:default:reservedqueue:default:delayed Laravel  LaravelLaravel Illuminate/Queue/QueueServiceProvider.php 12345678910111213141516171819202122232425262728293031&lt;?phpnamespace Illuminate\Queue;use Illuminate\Contracts\Debug\ExceptionHandler;use Illuminate\Contracts\Support\DeferrableProvider;use Illuminate\Queue\Connectors\RedisConnector;use Illuminate\Queue\Failed\DatabaseFailedJobProvider;use Illuminate\Support\Arr;use Illuminate\Support\ServiceProvider;use Illuminate\Support\Str;use Opis\Closure\SerializableClosure;class QueueServiceProvider extends ServiceProvider implements DeferrableProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;registerManager(); $this-&gt;registerConnection(); $this-&gt;registerWorker(); $this-&gt;registerListener(); $this-&gt;registerFailedJobServices(); $this-&gt;registerOpisSecurityKey(); &#125;&#125; registerManagerregisterManager 123456789101112131415161718192021222324252627282930313233343536373839404142/** * Register the queue manager. * * @return void */protected function registerManager()&#123; $this-&gt;app-&gt;singleton('queue', function ($app) &#123; // Once we have an instance of the queue manager, we will register the various // resolvers for the queue connectors. These connectors are responsible for // creating the classes that accept queue configs and instantiate queues. return tap(new QueueManager($app), function ($manager) &#123; $this-&gt;registerConnectors($manager); &#125;); &#125;);&#125;/** * Register the connectors on the queue manager. * * @param \Illuminate\Queue\QueueManager $manager * @return void */public function registerConnectors($manager)&#123; foreach (['Null', 'Sync', 'Database', 'Redis', 'Beanstalkd', 'Sqs'] as $connector) &#123; $this-&gt;&#123;"register&#123;$connector&#125;Connector"&#125;($manager); &#125;&#125;/** * Register the Redis queue connector. * * @param \Illuminate\Queue\QueueManager $manager * @return void */protected function registerRedisConnector($manager)&#123; $manager-&gt;addConnector('redis', function () &#123; return new RedisConnector($this-&gt;app['redis']); &#125;);&#125; QueueManagerQueueManager$connectorsLaravelDatabase,Redis,Beanstalkd,SQS 123456789101112131415161718192021class QueueManager implements FactoryContract, MonitorContract&#123; /** * The array of resolved queue connectors. * * @var array */ protected $connectors = []; /** * Add a queue connection resolver. * * @param string $driver * @param \Closure $resolver * @return void */ public function addConnector($driver, Closure $resolver) &#123; $this-&gt;connectors[$driver] = $resolver; &#125;&#125; $connectorsconnectorRedisConnectorSqsConnectorDatabaseConnectorBeanstalkdConnector registerConnectionRedis 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * Register the default queue connection binding. * * @return void */protected function registerConnection()&#123; $this-&gt;app-&gt;singleton('queue.connection', function ($app) &#123; return $app['queue']-&gt;connection(); &#125;);&#125;/** * Resolve a queue connection instance. * * @param string|null $name * @return \Illuminate\Contracts\Queue\Queue */public function connection($name = null)&#123; $name = $name ?: $this-&gt;getDefaultDriver(); // If the connection has not been resolved yet we will resolve it now as all // of the connections are resolved when they are actually needed so we do // not make any unnecessary connection to the various queue end-points. if (! isset($this-&gt;connections[$name])) &#123; $this-&gt;connections[$name] = $this-&gt;resolve($name); $this-&gt;connections[$name]-&gt;setContainer($this-&gt;app); &#125; return $this-&gt;connections[$name];&#125;/** * Get the name of the default queue connection. * * @return string */public function getDefaultDriver()&#123; return $this-&gt;app['config']['queue.default'];&#125; connectionconfig 1234567891011121314/** * Resolve a queue connection. * * @param string $name * @return \Illuminate\Contracts\Queue\Queue */protected function resolve($name)&#123; $config = $this-&gt;getConfig($name); return $this-&gt;getConnector($config['driver']) -&gt;connect($config) -&gt;setConnectionName($name);&#125; resolveconnectorconnectRedisQueue Illuminate/Queue/Connectors/RedisConnector.php 12345678910111213141516171819202122232425&lt;?phpnamespace Illuminate\Queue\Connectors;use Illuminate\Contracts\Redis\Factory as Redis;use Illuminate\Queue\RedisQueue;class RedisConnector implements ConnectorInterface&#123; /** * Establish a queue connection. * * @param array $config * @return \Illuminate\Contracts\Queue\Queue */ public function connect(array $config) &#123; return new RedisQueue( $this-&gt;redis, $config['queue'], $config['connection'] ?? $this-&gt;connection, $config['retry_after'] ?? 60, $config['block_for'] ?? null ); &#125;&#125; registerWorkerIlluminate\Queue\Worker 1234567891011121314151617181920/** * Register the queue worker. * * @return void */protected function registerWorker()&#123; $this-&gt;app-&gt;singleton('queue.worker', function ($app) &#123; $isDownForMaintenance = function () &#123; return $this-&gt;app-&gt;isDownForMaintenance(); &#125;; return new Worker( $app['queue'], $app['events'], $app[ExceptionHandler::class], $isDownForMaintenance ); &#125;);&#125; Laravel BusRedisdispatch 1Job::dispatch();  12$job = (new ProcessPodcast($pocast));dispatch($job); dispatchBus 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?phpnamespace Illuminate\Bus;use Illuminate\Contracts\Bus\Dispatcher as DispatcherContract;use Illuminate\Contracts\Bus\QueueingDispatcher as QueueingDispatcherContract;use Illuminate\Contracts\Queue\Factory as QueueFactoryContract;use Illuminate\Contracts\Support\DeferrableProvider;use Illuminate\Support\ServiceProvider;class BusServiceProvider extends ServiceProvider implements DeferrableProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton(Dispatcher::class, function ($app) &#123; return new Dispatcher($app, function ($connection = null) use ($app) &#123; return $app[QueueFactoryContract::class]-&gt;connection($connection); &#125;); &#125;); $this-&gt;app-&gt;alias( Dispatcher::class, DispatcherContract::class ); $this-&gt;app-&gt;alias( Dispatcher::class, QueueingDispatcherContract::class ); &#125; /** * Get the services provided by the provider. * * @return array */ public function provides() &#123; return [ Dispatcher::class, DispatcherContract::class, QueueingDispatcherContract::class, ]; &#125;&#125; queue123456'redis' =&gt; [ 'driver' =&gt; 'redis', 'connection' =&gt; 'default', 'queue' =&gt; 'default', 'retry_after' =&gt; 90,], redisconnectiondatabaseredisqueueredisrediskey hash tag{default}retry_after  handle Illuminate\Contracts\Queue\ShouldQueue redissqsconneciton queue delay tries timeout trait:Illuminate\Queue\InteractsWithQueue failedfailed 1234567891011121314151617181920212223242526272829class ProcessPodcast implements ShouldQueue&#123; use Dispatchable, InteractsWithQueue, Queueable, SerializesModels; protected $podcast; public $connection = 'redis'; public $queue = 'test'; public $delay = 30; public $tries = 5; public $timeout = 30; public function __construct(Podcast $podcast) &#123; $this-&gt;podcast = $podcast; &#125; public function handle(AudioProcessor $processor) &#123; // Process uploaded podcast... if (false) &#123; $this-&gt;release(30); &#125; &#125; public function failed(OrderShipped $event, $exception) &#123; // &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940class AppServiceProvider extends ServiceProvider&#123; public function boot() &#123; //  Queue::before(function (JobProcessing $event) &#123; // $event-&gt;connectionName // $event-&gt;job // $event-&gt;job-&gt;payload() &#125;); // Queue::after(function (JobProcessed $event) &#123; // $event-&gt;connectionName // $event-&gt;job // $event-&gt;job-&gt;payload() &#125;); // Queue::looping(function () &#123; while (DB::transactionLevel() &gt; 0) &#123; DB::rollBack(); &#125; &#125;); //  Queue::failing(function (JobFailed $event) &#123; // $event-&gt;connectionName // $event-&gt;job // $event-&gt;exception &#125;); //  Queue::exceptionOccurred(function (JobFailed $event) &#123; // $event-&gt;connectionName // $event-&gt;job // $event-&gt;exception &#125;); &#125;&#125; dispatchdispatch 12345678class PodcastController extends Controller&#123; public function store(Request $request) &#123; // ... ProcessPodcast::dispatch($podcast); &#125;&#125; delay 1ProcessPodcast::dispatch($podcast)-&gt;delay(Carbon::now()-&gt;addMinutes(10)); onQueue 1ProcessPodcast::dispatch($podcast)-&gt;onQueue('processing'); onConnection 1ProcessPodcast::dispatch($podcast)-&gt;onConnection('redis'); traitIlluminate\Foundation\Bus\Dispatchabletraitdispatch 1234567trait Dispatchable&#123; public static function dispatch() &#123; return new PendingDispatch(new static(...func_get_args())); &#125;&#125; PendingDispatchdispatch 123456789101112131415161718192021222324252627282930class PendingDispatch&#123; public function __construct($job) &#123; $this-&gt;job = $job; &#125; public function onConnection($connection) &#123; $this-&gt;job-&gt;onConnection($connection); return $this; &#125; public function onQueue($queue) &#123; $this-&gt;job-&gt;onQueue($queue); return $this; &#125; public function delay($delay) &#123; $this-&gt;job-&gt;delay($delay); return $this; &#125; public function __destruct() &#123; dispatch($this-&gt;job); &#125;&#125; onConnectiondelayonQueuetraitIlluminate\Bus\Queueable 1234567891011121314151617181920trait Queueable&#123; public function onConnection($connection) &#123; $this-&gt;connection = $connection; return $this; &#125; public function onQueue($queue) &#123; $this-&gt;queue = $queue; return $this; &#125; public function delay($delay) &#123; $this-&gt;delay = $delay; return $this; &#125;&#125; dispatchBusdispatchDispatchabletrait Illuminate/Bus/Dispatcher.php 1234567891011121314151617181920212223242526272829303132333435class Dispatcher implements QueueingDispatcher&#123; /** * The queue resolver callback. * * @var \Closure|null */ protected $queueResolver; /** * Dispatch a command to its appropriate handler. * * @param mixed $command * @return mixed */ public function dispatch($command) &#123; if ($this-&gt;queueResolver &amp;&amp; $this-&gt;commandShouldBeQueued($command)) &#123; return $this-&gt;dispatchToQueue($command); &#125; return $this-&gt;dispatchNow($command); &#125; /** * Determine if the given command should be queued. * * @param mixed $command * @return bool */ protected function commandShouldBeQueued($command) &#123; return $command instanceof ShouldQueue; &#125;&#125;  12345678910111213141516171819202122/** * Dispatch a command to its appropriate handler behind a queue. * * @param mixed $command * @return mixed */public function dispatchToQueue($command)&#123; $connection = $command-&gt;connection ?? null; $queue = call_user_func($this-&gt;queueResolver, $connection); if (! $queue instanceof Queue) &#123; throw new RuntimeException('Queue resolver did not return a Queue implementation.'); &#125; if (method_exists($command, 'queue')) &#123; return $command-&gt;queue($queue, $command); &#125; return $this-&gt;pushCommandToQueue($queue, $command);&#125; queueResolverqueuequeue 1234567891011121314151617181920212223/** * Push the command onto the given queue instance. * * @param \Illuminate\Contracts\Queue\Queue $queue * @param mixed $command * @return mixed */protected function pushCommandToQueue($queue, $command)&#123; if (isset($command-&gt;queue, $command-&gt;delay)) &#123; return $queue-&gt;laterOn($command-&gt;queue, $command-&gt;delay, $command); &#125; if (isset($command-&gt;queue)) &#123; return $queue-&gt;pushOn($command-&gt;queue, $command); &#125; if (isset($command-&gt;delay)) &#123; return $queue-&gt;later($command-&gt;delay, $command); &#125; return $queue-&gt;push($command);&#125; redisqueueIlluminate\Queue\RedisQueue: 123456789101112131415161718192021222324252627282930class RedisQueue extends Queue implements QueueContract&#123; /** * Push a new job onto the queue. * * @param object|string $job * @param mixed $data * @param string|null $queue * @return mixed */ public function push($job, $data = '', $queue = null) &#123; return $this-&gt;pushRaw($this-&gt;createPayload($job, $this-&gt;getQueue($queue), $data), $queue); &#125; /** * Push a new job onto the queue after a delay. * * @param \DateTimeInterface|\DateInterval|int $delay * @param object|string $job * @param mixed $data * @param string|null $queue * @return mixed */ public function later($delay, $job, $data = '', $queue = null) &#123; return $this-&gt;laterRaw($delay, $this-&gt;createPayload($job, $this-&gt;getQueue($queue), $data), $queue); &#125;&#125; pushpushpushRawjson 12345678910111213141516171819202122232425262728293031323334353637383940/** * Create a payload string from the given job and data. * * @param string $job * @param string $queue * @param mixed $data * @return array */protected function createPayloadArray($job, $queue, $data = '')&#123; return array_merge(parent::createPayloadArray($job, $queue, $data), [ 'id' =&gt; $this-&gt;getRandomId(), 'attempts' =&gt; 0, ]);&#125;protected function createPayloadArray($job, $data = '', $queue = null)&#123; return is_object($job) ? $this-&gt;createObjectPayload($job) : $this-&gt;createStringPayload($job, $data);&#125;protected function createObjectPayload($job)&#123; return [ 'job' =&gt; 'Illuminate\Queue\CallQueuedHandler@call', 'maxTries' =&gt; isset($job-&gt;tries) ? $job-&gt;tries : null, 'timeout' =&gt; isset($job-&gt;timeout) ? $job-&gt;timeout : null, 'data' =&gt; [ 'commandName' =&gt; get_class($job), 'command' =&gt; serialize(clone $job), ], ];&#125;protected function createStringPayload($job, $data)&#123; return ['job' =&gt; $job, 'data' =&gt; $data];&#125; jsonredisrpush 123456public function pushRaw($payload, $queue = null, array $options = [])&#123; $this-&gt;getConnection()-&gt;rpush($this-&gt;getQueue($queue), $payload); return Arr::get(json_decode($payload, true), 'id');&#125; laterRawrediszadd: 1234567891011121314151617protected function availableAt($delay = 0)&#123; return $delay instanceof DateTimeInterface ? $delay-&gt;getTimestamp() : Carbon::now()-&gt;addSeconds($delay)-&gt;getTimestamp();&#125;protected function laterRaw($delay, $payload, $queue = null)&#123; $this-&gt;getConnection()-&gt;zadd( $this-&gt;getQueue($queue).':delayed', $this-&gt;availableAt($delay), $payload ); return Arr::get(json_decode($payload, true), 'id');&#125; redis]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Redis]]></title>
    <url>%2F2020%2F05%2F10%2FLaravel-Redis%2F</url>
    <content type="text"><![CDATA[ ConnectorConnection RedisManagerConnectionConnetornewPhpRedisConnectorConnectorConnection $redis-&gt;get$redis-&gt;commandCommandExecuted pipelineRedisRedisRedis 1234567Redis::pipeline(function ($pipe) &#123; for ($i = 0; $i &lt; 1000; $i++) &#123; $pipe-&gt;set("key:$i", $i); &#125;&#125;);   config/database.php 12345678910111213141516171819'redis' =&gt; [ 'client' =&gt; 'predis', 'default' =&gt; [ 'host' =&gt; env('REDIS_HOST', '127.0.0.1'), 'password' =&gt; env('REDIS_PASSWORD', null), 'port' =&gt; env('REDIS_PORT', 6379), 'database' =&gt; env('REDIS_DB', 0), ], 'cache' =&gt; [ 'host' =&gt; env('REDIS_HOST', '127.0.0.1'), 'password' =&gt; env('REDIS_PASSWORD', null), 'port' =&gt; env('REDIS_PORT', 6379), 'database' =&gt; env('REDIS_CACHE_DB', 1), ], ], ConnectorConnector Illuminate\Contracts\Redis\Connector.php 1234567891011121314151617181920212223242526&lt;?phpnamespace Illuminate\Contracts\Redis;interface Connector&#123; /** * Create a connection to a Redis instance. * * @param array $config * @param array $options * @return \Illuminate\Redis\Connections\Connection */ public function connect(array $config, array $options); /** * Create a connection to a Redis cluster. * * @param array $config * @param array $clusterOptions * @param array $options * @return \Illuminate\Redis\Connections\Connection */ public function connectToCluster(array $config, array $clusterOptions, array $options);&#125; Illuminate\Redis\Connectors\PhpRedisConnector.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168&lt;?phpnamespace Illuminate\Redis\Connectors;use Illuminate\Contracts\Redis\Connector;use Illuminate\Redis\Connections\PhpRedisClusterConnection;use Illuminate\Redis\Connections\PhpRedisConnection;use Illuminate\Support\Arr;use Illuminate\Support\Facades\Redis as RedisFacade;use LogicException;use Redis;use RedisCluster;class PhpRedisConnector implements Connector&#123; /** * Create a new clustered PhpRedis connection. * * @param array $config * @param array $options * @return \Illuminate\Redis\Connections\PhpRedisConnection */ public function connect(array $config, array $options) &#123; $connector = function () use ($config, $options) &#123; return $this-&gt;createClient(array_merge( $config, $options, Arr::pull($config, 'options', []) )); &#125;; return new PhpRedisConnection($connector(), $connector); &#125; /** * Create a new clustered PhpRedis connection. * * @param array $config * @param array $clusterOptions * @param array $options * @return \Illuminate\Redis\Connections\PhpRedisClusterConnection */ public function connectToCluster(array $config, array $clusterOptions, array $options) &#123; $options = array_merge($options, $clusterOptions, Arr::pull($config, 'options', [])); return new PhpRedisClusterConnection($this-&gt;createRedisClusterInstance( array_map([$this, 'buildClusterConnectionString'], $config), $options )); &#125; /** * Build a single cluster seed string from array. * * @param array $server * @return string */ protected function buildClusterConnectionString(array $server) &#123; return $server['host'].':'.$server['port'].'?'.Arr::query(Arr::only($server, [ 'database', 'password', 'prefix', 'read_timeout', ])); &#125; /** * Create the Redis client instance. * * @param array $config * @return \Redis * * @throws \LogicException */ protected function createClient(array $config) &#123; return tap(new Redis, function ($client) use ($config) &#123; if ($client instanceof RedisFacade) &#123; throw new LogicException( extension_loaded('redis') ? 'Please remove or rename the Redis facade alias in your "app" configuration file in order to avoid collision with the PHP Redis extension.' : 'Please make sure the PHP Redis extension is installed and enabled.' ); &#125; $this-&gt;establishConnection($client, $config); if (! empty($config['password'])) &#123; $client-&gt;auth($config['password']); &#125; if (isset($config['database'])) &#123; $client-&gt;select((int) $config['database']); &#125; if (! empty($config['prefix'])) &#123; $client-&gt;setOption(Redis::OPT_PREFIX, $config['prefix']); &#125; if (! empty($config['read_timeout'])) &#123; $client-&gt;setOption(Redis::OPT_READ_TIMEOUT, $config['read_timeout']); &#125; if (! empty($config['scan'])) &#123; $client-&gt;setOption(Redis::OPT_SCAN, $config['scan']); &#125; &#125;); &#125; /** * Establish a connection with the Redis host. * * @param \Redis $client * @param array $config * @return void */ protected function establishConnection($client, array $config) &#123; $persistent = $config['persistent'] ?? false; $parameters = [ $config['host'], $config['port'], Arr::get($config, 'timeout', 0.0), $persistent ? Arr::get($config, 'persistent_id', null) : null, Arr::get($config, 'retry_interval', 0), ]; if (version_compare(phpversion('redis'), '3.1.3', '&gt;=')) &#123; $parameters[] = Arr::get($config, 'read_timeout', 0.0); &#125; $client-&gt;&#123;($persistent ? 'pconnect' : 'connect')&#125;(...$parameters); &#125; /** * Create a new redis cluster instance. * * @param array $servers * @param array $options * @return \RedisCluster */ protected function createRedisClusterInstance(array $servers, array $options) &#123; $parameters = [ null, array_values($servers), $options['timeout'] ?? 0, $options['read_timeout'] ?? 0, isset($options['persistent']) &amp;&amp; $options['persistent'], ]; if (version_compare(phpversion('redis'), '4.3.0', '&gt;=')) &#123; $parameters[] = $options['password'] ?? null; &#125; return tap(new RedisCluster(...$parameters), function ($client) use ($options) &#123; if (! empty($options['prefix'])) &#123; $client-&gt;setOption(RedisCluster::OPT_PREFIX, $options['prefix']); &#125; if (! empty($options['scan'])) &#123; $client-&gt;setOption(RedisCluster::OPT_SCAN, $options['scan']); &#125; if (! empty($options['failover'])) &#123; $client-&gt;setOption(RedisCluster::OPT_SLAVE_FAILOVER, $options['failover']); &#125; &#125;); &#125;&#125; Connections Illuminate\Contracts\Redis\Connection.php 1234567891011121314151617181920212223242526272829303132333435&lt;?phpnamespace Illuminate\Contracts\Redis;use Closure;interface Connection&#123; /** * Subscribe to a set of given channels for messages. * * @param array|string $channels * @param \Closure $callback * @return void */ public function subscribe($channels, Closure $callback); /** * Subscribe to a set of given channels with wildcards. * * @param array|string $channels * @param \Closure $callback * @return void */ public function psubscribe($channels, Closure $callback); /** * Run a command against the Redis database. * * @param string $method * @param array $parameters * @return mixed */ public function command($method, array $parameters = []);&#125; Illuminate\Redis\Connections\Connection.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222&lt;?phpnamespace Illuminate\Redis\Connections;use Closure;use Illuminate\Contracts\Events\Dispatcher;use Illuminate\Redis\Events\CommandExecuted;use Illuminate\Redis\Limiters\ConcurrencyLimiterBuilder;use Illuminate\Redis\Limiters\DurationLimiterBuilder;use Illuminate\Support\Traits\Macroable;abstract class Connection&#123; use Macroable &#123; __call as macroCall; &#125; /** * The Redis client. * * @var \Redis */ protected $client; /** * The Redis connection name. * * @var string|null */ protected $name; /** * The event dispatcher instance. * * @var \Illuminate\Contracts\Events\Dispatcher */ protected $events; /** * Subscribe to a set of given channels for messages. * * @param array|string $channels * @param \Closure $callback * @param string $method * @return void */ abstract public function createSubscription($channels, Closure $callback, $method = 'subscribe'); /** * Funnel a callback for a maximum number of simultaneous executions. * * @param string $name * @return \Illuminate\Redis\Limiters\ConcurrencyLimiterBuilder */ public function funnel($name) &#123; return new ConcurrencyLimiterBuilder($this, $name); &#125; /** * Throttle a callback for a maximum number of executions over a given duration. * * @param string $name * @return \Illuminate\Redis\Limiters\DurationLimiterBuilder */ public function throttle($name) &#123; return new DurationLimiterBuilder($this, $name); &#125; /** * Get the underlying Redis client. * * @return mixed */ public function client() &#123; return $this-&gt;client; &#125; /** * Subscribe to a set of given channels for messages. * * @param array|string $channels * @param \Closure $callback * @return void */ public function subscribe($channels, Closure $callback) &#123; return $this-&gt;createSubscription($channels, $callback, __FUNCTION__); &#125; /** * Subscribe to a set of given channels with wildcards. * * @param array|string $channels * @param \Closure $callback * @return void */ public function psubscribe($channels, Closure $callback) &#123; return $this-&gt;createSubscription($channels, $callback, __FUNCTION__); &#125; /** * Run a command against the Redis database. * * @param string $method * @param array $parameters * @return mixed */ public function command($method, array $parameters = []) &#123; $start = microtime(true); $result = $this-&gt;client-&gt;&#123;$method&#125;(...$parameters); $time = round((microtime(true) - $start) * 1000, 2); if (isset($this-&gt;events)) &#123; $this-&gt;event(new CommandExecuted($method, $parameters, $time, $this)); &#125; return $result; &#125; /** * Fire the given event if possible. * * @param mixed $event * @return void */ protected function event($event) &#123; if (isset($this-&gt;events)) &#123; $this-&gt;events-&gt;dispatch($event); &#125; &#125; /** * Register a Redis command listener with the connection. * * @param \Closure $callback * @return void */ public function listen(Closure $callback) &#123; if (isset($this-&gt;events)) &#123; $this-&gt;events-&gt;listen(CommandExecuted::class, $callback); &#125; &#125; /** * Get the connection name. * * @return string|null */ public function getName() &#123; return $this-&gt;name; &#125; /** * Set the connections name. * * @param string $name * @return $this */ public function setName($name) &#123; $this-&gt;name = $name; return $this; &#125; /** * Get the event dispatcher used by the connection. * * @return \Illuminate\Contracts\Events\Dispatcher */ public function getEventDispatcher() &#123; return $this-&gt;events; &#125; /** * Set the event dispatcher instance on the connection. * * @param \Illuminate\Contracts\Events\Dispatcher $events * @return void */ public function setEventDispatcher(Dispatcher $events) &#123; $this-&gt;events = $events; &#125; /** * Unset the event dispatcher instance on the connection. * * @return void */ public function unsetEventDispatcher() &#123; $this-&gt;events = null; &#125; /** * Pass other method calls down to the underlying client. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; if (static::hasMacro($method)) &#123; return $this-&gt;macroCall($method, $parameters); &#125; return $this-&gt;command($method, $parameters); &#125;&#125; Illuminate\Redis\Connections\PhpRedisConnection.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477&lt;?phpnamespace Illuminate\Redis\Connections;use Closure;use Illuminate\Contracts\Redis\Connection as ConnectionContract;use Illuminate\Support\Str;use Redis;use RedisCluster;use RedisException;/** * @mixin \Redis */class PhpRedisConnection extends Connection implements ConnectionContract&#123; /** * The connection creation callback. * * @var callable */ protected $connector; /** * Create a new PhpRedis connection. * * @param \Redis $client * @param callable|null $connector * @return void */ public function __construct($client, callable $connector = null) &#123; $this-&gt;client = $client; $this-&gt;connector = $connector; &#125; /** * Returns the value of the given key. * * @param string $key * @return string|null */ public function get($key) &#123; $result = $this-&gt;command('get', [$key]); return $result !== false ? $result : null; &#125; /** * Get the values of all the given keys. * * @param array $keys * @return array */ public function mget(array $keys) &#123; return array_map(function ($value) &#123; return $value !== false ? $value : null; &#125;, $this-&gt;command('mget', [$keys])); &#125; /** * Set the string value in argument as value of the key. * * @param string $key * @param mixed $value * @param string|null $expireResolution * @param int|null $expireTTL * @param string|null $flag * @return bool */ public function set($key, $value, $expireResolution = null, $expireTTL = null, $flag = null) &#123; return $this-&gt;command('set', [ $key, $value, $expireResolution ? [$flag, $expireResolution =&gt; $expireTTL] : null, ]); &#125; /** * Set the given key if it doesn't exist. * * @param string $key * @param string $value * @return int */ public function setnx($key, $value) &#123; return (int) $this-&gt;command('setnx', [$key, $value]); &#125; /** * Get the value of the given hash fields. * * @param string $key * @param mixed $dictionary * @return array */ public function hmget($key, ...$dictionary) &#123; if (count($dictionary) === 1) &#123; $dictionary = $dictionary[0]; &#125; return array_values($this-&gt;command('hmget', [$key, $dictionary])); &#125; /** * Set the given hash fields to their respective values. * * @param string $key * @param mixed $dictionary * @return int */ public function hmset($key, ...$dictionary) &#123; if (count($dictionary) === 1) &#123; $dictionary = $dictionary[0]; &#125; else &#123; $input = collect($dictionary); $dictionary = $input-&gt;nth(2)-&gt;combine($input-&gt;nth(2, 1))-&gt;toArray(); &#125; return $this-&gt;command('hmset', [$key, $dictionary]); &#125; /** * Set the given hash field if it doesn't exist. * * @param string $hash * @param string $key * @param string $value * @return int */ public function hsetnx($hash, $key, $value) &#123; return (int) $this-&gt;command('hsetnx', [$hash, $key, $value]); &#125; /** * Removes the first count occurrences of the value element from the list. * * @param string $key * @param int $count * @param mixed $value * @return int|false */ public function lrem($key, $count, $value) &#123; return $this-&gt;command('lrem', [$key, $value, $count]); &#125; /** * Removes and returns the first element of the list stored at key. * * @param mixed $arguments * @return array|null */ public function blpop(...$arguments) &#123; $result = $this-&gt;command('blpop', $arguments); return empty($result) ? null : $result; &#125; /** * Removes and returns the last element of the list stored at key. * * @param mixed $arguments * @return array|null */ public function brpop(...$arguments) &#123; $result = $this-&gt;command('brpop', $arguments); return empty($result) ? null : $result; &#125; /** * Removes and returns a random element from the set value at key. * * @param string $key * @param int|null $count * @return mixed|false */ public function spop($key, $count = 1) &#123; return $this-&gt;command('spop', [$key, $count]); &#125; /** * Add one or more members to a sorted set or update its score if it already exists. * * @param string $key * @param mixed $dictionary * @return int */ public function zadd($key, ...$dictionary) &#123; if (is_array(end($dictionary))) &#123; foreach (array_pop($dictionary) as $member =&gt; $score) &#123; $dictionary[] = $score; $dictionary[] = $member; &#125; &#125; $options = []; foreach (array_slice($dictionary, 0, 3) as $i =&gt; $value) &#123; if (in_array($value, ['nx', 'xx', 'ch', 'incr', 'NX', 'XX', 'CH', 'INCR'], true)) &#123; $options[] = $value; unset($dictionary[$i]); &#125; &#125; return $this-&gt;command('zadd', array_merge([$key], [$options], array_values($dictionary))); &#125; /** * Return elements with score between $min and $max. * * @param string $key * @param mixed $min * @param mixed $max * @param array $options * @return array */ public function zrangebyscore($key, $min, $max, $options = []) &#123; if (isset($options['limit'])) &#123; $options['limit'] = [ $options['limit']['offset'], $options['limit']['count'], ]; &#125; return $this-&gt;command('zRangeByScore', [$key, $min, $max, $options]); &#125; /** * Return elements with score between $min and $max. * * @param string $key * @param mixed $min * @param mixed $max * @param array $options * @return array */ public function zrevrangebyscore($key, $min, $max, $options = []) &#123; if (isset($options['limit'])) &#123; $options['limit'] = [ $options['limit']['offset'], $options['limit']['count'], ]; &#125; return $this-&gt;command('zRevRangeByScore', [$key, $min, $max, $options]); &#125; /** * Find the intersection between sets and store in a new set. * * @param string $output * @param array $keys * @param array $options * @return int */ public function zinterstore($output, $keys, $options = []) &#123; return $this-&gt;command('zinterstore', [$output, $keys, $options['weights'] ?? null, $options['aggregate'] ?? 'sum', ]); &#125; /** * Find the union between sets and store in a new set. * * @param string $output * @param array $keys * @param array $options * @return int */ public function zunionstore($output, $keys, $options = []) &#123; return $this-&gt;command('zunionstore', [$output, $keys, $options['weights'] ?? null, $options['aggregate'] ?? 'sum', ]); &#125; /** * Execute commands in a pipeline. * * @param callable|null $callback * @return \Redis|array */ public function pipeline(callable $callback = null) &#123; $pipeline = $this-&gt;client()-&gt;pipeline(); return is_null($callback) ? $pipeline : tap($pipeline, $callback)-&gt;exec(); &#125; /** * Execute commands in a transaction. * * @param callable|null $callback * @return \Redis|array */ public function transaction(callable $callback = null) &#123; $transaction = $this-&gt;client()-&gt;multi(); return is_null($callback) ? $transaction : tap($transaction, $callback)-&gt;exec(); &#125; /** * Evaluate a LUA script serverside, from the SHA1 hash of the script instead of the script itself. * * @param string $script * @param int $numkeys * @param mixed $arguments * @return mixed */ public function evalsha($script, $numkeys, ...$arguments) &#123; return $this-&gt;command('evalsha', [ $this-&gt;script('load', $script), $arguments, $numkeys, ]); &#125; /** * Evaluate a script and return its result. * * @param string $script * @param int $numberOfKeys * @param dynamic $arguments * @return mixed */ public function eval($script, $numberOfKeys, ...$arguments) &#123; return $this-&gt;command('eval', [$script, $arguments, $numberOfKeys]); &#125; /** * Subscribe to a set of given channels for messages. * * @param array|string $channels * @param \Closure $callback * @return void */ public function subscribe($channels, Closure $callback) &#123; $this-&gt;client-&gt;subscribe((array) $channels, function ($redis, $channel, $message) use ($callback) &#123; $callback($message, $channel); &#125;); &#125; /** * Subscribe to a set of given channels with wildcards. * * @param array|string $channels * @param \Closure $callback * @return void */ public function psubscribe($channels, Closure $callback) &#123; $this-&gt;client-&gt;psubscribe((array) $channels, function ($redis, $pattern, $channel, $message) use ($callback) &#123; $callback($message, $channel); &#125;); &#125; /** * Subscribe to a set of given channels for messages. * * @param array|string $channels * @param \Closure $callback * @param string $method * @return void */ public function createSubscription($channels, Closure $callback, $method = 'subscribe') &#123; // &#125; /** * Flush the selected Redis database. * * @return void */ public function flushdb() &#123; if (! $this-&gt;client instanceof RedisCluster) &#123; return $this-&gt;command('flushdb'); &#125; foreach ($this-&gt;client-&gt;_masters() as [$host, $port]) &#123; tap(new Redis)-&gt;connect($host, $port)-&gt;flushDb(); &#125; &#125; /** * Execute a raw command. * * @param array $parameters * @return mixed */ public function executeRaw(array $parameters) &#123; return $this-&gt;command('rawCommand', $parameters); &#125; /** * Run a command against the Redis database. * * @param string $method * @param array $parameters * @return mixed */ public function command($method, array $parameters = []) &#123; try &#123; return parent::command($method, $parameters); &#125; catch (RedisException $e) &#123; if (Str::contains($e-&gt;getMessage(), 'went away')) &#123; $this-&gt;client = $this-&gt;connector ? call_user_func($this-&gt;connector) : $this-&gt;client; &#125; throw $e; &#125; &#125; /** * Disconnects from the Redis instance. * * @return void */ public function disconnect() &#123; $this-&gt;client-&gt;close(); &#125; /** * Apply prefix to the given key if necessary. * * @param string $key * @return string */ private function applyPrefix($key) &#123; $prefix = (string) $this-&gt;client-&gt;getOption(Redis::OPT_PREFIX); return $prefix.$key; &#125; /** * Pass other method calls down to the underlying client. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; return parent::__call(strtolower($method), $parameters); &#125;&#125; Illuminate\Redis\Connections\PredisConnection.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172&lt;?phpnamespace Illuminate\Redis\Connections;use Closure;use Illuminate\Contracts\Redis\Connection as ConnectionContract;use Predis\Command\ServerFlushDatabase;use Predis\Connection\Aggregate\ClusterInterface;/** * @mixin \Predis\Client * @deprecated Predis is no longer maintained by its original author */class PredisConnection extends Connection implements ConnectionContract&#123; /** * The Predis client. * * @var \Predis\Client */ protected $client; /** * Create a new Predis connection. * * @param \Predis\Client $client * @return void */ public function __construct($client) &#123; $this-&gt;client = $client; &#125; /** * Subscribe to a set of given channels for messages. * * @param array|string $channels * @param \Closure $callback * @param string $method * @return void */ public function createSubscription($channels, Closure $callback, $method = 'subscribe') &#123; $loop = $this-&gt;pubSubLoop(); call_user_func_array([$loop, $method], (array) $channels); foreach ($loop as $message) &#123; if ($message-&gt;kind === 'message' || $message-&gt;kind === 'pmessage') &#123; call_user_func($callback, $message-&gt;payload, $message-&gt;channel); &#125; &#125; unset($loop); &#125; /** * Flush the selected Redis database. * * @return void */ public function flushdb() &#123; if (! $this-&gt;client-&gt;getConnection() instanceof ClusterInterface) &#123; return $this-&gt;command('flushdb'); &#125; foreach ($this-&gt;getConnection() as $node) &#123; $node-&gt;executeCommand(new ServerFlushDatabase); &#125; &#125;&#125; RedisManager Illuminate\Redis\RedisManager.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260&lt;?phpnamespace Illuminate\Redis;use Closure;use Illuminate\Contracts\Redis\Factory;use Illuminate\Redis\Connections\Connection;use Illuminate\Redis\Connectors\PhpRedisConnector;use Illuminate\Redis\Connectors\PredisConnector;use Illuminate\Support\ConfigurationUrlParser;use InvalidArgumentException;/** * @mixin \Illuminate\Redis\Connections\Connection */class RedisManager implements Factory&#123; /** * The application instance. * * @var \Illuminate\Contracts\Foundation\Application */ protected $app; /** * The name of the default driver. * * @var string */ protected $driver; /** * The registered custom driver creators. * * @var array */ protected $customCreators = []; /** * The Redis server configurations. * * @var array */ protected $config; /** * The Redis connections. * * @var mixed */ protected $connections; /** * Indicates whether event dispatcher is set on connections. * * @var bool */ protected $events = false; /** * Create a new Redis manager instance. * * @param \Illuminate\Contracts\Foundation\Application $app * @param string $driver * @param array $config * @return void */ public function __construct($app, $driver, array $config) &#123; $this-&gt;app = $app; $this-&gt;driver = $driver; $this-&gt;config = $config; &#125; /** * Get a Redis connection by name. * * @param string|null $name * @return \Illuminate\Redis\Connections\Connection */ public function connection($name = null) &#123; $name = $name ?: 'default'; if (isset($this-&gt;connections[$name])) &#123; return $this-&gt;connections[$name]; &#125; return $this-&gt;connections[$name] = $this-&gt;configure( $this-&gt;resolve($name), $name ); &#125; /** * Resolve the given connection by name. * * @param string|null $name * @return \Illuminate\Redis\Connections\Connection * * @throws \InvalidArgumentException */ public function resolve($name = null) &#123; $name = $name ?: 'default'; $options = $this-&gt;config['options'] ?? []; if (isset($this-&gt;config[$name])) &#123; return $this-&gt;connector()-&gt;connect( $this-&gt;parseConnectionConfiguration($this-&gt;config[$name]), $options ); &#125; if (isset($this-&gt;config['clusters'][$name])) &#123; return $this-&gt;resolveCluster($name); &#125; throw new InvalidArgumentException("Redis connection [&#123;$name&#125;] not configured."); &#125; /** * Resolve the given cluster connection by name. * * @param string $name * @return \Illuminate\Redis\Connections\Connection */ protected function resolveCluster($name) &#123; return $this-&gt;connector()-&gt;connectToCluster( array_map(function ($config) &#123; return $this-&gt;parseConnectionConfiguration($config); &#125;, $this-&gt;config['clusters'][$name]), $this-&gt;config['clusters']['options'] ?? [], $this-&gt;config['options'] ?? [] ); &#125; /** * Configure the given connection to prepare it for commands. * * @param \Illuminate\Redis\Connections\Connection $connection * @param string $name * @return \Illuminate\Redis\Connections\Connection */ protected function configure(Connection $connection, $name) &#123; $connection-&gt;setName($name); if ($this-&gt;events &amp;&amp; $this-&gt;app-&gt;bound('events')) &#123; $connection-&gt;setEventDispatcher($this-&gt;app-&gt;make('events')); &#125; return $connection; &#125; /** * Get the connector instance for the current driver. * * @return \Illuminate\Contracts\Redis\Connector */ protected function connector() &#123; $customCreator = $this-&gt;customCreators[$this-&gt;driver] ?? null; if ($customCreator) &#123; return $customCreator(); &#125; switch ($this-&gt;driver) &#123; case 'predis': return new PredisConnector; case 'phpredis': return new PhpRedisConnector; &#125; &#125; /** * Parse the Redis connection configuration. * * @param mixed $config * @return array */ protected function parseConnectionConfiguration($config) &#123; $parsed = (new ConfigurationUrlParser)-&gt;parseConfiguration($config); return array_filter($parsed, function ($key) &#123; return ! in_array($key, ['driver', 'username'], true); &#125;, ARRAY_FILTER_USE_KEY); &#125; /** * Return all of the created connections. * * @return array */ public function connections() &#123; return $this-&gt;connections; &#125; /** * Enable the firing of Redis command events. * * @return void */ public function enableEvents() &#123; $this-&gt;events = true; &#125; /** * Disable the firing of Redis command events. * * @return void */ public function disableEvents() &#123; $this-&gt;events = false; &#125; /** * Set the default driver. * * @param string $driver * @return void */ public function setDriver($driver) &#123; $this-&gt;driver = $driver; &#125; /** * Register a custom driver creator Closure. * * @param string $driver * @param \Closure $callback * @return $this */ public function extend($driver, Closure $callback) &#123; $this-&gt;customCreators[$driver] = $callback-&gt;bindTo($this, $this); return $this; &#125; /** * Pass methods onto the default Redis connection. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; return $this-&gt;connection()-&gt;&#123;$method&#125;(...$parameters); &#125;&#125; RedisServiceProvider Illuminate\Redis\RedisServiceProvider.php 1234567891011121314151617181920212223242526272829303132333435363738&lt;?phpnamespace Illuminate\Redis;use Illuminate\Contracts\Support\DeferrableProvider;use Illuminate\Support\Arr;use Illuminate\Support\ServiceProvider;class RedisServiceProvider extends ServiceProvider implements DeferrableProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton('redis', function ($app) &#123; $config = $app-&gt;make('config')-&gt;get('database.redis', []); return new RedisManager($app, Arr::pull($config, 'client', 'phpredis'), $config); &#125;); $this-&gt;app-&gt;bind('redis.connection', function ($app) &#123; return $app['redis']-&gt;connection(); &#125;); &#125; /** * Get the services provided by the provider. * * @return array */ public function provides() &#123; return ['redis', 'redis.connection']; &#125;&#125; Application Illuminate\Foundation\Application.php 12345678910111213141516171819202122namespace Illuminate\Foundation;class Application extends Container&#123; /** * Register the core class aliases in the container. * * @return void */ public function registerCoreContainerAliases() &#123; foreach ([ 'redis' =&gt; [\Illuminate\Redis\RedisManager::class, \Illuminate\Contracts\Redis\Factory::class], 'redis.connection' =&gt; [\Illuminate\Redis\Connections\Connection::class, \Illuminate\Contracts\Redis\Connection::class], ] as $key =&gt; $aliases) &#123; foreach ($aliases as $alias) &#123; $this-&gt;alias($key, $alias); &#125; &#125; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Log]]></title>
    <url>%2F2020%2F05%2F10%2FLaravel-Log%2F</url>
    <content type="text"><![CDATA[  Illuminate\Log\Logger.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196&lt;?phpnamespace Illuminate\Log;use Closuore;use Illuminate\Contracts\Events\Dispatcher;use Illuminate\Contracts\Support\Arrayable;use Illuminate\Contracts\Support\Jsonable;use Illuminate\Log\Events\MessageLogged;use Psr\Log\LoggerInterface;use RuntimeException;class Logger implements LoggerInterface&#123; /** * The underlying logger implementation. * * @var \Psr\Log\LoggerInterface */ protected $logger; /** * The event dispatcher instance. * * @var \Illuminate\Contracts\Events\Dispatcher|null */ protected $dispatcher; /** * Create a new log writer instance. * * @param \Psr\Log\LoggerInterface $logger * @param \Illuminate\Contracts\Events\Dispatcher|null $dispatcher * @return void */ public function __construct(LoggerInterface $logger, Dispatcher $dispatcher = null) &#123; $this-&gt;logger = $logger; $this-&gt;dispatcher = $dispatcher; &#125; /** * Log an emergency message to the logs. * * @param string $message * @param array $context * @return void */ public function emergency($message, array $context = []) &#123; $this-&gt;writeLog(__FUNCTION__, $message, $context); &#125; /** * Log a message to the logs. * * @param string $level * @param string $message * @param array $context * @return void */ public function log($level, $message, array $context = []) &#123; $this-&gt;writeLog($level, $message, $context); &#125; /** * Dynamically pass log calls into the writer. * * @param string $level * @param string $message * @param array $context * @return void */ public function write($level, $message, array $context = []) &#123; $this-&gt;writeLog($level, $message, $context); &#125; /** * Write a message to the log. * * @param string $level * @param string $message * @param array $context * @return void */ protected function writeLog($level, $message, $context) &#123; $this-&gt;logger-&gt;&#123;$level&#125;($message = $this-&gt;formatMessage($message), $context); $this-&gt;fireLogEvent($level, $message, $context); &#125; /** * Register a new callback handler for when a log event is triggered. * * @param \Closure $callback * @return void * * @throws \RuntimeException */ public function listen(Closure $callback) &#123; if (! isset($this-&gt;dispatcher)) &#123; throw new RuntimeException('Events dispatcher has not been set.'); &#125; $this-&gt;dispatcher-&gt;listen(MessageLogged::class, $callback); &#125; /** * Fires a log event. * * @param string $level * @param string $message * @param array $context * @return void */ protected function fireLogEvent($level, $message, array $context = []) &#123; //  //  if (isset($this-&gt;dispatcher)) &#123; $this-&gt;dispatcher-&gt;dispatch(new MessageLogged($level, $message, $context)); &#125; &#125; /** * Format the parameters for the logger. * * @param mixed $message * @return mixed */ protected function formatMessage($message) &#123; if (is_array($message)) &#123; return var_export($message, true); &#125; elseif ($message instanceof Jsonable) &#123; return $message-&gt;toJson(); &#125; elseif ($message instanceof Arrayable) &#123; return var_export($message-&gt;toArray(), true); &#125; return $message; &#125; /** * Get the underlying logger implementation. * * @return \Psr\Log\LoggerInterface */ public function getLogger() &#123; return $this-&gt;logger; &#125; /** * Get the event dispatcher instance. * * @return \Illuminate\Contracts\Events\Dispatcher */ public function getEventDispatcher() &#123; return $this-&gt;dispatcher; &#125; /** * Set the event dispatcher instance. * * @param \Illuminate\Contracts\Events\Dispatcher $dispatcher * @return void */ public function setEventDispatcher(Dispatcher $dispatcher) &#123; $this-&gt;dispatcher = $dispatcher; &#125; /** * Dynamically proxy method calls to the underlying logger. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; return $this-&gt;logger-&gt;&#123;$method&#125;(...$parameters); &#125;&#125; Illuminate\Mail\Events\MessageSending.php 123456789101112131415161718192021222324252627282930313233&lt;?phpnamespace Illuminate\Mail\Events;class MessageSending&#123; /** * The Swift message instance. * * @var \Swift_Message */ public $message; /** * The message data. * * @var array */ public $data; /** * Create a new event instance. * * @param \Swift_Message $message * @param array $data * @return void */ public function __construct($message, $data = []) &#123; $this-&gt;data = $data; $this-&gt;message = $message; &#125;&#125; Illuminate\Log\ParsesLogConfiguration.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960namespace Illuminate\Log;use InvalidArgumentException;use Monolog\Logger as Monolog;trait ParsesLogConfiguration&#123; /** * The Log levels. * * @var array */ protected $levels = [ 'debug' =&gt; Monolog::DEBUG, 'info' =&gt; Monolog::INFO, 'notice' =&gt; Monolog::NOTICE, 'warning' =&gt; Monolog::WARNING, 'error' =&gt; Monolog::ERROR, 'critical' =&gt; Monolog::CRITICAL, 'alert' =&gt; Monolog::ALERT, 'emergency' =&gt; Monolog::EMERGENCY, ]; /** * Get fallback log channel name. * * @return string */ abstract protected function getFallbackChannelName(); /** * Parse the string level into a Monolog constant. * * @param array $config * @return int * * @throws \InvalidArgumentException */ protected function level(array $config) &#123; $level = $config['level'] ?? 'debug'; if (isset($this-&gt;levels[$level])) &#123; return $this-&gt;levels[$level]; &#125; throw new InvalidArgumentException('Invalid log level.'); &#125; /** * Extract the log channel from the given configuration. * * @param array $config * @return string */ protected function parseChannel(array $config) &#123; return $config['name'] ?? $this-&gt;getFallbackChannelName(); &#125;&#125; Illuminate\Log\LogServiceProvider 1234567891011121314151617181920&lt;?phpnamespace Illuminate\Log;use Illuminate\Support\ServiceProvider;class LogServiceProvider extends ServiceProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton('log', function ($app) &#123; return new LogManager($app); &#125;); &#125;&#125; Illuminate\Log\LogManager.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677&lt;?phpnamespace Illuminate\Log;use Closure;use Illuminate\Support\Str;use InvalidArgumentException;use Monolog\Formatter\LineFormatter;use Monolog\Handler\ErrorLogHandler;use Monolog\Handler\FormattableHandlerInterface;use Monolog\Handler\HandlerInterface;use Monolog\Handler\RotatingFileHandler;use Monolog\Handler\SlackWebhookHandler;use Monolog\Handler\StreamHandler;use Monolog\Handler\SyslogHandler;use Monolog\Handler\WhatFailureGroupHandler;use Monolog\Logger as Monolog;use Psr\Log\LoggerInterface;use Throwable;class LogManager implements LoggerInterface&#123; use ParsesLogConfiguration; /** * The application instance. * * @var \Illuminate\Contracts\Foundation\Application */ protected $app; /** * The array of resolved channels. * * @var array */ protected $channels = []; /** * The registered custom driver creators. * * @var array */ protected $customCreators = []; /** * The standard date format to use when writing logs. * * @var string */ protected $dateFormat = 'Y-m-d H:i:s'; /** * Create a new Log manager instance. * * @param \Illuminate\Contracts\Foundation\Application $app * @return void */ public function __construct($app) &#123; $this-&gt;app = $app; &#125; /** * Register a custom driver creator Closure. * * @param string $driver * @param \Closure $callback * @return $this */ public function extend($driver, Closure $callback) &#123; $this-&gt;customCreators[$driver] = $callback-&gt;bindTo($this, $this); return $this; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL-]]></title>
    <url>%2F2020%2F05%2F09%2FMySQL%E7%9A%84%E5%8F%88%E4%B8%80%E7%A5%9E%E5%99%A8-%E9%94%81%2F</url>
    <content type="text"><![CDATA[ MySQL locklatch LatchInnoDBLatchmutexrwlock Locklockcommitrollback InnoDB1000https://blog.csdn.net/baolingye/article/details/102506072 MySQL  MyISAMMEMORYCSV  MySQL   BerkeleyDB     WebOLTP MySQL InnoDB S or X InnoDBShared LockExclusive Lock S Lock X Lock IS or IX InnoDBInnoDB    A B  S or X IS or IX  Locking ReadsSELECTInnoDB SELECT  LOCK IN SHARE MODE SELECT  FOR UPDATE SELECT  LOCK IN SHARE MODESSX SELECT  FOR UPDATEXSXSELECT FOR UPDATE consistent nonlocking readInnoDBMVVCDELETEUPDATEInnoDB InnoDBREAD COMMITTEDREPEATABLE READInnoDB READ COMMITTEDREPEATABLE READ  ;  1insert into lock_test values(1);  1select @@tx_isolation;  REPEATABLE READ REPEATABLE READB READ COMMITTED; READ COMMITTEDBA InnoDB3 Record Lock Gap Lock Next-Key LockGap Lock+Record Lock Record LockInnoDBInnoDB Next-Key LockGap LockRecord LockNext-Key LockInnoDB102030Next-Key Locking Next-Key LockingPrevious-Key LockingNext-Key LockPrevious-Key Locking Next-key LockNext-key LockRecord Lock  12345678910CREATE TABLE test ( x INT, y INT, PRIMARY KEY(x), // x KEY(y) // y);INSERT INTO test select 3, 2;INSERT INTO test select 5, 3;INSERT INTO test select 7, 6;INSERT INTO test select 10, 8; A 1SELECT * FROM test WHERE y = 3 FOR UPDATE  x y Gap Lock  READ COMMITED innodb_locks_unsafe_for_binlog1 Gap LockPhontom ProblemMySQLRepeatable ReadInnoDB SQLSQL MySQLREPEATABLE READREAD UNCOMMITTED  READ UNCOMMITTEDABA   AB READ COMMITTED Next-Key LockREAD REPEATABLEMySQLPhantom Problem   SELECT  FOR UPDATEX ]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F05%2F08%2F%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%A2%E9%BB%91%E6%A0%91%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[   Binary Search Tree BST 1. 2. 3.  10 1.9 2.10 &gt; 913 3.10 &lt; 1311 4.10 &lt; 111010     9812 76543  [] Red Black Tree 1. 2. 3.NIL 4. 5.  2   1.14 15 2.21 224  : [][][][]   252122422 525 252727   YXX   YXX   21 25 1725174213 13X17Y  17 -&gt; 8 -&gt; 6 -&gt; NIL435 13X8Y    -&gt;  -&gt;  -&gt;  -&gt;  JDKTreeMapTreeSetJava8HashMap  1.Case 2. PHP123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350&lt;?php/** *  * 1. * 2. * 3. * 4. * 5. * */class Node&#123; private $id; /** * @var * 1 =&gt; red * 2 =&gt; black */ private $color = 1; private $value = null; public $parent = 0; public $left = 0; public $right = 0; public function __construct($value) &#123; $this-&gt;id = uniqid(); $this-&gt;value = $value; &#125; public function getID() &#123; return $this-&gt;id; &#125; public function getValue() &#123; return $this-&gt;value; &#125; public function setColor($color) &#123; $this-&gt;color = $color; &#125; public function getColor() &#123; return $this-&gt;color; &#125;&#125;class RedBlackTree&#123; public $root = 0; private $nodePool = []; private $nil; public function __construct() &#123; $nilNode = new Node(null); $nilNode-&gt;setColor(2); $this-&gt;addNodeToPool($nilNode-&gt;getID(), $nilNode); $this-&gt;nil = $nilNode-&gt;getID(); $this-&gt;root = $this-&gt;nil; &#125; public function addNodeToPool($id, $object) &#123; $this-&gt;nodePool[$id] = $object; &#125; /** * @param $id * @return Node */ public function getNodeFromPool($id) &#123; return isset($this-&gt;nodePool[$id]) ? $this-&gt;nodePool[$id] : null; &#125; public function find($value) &#123; $tmp = $this-&gt;getNodeFromPool($this-&gt;root); while (!is_null($tmp-&gt;getValue())) &#123; if ($tmp-&gt;getValue() &gt; $value) &#123; $tmp = $this-&gt;getNodeFromPool($tmp-&gt;left); &#125; else if ($tmp-&gt;getValue() &lt; $value) &#123; $tmp = $this-&gt;getNodeFromPool($tmp-&gt;right); &#125; else &#123; return true; &#125; &#125; return false; &#125; public function walk($nodeID) &#123; var_dump($this-&gt;root); var_dump($this-&gt;nodePool); &#125; public function insert($value) &#123; $tmpNode = $this-&gt;getNodeFromPool($this-&gt;root); $prevNode = $tmpNode; while (!is_null($tmpNode-&gt;getValue())) &#123; $prevNode = $tmpNode; if ($tmpNode-&gt;getValue() &gt; $value) &#123; $tmpNode = $this-&gt;getNodeFromPool($tmpNode-&gt;left); &#125; else &#123; $tmpNode = $this-&gt;getNodeFromPool($tmpNode-&gt;right); &#125; &#125; $newNode = new Node($value); $newNode-&gt;left = $this-&gt;nil; $newNode-&gt;right = $this-&gt;nil; $newNode-&gt;parent = $prevNode-&gt;getID(); $this-&gt;addNodeToPool($newNode-&gt;getID(), $newNode); if (is_null($prevNode-&gt;getValue())) &#123; // $newNode-&gt;setColor(2); $this-&gt;root = $newNode-&gt;getID(); &#125; else if ($prevNode-&gt;getValue() &gt; $newNode-&gt;getValue()) &#123; $prevNode-&gt;left = $newNode-&gt;getID(); &#125; else &#123; $prevNode-&gt;right = $newNode-&gt;getID(); &#125; $this-&gt;insertFix($newNode-&gt;getID()); return true; &#125; protected function insertFix($node) &#123; $tmpNode = $this-&gt;getNodeFromPool($node); while (!is_null($tmpNode-&gt;getValue()) &amp;&amp; ($this-&gt;getNodeFromPool($tmpNode-&gt;parent)-&gt;getColor() == 1)) &#123; $grandP = $this-&gt;getNodeFromPool($this-&gt;getNodeFromPool($tmpNode-&gt;parent)-&gt;parent); $parent = $this-&gt;getNodeFromPool($tmpNode-&gt;parent); if ($tmpNode-&gt;parent == $grandP-&gt;left) &#123; $rightUncle = $this-&gt;getNodeFromPool($grandP-&gt;right); if ($rightUncle-&gt;getColor() == 1) &#123; $parent-&gt;setColor(2); $rightUncle-&gt;setColor(2); $grandP-&gt;setColor(1); $tmpNode = $grandP; &#125; else if ($tmpNode-&gt;getID() == $parent-&gt;right) &#123; $this-&gt;leftRotate($tmpNode-&gt;getID()); $tmpNode = $parent; $this-&gt;rightRotate($tmpNode-&gt;parent, true); &#125; else &#123; $this-&gt;rightRotate($tmpNode-&gt;getID(), true); &#125; &#125; else &#123; $leftUncle = $this-&gt;getNodeFromPool($grandP-&gt;left); if ($leftUncle-&gt;getColor() == 1) &#123; $parent-&gt;setColor(2); $leftUncle-&gt;setColor(2); $grandP-&gt;setColor(1); $tmpNode = $grandP; &#125; else if ($tmpNode-&gt;getID() == $parent-&gt;left) &#123; $this-&gt;rightRotate($tmpNode-&gt;getID()); $tmpNode = $parent; $this-&gt;leftRotate($tmpNode-&gt;parent, true); &#125; else &#123; $this-&gt;leftRotate($tmpNode-&gt;getID(), true); &#125; &#125; $this-&gt;getNodeFromPool($this-&gt;root)-&gt;setColor(2); &#125; &#125; protected function leftRotate($nodeID, $changeColor = false) &#123; $node = $this-&gt;getNodeFromPool($nodeID); $parentID = $node-&gt;parent; $parent = $this-&gt;getNodeFromPool($parentID); $grandPID = $parent-&gt;parent; $grandP = $this-&gt;getNodeFromPool($grandPID); if (is_null($grandP-&gt;getValue())) &#123; $this-&gt;root = $nodeID; &#125; else &#123; if ($grandP-&gt;left == $parentID) &#123; $grandP-&gt;left = $nodeID; &#125; else &#123; $grandP-&gt;right = $nodeID; &#125; &#125; if ($changeColor) &#123; $node-&gt;setColor(2); $parent-&gt;setColor(1); &#125; $leftNode = $this-&gt;getNodeFromPool($node-&gt;left); if (!is_null($leftNode-&gt;getValue())) &#123; $leftNode-&gt;parent = $parentID; &#125; $parent-&gt;right = $node-&gt;left; $parent-&gt;parent = $nodeID; $node-&gt;parent = $grandPID; $node-&gt;left = $parentID; &#125; protected function rightRotate($nodeID, $changeColor = false) &#123; $node = $this-&gt;getNodeFromPool($nodeID); $parentID = $node-&gt;parent; $parent = $this-&gt;getNodeFromPool($parentID); $grandPID = $parent-&gt;parent; $grandP = $this-&gt;getNodeFromPool($grandPID); if (is_null($grandP-&gt;getValue())) &#123; $this-&gt;root = $nodeID; &#125; else &#123; if ($grandP-&gt;left == $parentID) &#123; $grandP-&gt;left = $nodeID; &#125; else &#123; $grandP-&gt;right = $nodeID; &#125; &#125; if ($changeColor) &#123; $node-&gt;setColor(2); $parent-&gt;setColor(1); &#125; $rightNode = $this-&gt;getNodeFromPool($node-&gt;right); if (!is_null($rightNode-&gt;getValue())) &#123; $rightNode-&gt;parent = $parentID; &#125; $parent-&gt;left = $node-&gt;right; $parent-&gt;parent = $nodeID; $node-&gt;parent = $grandPID; $node-&gt;right = $parentID; &#125; public function delete($value) &#123; //TODO &#125;&#125;$test = [12, 550, 300, 20, 1, 50, 44, 34, 24, 25, 79, 11, 21, 1000, 3000, 99];$testH = [12, 550, 300, 20, 1, 50, 44, 34, 24, 25, 79, 19, 99];echo '&lt;pre&gt;';$tree = new RedBlackTree();foreach ($test as $value) &#123; $tree-&gt;insert($value);&#125;foreach ($testH as $v) &#123; if ($tree-&gt;find($v)) &#123; echo 'true;'; &#125; else &#123; echo 'false;'; &#125;&#125;// $tree-&gt;walk($tree-&gt;root);]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[BB+]]></title>
    <url>%2F2020%2F05%2F07%2F%E5%9B%BE%E8%A7%A3B%E6%A0%91B-%E6%A0%91%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ BB+B BBB-BB+B m-1 1 m/2   keyvalue 1 &lt;= k &lt;= m-1m/2 &lt;= k &lt;= m-1 Bm 5B1 &lt;= k &lt;= 42 &lt;= k &lt;= 4 B Bkeym-1key 5B4key2keykeyvalue 18705040 22 224 232539   BB B 15m/2 2222keykeykeykey222422 262m/2m/2m/2m/2  282key   BB+B+ B+B+B+B  m/2 &lt;= k &lt;= m-1  B+ keykeykeykeykey   B+ m-1 5B+5B+24 5101520 254 2630  Bm/2m/2key  10 5  B+ BB+B+B IOMySQL B ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLB+]]></title>
    <url>%2F2020%2F05%2F07%2F%E4%B8%BA%E4%BB%80%E4%B9%88MySQL%E7%94%A8B-%E6%A0%91%E5%81%9A%E7%B4%A2%E5%BC%95%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[ B+B  AVL1  B+  MySQLB+B+ [1,2,3,4]4MySQL B+Hash InnoDBB+ B+BB+  userkeydata useriduser id=12 112101210 212131213 312121212dataid=12,name=xm 36   id=177   AVL1     Buser       IO B BBalance TreeB pMySQLMySQL BkeydataB3B B id=28B 112817351p23 22832826303p28 32882828(28,bv) B+B+BB+ B+B 1B+BInnoDB16KBIOB+B+10003B+100010001000=10102IO 2B+B+B B+ BMySQLInnoDBB+InnoDBB+ InnoDB MyISAMB+InnoDBMyISAMB+  VS B+ MySQLB+ InnoDB 1InnoDBInnoDBB+B+B+B+B+ 2B+  B+B+B+  B+id&gt;=18id&lt;40sqlselect * from user where id&gt;=18 and id &lt;40id 11 1id&gt;=18 and id &lt;40id=18 118p23 23p23 33183p18 388 8 18 18 8 2288p9 4998124140   (18,kl),(19,kl),(22,hj),(24,io),(25,vg),(29,jk),(31,jk),(33,rt),(34,ty),(35,yu),(37,rt),(39,rt) 12     id name luckyNum 1 zs 23 2 ls 7  x-y1-11133sqlselect * from user where luckNum=33 47  MyISAM MySQLB+InnoDBB+]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[B-B+]]></title>
    <url>%2F2020%2F05%2F06%2FB-%E6%A0%91%E5%92%8CB-%E6%A0%91%2F</url>
    <content type="text"><![CDATA[   B+B-B+ B+  B+ MySQLHashB+ B+B-B-BB    IO G  410:  1IO 2IO 3IO 4IO IO IO44IOIOB- B BB BkkBk B-Balance TreemB 1. 2.k-1km/2 &lt;= k &lt;= m 3.k-1m/2 &lt;= k &lt;= mB--14B-4321 4. 5.k-1k 3B-B- (26)261(35)812(35)268(35) 5 1IO 9 2IO 26 3IO 35 B- IOIO B- B-4 4435 3526935269496 BB-B- 11 11 1112B121315131212 B-MongoDB B- MySQLB+ B+B+B-B- B-mB 1. 2.k-1km/2 &lt;= k &lt;= m 3.k-1m/2 &lt;= k &lt;= m 4. 5.k-1k B+B-B+ mB+ 1.kkBk-1 2. 3.   B+ 825868 1511151315 15B+    B+[] B- B-Satellite Information B+ B+Satellite Information Clustered IndexNonClustered Index B+ B+ B+3 IO IO IO B-B+ B+B-IO B+B- B-B+ B+IO1010030 B- B-311 3 6 8 9 11 B-B+ B+ 3 68 911 B- B+B- 1.IO 2. 3. B+B- AA  B+ B+ 1.kkBk-1 2. 3. B+ 1.IO 2. 3. B+B100B+1000 MongoDBB-MySQLB+B-B+B-B+ 1B- B- B- 1 2 3 2B+ B+B-  1 2 3 4 MongoDBMySQL 3B-B+ 1B+lognB-O(1) 2B+B-keydata 3B+data 4123B-IOB+IO  MongoDBMySQL 1MongoDB MongoDBNoSQLJsonJson MongoDBB- MongoDBB-DataMySQL 2MySQL MySQLB+ B-B+]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel]]></title>
    <url>%2F2020%2F04%2F29%2F%E4%B8%80%E6%AC%A1Laravel%E8%AF%B7%E6%B1%82%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%2F</url>
    <content type="text"><![CDATA[  Laravelpublic/index.phpwebApache/Nginxindex.php index.phpComposerbootstrap/app.phpLaravelLaravel HTTP/ConsoleHTTPConsoleWebArtisanapp/Http/Kernel.phpHTTP HTTPIlluminate\Foundation\Http\Kernelbootstrappersbootstrappers HTTPHTTPHTTPCSRF HTTPhandleRequestResponseHTTPHTTP config/app.phpprovidersregisterboot Laravel Request Laravel Laravelapp/Providers AppServiceProvider  WebHTTP LaravelWebHTTPHTTPpublic/index.phpHTTPHTTP 1234567891011121314151617181920212223$app = new Illuminate\Foundation\Application( realpath(__DIR__.'/../')); // HTTP$app-&gt;singleton( Illuminate\Contracts\Http\Kernel::class, App\Http\Kernel::class);// HTTPKernel$kernel = $app-&gt;make(Illuminate\Contracts\Http\Kernel::class);// HTTP$response = $kernel-&gt;handle( $request = Illuminate\Http\Request::capture());// $response-&gt;send();// $kernel-&gt;terminate($request, $response); ApplicationKernelHTTPKernelsend()Kernelterminate() LaravelHTTP$kernel-&gt;handle() Laravel $appKernel 1234$app-&gt;singleton( Illuminate\Contracts\Http\Kernel::class, App\Http\Kernel::class); singletonApp\Http\KernelIlluminate\Contracts\Http\KernelApp\Http\KernelIlluminate\Contracts\Http\Kernel$app-&gt;make() 1$kernel = $app-&gt;make(Illuminate\Contracts\Http\Kernel::class); Kernel$kernel-&gt;handle()HTTPIlluminate\Foundation\Http\KernelApp\Http\KernelhandlesendRequestThroughRouter 12345678910111213protected function sendRequestThroughRouter($request)&#123; $this-&gt;app-&gt;instance('request', $request); Facade::clearResolvedInstance('request'); $this-&gt;bootstrap(); return (new Pipeline($this-&gt;app)) -&gt;send($request) -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [] : $this-&gt;middleware) -&gt;then($this-&gt;dispatchToRouter());&#125; bootstrap() 12345678protected $bootstrappers = [ \Illuminate\Foundation\Bootstrap\LoadEnvironmentVariables::class, \Illuminate\Foundation\Bootstrap\LoadConfiguration::class, \Illuminate\Foundation\Bootstrap\HandleExceptions::class, \Illuminate\Foundation\Bootstrap\RegisterFacades::class, \Illuminate\Foundation\Bootstrap\RegisterProviders::class, \Illuminate\Foundation\Bootstrap\BootProviders::class,]; config/app.phpprovidersaliasboot HTTP 1234return (new Pipeline($this-&gt;app)) -&gt;send($request) -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [] : $this-&gt;middleware) -&gt;then($this-&gt;dispatchToRouter()); LaravelHTTPfalse URL Kernel$response-&gt;send()$kernel-&gt;terminate() 123456public function terminate($request, $response)&#123; $this-&gt;terminateMiddleware($request, $response); $this-&gt;app-&gt;terminate();&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IoC]]></title>
    <url>%2F2020%2F04%2F27%2F%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0IoC%E5%AE%B9%E5%99%A8%E5%92%8C%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85%E6%98%AF%E4%BB%80%E4%B9%88%E6%A6%82%E5%BF%B5%2F</url>
    <content type="text"><![CDATA[ IoCloginloginnew FileLog() loguserIocUserloginIoC  1Iocbindingbindlog=&gt;FileLoguser=&gt;User 2ioc-&gt;make(user)UserUserloglogFileLog 3$filelog = new FileLog(); 4newInstanceArgsnew User($filelog); 123456// ioc$ioc = new Ioc();$ioc-&gt;bind('log','FileLog');$ioc-&gt;bind('user','User');$user = $ioc-&gt;make('user');$user-&gt;login(); IocUser IoC IoC123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100interface log&#123; public function write();&#125;// class FileLog implements Log&#123; public function write() &#123; echo 'file log write...'; &#125;&#125;// class DatabaseLog implements Log&#123; public function write() &#123; echo 'database log write...'; &#125;&#125;class User&#123; protected $log; public function __construct(Log $log) &#123; $this-&gt;log = $log; &#125; public function login() &#123; //  echo 'login success...'; $this-&gt;log-&gt;write(); &#125;&#125;class Ioc&#123; public $binding = []; public function bind($abstract, $concrete) &#123; // closurebindUserclosuremakeFileLog; $this-&gt;binding[$abstract]['concrete'] = function ($ioc) use ($concrete) &#123; return $ioc-&gt;build($concrete); &#125;; &#125; public function make($abstract) &#123; // keybinding $concrete = $this-&gt;binding[$abstract]['concrete']; return $concrete($this); &#125; //  public function build($concrete) &#123; $reflector = new ReflectionClass($concrete); $constructor = $reflector-&gt;getConstructor(); if(is_null($constructor)) &#123; return $reflector-&gt;newInstance(); &#125; else &#123; $dependencies = $constructor-&gt;getParameters(); $instances = $this-&gt;getDependencies($dependencies); return $reflector-&gt;newInstanceArgs($instances); &#125; &#125; //  protected function getDependencies($paramters) &#123; $dependencies = []; foreach ($paramters as $paramter) &#123; $dependencies[] = $this-&gt;make($paramter-&gt;getClass()-&gt;name); &#125; return $dependencies; &#125;&#125;// IoC$ioc = new Ioc();$ioc-&gt;bind('log','FileLog');$ioc-&gt;bind('user','User');$user = $ioc-&gt;make('user');$user-&gt;login(); IoC Laravel1234567891011121314151617181920212223242526272829$providers = [ Illuminate\Auth\AuthServiceProvider::class, Illuminate\Broadcasting\BroadcastServiceProvider::class, Illuminate\Bus\BusServiceProvider::class, Illuminate\Cache\CacheServiceProvider::class, ...]...// CacheServiceProviderregisteriocappIoc// singletonbindsingletonclass CacheServiceProvider&#123; public function register() &#123; $this-&gt;app-&gt;singleton('cache', function ($app) &#123; return new CacheManager($app); &#125;); $this-&gt;app-&gt;singleton('cache.store', function ($app) &#123; return $app['cache']-&gt;driver(); &#125;); $this-&gt;app-&gt;singleton('memcached.connector', function () &#123; return new MemcachedConnector; &#125;); &#125;&#125; configapp.phpproviders registerLaravel]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F04%2F27%2F%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E3%80%81%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%E3%80%81%E5%8F%8D%E5%B0%84%E5%90%84%E4%B8%AA%E6%A6%82%E5%BF%B5%E7%9A%84%E7%90%86%E8%A7%A3%E5%92%8C%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[   1234567891011121314151617181920212223242526272829303132333435363738394041424344// interface log&#123; public function write(); &#125;// class FileLog implements Log&#123; public function write() &#123; echo 'file log write...'; &#125; &#125;// class DatabaseLog implements Log&#123; public function write() &#123; echo 'database log write...'; &#125; &#125;// class User &#123; protected $fileLog; public function __construct() &#123; $this-&gt;fileLog = new FileLog(); &#125; public function login() &#123; //  echo 'login success...'; $this-&gt;fileLog-&gt;write(); &#125;&#125;$user = new User();$user-&gt;login(); UserUser 1234567891011121314151617181920class User &#123; protected $log; public function __construct(Log $log) &#123; $this-&gt;log = $log; &#125; public function login() &#123; //  echo 'login success...'; $this-&gt;log-&gt;write(); &#125;&#125;$user = new User(new DatabaseLog());$user-&gt;login(); User IoC newDI  LaravelLaravelRequest 123456789101112131415// routes/web.phpRoute::get('/post/store', 'PostController@store');// App\Http\Controllersclass PostController extends Controller &#123; public function store(Illuminate\Http\Request $request) &#123; $this-&gt;validate($request, [ 'category_id' =&gt; 'required', 'title' =&gt; 'required|max:255|min:4', 'body' =&gt; 'required|min:6', ]); &#125;&#125; LaravelPoststore apiUser 1234567891011121314// UserreflectionClass$class = new ReflectionClass(User::class);// User$constructor = $class-&gt;getConstructor();// User$dependencies = $constructor-&gt;getParameters();// user$user = $reflector-&gt;newInstance();// user$user = $reflector-&gt;newInstanceArgs($dependencies = []); makeUserUsernewInstanceArgsUser 1234567891011121314function make($concrete)&#123; // User $reflector = new ReflectionClass($concrete); // User $constructor = $reflector-&gt;getConstructor(); // User $dependencies = $constructor-&gt;getParameters(); // User return $reflector-&gt;newInstanceArgs($dependencies);&#125;$user = make('User');$user-&gt;login(); 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556// User// // Iocclass User &#123; protected $log; public function __construct(FileLog $log) &#123; $this-&gt;log = $log; &#125; public function login() &#123; //  echo 'login success...'; $this-&gt;log-&gt;write(); &#125;&#125;function make($concrete)&#123; $reflector = new ReflectionClass($concrete); $constructor = $reflector-&gt;getConstructor(); // ? FileLog if(is_null($constructor)) &#123; return $reflector-&gt;newInstance(); &#125; else &#123; //  $dependencies = $constructor-&gt;getParameters(); // FileLog $instances = $this-&gt;getDependencies($dependencies); return $reflector-&gt;newInstanceArgs($instances); &#125;&#125;function getDependencies($paramters)&#123; $dependencies = []; foreach ($paramters as $paramter) &#123; $dependencies[] = make($paramter-&gt;getClass()-&gt;name); &#125; return $dependencies;&#125;$user = make('User');$user-&gt;login(); ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Container tag]]></title>
    <url>%2F2020%2F04%2F25%2FContainer-tag%E8%A7%A3%E6%9E%90%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[   123456789101112// currency// taggedcurrencyabstractpublic function testTags()&#123; $this-&gt;app-&gt;tag(Rmb::class, 'currency'); $this-&gt;app-&gt;tag(Dollar::class, 'currency'); $currencyArray = $this-&gt;app-&gt;tagged('currency'); $this-&gt;assertTrue($currencyArray[0] instanceof Rmb); $this-&gt;assertTrue($currencyArray[1] instanceof Dollar);&#125; abstracttaggedmaketaggedmake  1234567891011121314151617181920212223242526272829303132333435363738394041class AusDollars&#123; private $amount; public function __construct($amount) &#123; $this-&gt;amount = $amount; &#125;&#125;class Rmb&#123;&#125;class Dollar&#123; public function __construct() &#123; &#125; public function getAmount() &#123; return 1; &#125;&#125;Class Currency&#123; private $dollar; public function __construct(Dollar $dollar) &#123; $this-&gt;dollar = $dollar; &#125; public function getAmount() &#123; return $this-&gt;dollar-&gt;getAmount(); &#125;&#125; 1. 123456789101112131415public function testTags()&#123; $this-&gt;app-&gt;bind('rmb', Rmb::class); //  $this-&gt;app-&gt;tag('rmb', 'currency', 'money'); //  $this-&gt;app-&gt;tag(Dollar::class, 'currency', 'money'); $currencyArray = $this-&gt;app-&gt;tagged('money'); $this-&gt;assertTrue($currencyArray[0] instanceof Rmb); $this-&gt;assertTrue($currencyArray[1] instanceof Dollar);&#125; 2.tag 12345678910111213public function testTagsWithDependency()&#123; $this-&gt;app-&gt;tag(AusDollars::class, 'currency', 'money'); try &#123; $this-&gt;app-&gt;tagged('money'); &#125; catch(\Exception $e) &#123; $this-&gt;assertContains('Unresolvable dependency resolving',$e-&gt;getMessage()); &#125;&#125;  1`Unresolvable dependency resolving [Parameter #0 [ &lt;required&gt; $amount ]] in class ...` 1.tag 123456789101112131415161718192021222324/** * Assign a set of tags to a given binding. * * @param array|string $abstracts * @param array|mixed ...$tags * @return void */public function tag($abstracts, $tags)&#123; $tags = is_array($tags) ? $tags : array_slice(func_get_args(), 1); foreach ($tags as $tag) &#123; if (! isset($this-&gt;tags[$tag])) &#123; $this-&gt;tags[$tag] = []; &#125; foreach ((array) $abstracts as $abstract) &#123; $this-&gt;tags[$tag][] = $abstract; &#125; &#125;&#125; 1.0 $abstractsbindconcretemake 1.1 $tags array_slice 1$tags = is_array($tags) ? $tags : array_slice(func_get_args(), 1);  123456// $this-&gt;app-&gt;tag(Rmb::class, 'currency');// $this-&gt;app-&gt;tag(Rmb::class, ['currency', 'money']);// $this-&gt;app-&gt;tag(Rmb::class, 'currency'money);  1.2  a.tagstagsprotected $tags = [];tag b.$abstracts$abstractabstracttag tags 123456789101112foreach ($tags as $tag) &#123; if (! isset($this-&gt;tags[$tag])) &#123; $this-&gt;tags[$tag] = []; &#125; foreach ((array) $abstracts as $abstract) &#123; $this-&gt;tags[$tag][] = $abstract; &#125;&#125; tags 2.taggedtag 1234567891011121314151617181920/** * Resolve all of the bindings for a given tag. * * @param string $tag * @return iterable */public function tagged($tag)&#123; if (! isset($this-&gt;tags[$tag])) &#123; return []; &#125; return new RewindableGenerator(function () use ($tag) &#123; foreach ($this-&gt;tags[$tag] as $abstract) &#123; yield $this-&gt;make($abstract); &#125; &#125;, count($this-&gt;tags[$tag]));&#125; 2.1  a.tags b.tagmake$abstract makebindingbuild makeparametersmake]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Container build]]></title>
    <url>%2F2020%2F04%2F25%2FContainer-build%E8%A7%A3%E6%9E%90%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[ concretebuildStack build 1build16 12345678910111213141516171819202122232425&lt;?php// class Money&#123; public function getAmount() &#123; return 100; &#125;&#125;class ExampleTest extends TestCase&#123; public function testClosure() &#123; //  $boss = app()-&gt;build(function()&#123; return new Money(); &#125;); $output = $boss-&gt;getAmount(); $this-&gt;assertEquals($output, 100); &#125;&#125; 2makemakebuild 123456789101112131415161718192021222324252627282930&lt;?php// class Money&#123; //  private $amount = 0; public function __construct($amount) &#123; $this-&gt;amount = $amount; &#125; public function getAmount() &#123; return $this-&gt;amount; &#125;&#125;class ExampleTest extends TestCase&#123; public function testClosure() &#123; $this-&gt;app-&gt;bind('money', function($app, $parameters)&#123; return new Money($parameters[0]); &#125;); $boss = app()-&gt;make('money', [$amount = 1000]); &#125;&#125; 3.makemakebuild 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;?php// class Money&#123; private $amount = 0; public function __construct($amount) &#123; $this-&gt;amount = $amount; &#125; public function getAmount() &#123; return $this-&gt;amount; &#125;&#125;class Dollar extends Money&#123; //private $amount = 0; public function __construct() &#123; &#125; public function getAmount() &#123; return 1; &#125;&#125;Class Currency&#123; private $dollar; //  public function __construct(Dollar $dollar) &#123; $this-&gt;dollar = $dollar; &#125; public function getAmount() &#123; return $this-&gt;dollar-&gt;getAmount(); &#125;&#125;public function testFunctionBuildWithDependenceOfClass()&#123; $obj = app()-&gt;make(Currency::class); $this-&gt;assertEquals($obj-&gt;getAmount(), 1);&#125;  12345678910111213141516class Money&#123; private $amount = 0; public function __construct($amount) &#123; $this-&gt;amount = $amount; &#125; public function getAmount() &#123; return $this-&gt;amount; &#125;&#125;$obj = app()-&gt;make(Money::class, [$amount =&gt; 1000]); amountwithparameter 123array(1) &#123; [0]=&gt;int(1000)&#125; parameterkey 1$obj = app()-&gt;make(Money::class, ['amount' =&gt; 1000]); 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970/** *  * * @param \Closure|string $concrete * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException *///0 -&gt; public function build($concrete)&#123; // $concrete //  // 1 if ($concrete instanceof Closure) &#123; return $concrete($this, $this-&gt;getLastParameterOverride()); &#125; try &#123; // 2 $reflector = new ReflectionClass($concrete); &#125; catch (ReflectionException $e) &#123; throw new BindingResolutionException("Target class [$concrete] does not exist.", 0, $e); &#125; //  // InterfaceAbstract Class if (! $reflector-&gt;isInstantiable()) &#123; return $this-&gt;notInstantiable($concrete); &#125; // 3 $this-&gt;buildStack[] = $concrete; $constructor = $reflector-&gt;getConstructor(); //  //  if (is_null($constructor)) &#123; array_pop($this-&gt;buildStack); return new $concrete; &#125; // 4 $dependencies = $constructor-&gt;getParameters(); //  //  try &#123; $instances = $this-&gt;resolveDependencies($dependencies); &#125; catch (BindingResolutionException $e) &#123; array_pop($this-&gt;buildStack); throw $e; &#125; array_pop($this-&gt;buildStack); return $reflector-&gt;newInstanceArgs($instances);&#125; 0.concreteconcreteinstance 1.concrete 1234if ($concrete instanceof Closure) &#123; return $concrete($this, $this-&gt;getLastParameterOverride());&#125;  1$concrete($this, $this-&gt;getLastParameterOverride());  $this-&gt;getLastParameterOverride() 123456789/** * Get the last parameter override. * * @return array */protected function getLastParameterOverride()&#123; return count($this-&gt;with) ? end($this-&gt;with) : [];&#125; makeparameterswithgetLastParameterOverridewithmakeparameters 2phpReflectionClassReflectionClassReflectionObject concrete 1$reflector = new ReflectionClass($concrete); 2.1notInstantiable 1234if (! $reflector-&gt;isInstantiable()) &#123; return $this-&gt;notInstantiable($concrete);&#125; notInstantiable 123456789101112131415161718192021222324/** * Throw an exception that the concrete is not instantiable. *  * * @param string $concrete * @return void * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function notInstantiable($concrete)&#123; if (! empty($this-&gt;buildStack)) &#123; $previous = implode(', ', $this-&gt;buildStack); $message = "Target [$concrete] is not instantiable while building [$previous]."; &#125; else &#123; $message = "Target [$concrete] is not instantiable."; &#125; throw new BindingResolutionException($message);&#125; messageTarget  is not instantiable. 3phpConcrete 3.1concretebuildStack 1$this-&gt;buildStack[] = $concrete; 3.2getConstructorbuildStackconcretenew 12345678$constructor = $reflector-&gt;getConstructor();if (is_null($constructor)) &#123; array_pop($this-&gt;buildStack); return new $concrete;&#125; 4 4.1  1$dependencies = $constructor-&gt;getParameters(); getParameters() 1234567891011121314151617181920&lt;?phpclass dollar&#123; public function __construct($import) &#123; &#125; public function getAmount() &#123; return 100; &#125;&#125;$reflect = new ReflectionClass('dollar');$constructor = $reflect-&gt;getConstructor();var_dump($constructor-&gt;getParameters());  12345array(1) &#123; [0] =&gt; object(ReflectionParameter)#3 (1) &#123; [&quot;name&quot;]=&gt;string(6) &quot;import&quot; &#125;&#125; 4.2 resolveDependencies4.3 1$instances = $this-&gt;resolveDependencies($dependencies);  1234567891011121314151617181920212223242526272829303132333435363738394041/** * ReflectionParameters * * @param array $dependencies * @return array * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function resolveDependencies(array $dependencies)&#123; $results = []; foreach ($dependencies as $dependency) &#123; // build //  if ($this-&gt;hasParameterOverride($dependency)) &#123; $results[] = $this-&gt;getParameterOverride($dependency); continue; &#125; // null //  $result = is_null($dependency-&gt;getClass()) ? $this-&gt;resolvePrimitive($dependency) : $this-&gt;resolveClass($dependency); if ($dependency-&gt;isVariadic()) &#123; $results = array_merge($results, $result); &#125; else &#123; $results[] = $result; &#125; &#125; return $results;&#125; 4.2.1 $this-&gt;hasParameterOverride($dependency)hasParameterOverride 123456789101112/** *  * * @param \ReflectionParameter $dependency * @return bool */protected function hasParameterOverride($dependency)&#123; return array_key_exists( $dependency-&gt;name, $this-&gt;getLastParameterOverride() );&#125; $this-&gt;getLastParameterOverride()makewith$dependency-&gt;nameimportmakemakeparameters 4.2.2 getParameterOverrideresult 1$results[] = $this-&gt;getParameterOverride($dependency); getParameterOverride 12345678910/** * Get a parameter override for a dependency. * * @param \ReflectionParameter $dependency * @return mixed */protected function getParameterOverride($dependency)&#123; return $this-&gt;getLastParameterOverride()[$dependency-&gt;name];&#125; getLastParameterOverridewithnameimport 4.2.3 continue 4.2.4 withmakeparameters I. resolvePrimitive4.2.5resolvePrimitive II. resolveClassmake4.2.6resolveClass 12345// null// $result = is_null($dependency-&gt;getClass()) ? $this-&gt;resolvePrimitive($dependency) : $this-&gt;resolveClass($dependency); 4.2.5 resolvePrimitive 12345678910111213141516171819202122/** *  * * @param \ReflectionParameter $parameter * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function resolvePrimitive(ReflectionParameter $parameter)&#123; if (! is_null($concrete = $this-&gt;getContextualConcrete('$'.$parameter-&gt;name))) &#123; return $concrete instanceof Closure ? $concrete($this) : $concrete; &#125; if ($parameter-&gt;isDefaultValueAvailable()) &#123; return $parameter-&gt;getDefaultValue(); &#125; $this-&gt;unresolvablePrimitive($parameter);&#125; a. name b.  c. $import=100 d. unresolvablePrimitive 1234567891011121314/** *  * * @param \ReflectionParameter $parameter * @return void * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function unresolvablePrimitive(ReflectionParameter $parameter)&#123; $message = "Unresolvable dependency resolving [$parameter] in class &#123;$parameter-&gt;getDeclaringClass()-&gt;getName()&#125;"; throw new BindingResolutionException($message);&#125; 4.2.6 resolveClass 12345678910111213141516171819202122232425262728293031323334/** *  * * @param \ReflectionParameter $parameter * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function resolveClass(ReflectionParameter $parameter)&#123; try &#123; return $parameter-&gt;isVariadic() ? $this-&gt;resolveVariadicClass($parameter) : $this-&gt;make($parameter-&gt;getClass()-&gt;name); &#125; //  //  catch (BindingResolutionException $e) &#123; if ($parameter-&gt;isDefaultValueAvailable()) &#123; return $parameter-&gt;getDefaultValue(); &#125; if ($parameter-&gt;isVariadic()) &#123; return []; &#125; throw $e; &#125;&#125; a.makebuildbuildstackresolvegetContextualConcrete b.BindingResolutionException$importoptional ($import == 100) 100 4.2.7 resultresult[] 4.3 newInstanceArgsnew$instances. 4.3.1 array_popbuildStackbuildStack buildconcretion 123array_pop($this-&gt;buildStack);return $reflector-&gt;newInstanceArgs($instances);  build 1 2phpphp 3new 4 4.1make 4.2 a b 4.3]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Container make]]></title>
    <url>%2F2020%2F04%2F25%2FContainer-make%E8%A7%A3%E6%9E%90%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[ makebuild make($abstract, array $parameters = []); makeresolveconcretebind makebuildLaravel  resolvemakeContainermakeresolve makeresolvemakeWith 12345678910111213/** *  * * @param string $abstract * @param array $parameters * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException */public function make($abstract, array $parameters = [])&#123; return $this-&gt;resolve($abstract, $parameters);&#125; 1234567891011/** * An alias function name for make(). * * @param string $abstract * @param array $parameters * @return mixed */public function makeWith($abstract, array $parameters = [])&#123; return $this-&gt;make($abstract, $parameters);&#125; resolve 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667/** *  * * @param string $abstract * @param array $parameters * @param bool $raiseEvents * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function resolve($abstract, $parameters = [], $raiseEvents = true)&#123; $abstract = $this-&gt;getAlias($abstract); $needsContextualBuild = ! empty($parameters) || ! is_null( $this-&gt;getContextualConcrete($abstract) ); //  //  if (isset($this-&gt;instances[$abstract]) &amp;&amp; ! $needsContextualBuild) &#123; return $this-&gt;instances[$abstract]; &#125; $this-&gt;with[] = $parameters; $concrete = $this-&gt;getConcrete($abstract); //  //  if ($this-&gt;isBuildable($concrete, $abstract)) &#123; $object = $this-&gt;build($concrete); &#125; else &#123; $object = $this-&gt;make($concrete); &#125; //  //  foreach ($this-&gt;getExtenders($abstract) as $extender) &#123; $object = $extender($object, $this); &#125; //  //  if ($this-&gt;isShared($abstract) &amp;&amp; ! $needsContextualBuild) &#123; $this-&gt;instances[$abstract] = $object; &#125; if ($raiseEvents) &#123; $this-&gt;fireResolvingCallbacks($abstract, $object); &#125; //  true //  $this-&gt;resolved[$abstract] = true; array_pop($this-&gt;with); return $object;&#125;  $abstractid $parameters$parameters bindmakeBoss::classObjectBoss::class 12345678910111213141516&lt;?phpclass Boss()&#123; private $obj; //  public function __construct(Object $obj) &#123; $this-&gt;obj = $obj; &#125;&#125;app()-&gt;bind('Boss', Boss::class);app()-&gt;make('Boss', [new Object()]); 1.$abstract 1$abstract = $this-&gt;getAlias($abstract); 2.$needsContextualBuild 123$needsContextualBuild = ! empty($parameters) || ! is_null( $this-&gt;getContextualConcrete($abstract) ); make a. b.getContextualConcrete 2.1.getContextualConcrete($abstract) getContextualConcrete 123456789101112131415161718192021222324252627/** * concrete * * @param string $abstract * @return \Closure|string|null */protected function getContextualConcrete($abstract)&#123; if (! is_null($binding = $this-&gt;findInContextualBindings($abstract))) &#123; return $binding; &#125; //   if (empty($this-&gt;abstractAliases[$abstract])) &#123; return; &#125; foreach ($this-&gt;abstractAliases[$abstract] as $alias) &#123; if (! is_null($binding = $this-&gt;findInContextualBindings($alias))) &#123; return $binding; &#125; &#125;&#125; 2.1.1.abstractconcrete 2.1.2.$abstractAliases$abstract$aliasesabstractaliasvalueappabstract 123456789$abstractAliases = [ app = &#123;array&#125; [3] 0 = &quot;Illuminate\Foundation\Application&quot; 1 = &quot;Illuminate\Contracts\Container\Container&quot; 2 = &quot;Illuminate\Contracts\Foundation\Application&quot; blade.compiler = &#123;array&#125; [1] 0 = &quot;Illuminate\View\Compilers\BladeCompiler&quot; ...]  2.1.3.abstractbinding abstractabstract 2.1.3.1findInContextualBindings: 12345678910/** * Find the concrete binding for the given abstract in the contextual binding array. * * @param string $abstract * @return \Closure|string|null */protected function findInContextualBindings($abstract)&#123; return $this-&gt;contextual[end($this-&gt;buildStack)][$abstract] ?? null;&#125; :contextual[when][give]=implement [give]end($this-&gt;buildStack)buildStackbuildresolvegetContextualConcretebuildmakebuild parametersgetContextualConcrete 3.resolveinstancesabstractinstancesinstancesshared instancesinstancenew A(1)newA(2) 1234if (isset($this-&gt;instances[$abstract]) &amp;&amp; ! $needsContextualBuild) &#123; return $this-&gt;instances[$abstract];&#125; instance()instancesmakeinstace 123456789101112131415// instance$this-&gt;app-&gt;instance('money', "11");$re = $this-&gt;app-&gt;make('money'); // success//  $this-&gt;app-&gt;bind('money', function()&#123; return "11";&#125;);$re = $this-&gt;app-&gt;make('money'); // success// instances11$this-&gt;app-&gt;bind('money', '11');$re = $this-&gt;app-&gt;make('money'); // fail 4.1parameterswithparameterswith 1$this-&gt;with[] = $parameters; 4.2.getConcrete($abstract)concrete 1$concrete = $this-&gt;getConcrete($abstract); getConcrete: 1234567891011121314151617181920212223/** * Get the concrete type for a given abstract. * * @param string $abstract * @return mixed $concrete */protected function getConcrete($abstract)&#123; if (! is_null($concrete = $this-&gt;getContextualConcrete($abstract))) &#123; return $concrete; &#125; // If we don't have a registered resolver or concrete for the type, we'll just // assume each type is a concrete name and will attempt to resolve it as is // since the container should be able to resolve concretes automatically. if (isset($this-&gt;bindings[$abstract])) &#123; return $this-&gt;bindings[$abstract]['concrete']; &#125; return $abstract;&#125;  a. $abstractconcrete concrete getConcretegetContextualConcretebuildstackbuildbuildstack b.bindings$abstractconcrete$concrete c.$abstract bindmake$abstract$concrete 12// Money::class $boss= app()-&gt;make(Money::class);  a.concrete b.binding concrete c.$concrete===$abstract c 5. 123456789//  // if ($this-&gt;isBuildable($concrete, $abstract)) &#123; $object = $this-&gt;build($concrete);&#125; else &#123; $object = $this-&gt;make($concrete);&#125; 5.1 isBuildable$concrete===$abstract concretetrue 1234567891011/** * Determine if the given concrete is buildable. * * @param mixed $concrete * @param string $abstract * @return bool */protected function isBuildable($concrete, $abstract)&#123; return $concrete === $abstract || $concrete instanceof Closure;&#125; 5.2 truebuildobject buildbuild build a.concretebuild b.build$concrete$abstract===$concrete 5.3 isBuildablefalse$concretemakegivemake 1234$container -&gt;when(VideoController::class) -&gt;needs(Filesystem::class) -&gt;give(S3Filesystem::class); makegetConcretebinding abstractbuild 6.object entend0.2 12345//  // foreach ($this-&gt;getExtenders($abstract) as $extender) &#123; $object = $extender($object, $this);&#125; 7.instance0.4 12345// // if ($this-&gt;isShared($abstract) &amp;&amp; ! $needsContextualBuild) &#123; $this-&gt;instances[$abstract] = $object;&#125; 8.0.33 1$this-&gt;fireResolvingCallbacks($abstract, $object); 9.withpopwithbuildmake 12345// true // $this-&gt;resolved[$abstract] = true;array_pop($this-&gt;with);  make 1. 2. 3.sharedinstances 4.parameterswith 5.getConcrete$concrete.concrete 6.$concretebuild 7.$concretebuildwithbuild 8.extend 9.shardinstance 10. 11.abstract 12.withparameters 13.]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Container bind]]></title>
    <url>%2F2020%2F04%2F25%2FContainer-bind%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[   Illuminate\Container\Containerbind make  1bindmake 2singletonmake 3instance 4 5 6tag 7extends 1 12345678910111213141516171819class Money&#123; private $amount = 0; public function __construct($amount) &#123; $this-&gt;amount = $amount; &#125; public function getAmount() &#123; return $this-&gt;amount; &#125;&#125;// $this-&gt;app-&gt;bind('money', function($app, $parameters)&#123; return new Money($parameters[0]);&#125;); 2 1234567891011class Dollar&#123; public function getAmount() &#123; return 100; &#125;&#125;$this-&gt;app-&gt;bind('dollar', function()&#123; return new Dollar();&#125;); bind 123456789101112131415161718192021222324252627282930313233343536373839/** *  *  * * @param string $abstract * @param \Closure|string|null $concrete * @param bool $shared * @return void */public function bind(string $abstract, $concrete = null, bool $shared = false)&#123; //  $this-&gt;dropStaleInstances($abstract); //  if (is_null($concrete)) &#123; $concrete = $abstract; &#125; // ClosureClosure if (! $concrete instanceof Closure) &#123; if (! is_string($concrete)) &#123; throw new \TypeError(self::class.'::bind(): Argument #2 ($concrete) must be of type Closure|string|null'); &#125; $concrete = $this-&gt;getClosure($abstract, $concrete); &#125; $this-&gt;bindings[$abstract] = compact('concrete', 'shared'); //  if ($this-&gt;resolved($abstract)) &#123; $this-&gt;rebound($abstract); &#125;&#125;  1$abstractid 2$concrete 3shared  1instancesaliases 1$this-&gt;dropStaleInstances($abstract); dropStaleInstances($abstract) 12345678910/** *  * * @param string $abstract * @return void */protected function dropStaleInstances(string $abstract)&#123; unset($this-&gt;instances[$abstract], $this-&gt;aliases[$abstract]);&#125; 2$concrete$abstract$concreteapp()-&gt;bind(Boss::class) 1234if (is_null($concrete))&#123; $concrete = $abstract;&#125; 3$concretegetClosure 1234if (! $concrete instanceof Closure)&#123; $concrete = $this-&gt;getClosure($abstract, $concrete);&#125; getClosure 1234567891011121314151617181920/** *  * * @param string $abstract * @param string $concrete * @return \Closure */protected function getClosure(string $abstract, string $concrete)&#123; return function ($container, $parameters = []) use ($abstract, $concrete) &#123; if ($abstract == $concrete) &#123; return $container-&gt;build($concrete); &#125; return $container-&gt;resolve( $concrete, $parameters, $raiseEvents = false ); &#125;;&#125; function($container,$parameters=[])  usegetClosure$abstract$concrete $abstract$concreteapp-&gt;bind(User::class, User::class)buildresolvebuildresolve function($container,$parameters=[])$concretebuildresolve 4bind$concretecompact$concrete$shardsharedkeyconcretesharedbindingbindingkey 1$this-&gt;bindings[$abstract] = compact('concrete', 'shared');  1234$binding[$abstract] =&gt; [ 'concrete' =&gt; function($container, $parameters=[]), //getClosure() 'shared' =&gt; true/false, // sharedbind] 5reboundreboundCallbacks  1234if ($this-&gt;resolved($abstract))&#123; $this-&gt;rebound($abstract);&#125; $abstractresolved 12345678910111213141516/** *  * * @param string $abstract * @return bool */public function resolved(string $abstract)&#123; if ($this-&gt;isAlias($abstract)) &#123; $abstract = $this-&gt;getAlias($abstract); &#125; return isset($this-&gt;resolved[$abstract]) || isset($this-&gt;instances[$abstract]);&#125;  1.resolved$abstract 2.instancesbind$this-&gt;dropStaleInstances($abstract);instances$abstract$abstractinstances bind 1$concretegetClosurecontainer buildresolvebuildresolve 2share$this-&gt;bindings 3$abstract idLaravel  ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Container sharealias]]></title>
    <url>%2F2020%2F04%2F25%2FContainer-share%E6%9C%BA%E5%88%B6%E4%B8%8Ealias%E5%88%AB%E5%90%8D%2F</url>
    <content type="text"><![CDATA[ app()-&gt;alias(money,alias_money); ShareLaravelContainershared 123456789101112/** * Determine if a given type is shared. * * @param string $abstract * @return bool */public function isShared($abstract)&#123; return isset($this-&gt;instances[$abstract]) || (isset($this-&gt;bindings[$abstract]['shared']) &amp;&amp; $this-&gt;bindings[$abstract]['shared'] === true);&#125; shared 1.instancesshard 2.bindingsshard==true sharedshare 1.instancesshared 2.bingingshardetruesharde shardeinstance Alias  auth 1$this-&gt;app-&gt;make('auth');  1$this-&gt;app-&gt;make('\Illuminate\Auth\AuthManager::class');  1$this-&gt;app-&gt;make('\Illuminate\Contracts\Auth\Factory::class'); authauth  alias_moneyMoney::classmoneyMoney::class 123456789101112131415161718192021class Money&#123; public function getAmount() &#123; return 100; &#125;&#125;class ExampleTest extends TestCase&#123; public function testClosure() &#123; app()-&gt;bind('money', Money::class); app()-&gt;alias('money', 'alias_money'); $boss= app()-&gt;make('alias_money'); $output = $boss-&gt;getAmount(); $this-&gt;assertEquals($output, 100); &#125;&#125;  1$abstract$abstract 2 123456789101112/** * Get the alias for an abstract if available. * * @param string $abstract * @return string */public function getAlias($abstract)&#123; return isset($this-&gt;aliases[$abstract]) ? $this-&gt;getAlias($this-&gt;aliases[$abstract]) : $abstract;&#125;   1Containeralias 1234567891011121314151617181920/** * Alias a type to a different name. * * @param string $abstract * @param string $alias * @return void * * @throws \LogicException */public function alias($abstract, $alias)&#123; // $abstract if ($alias === $abstract) &#123; throw new LogicException("[&#123;$abstract&#125;] is aliased to itself."); &#125; $this-&gt;aliases[$alias] = $abstract; $this-&gt;abstractAliases[$abstract][] = $alias;&#125; aliasesabstractAliasesaliaseskeyabstractAliasesvaluekeyvalue 2 alias()laravel app.phpaliaslaravel/framwork/src/Illuminate/Foundation/Application.phpregisterCoreContainerAliasesApplicationApplicationContainer  123456789101112131415161718192021222324&lt;?php$aliases = [ 'app' =&gt; [ \Illuminate\Foundation\Application::class, \Illuminate\Contracts\Container\Container::class, \Illuminate\Contracts\Foundation\Application::class ], 'auth' =&gt; [ \Illuminate\Auth\AuthManager::class, \Illuminate\Contracts\Auth\Factory::class ], 'auth.driver' =&gt; [ \Illuminate\Contracts\Auth\Guard::class ], 'blade.compiler' =&gt; [ \Illuminate\View\Compilers\BladeCompiler::class ], 'cache' =&gt; [ \Illuminate\Cache\CacheManager::class, \Illuminate\Contracts\Cache\Factory::class ],...] registerCoreContainerAliasesalias() 12345678910111213/** * Register the core class aliases in the container. * * @return void */public function registerCoreContainerAliases()&#123; foreach ([$aliases] as $key =&gt; $aliases) &#123; foreach ($aliases as $alias) &#123; $this-&gt;alias($key, $alias); &#125; &#125;&#125; aliasesabstractAliases 123456789101112$aliases = [ 'Illuminate\Foundation\Application' = "app" 'Illuminate\Contracts\Container\Container' = "app" 'Illuminate\Contracts\Foundation\Application' = "app" 'Illuminate\Auth\AuthManager' = "auth" 'Illuminate\Contracts\Auth\Factory' = "auth" 'Illuminate\Contracts\Auth\Guard' = "auth.driver" 'Illuminate\View\Compilers\BladeCompiler' = "blade.compiler" 'Illuminate\Cache\CacheManager' = "cache" 'Illuminate\Contracts\Cache\Factory' = "cache" ... 1234567891011121314151617$abstractAliases = [ app = &#123;array&#125; [3] 0 = &quot;Illuminate\Foundation\Application&quot; 1 = &quot;Illuminate\Contracts\Container\Container&quot; 2 = &quot;Illuminate\Contracts\Foundation\Application&quot; auth = &#123;array&#125; [2] 0 = &quot;Illuminate\Auth\AuthManager&quot; 1 = &quot;Illuminate\Contracts\Auth\Factory&quot; auth.driver = &#123;array&#125; [1] 0 = &quot;Illuminate\Contracts\Auth\Guard&quot; blade.compiler = &#123;array&#125; [1] 0 = &quot;Illuminate\View\Compilers\BladeCompiler&quot; cache = &#123;array&#125; [2] 0 = &quot;Illuminate\Cache\CacheManager&quot; 1 = &quot;Illuminate\Contracts\Cache\Factory&quot; ...]  $abstractAliasesappabstractappalias 1234app = &#123;array&#125; [3] 0 = &quot;Illuminate\Foundation\Application&quot; 1 = &quot;Illuminate\Contracts\Container\Container&quot; 2 = &quot;Illuminate\Contracts\Foundation\Application&quot; appabstractabstractbindingbindingabstractconcrete$abstractAliases$aliasesabstrucalias Facade 1.abstractAliases 2.abstracts ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Container callbacks]]></title>
    <url>%2F2020%2F04%2F25%2FContainer-callbacks%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[  call_user_func ( callable $callback [, mixed $parameter [, mixed $ ]] ) : mixed; app()-&gt;rebinding(money, Closure); hookEvent Containercallbacks 12345protected $reboundCallbacks = []; // protected $globalResolvingCallbacks = []; // protected $globalAfterResolvingCallbacks = []; // protected $resolvingCallbacks = []; // protected $afterResolvingCallbacks = []; //   rebound extendrebindingextendthis is rebinding callbacks 12345678910111213141516171819202122232425262728293031323334class Money&#123; public function getAmount()&#123; return 100; &#125;&#125;class Dollar extends Money&#123; public function getAmount() &#123; return 1; &#125;&#125;class ExampleTest extends TestCase&#123; public function testClosure() &#123; app()-&gt;bind('money', Money::class); app()-&gt;rebinding('money', function()&#123; var_dump("this is rebinding callbacks"); &#125;); app()-&gt;extend('money',function()&#123; return new Dollar(); &#125;); $boss= app()-&gt;make('money'); $output = $boss-&gt;getAmount(); $this-&gt;assertEquals($output, 1); &#125;&#125; rebound() 1234567891011121314/** * Fire the "rebound" callbacks for the given abstract type. * * @param string $abstract * @return void */protected function rebound($abstract)&#123; $instance = $this-&gt;make($abstract); foreach ($this-&gt;getReboundCallbacks($abstract) as $callback) &#123; call_user_func($callback, $this, $instance); &#125;&#125; 1. 2.reboundcall_user_func 2.1 getReboundCallbacks,reboundCallbacks 12345678910/** * Get the rebound callbacks for a given type. * * @param string $abstract * @return array */protected function getReboundCallbacks($abstract)&#123; return $this-&gt;reboundCallbacks[$abstract] ?? [];&#125; 3.rebound()1.2extend   rebindingreboundCallbacks  123456789101112131415/** * Bind a new callback to an abstract's rebind event. * * @param string $abstract * @param \Closure $callback * @return mixed */public function rebinding($abstract, Closure $callback)&#123; $this-&gt;reboundCallbacks[$abstract = $this-&gt;getAlias($abstract)][] = $callback; if ($this-&gt;bound($abstract)) &#123; return $this-&gt;make($abstract); &#125;&#125; rebindingreboundCallbacksreboundextend]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Container extend]]></title>
    <url>%2F2020%2F04%2F25%2FContainer-extend%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[ extend()make()instancesextenders extendinstanceextendinstances extend($abstract, Closure $closure)  1 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// interface Money&#123; public function getAmount();&#125;class Dollar implements Money&#123; public function getAmount() &#123; return 1; &#125;&#125;class Cheque implements Money&#123; public function getAmount() &#123; return 100000; &#125;&#125;// class Boss&#123; private $money; public function __construct(Money $money) &#123; $this-&gt;money = $money; // prints '100000' &#125; public function getA()&#123; return $this-&gt;money-&gt;getAmount(); &#125;&#125;// public function testClosure()&#123; // 1 app()-&gt;bind('boss', Boss::class); //  $this-&gt;app-&gt;when(Boss::class) -&gt;needs(Money::class) -&gt;give(Cheque::class); //  app()-&gt;extend(Money::class, function() &#123; //  return new Dollar(); &#125;); // 2 $boss = app()-&gt;make('boss'); $output = $boss-&gt;getA(); $this-&gt;assertEquals($output, 1); // &#125; BossMoneyChequeDollar 2 12345678910111213141516171819202122232425262728293031323334class Money&#123; public function getAmount()&#123; return 100; &#125;&#125;class Dollar extends Money&#123; public function getAmount() &#123; return 1; &#125;&#125;class Cheque extends Money&#123; public function getAmount() &#123; return 100000; &#125;&#125;public function testClosure()&#123; //  app()-&gt;extend(Money::class, function() &#123; //  return new Dollar(); &#125;); $money= app()-&gt;make(Money::class); $output = $money-&gt;getAmount(); $this-&gt;assertEquals($output, 1);&#125; 3 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950class Money&#123; public function getAmount()&#123; return 100; &#125;&#125;class Dollar extends Money&#123; public function getAmount() &#123; return 1; &#125;&#125;class Cheque extends Money&#123; public function getAmount() &#123; return 100000; &#125;&#125;class Currenty&#123; protected $money; public function __construct(Money $money) &#123; $this-&gt;money = $money; &#125; public function getAmount() &#123; return "harveynorman"; &#125;&#125;public function testClosure()&#123; app()-&gt;bind('money', Money::class); app()-&gt;extend('money', function($money) &#123; //  return new Currenty($money); &#125;); $boss = app()-&gt;make('money'); $output = $boss-&gt;getAmount(); $this-&gt;assertEquals($output, "harveynorman");&#125; extendextendMoney::class extendextend 123$this-&gt;app-&gt;extend(Service::class, function($service) &#123; return new DecoratedService($service);&#125;); extend 123app()-&gt;extend('Service', function ($service, $app) &#123; return new DecoratedService($service);&#125;); DecoratedServiceService Container  12345678910111213141516171819202122232425/** * "Extend" an abstract type in the container. * * @param string $abstract * @param \Closure $closure * @return void * * @throws \InvalidArgumentException */public function extend($abstract, Closure $closure)&#123; $abstract = $this-&gt;getAlias($abstract); if (isset($this-&gt;instances[$abstract])) &#123; $this-&gt;instances[$abstract] = $closure($this-&gt;instances[$abstract], $this); $this-&gt;rebound($abstract); &#125; else &#123; $this-&gt;extenders[$abstract][] = $closure; if ($this-&gt;resolved($abstract)) &#123; $this-&gt;rebound($abstract); &#125; &#125;&#125; 1Containerid($abstract) 2instanceextend rebound() extend 3instanceextenders idresolvedrebound extendinstanceextendinstances  ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Container contextual]]></title>
    <url>%2F2020%2F04%2F25%2FContainer-Contextual%E4%B8%8A%E4%B8%8B%E6%96%87%E7%BB%91%E5%AE%9A%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[  contextual[PhotoController::class][Filesystem::class] = contextualmake  Container $resolved[abstractClassName=&gt;true/false]$bindings[abstractClassName=&gt;[]]methodBindings[methodName=&gt;$closure]$instances[abstractClassName=&gt;$instance] $alias[=&gt;abstractClassName]$buildStack[concrete]$with AABBC Container Add   Laravel 12345678910111213141516use Illuminate\Support\Facades\Storage;use App\Http\Controllers\PhotoController;use App\Http\Controllers\VideoController;use Illuminate\Contracts\Filesystem\Filesystem;$this-&gt;app-&gt;when(PhotoController::class) -&gt;needs(Filesystem::class) -&gt;give(function () &#123; return Storage::disk('local'); &#125;);$this-&gt;app-&gt;when(VideoController::class) -&gt;needs(Filesystem::class) -&gt;give(function () &#123; return Storage::disk('s3'); &#125;); LaravelFlySystemFilesystem  PhotoController::classFilesystem::classPhotoController::class 123function () &#123; return Storage::disk('local');&#125; VideoController::classFilesystem::classVideoController::class 123function () &#123; return Storage::disk('s3');&#125; 12345678910111213141516171819if (! function_exists('app')) &#123; /** * Get the available container instance. * * @param string|null $abstract * @param array $parameters * @return mixed|\Illuminate\Contracts\Foundation\Application */ function app($abstract = null, array $parameters = []) &#123; if (is_null($abstract)) &#123; return Container::getInstance(); &#125; return Container::getInstance()-&gt;make($abstract, $parameters); &#125;&#125; Illuminate/Container/Container.php 123456789101112131415161718192021222324class Container implements ArrayAccess, ContainerContract&#123; /** * The current globally available container (if any). * * @var static */ protected static $instance; /** * Get the globally available instance of the container. * * @return static */ public static function getInstance() &#123; if (is_null(static::$instance)) &#123; static::$instance = new static; &#125; return static::$instance; &#125;&#125;  123456789101112131415161718192021222324252627282930// interfacemoneyinterface Money&#123; public function getAmount();&#125;// Chequeclass Cheque implements Money&#123; public function getAmount() &#123; return 100000; &#125;&#125;// Bossclass Boss&#123; private $money; public function __construct(Money $money) &#123; $this-&gt;money = $money; // prints '100000' &#125; public function getA() &#123; return $this-&gt;money-&gt;getAmount(); &#125;&#125; 1BossBossMoneyCheque 123456789101112public function testClosure()&#123; $this-&gt;app-&gt;when(Boss::class) -&gt;needs(Money::class) -&gt;give(Cheque::class); $boss = app()-&gt;make(Boss::class); $output = $boss-&gt;getA(); $this-&gt;assertEquals($output, 100000);&#125;  Illuminate\Container\Util.php 123456789101112131415161718192021222324252627282930313233343536373839&lt;?phpnamespace Illuminate\Container;use Closure;class Util&#123; /** * If the given value is not an array and not null, wrap it in one. * * From Arr::wrap() in Illuminate\Support. * * @param mixed $value * @return array */ public static function arrayWrap($value) &#123; if (is_null($value)) &#123; return []; &#125; return is_array($value) ? $value : [$value]; &#125; /** * Return the default value of the given value. * * From global value() helper in Illuminate\Support. * * @param mixed $value * @return mixed */ public static function unwrapIfClosure($value) &#123; return $value instanceof Closure ? $value() : $value; &#125;&#125; 1when illuminate\Container\Container.php 1234567891011121314151617/** * Define a contextual binding. * * @param array|string $concrete * @return \Illuminate\Contracts\Container\ContextualBindingBuilder */public function when($concrete)&#123; $aliases = []; foreach (Util::arrayWrap($concrete) as $c) &#123; $aliases[] = $this-&gt;getAlias($c); &#125; return new ContextualBindingBuilder($this, $aliases);&#125; ContextualBindingBuildercontainer$concrete $concretePhotoController::classVideoController::class PhotoController::class 2ContextualBindingBuilder Illuminate\Contracts\Container\ContextualBindingBuilder.php 12345678910111213141516171819202122&lt;?phpnamespace Illuminate\Contracts\Container;interface ContextualBindingBuilder&#123; /** * Define the abstract target that depends on the context. * * @param string $abstract * @return $this */ public function needs($abstract); /** * Define the implementation for the contextual binding. * * @param \Closure|string $implementation * @return void */ public function give($implementation);&#125; Illuminate\Container\ContextualBindingBuilder.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970&lt;?phpnamespace Illuminate\Container;use Illuminate\Contracts\Container\Container;use Illuminate\Contracts\Container\ContextualBindingBuilder as ContextualBindingBuilderContract;class ContextualBindingBuilder implements ContextualBindingBuilderContract&#123; /** * The underlying container instance. * * @var \Illuminate\Contracts\Container\Container */ protected $container; /** * The concrete instance. * * @var string|array */ protected $concrete; /** * The abstract target. * * @var string */ protected $needs; /** * Create a new contextual binding builder. * * @param \Illuminate\Contracts\Container\Container $container * @param string|array $concrete * @return void */ public function __construct(Container $container, $concrete) &#123; $this-&gt;concrete = $concrete; $this-&gt;container = $container; &#125; /** * Define the abstract target that depends on the context. * * @param string $abstract * @return $this */ public function needs($abstract) &#123; $this-&gt;needs = $abstract; return $this; &#125; /** * Define the implementation for the contextual binding. * * @param \Closure|string $implementation * @return void */ public function give($implementation) &#123; foreach (Util::arrayWrap($this-&gt;concrete) as $concrete) &#123; $this-&gt;container-&gt;addContextualBinding($concrete, $this-&gt;needs, $implementation); &#125; &#125;&#125; needsgive needs$abstract $abstractFilesystem::class  123456789101112/** * Define the abstract target that depends on the context. * * @param string $abstract * @return $this */public function needs($abstract)&#123; $this-&gt;needs = $abstract; return $this;&#125; 3give 12345678910111213/** * Define the implementation for the contextual binding. * * @param \Closure|string $implementation * @return void */public function give($implementation)&#123; foreach (Util::arrayWrap($this-&gt;concrete) as $concrete) &#123; $this-&gt;container-&gt;addContextualBinding($concrete, $this-&gt;needs, $implementation); &#125;&#125; ContaineraddContextualBinding() concretePhotoController::class abstractFilesystem::class implementationStorage::disk(local); 4ContaineraddContextualBinding() 123456789101112/** * Add a contextual binding to the container. * * @param string $concrete * @param string $abstract * @param \Closure|string $implementation * @return void */public function addContextualBinding($concrete, $abstract, $implementation)&#123; $this-&gt;contextual[$concrete][$this-&gt;getAlias($abstract)] = $implementation;&#125; contextual  contextual[PhotoController::class][Filesystem::class] =   needsgivewhen contextual[when][needs] = implementimplementneedsbuild]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2020%2F04%2F23%2FMySQL%E7%9A%84%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%2F</url>
    <content type="text"><![CDATA[     MySQL ACIDAtomicityConsistencyIsolationDurability    1 2MySQL 3MyISAMInnoDB   1dirty read  dirty page 1  2non-repeatable read        3phantom read T112T21 T11T2      ANSI/ISO SQL4  Serializable  100%  Repeatable read    Read committed  Read committedSql ServerOracle  Read uncommitted   B  AB B12AB   4  read-viewMVCC  SQLSQLSQL     id3A0 idundo     Read CommittedRead Committed Read RepeatableMVCC undo logundo logid=2Name=BName=B2undoName=Bundo undo 1234 4read-view ABC124MVCCread-viewA1 45read-view ABC undo log: insert undo log update undo log insert undo loginsertundolog update undo logdeleteupdateundo logpurge   read-view Long Transaction   undo log MySQL 5.5ibdata   ]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHPstatic]]></title>
    <url>%2F2020%2F04%2F21%2FPHP%E7%9A%84static%E5%BB%B6%E8%BF%9F%E9%9D%99%E6%80%81%E7%BB%91%E5%AE%9A%E5%8A%9F%E8%83%BD%2F</url>
    <content type="text"><![CDATA[    12345678910111213141516171819202122232425262728293031class A&#123; static $name = "Tom"; public function printName() &#123; echo self::$name."\n"; self::fun(); &#125; static function fun() &#123; echo "A Class\n"; &#125;&#125;class B extends A&#123; static $name = "Jon"; static function fun() &#123; echo "B Class\n"; &#125;&#125;$obj = new B();$obj-&gt;printName();// // Tom// A Class printNameselfself 12// Join// B Class AprintNameselfAphp php5.5static 12345678910111213141516171819202122232425262728293031class A&#123; static $name = "Tom"; public function printName() &#123; echo static::$name."\n"; static::fun(); &#125; static function fun() &#123; echo "A Class\n"; &#125;&#125;class B extends A&#123; static $name = "Jon"; static function fun() &#123; echo "B Class\n"; &#125;&#125;$obj = new B();$obj-&gt;printName();// // Join// B Class class Vipsvipyvipstatic usergroup()]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Throttle]]></title>
    <url>%2F2020%2F04%2F17%2FLaravel-Throttle%2F</url>
    <content type="text"><![CDATA[ Laravel-FunnelAPI throttle6010 123456789Redis::throttle('key')-&gt;allow(10)-&gt;every(60)-&gt;then(function () &#123; // Job logic... // 1100110 // file_put_contents('1.txt', date('Y-m-d H:i:s').PHP_EOL, FILE_APPEND);&#125;, function () &#123; // Could not obtain lock... return $this-&gt;release(10);&#125;); keyEloquentID  Illuminate\Redis\Limiters\DurationLimiter.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148&lt;?phpnamespace Illuminate\Redis\Limiters;use Illuminate\Contracts\Redis\LimiterTimeoutException;class DurationLimiter&#123; /** * The Redis factory implementation. * * @var \Illuminate\Redis\Connections\Connection */ private $redis; /** * The unique name of the lock. * * @var string */ private $name; /** * The allowed number of concurrent tasks. * * @var int */ private $maxLocks; /** * The number of seconds a slot should be maintained. * * @var int */ private $decay; /** * The timestamp of the end of the current duration. * * @var int */ public $decaysAt; /** * The number of remaining slots. * * @var int */ public $remaining; /** * Create a new duration limiter instance. * * @param \Illuminate\Redis\Connections\Connection $redis * @param string $name * @param int $maxLocks * @param int $decay * @return void */ public function __construct($redis, $name, $maxLocks, $decay) &#123; $this-&gt;name = $name; $this-&gt;decay = $decay; $this-&gt;redis = $redis; $this-&gt;maxLocks = $maxLocks; &#125; /** * Attempt to acquire the lock for the given number of seconds. * * @param int $timeout * @param callable|null $callback * @return mixed * * @throws \Illuminate\Contracts\Redis\LimiterTimeoutException */ public function block($timeout, $callback = null) &#123; $starting = time(); while (! $this-&gt;acquire()) &#123; if (time() - $timeout &gt;= $starting) &#123; throw new LimiterTimeoutException; &#125; usleep(750 * 1000); &#125; if (is_callable($callback)) &#123; return $callback(); &#125; return true; &#125; /** * Attempt to acquire the lock. * * @return bool */ public function acquire() &#123; $results = $this-&gt;redis-&gt;eval( $this-&gt;luaScript(), 1, $this-&gt;name, microtime(true), time(), $this-&gt;decay, $this-&gt;maxLocks ); $this-&gt;decaysAt = $results[1]; $this-&gt;remaining = max(0, $results[2]); return (bool) $results[0]; &#125; /** * Get the Lua script for acquiring a lock. * * KEYS[1] - The limiter name * ARGV[1] - Current time in microseconds * ARGV[2] - Current time in seconds * ARGV[3] - Duration of the bucket * ARGV[4] - Allowed number of tasks * * @return string */ protected function luaScript() &#123; return &lt;&lt;&lt;'LUA'local function reset() redis.call('HMSET', KEYS[1], 'start', ARGV[2], 'end', ARGV[2] + ARGV[3], 'count', 1) return redis.call('EXPIRE', KEYS[1], ARGV[3] * 2)endif redis.call('EXISTS', KEYS[1]) == 0 then return &#123;reset(), ARGV[2] + ARGV[3], ARGV[4] - 1&#125;endif ARGV[1] &gt;= redis.call('HGET', KEYS[1], 'start') and ARGV[1] &lt;= redis.call('HGET', KEYS[1], 'end') then return &#123; tonumber(redis.call('HINCRBY', KEYS[1], 'count', 1)) &lt;= tonumber(ARGV[4]), redis.call('HGET', KEYS[1], 'end'), ARGV[4] - redis.call('HGET', KEYS[1], 'count') &#125;endreturn &#123;reset(), ARGV[2] + ARGV[3], ARGV[4] - 1&#125;LUA; &#125;&#125; Illuminate\Redis\Limiters\DurationLimiterBuilder.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122&lt;?phpnamespace Illuminate\Redis\Limiters;use Illuminate\Contracts\Redis\LimiterTimeoutException;use Illuminate\Support\InteractsWithTime;class DurationLimiterBuilder&#123; use InteractsWithTime; /** * The Redis connection. * * @var \Illuminate\Redis\Connections\Connection */ public $connection; /** * The name of the lock. * * @var string */ public $name; /** * The maximum number of locks that can obtained per time window. * * @var int */ public $maxLocks; /** * The amount of time the lock window is maintained. * * @var int */ public $decay; /** * The amount of time to block until a lock is available. * * @var int */ public $timeout = 3; /** * Create a new builder instance. * * @param \Illuminate\Redis\Connections\Connection $connection * @param string $name * @return void */ public function __construct($connection, $name) &#123; $this-&gt;name = $name; $this-&gt;connection = $connection; &#125; /** * Set the maximum number of locks that can obtained per time window. * * @param int $maxLocks * @return $this */ public function allow($maxLocks) &#123; $this-&gt;maxLocks = $maxLocks; return $this; &#125; /** * Set the amount of time the lock window is maintained. * * @param int $decay * @return $this */ public function every($decay) &#123; $this-&gt;decay = $this-&gt;secondsUntil($decay); return $this; &#125; /** * Set the amount of time to block until a lock is available. * * @param int $timeout * @return $this */ public function block($timeout) &#123; $this-&gt;timeout = $timeout; return $this; &#125; /** * Execute the given callback if a lock is obtained, otherwise call the failure callback. * * @param callable $callback * @param callable|null $failure * @return mixed * * @throws \Illuminate\Contracts\Redis\LimiterTimeoutException */ public function then(callable $callback, callable $failure = null) &#123; try &#123; return (new DurationLimiter( $this-&gt;connection, $this-&gt;name, $this-&gt;maxLocks, $this-&gt;decay ))-&gt;block($this-&gt;timeout, $callback); &#125; catch (LimiterTimeoutException $e) &#123; if ($failure) &#123; return $failure($e); &#125; throw $e; &#125; &#125;&#125; Illuminate\Redis\Connections\Connection.php 12345678910111213141516171819202122232425262728&lt;?phpnamespace Illuminate\Redis\Connections;use Closure;use Illuminate\Contracts\Events\Dispatcher;use Illuminate\Redis\Events\CommandExecuted;use Illuminate\Redis\Limiters\ConcurrencyLimiterBuilder;use Illuminate\Redis\Limiters\DurationLimiterBuilder;use Illuminate\Support\Traits\Macroable;abstract class Connection&#123; use Macroable &#123; __call as macroCall; &#125; /** * Throttle a callback for a maximum number of executions over a given duration. * * @param string $name * @return \Illuminate\Redis\Limiters\DurationLimiterBuilder */ public function throttle($name) &#123; return new DurationLimiterBuilder($this, $name); &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LaravelMacroable]]></title>
    <url>%2F2020%2F04%2F15%2FLaravel%E4%B8%AD%E9%80%9A%E8%BF%87Macroable%E5%AE%8F%E6%9D%A5%E6%89%A9%E5%B1%95%E7%B1%BB%E7%9A%84%E8%83%BD%E5%8A%9B%2F</url>
    <content type="text"><![CDATA[ Closure $new_closure = Closure::bind($closure, new ClassName(), ClassName::class);$new_closure = $closure-&gt;bindTo(new ClassName(), ClassName::class); PHPbindTobind123456789101112131415161718192021final class Closure &#123; //  private function __construct() &#123; &#125; // $this Closure::bindTo()  static function bind ( Closure $closure , object $newthis [, mixed $newscope = 'static' ] ) : Closure // $this public function bindTo ( object $newthis [, mixed $newscope = 'static' ] ) : Closure // __invoke()  public function __invoke ([ $... ] ) : mixed // Temporarily binds the closure to newthis, and calls it with any given parameters. // $this // @since 7.0 function call ($newThis, ...$parameters) &#123;&#125; //  public static function fromCallable (callable $callable) &#123;&#125;&#125; fromCallable 12$reflexion = new ReflectionFunction('addDiscount');$closure = $reflexion-&gt;getClosure(); bindTobind  12345$clo = function ($name) &#123; echo $name;&#125;;var_dump($clo);  1234567object(Closure)#1 (1) &#123; ["parameter"]=&gt; array(1) &#123; ["$name"]=&gt; string(10) "&lt;required&gt;" &#125;&#125; $cloClosureClosure $clo-&gt;bindTo($newthis, $newscope)Closure::bind($clo, $newthis, $newscope)   $this 1 2$this$this  123456789101112131415161718192021222324252627class Test &#123; public static $name = "rao"; protected static $color = "red"; private static $height = "188"; public $age = 12; protected $sex = 1; private $weight = 100; function a() &#123; $fun = function ()&#123; var_dump(Test::$name); var_dump(Test::$color); var_dump(Test::$height); var_dump($this-&gt;age); var_dump($this-&gt;sex); var_dump($this-&gt;weight); &#125;; var_dump($fun); $fun(); &#125;&#125;(new Test())-&gt;a();  1234567891011121314151617object(Closure)#2 (1) &#123; ["this"]=&gt; object(Test)#1 (3) &#123; ["age"]=&gt; int(12) ["sex":protected]=&gt; int(1) ["weight":"Test":private]=&gt; int(100) &#125;&#125;string(3) "rao"string(3) "red"string(3) "188"int(12)int(1)int(100) $fun$this 12345$fun = static function ()&#123; var_dump(Test::$name); var_dump(Test::$color); var_dump(Test::$height);&#125;;   $fun2 12345678$fun2 = function ()&#123; var_dump(Test::$name); //  var_dump(Test::$color); //  var_dump(Test::$height); //  var_dump($this-&gt;age); //  var_dump($this-&gt;sex); //  var_dump($this-&gt;weight); // &#125;; bind() 12345$fun22 = Closure::bind($fun2, new Test(), Test::class);//  $fun22 = $fun2-&gt;bindTo(new Test(), Test::class);var_dump($fun22);$fun22();  1234567891011121314151617object(Closure)#3 (1) &#123; ["this"]=&gt; object(Test)#2 (3) &#123; ["age"]=&gt; int(12) ["sex":protected]=&gt; int(1) ["weight":"Test":private]=&gt; int(100) &#125;&#125;string(3) "rao"string(3) "red"string(3) "188"int(12)int(1)int(100) $thisPHP7.0call 1$fun2-&gt;call(new Test()); bindbindTonewthisNULL newscopestatic $this   LaravelIlluminate\Support\Traits\MacroableLaravelMacroable MacroableIlluminate\Support\Traits\Macroable trait LaravelMacroable Macroable 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104trait Macroable&#123; /** * The registered string macros. * * @var array */ protected static $macros = []; /** * Register a custom macro. * * @param string $name * @param object|callable $macro * * @return void */ public static function macro($name, $macro) &#123; static::$macros[$name] = $macro; &#125; /** * Mix another object into the class. * * @param object $mixin * @return void * * @throws \ReflectionException */ public static function mixin($mixin) &#123; $methods = (new ReflectionClass($mixin))-&gt;getMethods( ReflectionMethod::IS_PUBLIC | ReflectionMethod::IS_PROTECTED ); foreach ($methods as $method) &#123; $method-&gt;setAccessible(true); static::macro($method-&gt;name, $method-&gt;invoke($mixin)); &#125; &#125; /** * Checks if macro is registered. * * @param string $name * @return bool */ public static function hasMacro($name) &#123; return isset(static::$macros[$name]); &#125; /** * Dynamically handle calls to the class. * * @param string $method * @param array $parameters * @return mixed * * @throws \BadMethodCallException */ public static function __callStatic($method, $parameters) &#123; if (! static::hasMacro($method)) &#123; throw new BadMethodCallException(sprintf( 'Method %s::%s does not exist.', static::class, $method )); &#125; if (static::$macros[$method] instanceof Closure) &#123; return call_user_func_array(Closure::bind(static::$macros[$method], null, static::class), $parameters); &#125; return call_user_func_array(static::$macros[$method], $parameters); &#125; /** * Dynamically handle calls to the class. * * @param string $method * @param array $parameters * @return mixed * * @throws \BadMethodCallException */ public function __call($method, $parameters) &#123; if (! static::hasMacro($method)) &#123; throw new BadMethodCallException(sprintf( 'Method %s::%s does not exist.', static::class, $method )); &#125; $macro = static::$macros[$method]; if ($macro instanceof Closure) &#123; return call_user_func_array($macro-&gt;bindTo($this, static::class), $parameters); &#125; return call_user_func_array($macro, $parameters); &#125;&#125; __callStatic__callMacroable 1use Macroable; 2macro$macros macro__invoke()__invoke()  123456789101112131415class Foo&#123; use Macroable;&#125;final class Join&#123; public function __invoke(...$string) &#123; return implode('-', $string); &#125;&#125;Foo::macro('join', new Join());  123Foo::macro('join', function(...$string)&#123; return implode('-', $string);&#125;); 3mixin publicprotectedprotected $macros 123456789101112131415161718192021final class Str&#123; public function join() &#123; //  return function(...$string)&#123; return implode('-', $string); &#125;; &#125; public function split() &#123; //  return function(string $string)&#123; return explode('-', $string); &#125;; &#125;&#125;// mixin(new Str()) macromixinhasMacro]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Macroable]]></title>
    <url>%2F2020%2F04%2F12%2FLaravel-Macroable%2F</url>
    <content type="text"><![CDATA[ Macro staticTraitsstatic Macroable Traitsstring=&gt;obj/callablemacrohasMacro __call()(new Test(construct_param))-&gt;__call(method, parameter); Macro) Laravel LaravelMacroable macro 123456789101112131415161718class Father&#123; // __invoke public function __invoke() &#123; echo __CLASS__; &#125;&#125;class Child&#123; use \Illuminate\Support\Traits\Macroable;&#125;// ChildChild::macro('show', new Father);// :Father(new Child)-&gt;show(); 1234567891011121314class Child&#123; use \Illuminate\Support\Traits\Macroable; protected $name = 'father';&#125;// $this, Child::macro('show', function () &#123; echo $this-&gt;name;&#125;);// :father(new Child)-&gt;show(); mixin 12345678910111213141516171819202122232425262728293031323334353637383940// class Father&#123; public function say() &#123; return function () &#123; echo 'say'; &#125;; &#125; public function show() &#123; return function () &#123; echo 'show'; &#125;; &#125; protected function eat() &#123; return function () &#123; echo 'eat'; &#125;; &#125;&#125;class Child&#123; use \Illuminate\Support\Traits\Macroable;&#125;// Child::mixin(new Father);$child = new Child;// :say$child-&gt;say();// :show$child-&gt;show();// :eat$child-&gt;eat(); PHPstatic Illuminate\Support\Traits\Macroable.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117&lt;?phpnamespace Illuminate\Support\Traits;use Closure;use ReflectionClass;use ReflectionMethod;use BadMethodCallException;trait Macroable&#123; /** * The registered string macros. * * @var array */ protected static $macros = []; /** * Register a custom macro. * * @param string $name * @param object|callable $macro * * @return void */ public static function macro($name, $macro) &#123; static::$macros[$name] = $macro; &#125; /** * Mix another object into the class. * * @param object $mixin * @param bool $replace * @return void * * @throws \ReflectionException */ public static function mixin($mixin, $replace = true) &#123; $methods = (new ReflectionClass($mixin))-&gt;getMethods( ReflectionMethod::IS_PUBLIC | ReflectionMethod::IS_PROTECTED ); foreach ($methods as $method) &#123; if ($replace || ! static::hasMacro($method-&gt;name)) &#123; $method-&gt;setAccessible(true); static::macro($method-&gt;name, $method-&gt;invoke($mixin)); &#125; &#125; &#125; /** * Checks if macro is registered. * * @param string $name * @return bool */ public static function hasMacro($name) &#123; return isset(static::$macros[$name]); &#125; /** * Dynamically handle calls to the class. * * @param string $method * @param array $parameters * @return mixed * * @throws \BadMethodCallException */ public static function __callStatic($method, $parameters) &#123; if (! static::hasMacro($method)) &#123; throw new BadMethodCallException(sprintf( 'Method %s::%s does not exist.', static::class, $method )); &#125; $macro = static::$macros[$method]; if ($macro instanceof Closure) &#123; return call_user_func_array(Closure::bind($macro, null, static::class), $parameters); &#125; return $macro(...$parameters); &#125; /** * Dynamically handle calls to the class. * * @param string $method * @param array $parameters * @return mixed * * @throws \BadMethodCallException */ public function __call($method, $parameters) &#123; if (! static::hasMacro($method)) &#123; throw new BadMethodCallException(sprintf( 'Method %s::%s does not exist.', static::class, $method )); &#125; $macro = static::$macros[$method]; if ($macro instanceof Closure) &#123; return call_user_func_array($macro-&gt;bindTo($this, static::class), $parameters); &#125; return $macro(...$parameters); &#125;&#125; Macroable::macro 1234public static function macro($name, $macro)&#123; static::$macros[$name] = $macro;&#125; $macroPHP Macroable::mixin  12345678910111213public static function mixin($mixin, $replace = true)&#123; $methods = (new ReflectionClass($mixin))-&gt;getMethods( ReflectionMethod::IS_PUBLIC | ReflectionMethod::IS_PROTECTED ); foreach ($methods as $method) &#123; if ($replace || ! static::hasMacro($method-&gt;name)) &#123; $method-&gt;setAccessible(true); static::macro($method-&gt;name, $method-&gt;invoke($mixin)); &#125; &#125;&#125; mixin Macroable::hasMacro 1234public static function hasMacro($name)&#123; return isset(static::$macros[$name]);&#125;  Macroable::__callMacroable::__callStatic __call 123456789101112131415161718public function __call($method, $parameters)&#123; //  if (! static::hasMacro($method)) &#123; throw new BadMethodCallException("Method &#123;$method&#125; does not exist."); &#125; //  $macro = static::$macros[$method]; //  if ($macro instanceof Closure) &#123; return call_user_func_array($macro-&gt;bindTo($this, static::class), $parameters); &#125; // `__invoke` return call_user_func_array($macro, $parameters);&#125; $thisChild__callClosure::bindTo Closure::bindTo$this LaravelLaraveltrait Illuminate\Filesystem\Filesystem::class Illuminate\Filesystem\Filesystem.php 123456789101112131415161718192021222324252627282930313233343536&lt;?phpnamespace Illuminate\Filesystem;use ErrorException;use FilesystemIterator;use Illuminate\Contracts\Filesystem\FileNotFoundException;use Illuminate\Support\Traits\Macroable;use Symfony\Component\Finder\Finder;class Filesystem&#123; use Macroable; /** * Determine if a file or directory exists. * * @param string $path * @return bool */ public function exists($path) &#123; return file_exists($path); &#125; /** * Determine if a file or directory is missing. * * @param string $path * @return bool */ public function missing($path) &#123; return ! $this-&gt;exists($path); &#125;&#125; App\Providers\AppServiceProvider::register App\Providers\AppServiceProvider.php 1234567891011121314151617181920212223242526272829303132&lt;?phpnamespace App\Providers;use Illuminate\Support\Facades\Schema;use Illuminate\Support\ServiceProvider;use Illuminate\Filesystem\Filesystem;class AppServiceProvider extends ServiceProvider&#123; /** * Register any application services. * * @return void */ public function register() &#123; // &#125; /** * Bootstrap any application services. * * @return void */ public function boot() &#123; Filesystem::macro('readFile', function ($fileName, $useIncludePath = null, $context = null)&#123; readfile($fileName, $useIncludePath, $context); &#125;); &#125;&#125;  12345&lt;?phpRoute::get('/', function (\Illuminate\Filesystem\Filesystem $filesystem)&#123; $filesystem-&gt;readFile(__DIR__.'/../.env.example');&#125;);  MacroableLaravelMacroableMacroable Macroable PHP  123class Foo&#123;&#125;  123$join = function(...$string)&#123; return implode('-', $string);&#125; bindTojoin 123$foo = new Foo();$bindFoo = $join-&gt;bindTo($foo, Foo::class);$bindFoo('a', 'b', 'c'); // "a-b-c" PHP7call 12$foo = new Foo();$join-&gt;call($foo, 'a', 'b', 'c'); // "a-b-c" bind 12$bindClass = \Closure::bind($join, null, Foo::class);$bindClass('a', 'b', 'c'); // "a-b-c" PHP-  123456789101112&lt;?phptrait Macroable &#123; //  protected static $macros = []; //  public static function macro($name, $macro) &#123; static::$macros[$name] = $macro; &#125;&#125; macrosTrait 1234class Foo &#123; use Macroable;&#125; join 123Foo::macro('join', function(...$string)&#123; return implode('-', $string);&#125;); joinmacrosjoin 1Foo::join('a', 'b', 'c') Foojoin__callStatic 1234567891011public static function __callStatic($name, $parameters)&#123; //  $macro = static::$macros[$name]; //  $bindClass = \Closure::bind($macro, null, static::class); //  return $bindClass(...$parameters);&#125;  1echo Foo::join('a', 'b', 'c'); // a-b-c  12345678public function __call($name, $parameters) &#123; //  $macro = static::$macros[$name]; //  return $macro-&gt;call($this, ...$parameters);&#125;  12$foo = new Foo();echo $foo-&gt;join('a', 'b', 'c'); // 'a-b-c'  123Foo::macro('join', function(...$string)&#123; return implode('-', $string);&#125;);  1234567final class Join&#123; public function __invoke(...$string) &#123; return implode('-', $string); &#125;&#125; __invoke 12$join = new Join();$join('a', 'b', 'c'); // a-b-c Join 1Foo::macro('join', new Join()); __callStatic __invoke  123456789101112131415161718192021222324public function __call($name, $parameters) &#123; $macro = static::$macros[$name]; if($macro instanceof Closure)&#123; return $macro-&gt;call($this, ...$parameters); &#125; return $macro(...$parameters);&#125;public static function __callStatic($name, $parameters)&#123; $macro = static::$macros[$name]; //  if($macro instanceof Closure)&#123; $bindClass = \Closure::bind($macro, null, static::class); return $bindClass(...$parameters); &#125; //  return $macro(...$parameters);&#125;  1Foo::join('a', 'b', 'c'); // a-b-c LaravelMacroable  123456789101112131415161718final class Str&#123; public function join() &#123; //  return function(...$string)&#123; return implode('-', $string); &#125;; &#125; public function split() &#123; //  return function(string $string)&#123; return explode('-', $string); &#125;; &#125;&#125; $macrosPHP 1234567891011121314public static function mixin($mixin) &#123; //  ReflectionMethod  $methods = (new \ReflectionClass($mixin))-&gt;getMethods( \ReflectionMethod::IS_PUBLIC | \ReflectionMethod::IS_PROTECTED ); //  ReflectionMethod  $macros  foreach ($methods as $method) &#123; $method-&gt;setAccessible(true); //  $macros  static::macro($method-&gt;name, $method-&gt;invoke($mixin)); &#125;&#125;  123Foo::mixin(new Str());Foo::join('a', 'b', 'c');Foo::split('a-b-c'); Trait Laravel MacroableOr videospostscommentscommentable_typecommentable_id   commentable_type  commentable_id   macroRequestcommentable 1234567891011121314151617Request::macro(('commentable'), function(bool $required = false)&#123; if (!request()-&gt;has('commentable_type')) &#123; return $required ? abort(422, '') : null; &#125; $model = request()-&gt;get('commentable_type'); $model = Relation::getMorphedModel($model) ?? $mode; $commentable = call_user_func([$model, 'find'], request()-&gt;get('commentable_id')); if (!$commentable)&#123; return $required ? abort(422, '') : null; &#125; return $commentable;&#125;); commentable_typecommentable_id  123456789101112131415class CommentController extends Controller&#123; /** * Display a listing of the resource. * * @param \Illuminate\Http\Request $request * * @return \Illuminate\Http\Resources\Json\AnonymousResourceCollection */ public function index(Request $request) &#123; return CommentResource::collection($request-&gt;commentable(true)-&gt;comments()-&gt;get()); &#125;&#125;  $request-&gt;commentable(true)  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152class Polymorphic extends Rule&#123; /** * @var string */ protected $name; /** * @var string */ protected $message; /** * Create a new rule instance. * * @param string $name * @param string|null $message */ public function __construct(string name, string $message = null) &#123; $this-&gt;name = $name; $this-&gt;message = $message; &#125; /** * Determine if the validation rule passes. * * @param string $attribute * @param mixed $value * * @return bool */ public function passes($attribute, $value) &#123; $model = request()-&gt;get(\sprintf('%s_type'), $this-&gt;name); $model = Relation::getMorphedModel($model) ?? $mode; return \class_exists($model) &amp;&amp; (bool) \call_user_func([$model, 'find'], \request()-&gt;get(\sprintf('%s_id'), $this-&gt;name))); &#125; /** * Get the validation error message. * * @return string */ public function message() &#123; return $this-&gt;message ?: ''; &#125;&#125;  1234567891011121314151617/** * Display a listing of the resource. * * @param \Illuminate\Http\Request $request * * @return \Illuminate\Http\Resources\Json\AnonymousResourceCollection * * @throws \Illuminate\Validation\ValidationException */public function index(Request $request)&#123; $this-&gt;validate($request, [ 'commentable_id' =&gt; ['required', new Polymorphic('commentable', '')], ]); return CommentResource::collection($request-&gt;commentable(true)-&gt;comments()-&gt;get());&#125; MacrosIlluminateMacroable$macrosCollectionCollection  macro($name$macro)$name$macro$macrosCollection macro __call__callStaticPHP static :: hasMacro$ macro macro  macro   mixin   Closure  $this   $thisClosure  PHP  bindTo  Laravel   Closure  $this  Closure   Macroable  __call   Macroable  Macroable  __call __call   Cache\Repository   trait __call  macrocrock  Repository __call  macroCall   b  :  Request  123Request::macro('checked', function ($attribute) &#123; return in_array($this-&gt;input($attribute, false), [true, 1, '1', 'on']);&#125;);]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Cache]]></title>
    <url>%2F2020%2F04%2F12%2FLaravel-Cache%2F</url>
    <content type="text"><![CDATA[ use Macroable {__call as macroCall;} CacheManager[string=&gt;Repository]Cache  Cache Illuminate\Support\Facades\Cache.php 123456789101112131415161718192021222324252627282930313233343536&lt;?phpnamespace Illuminate\Support\Facades;/** * @method static \Illuminate\Contracts\Cache\Repository store(string|null $name = null) * @method static bool has(string $key) * @method static bool missing(string $key) * @method static mixed get(string $key, mixed $default = null) * @method static mixed pull(string $key, mixed $default = null) * @method static bool put(string $key, $value, \DateTimeInterface|\DateInterval|int $ttl = null) * @method static bool add(string $key, $value, \DateTimeInterface|\DateInterval|int $ttl = null) * @method static int|bool increment(string $key, $value = 1) * @method static int|bool decrement(string $key, $value = 1) * @method static bool forever(string $key, $value) * @method static mixed remember(string $key, \DateTimeInterface|\DateInterval|int $ttl, \Closure $callback) * @method static mixed sear(string $key, \Closure $callback) * @method static mixed rememberForever(string $key, \Closure $callback) * @method static bool forget(string $key) * @method static \Illuminate\Contracts\Cache\Store getStore() * * @see \Illuminate\Cache\CacheManager * @see \Illuminate\Cache\Repository */class Cache extends Facade&#123; /** * Get the registered name of the component. * * @return string */ protected static function getFacadeAccessor() &#123; return 'cache'; &#125;&#125; CacheServiceProvider Illuminate\Cache\CacheServiceProvider.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546&lt;?phpnamespace Illuminate\Cache;use Illuminate\Contracts\Support\DeferrableProvider;use Illuminate\Support\ServiceProvider;use Symfony\Component\Cache\Adapter\Psr16Adapter;class CacheServiceProvider extends ServiceProvider implements DeferrableProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton('cache', function ($app) &#123; return new CacheManager($app); &#125;); $this-&gt;app-&gt;singleton('cache.store', function ($app) &#123; return $app['cache']-&gt;driver(); &#125;); $this-&gt;app-&gt;singleton('cache.psr6', function ($app) &#123; return new Psr16Adapter($app['cache.store']); &#125;); $this-&gt;app-&gt;singleton('memcached.connector', function () &#123; return new MemcachedConnector; &#125;); &#125; /** * Get the services provided by the provider. * * @return array */ public function provides() &#123; return [ 'cache', 'cache.store', 'cache.psr6', 'memcached.connector', ]; &#125;&#125;  Illuminate\Contracts\Cache\Factory.php 1234567891011121314&lt;?phpnamespace Illuminate\Contracts\Cache;interface Factory&#123; /** * Get a cache store instance by name. * * @param string|null $name * @return \Illuminate\Contracts\Cache\Repository */ public function store($name = null);&#125; Illuminate\Cache\Repository.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656namespace Illuminate\Cache;use ArrayAccess;use BadMethodCallException;use Closure;use DateTimeInterface;use Illuminate\Cache\Events\CacheHit;use Illuminate\Cache\Events\CacheMissed;use Illuminate\Cache\Events\KeyForgotten;use Illuminate\Cache\Events\KeyWritten;use Illuminate\Contracts\Cache\Repository as CacheContract;use Illuminate\Contracts\Cache\Store;use Illuminate\Contracts\Events\Dispatcher;use Illuminate\Support\Carbon;use Illuminate\Support\InteractsWithTime;use Illuminate\Support\Traits\Macroable;/** * @mixin \Illuminate\Contracts\Cache\Store */class Repository implements ArrayAccess, CacheContract&#123; use InteractsWithTime; use Macroable &#123; __call as macroCall; &#125; /** * The cache store implementation. * * @var \Illuminate\Contracts\Cache\Store */ protected $store; /** * The event dispatcher implementation. * * @var \Illuminate\Contracts\Events\Dispatcher */ protected $events; /** * The default number of seconds to store items. * * @var int|null */ protected $default = 3600; /** * Create a new cache repository instance. * * @param \Illuminate\Contracts\Cache\Store $store * @return void */ public function __construct(Store $store) &#123; $this-&gt;store = $store; &#125; /** * Determine if an item exists in the cache. * * @param string $key * @return bool */ public function has($key) &#123; return ! is_null($this-&gt;get($key)); &#125; /** * Determine if an item doesn't exist in the cache. * * @param string $key * @return bool */ public function missing($key) &#123; return ! $this-&gt;has($key); &#125; /** * Retrieve an item from the cache by key. * * @param string $key * @param mixed $default * @return mixed */ public function get($key, $default = null) &#123; if (is_array($key)) &#123; return $this-&gt;many($key); &#125; $value = $this-&gt;store-&gt;get($this-&gt;itemKey($key)); // If we could not find the cache value, we will fire the missed event and get // the default value for this cache value. This default could be a callback // so we will execute the value function which will resolve it if needed. if (is_null($value)) &#123; $this-&gt;event(new CacheMissed($key)); $value = value($default); &#125; else &#123; $this-&gt;event(new CacheHit($key, $value)); &#125; return $value; &#125; /** * Retrieve multiple items from the cache by key. * * Items not found in the cache will have a null value. * * @param array $keys * @return array */ public function many(array $keys) &#123; $values = $this-&gt;store-&gt;many(collect($keys)-&gt;map(function ($value, $key) &#123; return is_string($key) ? $key : $value; &#125;)-&gt;values()-&gt;all()); return collect($values)-&gt;map(function ($value, $key) use ($keys) &#123; return $this-&gt;handleManyResult($keys, $key, $value); &#125;)-&gt;all(); &#125; /** * &#123;@inheritdoc&#125; */ public function getMultiple($keys, $default = null) &#123; $defaults = []; foreach ($keys as $key) &#123; $defaults[$key] = $default; &#125; return $this-&gt;many($defaults); &#125; /** * Handle a result for the "many" method. * * @param array $keys * @param string $key * @param mixed $value * @return mixed */ protected function handleManyResult($keys, $key, $value) &#123; // If we could not find the cache value, we will fire the missed event and get // the default value for this cache value. This default could be a callback // so we will execute the value function which will resolve it if needed. if (is_null($value)) &#123; $this-&gt;event(new CacheMissed($key)); return isset($keys[$key]) ? value($keys[$key]) : null; &#125; // If we found a valid value we will fire the "hit" event and return the value // back from this function. The "hit" event gives developers an opportunity // to listen for every possible cache "hit" throughout this applications. $this-&gt;event(new CacheHit($key, $value)); return $value; &#125; /** * Retrieve an item from the cache and delete it. * * @param string $key * @param mixed $default * @return mixed */ public function pull($key, $default = null) &#123; return tap($this-&gt;get($key, $default), function () use ($key) &#123; $this-&gt;forget($key); &#125;); &#125; /** * Store an item in the cache. * * @param string $key * @param mixed $value * @param \DateTimeInterface|\DateInterval|int|null $ttl * @return bool */ public function put($key, $value, $ttl = null) &#123; if (is_array($key)) &#123; return $this-&gt;putMany($key, $value); &#125; if ($ttl === null) &#123; return $this-&gt;forever($key, $value); &#125; $seconds = $this-&gt;getSeconds($ttl); if ($seconds &lt;= 0) &#123; return $this-&gt;forget($key); &#125; $result = $this-&gt;store-&gt;put($this-&gt;itemKey($key), $value, $seconds); if ($result) &#123; $this-&gt;event(new KeyWritten($key, $value, $seconds)); &#125; return $result; &#125; /** * &#123;@inheritdoc&#125; */ public function set($key, $value, $ttl = null) &#123; return $this-&gt;put($key, $value, $ttl); &#125; /** * Store multiple items in the cache for a given number of seconds. * * @param array $values * @param \DateTimeInterface|\DateInterval|int|null $ttl * @return bool */ public function putMany(array $values, $ttl = null) &#123; if ($ttl === null) &#123; return $this-&gt;putManyForever($values); &#125; $seconds = $this-&gt;getSeconds($ttl); if ($seconds &lt;= 0) &#123; return $this-&gt;deleteMultiple(array_keys($values)); &#125; $result = $this-&gt;store-&gt;putMany($values, $seconds); if ($result) &#123; foreach ($values as $key =&gt; $value) &#123; $this-&gt;event(new KeyWritten($key, $value, $seconds)); &#125; &#125; return $result; &#125; /** * Store multiple items in the cache indefinitely. * * @param array $values * @return bool */ protected function putManyForever(array $values) &#123; $result = true; foreach ($values as $key =&gt; $value) &#123; if (! $this-&gt;forever($key, $value)) &#123; $result = false; &#125; &#125; return $result; &#125; /** * &#123;@inheritdoc&#125; */ public function setMultiple($values, $ttl = null) &#123; return $this-&gt;putMany(is_array($values) ? $values : iterator_to_array($values), $ttl); &#125; /** * Store an item in the cache if the key does not exist. * * @param string $key * @param mixed $value * @param \DateTimeInterface|\DateInterval|int|null $ttl * @return bool */ public function add($key, $value, $ttl = null) &#123; if ($ttl !== null) &#123; if ($this-&gt;getSeconds($ttl) &lt;= 0) &#123; return false; &#125; // If the store has an "add" method we will call the method on the store so it // has a chance to override this logic. Some drivers better support the way // this operation should work with a total "atomic" implementation of it. if (method_exists($this-&gt;store, 'add')) &#123; $seconds = $this-&gt;getSeconds($ttl); return $this-&gt;store-&gt;add( $this-&gt;itemKey($key), $value, $seconds ); &#125; &#125; // If the value did not exist in the cache, we will put the value in the cache // so it exists for subsequent requests. Then, we will return true so it is // easy to know if the value gets added. Otherwise, we will return false. if (is_null($this-&gt;get($key))) &#123; return $this-&gt;put($key, $value, $ttl); &#125; return false; &#125; /** * Increment the value of an item in the cache. * * @param string $key * @param mixed $value * @return int|bool */ public function increment($key, $value = 1) &#123; return $this-&gt;store-&gt;increment($key, $value); &#125; /** * Decrement the value of an item in the cache. * * @param string $key * @param mixed $value * @return int|bool */ public function decrement($key, $value = 1) &#123; return $this-&gt;store-&gt;decrement($key, $value); &#125; /** * Store an item in the cache indefinitely. * * @param string $key * @param mixed $value * @return bool */ public function forever($key, $value) &#123; $result = $this-&gt;store-&gt;forever($this-&gt;itemKey($key), $value); if ($result) &#123; $this-&gt;event(new KeyWritten($key, $value)); &#125; return $result; &#125; /** * Get an item from the cache, or execute the given Closure and store the result. * * @param string $key * @param \DateTimeInterface|\DateInterval|int|null $ttl * @param \Closure $callback * @return mixed */ public function remember($key, $ttl, Closure $callback) &#123; $value = $this-&gt;get($key); // If the item exists in the cache we will just return this immediately and if // not we will execute the given Closure and cache the result of that for a // given number of seconds so it's available for all subsequent requests. if (! is_null($value)) &#123; return $value; &#125; $this-&gt;put($key, $value = $callback(), $ttl); return $value; &#125; /** * Get an item from the cache, or execute the given Closure and store the result forever. * * @param string $key * @param \Closure $callback * @return mixed */ public function sear($key, Closure $callback) &#123; return $this-&gt;rememberForever($key, $callback); &#125; /** * Get an item from the cache, or execute the given Closure and store the result forever. * * @param string $key * @param \Closure $callback * @return mixed */ public function rememberForever($key, Closure $callback) &#123; $value = $this-&gt;get($key); // If the item exists in the cache we will just return this immediately // and if not we will execute the given Closure and cache the result // of that forever so it is available for all subsequent requests. if (! is_null($value)) &#123; return $value; &#125; $this-&gt;forever($key, $value = $callback()); return $value; &#125; /** * Remove an item from the cache. * * @param string $key * @return bool */ public function forget($key) &#123; return tap($this-&gt;store-&gt;forget($this-&gt;itemKey($key)), function ($result) use ($key) &#123; if ($result) &#123; $this-&gt;event(new KeyForgotten($key)); &#125; &#125;); &#125; /** * &#123;@inheritdoc&#125; */ public function delete($key) &#123; return $this-&gt;forget($key); &#125; /** * &#123;@inheritdoc&#125; */ public function deleteMultiple($keys) &#123; $result = true; foreach ($keys as $key) &#123; if (! $this-&gt;forget($key)) &#123; $result = false; &#125; &#125; return $result; &#125; /** * &#123;@inheritdoc&#125; */ public function clear() &#123; return $this-&gt;store-&gt;flush(); &#125; /** * Begin executing a new tags operation if the store supports it. * * @param array|mixed $names * @return \Illuminate\Cache\TaggedCache * * @throws \BadMethodCallException */ public function tags($names) &#123; if (! method_exists($this-&gt;store, 'tags')) &#123; throw new BadMethodCallException('This cache store does not support tagging.'); &#125; $cache = $this-&gt;store-&gt;tags(is_array($names) ? $names : func_get_args()); if (! is_null($this-&gt;events)) &#123; $cache-&gt;setEventDispatcher($this-&gt;events); &#125; return $cache-&gt;setDefaultCacheTime($this-&gt;default); &#125; /** * Format the key for a cache item. * * @param string $key * @return string */ protected function itemKey($key) &#123; return $key; &#125; /** * Get the default cache time. * * @return int|null */ public function getDefaultCacheTime() &#123; return $this-&gt;default; &#125; /** * Set the default cache time in seconds. * * @param int|null $seconds * @return $this */ public function setDefaultCacheTime($seconds) &#123; $this-&gt;default = $seconds; return $this; &#125; /** * Get the cache store implementation. * * @return \Illuminate\Contracts\Cache\Store */ public function getStore() &#123; return $this-&gt;store; &#125; /** * Fire an event for this cache instance. * * @param string $event * @return void */ protected function event($event) &#123; if (isset($this-&gt;events)) &#123; $this-&gt;events-&gt;dispatch($event); &#125; &#125; /** * Get the event dispatcher instance. * * @return \Illuminate\Contracts\Events\Dispatcher */ public function getEventDispatcher() &#123; return $this-&gt;events; &#125; /** * Set the event dispatcher instance. * * @param \Illuminate\Contracts\Events\Dispatcher $events * @return void */ public function setEventDispatcher(Dispatcher $events) &#123; $this-&gt;events = $events; &#125; /** * Determine if a cached value exists. * * @param string $key * @return bool */ public function offsetExists($key) &#123; return $this-&gt;has($key); &#125; /** * Retrieve an item from the cache by key. * * @param string $key * @return mixed */ public function offsetGet($key) &#123; return $this-&gt;get($key); &#125; /** * Store an item in the cache for the default time. * * @param string $key * @param mixed $value * @return void */ public function offsetSet($key, $value) &#123; $this-&gt;put($key, $value, $this-&gt;default); &#125; /** * Remove an item from the cache. * * @param string $key * @return void */ public function offsetUnset($key) &#123; $this-&gt;forget($key); &#125; /** * Calculate the number of seconds for the given TTL. * * @param \DateTimeInterface|\DateInterval|int $ttl * @return int */ protected function getSeconds($ttl) &#123; $duration = $this-&gt;parseDateInterval($ttl); if ($duration instanceof DateTimeInterface) &#123; $duration = Carbon::now()-&gt;diffInRealSeconds($duration, false); &#125; return (int) $duration &gt; 0 ? $duration : 0; &#125; /** * Handle dynamic calls into macros or pass missing methods to the store. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; if (static::hasMacro($method)) &#123; return $this-&gt;macroCall($method, $parameters); &#125; return $this-&gt;store-&gt;$method(...$parameters); &#125; /** * Clone cache repository instance. * * @return void */ public function __clone() &#123; $this-&gt;store = clone $this-&gt;store; &#125;&#125; RedisStore Illuminate\Cache\RedisStore.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306namespace Illuminate\Cache;use Illuminate\Contracts\Cache\LockProvider;use Illuminate\Contracts\Redis\Factory as Redis;class RedisStore extends TaggableStore implements LockProvider&#123; /** * The Redis factory implementation. * * @var \Illuminate\Contracts\Redis\Factory */ protected $redis; /** * A string that should be prepended to keys. * * @var string */ protected $prefix; /** * The Redis connection that should be used. * * @var string */ protected $connection; /** * Create a new Redis store. * * @param \Illuminate\Contracts\Redis\Factory $redis * @param string $prefix * @param string $connection * @return void */ public function __construct(Redis $redis, $prefix = '', $connection = 'default') &#123; $this-&gt;redis = $redis; $this-&gt;setPrefix($prefix); $this-&gt;setConnection($connection); &#125; /** * Retrieve an item from the cache by key. * * @param string|array $key * @return mixed */ public function get($key) &#123; $value = $this-&gt;connection()-&gt;get($this-&gt;prefix.$key); return ! is_null($value) ? $this-&gt;unserialize($value) : null; &#125; /** * Retrieve multiple items from the cache by key. * * Items not found in the cache will have a null value. * * @param array $keys * @return array */ public function many(array $keys) &#123; $results = []; $values = $this-&gt;connection()-&gt;mget(array_map(function ($key) &#123; return $this-&gt;prefix.$key; &#125;, $keys)); foreach ($values as $index =&gt; $value) &#123; $results[$keys[$index]] = ! is_null($value) ? $this-&gt;unserialize($value) : null; &#125; return $results; &#125; /** * Store an item in the cache for a given number of seconds. * * @param string $key * @param mixed $value * @param int $seconds * @return bool */ public function put($key, $value, $seconds) &#123; return (bool) $this-&gt;connection()-&gt;setex( $this-&gt;prefix.$key, (int) max(1, $seconds), $this-&gt;serialize($value) ); &#125; /** * Store multiple items in the cache for a given number of seconds. * * @param array $values * @param int $seconds * @return bool */ public function putMany(array $values, $seconds) &#123; $this-&gt;connection()-&gt;multi(); $manyResult = null; foreach ($values as $key =&gt; $value) &#123; $result = $this-&gt;put($key, $value, $seconds); $manyResult = is_null($manyResult) ? $result : $result &amp;&amp; $manyResult; &#125; $this-&gt;connection()-&gt;exec(); return $manyResult ?: false; &#125; /** * Store an item in the cache if the key doesn't exist. * * @param string $key * @param mixed $value * @param int $seconds * @return bool */ public function add($key, $value, $seconds) &#123; $lua = "return redis.call('exists',KEYS[1])&lt;1 and redis.call('setex',KEYS[1],ARGV[2],ARGV[1])"; return (bool) $this-&gt;connection()-&gt;eval( $lua, 1, $this-&gt;prefix.$key, $this-&gt;serialize($value), (int) max(1, $seconds) ); &#125; /** * Increment the value of an item in the cache. * * @param string $key * @param mixed $value * @return int */ public function increment($key, $value = 1) &#123; return $this-&gt;connection()-&gt;incrby($this-&gt;prefix.$key, $value); &#125; /** * Decrement the value of an item in the cache. * * @param string $key * @param mixed $value * @return int */ public function decrement($key, $value = 1) &#123; return $this-&gt;connection()-&gt;decrby($this-&gt;prefix.$key, $value); &#125; /** * Store an item in the cache indefinitely. * * @param string $key * @param mixed $value * @return bool */ public function forever($key, $value) &#123; return (bool) $this-&gt;connection()-&gt;set($this-&gt;prefix.$key, $this-&gt;serialize($value)); &#125; /** * Get a lock instance. * * @param string $name * @param int $seconds * @param string|null $owner * @return \Illuminate\Contracts\Cache\Lock */ public function lock($name, $seconds = 0, $owner = null) &#123; return new RedisLock($this-&gt;connection(), $this-&gt;prefix.$name, $seconds, $owner); &#125; /** * Restore a lock instance using the owner identifier. * * @param string $name * @param string $owner * @return \Illuminate\Contracts\Cache\Lock */ public function restoreLock($name, $owner) &#123; return $this-&gt;lock($name, 0, $owner); &#125; /** * Remove an item from the cache. * * @param string $key * @return bool */ public function forget($key) &#123; return (bool) $this-&gt;connection()-&gt;del($this-&gt;prefix.$key); &#125; /** * Remove all items from the cache. * * @return bool */ public function flush() &#123; $this-&gt;connection()-&gt;flushdb(); return true; &#125; /** * Begin executing a new tags operation. * * @param array|mixed $names * @return \Illuminate\Cache\RedisTaggedCache */ public function tags($names) &#123; return new RedisTaggedCache( $this, new TagSet($this, is_array($names) ? $names : func_get_args()) ); &#125; /** * Get the Redis connection instance. * * @return \Illuminate\Redis\Connections\Connection */ public function connection() &#123; return $this-&gt;redis-&gt;connection($this-&gt;connection); &#125; /** * Set the connection name to be used. * * @param string $connection * @return void */ public function setConnection($connection) &#123; $this-&gt;connection = $connection; &#125; /** * Get the Redis database instance. * * @return \Illuminate\Contracts\Redis\Factory */ public function getRedis() &#123; return $this-&gt;redis; &#125; /** * Get the cache key prefix. * * @return string */ public function getPrefix() &#123; return $this-&gt;prefix; &#125; /** * Set the cache key prefix. * * @param string $prefix * @return void */ public function setPrefix($prefix) &#123; $this-&gt;prefix = ! empty($prefix) ? $prefix.':' : ''; &#125; /** * Serialize the value. * * @param mixed $value * @return mixed */ protected function serialize($value) &#123; return is_numeric($value) &amp;&amp; ! in_array($value, [INF, -INF]) &amp;&amp; ! is_nan($value) ? $value : serialize($value); &#125; /** * Unserialize the value. * * @param mixed $value * @return mixed */ protected function unserialize($value) &#123; return is_numeric($value) ? $value : unserialize($value); &#125;&#125; RedisLock Illuminate\Cache\Lock.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147&lt;?phpnamespace Illuminate\Cache;use Illuminate\Contracts\Cache\Lock as LockContract;use Illuminate\Contracts\Cache\LockTimeoutException;use Illuminate\Support\InteractsWithTime;use Illuminate\Support\Str;abstract class Lock implements LockContract&#123; use InteractsWithTime; /** * The name of the lock. * * @var string */ protected $name; /** * The number of seconds the lock should be maintained. * * @var int */ protected $seconds; /** * The scope identifier of this lock. * * @var string */ protected $owner; /** * Create a new lock instance. * * @param string $name * @param int $seconds * @param string|null $owner * @return void */ public function __construct($name, $seconds, $owner = null) &#123; if (is_null($owner)) &#123; $owner = Str::random(); &#125; $this-&gt;name = $name; $this-&gt;owner = $owner; $this-&gt;seconds = $seconds; &#125; /** * Attempt to acquire the lock. * * @return bool */ abstract public function acquire(); /** * Release the lock. * * @return bool */ abstract public function release(); /** * Returns the owner value written into the driver for this lock. * * @return string */ abstract protected function getCurrentOwner(); /** * Attempt to acquire the lock. * * @param callable|null $callback * @return mixed */ public function get($callback = null) &#123; $result = $this-&gt;acquire(); if ($result &amp;&amp; is_callable($callback)) &#123; try &#123; return $callback(); &#125; finally &#123; $this-&gt;release(); &#125; &#125; return $result; &#125; /** * Attempt to acquire the lock for the given number of seconds. * * @param int $seconds * @param callable|null $callback * @return bool * * @throws \Illuminate\Contracts\Cache\LockTimeoutException */ public function block($seconds, $callback = null) &#123; $starting = $this-&gt;currentTime(); while (! $this-&gt;acquire()) &#123; usleep(250 * 1000); if ($this-&gt;currentTime() - $seconds &gt;= $starting) &#123; throw new LockTimeoutException; &#125; &#125; if (is_callable($callback)) &#123; try &#123; return $callback(); &#125; finally &#123; $this-&gt;release(); &#125; &#125; return true; &#125; /** * Returns the current owner of the lock. * * @return string */ public function owner() &#123; return $this-&gt;owner; &#125; /** * Determines whether this lock is allowed to release the lock in the driver. * * @return bool */ protected function isOwnedByCurrentProcess() &#123; return $this-&gt;getCurrentOwner() === $this-&gt;owner; &#125;&#125; Illuminate\Cache\RedisLock 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;?phpnamespace Illuminate\Cache;class RedisLock extends Lock&#123; /** * The Redis factory implementation. * * @var \Illuminate\Redis\Connections\Connection */ protected $redis; /** * Create a new lock instance. * * @param \Illuminate\Redis\Connections\Connection $redis * @param string $name * @param int $seconds * @param string|null $owner * @return void */ public function __construct($redis, $name, $seconds, $owner = null) &#123; parent::__construct($name, $seconds, $owner); $this-&gt;redis = $redis; &#125; /** * Attempt to acquire the lock. * * @return bool */ public function acquire() &#123; if ($this-&gt;seconds &gt; 0) &#123; return $this-&gt;redis-&gt;set($this-&gt;name, $this-&gt;owner, 'EX', $this-&gt;seconds, 'NX') == true; &#125; else &#123; return $this-&gt;redis-&gt;setnx($this-&gt;name, $this-&gt;owner) === 1; &#125; &#125; /** * Release the lock. * * @return bool */ public function release() &#123; return (bool) $this-&gt;redis-&gt;eval(LuaScripts::releaseLock(), 1, $this-&gt;name, $this-&gt;owner); &#125; /** * Releases this lock in disregard of ownership. * * @return void */ public function forceRelease() &#123; $this-&gt;redis-&gt;del($this-&gt;name); &#125; /** * Returns the owner value written into the driver for this lock. * * @return string */ protected function getCurrentOwner() &#123; return $this-&gt;redis-&gt;get($this-&gt;name); &#125;&#125; CacheManager Illuminate\CacheManager.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313namespace Illuminate\Cache;use Closure;use Illuminate\Contracts\Cache\Factory as FactoryContract;use Illuminate\Contracts\Cache\Store;use Illuminate\Contracts\Events\Dispatcher as DispatcherContractuse Illuminate\Support\Arr;use InvalidArgumentException;/** * @mixin \Illuminate\Contracts\Cache\Repository */class CacheManager implements FactoryContract&#123; /** * The application instance. * * @var \Illuminate\Contracts\Foundation\Application */ protected $app; /** * The array of resolved cache stores. * * @var array */ protected $stores = []; /** * The registered custom driver creators. * * @var array */ protected $customCreators = []; /** * Create a new Cache manager instance. * * @param \Illuminate\Contracts\Foundation\Application $app * @return void */ public function __construct($app) &#123; $this-&gt;app = $app; &#125; /** * Get a cache store instance by name, wrapped in a repository. * * @param string|null $name * @return \Illuminate\Contracts\Cache\Repository */ public function store($name = null) &#123; $name = $name ?: $this-&gt;getDefaultDriver(); return $this-&gt;stores[$name] = $this-&gt;get($name); &#125; /** * Get a cache driver instance. * * @param string|null $driver * @return \Illuminate\Contracts\Cache\Repository */ public function driver($driver = null) &#123; return $this-&gt;store($driver); &#125; /** * Attempt to get the store from the local cache. * * @param string $name * @return \Illuminate\Contracts\Cache\Repository */ protected function get($name) &#123; return $this-&gt;stores[$name] ?? $this-&gt;resolve($name); &#125; /** * Resolve the given store. * * @param string $name * @return \Illuminate\Contracts\Cache\Repository * * @throws \InvalidArgumentException */ protected function resolve($name) &#123; $config = $this-&gt;getConfig($name); if (is_null($config)) &#123; throw new InvalidArgumentException("Cache store [&#123;$name&#125;] is not defined."); &#125; if (isset($this-&gt;customCreators[$config['driver']])) &#123; return $this-&gt;callCustomCreator($config); &#125; else &#123; $driverMethod = 'create'.ucfirst($config['driver']).'Driver'; if (method_exists($this, $driverMethod)) &#123; return $this-&gt;&#123;$driverMethod&#125;($config); &#125; else &#123; throw new InvalidArgumentException("Driver [&#123;$config['driver']&#125;] is not supported."); &#125; &#125; &#125; /** * Call a custom driver creator. * * @param array $config * @return mixed */ protected function callCustomCreator(array $config) &#123; return $this-&gt;customCreators[$config['driver']]($this-&gt;app, $config); &#125; /** * Create an instance of the array cache driver. * * @param array $config * @return \Illuminate\Cache\Repository */ protected function createArrayDriver(array $config) &#123; return $this-&gt;repository(new ArrayStore($config['serialize'] ?? false)); &#125; /** * Create an instance of the file cache driver. * * @param array $config * @return \Illuminate\Cache\Repository */ protected function createFileDriver(array $config) &#123; return $this-&gt;repository(new FileStore($this-&gt;app['files'], $config['path'], $config['permission'] ?? null)); &#125; /** * Create an instance of the Null cache driver. * * @return \Illuminate\Cache\Repository */ protected function createNullDriver() &#123; return $this-&gt;repository(new NullStore); &#125; /** * Create an instance of the Redis cache driver. * * @param array $config * @return \Illuminate\Cache\Repository */ protected function createRedisDriver(array $config) &#123; $redis = $this-&gt;app['redis']; $connection = $config['connection'] ?? 'default'; return $this-&gt;repository(new RedisStore($redis, $this-&gt;getPrefix($config), $connection)); &#125; /** * Create an instance of the database cache driver. * * @param array $config * @return \Illuminate\Cache\Repository */ protected function createDatabaseDriver(array $config) &#123; $connection = $this-&gt;app['db']-&gt;connection($config['connection'] ?? null); return $this-&gt;repository( new DatabaseStore( $connection, $config['table'], $this-&gt;getPrefix($config) ) ); &#125; /** * Create a new cache repository with the given implementation. * * @param \Illuminate\Contracts\Cache\Store $store * @return \Illuminate\Cache\Repository */ public function repository(Store $store) &#123; return tap(new Repository($store), function ($repository) &#123; $this-&gt;setEventDispatcher($repository); &#125;); &#125; /** * Set the event dispatcher on the given repository instance. * * @param \Illuminate\Cache\Repository $repository * @return void */ protected function setEventDispatcher(Repository $repository) &#123; if (! $this-&gt;app-&gt;bound(DispatcherContract::class)) &#123; return; &#125; $repository-&gt;setEventDispatcher( $this-&gt;app[DispatcherContract::class] ); &#125; /** * Re-set the event dispatcher on all resolved cache repositories. * * @return void */ public function refreshEventDispatcher() &#123; array_map([$this, 'setEventDispatcher'], $this-&gt;stores); &#125; /** * Get the cache prefix. * * @param array $config * @return string */ protected function getPrefix(array $config) &#123; return $config['prefix'] ?? $this-&gt;app['config']['cache.prefix']; &#125; /** * Get the cache connection configuration. * * @param string $name * @return array */ protected function getConfig($name) &#123; return $this-&gt;app['config']["cache.stores.&#123;$name&#125;"]; &#125; /** * Get the default cache driver name. * * @return string */ public function getDefaultDriver() &#123; return $this-&gt;app['config']['cache.default']; &#125; /** * Set the default cache driver name. * * @param string $name * @return void */ public function setDefaultDriver($name) &#123; $this-&gt;app['config']['cache.default'] = $name; &#125; /** * Unset the given driver instances. * * @param array|string|null $name * @return $this */ public function forgetDriver($name = null) &#123; $name = $name ?? $this-&gt;getDefaultDriver(); foreach ((array) $name as $cacheName) &#123; if (isset($this-&gt;stores[$cacheName])) &#123; unset($this-&gt;stores[$cacheName]); &#125; &#125; return $this; &#125; /** * Register a custom driver creator Closure. * * @param string $driver * @param \Closure $callback * @return $this */ public function extend($driver, Closure $callback) &#123; $this-&gt;customCreators[$driver] = $callback-&gt;bindTo($this, $this); return $this; &#125; /** * Dynamically call the default driver instance. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; return $this-&gt;store()-&gt;$method(...$parameters); &#125;&#125;  MemcachedRedis Laravel ForgeCache::lock 12345if (Cache::lock('foo', 10)-&gt;get()) &#123; // Lock acquired for 10 seconds... Cache::lock('foo')-&gt;release();&#125; getLaravel 123Cache::lock('foo')-&gt;get(function () &#123; // Lock acquired indefinitely and automatically released...&#125;); LaravelIlluminate\Contracts\Cache\LockTimeoutException 1234567891011121314151617use Illuminate\Contracts\Cache\LockTimeoutException;$lock = Cache::lock('foo', 10);try &#123; $lock-&gt;block(5); // Lock acquired after waiting maximum of 5 seconds...&#125; catch (LockTimeoutException $e) &#123; // Unable to acquire lock...&#125; finally &#123; optional($lock)-&gt;release();&#125;Cache::lock('foo', 10)-&gt;block(5, function () &#123; // Lock acquired after waiting maximum of 5 seconds...&#125;);  Web 1234567891011// ...$podcast = Podcast::find($id);$lock = Cache::lock('foo', 120);if ($result = $lock-&gt;get()) &#123; ProcessPodcast::dispatch($podcast, $lock-&gt;owner());&#125;//  ProcessPodcast ...Cache::restoreLock('foo', $this-&gt;owner)-&gt;release(); forceRelease 1Cache::lock('foo')-&gt;forceRelease();  filedatabaseMemcachedMemcached  12Cache::tags(['people', 'artists'])-&gt;put('John', $john, $seconds);Cache::tags(['people', 'authors'])-&gt;put('Anne', $anne, $seconds); tagskeyget 12$john = Cache::tags(['people', 'artists'])-&gt;get('John');$anne = Cache::tags(['people', 'authors'])-&gt;get('Anne'); /peopleauthors 1Cache::tags(['people', 'authors'])-&gt;flush(); AnneJohn authorsAnneJohn 1Cache::tags('authors')-&gt;flush();  Illuminate\Cache\TaggableStore.php 12345678910111213141516171819&lt;?phpnamespace Illuminate\Cache;use Illuminate\Contracts\Cache\Store;abstract class TaggableStore implements Store&#123; /** * Begin executing a new tags operation. * * @param array|mixed $names * @return \Illuminate\Cache\TaggedCache */ public function tags($names) &#123; return new TaggedCache($this, new TagSet($this, is_array($names) ? $names : func_get_args())); &#125;&#125; Illuminate\Cache\TaggedCache.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123namespace Illuminate\Cache;use Illuminate\Contracts\Cache\Store;class TaggedCache extends Repository&#123; use RetrievesMultipleKeys &#123; putMany as putManyAlias; &#125; /** * The tag set instance. * * @var \Illuminate\Cache\TagSet */ protected $tags; /** * Create a new tagged cache instance. * * @param \Illuminate\Contracts\Cache\Store $store * @param \Illuminate\Cache\TagSet $tags * @return void */ public function __construct(Store $store, TagSet $tags) &#123; parent::__construct($store); $this-&gt;tags = $tags; &#125; /** * Store multiple items in the cache for a given number of seconds. * * @param array $values * @param int|null $ttl * @return bool */ public function putMany(array $values, $ttl = null) &#123; if ($ttl === null) &#123; return $this-&gt;putManyForever($values); &#125; return $this-&gt;putManyAlias($values, $ttl); &#125; /** * Increment the value of an item in the cache. * * @param string $key * @param mixed $value * @return void */ public function increment($key, $value = 1) &#123; $this-&gt;store-&gt;increment($this-&gt;itemKey($key), $value); &#125; /** * Decrement the value of an item in the cache. * * @param string $key * @param mixed $value * @return void */ public function decrement($key, $value = 1) &#123; $this-&gt;store-&gt;decrement($this-&gt;itemKey($key), $value); &#125; /** * Remove all items from the cache. * * @return bool */ public function flush() &#123; $this-&gt;tags-&gt;reset(); return true; &#125; /** * &#123;@inheritdoc&#125; */ protected function itemKey($key) &#123; return $this-&gt;taggedItemKey($key); &#125; /** * Get a fully qualified key for a tagged item. * * @param string $key * @return string */ public function taggedItemKey($key) &#123; return sha1($this-&gt;tags-&gt;getNamespace()).':'.$key; &#125; /** * Fire an event for this cache instance. * * @param string $event * @return void */ protected function event($event) &#123; parent::event($event-&gt;setTags($this-&gt;tags-&gt;getNames())); &#125; /** * Get the tag set instance. * * @return \Illuminate\Cache\TagSet */ public function getTags() &#123; return $this-&gt;tags; &#125;&#125; Illuminate\Cache\TagSet.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110&lt;?phpnamespace Illuminate\Cache;use Illuminate\Contracts\Cache\Store;class TagSet&#123; /** * The cache store implementation. * * @var \Illuminate\Contracts\Cache\Store */ protected $store; /** * The tag names. * * @var array */ protected $names = []; /** * Create a new TagSet instance. * * @param \Illuminate\Contracts\Cache\Store $store * @param array $names * @return void */ public function __construct(Store $store, array $names = []) &#123; $this-&gt;store = $store; $this-&gt;names = $names; &#125; /** * Reset all tags in the set. * * @return void */ public function reset() &#123; array_walk($this-&gt;names, [$this, 'resetTag']); &#125; /** * Reset the tag and return the new tag identifier. * * @param string $name * @return string */ public function resetTag($name) &#123; $this-&gt;store-&gt;forever($this-&gt;tagKey($name), $id = str_replace('.', '', uniqid('', true))); return $id; &#125; /** * Get a unique namespace that changes when any of the tags are flushed. * * @return string */ public function getNamespace() &#123; return implode('|', $this-&gt;tagIds()); &#125; /** * Get an array of tag identifiers for all of the tags in the set. * * @return array */ protected function tagIds() &#123; return array_map([$this, 'tagId'], $this-&gt;names); &#125; /** * Get the unique tag identifier for a given tag. * * @param string $name * @return string */ public function tagId($name) &#123; return $this-&gt;store-&gt;get($this-&gt;tagKey($name)) ?: $this-&gt;resetTag($name); &#125; /** * Get the tag identifier key for a given tag. * * @param string $name * @return string */ public function tagKey($name) &#123; return 'tag:'.$name.':key'; &#125; /** * Get all of the tag names in the set. * * @return array */ public function getNames() &#123; return $this-&gt;names; &#125;&#125; Illuminate\Cache\RedisTaggedCache.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198&lt;?phpnamespace Illuminate\Cache;class RedisTaggedCache extends TaggedCache&#123; /** * Forever reference key. * * @var string */ const REFERENCE_KEY_FOREVER = 'forever_ref'; /** * Standard reference key. * * @var string */ const REFERENCE_KEY_STANDARD = 'standard_ref'; /** * Store an item in the cache. * * @param string $key * @param mixed $value * @param \DateTimeInterface|\DateInterval|int|null $ttl * @return bool */ public function put($key, $value, $ttl = null) &#123; if ($ttl === null) &#123; return $this-&gt;forever($key, $value); &#125; $this-&gt;pushStandardKeys($this-&gt;tags-&gt;getNamespace(), $key); return parent::put($key, $value, $ttl); &#125; /** * Increment the value of an item in the cache. * * @param string $key * @param mixed $value * @return void */ public function increment($key, $value = 1) &#123; $this-&gt;pushStandardKeys($this-&gt;tags-&gt;getNamespace(), $key); parent::increment($key, $value); &#125; /** * Decrement the value of an item in the cache. * * @param string $key * @param mixed $value * @return void */ public function decrement($key, $value = 1) &#123; $this-&gt;pushStandardKeys($this-&gt;tags-&gt;getNamespace(), $key); parent::decrement($key, $value); &#125; /** * Store an item in the cache indefinitely. * * @param string $key * @param mixed $value * @return bool */ public function forever($key, $value) &#123; $this-&gt;pushForeverKeys($this-&gt;tags-&gt;getNamespace(), $key); return parent::forever($key, $value); &#125; /** * Remove all items from the cache. * * @return bool */ public function flush() &#123; $this-&gt;deleteForeverKeys(); $this-&gt;deleteStandardKeys(); return parent::flush(); &#125; /** * Store standard key references into store. * * @param string $namespace * @param string $key * @return void */ protected function pushStandardKeys($namespace, $key) &#123; $this-&gt;pushKeys($namespace, $key, self::REFERENCE_KEY_STANDARD); &#125; /** * Store forever key references into store. * * @param string $namespace * @param string $key * @return void */ protected function pushForeverKeys($namespace, $key) &#123; $this-&gt;pushKeys($namespace, $key, self::REFERENCE_KEY_FOREVER); &#125; /** * Store a reference to the cache key against the reference key. * * @param string $namespace * @param string $key * @param string $reference * @return void */ protected function pushKeys($namespace, $key, $reference) &#123; $fullKey = $this-&gt;store-&gt;getPrefix().sha1($namespace).':'.$key; foreach (explode('|', $namespace) as $segment) &#123; $this-&gt;store-&gt;connection()-&gt;sadd($this-&gt;referenceKey($segment, $reference), $fullKey); &#125; &#125; /** * Delete all of the items that were stored forever. * * @return void */ protected function deleteForeverKeys() &#123; $this-&gt;deleteKeysByReference(self::REFERENCE_KEY_FOREVER); &#125; /** * Delete all standard items. * * @return void */ protected function deleteStandardKeys() &#123; $this-&gt;deleteKeysByReference(self::REFERENCE_KEY_STANDARD); &#125; /** * Find and delete all of the items that were stored against a reference. * * @param string $reference * @return void */ protected function deleteKeysByReference($reference) &#123; foreach (explode('|', $this-&gt;tags-&gt;getNamespace()) as $segment) &#123; $this-&gt;deleteValues($segment = $this-&gt;referenceKey($segment, $reference)); $this-&gt;store-&gt;connection()-&gt;del($segment); &#125; &#125; /** * Delete item keys that have been stored against a reference. * * @param string $referenceKey * @return void */ protected function deleteValues($referenceKey) &#123; $values = array_unique($this-&gt;store-&gt;connection()-&gt;smembers($referenceKey)); if (count($values) &gt; 0) &#123; foreach (array_chunk($values, 1000) as $valuesChunk) &#123; call_user_func_array([$this-&gt;store-&gt;connection(), 'del'], $valuesChunk); &#125; &#125; &#125; /** * Get the reference key for the segment. * * @param string $segment * @param string $suffix * @return string */ protected function referenceKey($segment, $suffix) &#123; return $this-&gt;store-&gt;getPrefix().$segment.':'.$suffix; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Collection]]></title>
    <url>%2F2020%2F04%2F12%2FLaravel-Collection%2F</url>
    <content type="text"><![CDATA[ macroable new static get_class() Illuminate\Support\Collectioncollectstrtoupper 12345$collection = collect(['taylor', 'abigail', null])-&gt;map(function ($name) &#123; return strtoupper($name);&#125;)-&gt;reject(function ($name) &#123; return empty($name);&#125;); CollectionCollectionCollection collectIlluminate\Support\Collection 1$collection = collect([1, 2, 3]); EloquentCollection macroableCollectiontoUpperCollection 12345678910111213use Illuminate\Support\Str;Collection::macro('toUpper', function () &#123; return $this-&gt;map(function ($value) &#123; return Str::upper($value); &#125;);&#125;);$collection = collect(['first', 'second']);$upper = $collection-&gt;toUpper();// ['FIRST', 'SECOND']  CollectionLazyCollectionPHP LaravelGBLazyCollection 1234567891011121314use App\LogEntry;use Illuminate\Support\LazyCollection;LazyCollection::make(function () &#123; $handle = fopen('log.txt', 'r'); while (($line = fgets($handle)) !== false) &#123; yield $line; &#125;&#125;)-&gt;chunk(4)-&gt;map(function ($lines) &#123; return LogEntry::fromLines($lines);&#125;)-&gt;each(function (LogEntry $logEntry) &#123; // Process the log entry...&#125;); 10000EloquentLaravel10000Eloquent 123$users = App\User::all()-&gt;filter(function ($user) &#123; return $user-&gt;id &gt; 500;&#125;); cursorLazyCollectionEloquentfilter 1234567$users = App\User::cursor()-&gt;filter(function ($user) &#123; return $user-&gt;id &gt; 500;&#125;);foreach ($users as $user) &#123; echo $user-&gt;id;&#125; PHPmake 123456789use Illuminate\Support\LazyCollection;LazyCollection::make(function () &#123; $handle = fopen('log.txt', 'r'); while (($line = fgets($handle)) !== false) &#123; yield $line; &#125;&#125;); new staticnew static()new self()newnewnew  1234567891011121314151617class Father&#123; public function getNewFather() &#123; return new self(); &#125; public function getNewCaller() &#123; return new static(); &#125;&#125; $f = new Father(); var_dump(get_class($f-&gt;getNewFather())); // Fathervar_dump(get_class($f-&gt;getNewCaller())); // Father getNewFathergetNewCallerFathernew self()new static() 123456789class Sun1 extends Father&#123; &#125; $sun1 = new Sun1(); var_dump($sun1-&gt;getNewFather()); // object(Father)#4 (0) &#123; &#125;var_dump($sun1-&gt;getNewCaller()); // object(Sun1)#4 (0) &#123; &#125; getNewFatherFathergetNewCaller  new self()new static LazyCollection Illuminate\Support\LazyCollection.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109namespace Illuminate\Support;use ArrayIterator;use Closure;use Illuminate\Support\Traits\EnumeratesValues;use Illuminate\Support\Traits\Macroable;use IteratorAggregate;use stdClass;class LazyCollection implements Enumerable&#123; use EnumeratesValues, Macroable; /** * The source from which to generate items. * * @var callable|static */ public $source; /** * Create a new lazy collection instance. * * @param mixed $source * @return void */ public function __construct($source = null) &#123; if ($source instanceof Closure || $source instanceof self) &#123; $this-&gt;source = $source; &#125; elseif (is_null($source)) &#123; $this-&gt;source = static::empty(); &#125; else &#123; $this-&gt;source = $this-&gt;getArrayableItems($source); &#125; &#125; /** * Create a new instance with no items. * * @return static */ public static function empty() &#123; return new static([]); &#125; /** * Create a new instance by invoking the callback a given amount of times. * * @param int $number * @param callable|null $callback * @return static */ public static function times($number, callable $callback = null) &#123; if ($number &lt; 1) &#123; return new static; &#125; $instance = new static(function () use ($number) &#123; for ($current = 1; $current &lt;= $number; $current++) &#123; yield $current; &#125; &#125;); return is_null($callback) ? $instance : $instance-&gt;map($callback); &#125; /** * Create an enumerable with the given range. * * @param int $from * @param int $to * @return static */ public static function range($from, $to) &#123; return new static(function () use ($from, $to) &#123; for (; $from &lt;= $to; $from++) &#123; yield $from; &#125; &#125;); &#125; /** * Get all items in the enumerable. * * @return array */ public function all() &#123; if (is_array($this-&gt;source)) &#123; return $this-&gt;source; &#125; return iterator_to_array($this-&gt;getIterator()); &#125; /** * Eager load all items into a new lazy collection backed by an array. * * @return static */ public function eager() &#123; return new static($this-&gt;all()); &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-tap]]></title>
    <url>%2F2020%2F04%2F10%2FLaravel-tap%2F</url>
    <content type="text"><![CDATA[ tap() Laraveltaptapcollectiontap TapLaravel5.3tapRubytaptap 123456function tap($value, $callback)&#123; $callback($value); return $value;&#125;  12345678&lt;?php$photo = App\Photo::find(1);return tap($photo, function($photo) &#123; $photo-&gt;validated = true; $photo-&gt;save();&#125;); PhotovalidatedtruePhoto taptap 12345678910function tap($value, $callback = null)&#123; if (is_null($callback)) &#123; return new HigherOrderTapProxy($value); &#125; $callback($value); return $value;&#125; PhotoModel 1234567&lt;?php$photo = App\Photo::find(1);return tap($photo)-&gt;update([ 'validated' =&gt; 'true',]) taptruefalsetapPhototap tap LaravelHigherOrderTapProxyHigherOrderTapProxyHigherOrderTapProxytaptap Illuminate/Support/HigherOrderTapProxy.php 1234567891011121314151617181920212223242526272829303132333435363738&lt;?phpnamespace Illuminate\Support;class HigherOrderTapProxy&#123; /** * The target being tapped. * * @var mixed */ public $target; /** * Create a new tap proxy instance. * * @param mixed $target * @return void */ public function __construct($target) &#123; $this-&gt;target = $target; &#125; /** * Dynamically pass method calls to the target. * * @param string $method * @param array $parameters * @return mixed */ public function __call($method, $parameters) &#123; $this-&gt;target-&gt;&#123;$method&#125;(...$parameters); return $this-&gt;target; &#125;&#125; targettap Laravel collectiontapLaravelcollectiontaptaptapcollection 123456789101112131415161718192021222324252627282930313233343536373839404142$photos = [ [ 'file_name' =&gt; 'wallpaper', 'validated' =&gt; true, 'extension' =&gt; 'jpg' ], [ 'file_name' =&gt; 'spring', 'validated' =&gt; true, 'extension' =&gt; 'png' ], [ 'file_name' =&gt; 'flowers', 'validated' =&gt; false, 'extension' =&gt; 'jpg' ], [ 'file_name' =&gt; 'mac', 'validated' =&gt; true, 'extension' =&gt; 'png' ], [ 'file_name' =&gt; 'books', 'validated' =&gt; false, 'extension' =&gt; 'jpg' ], [ 'file_name' =&gt; 'mobiles', 'validated' =&gt; false, 'extension' =&gt; 'jpg' ], [ 'file_name' =&gt; 'glass', 'validated' =&gt; false, 'extension' =&gt; 'png' ], [ 'file_name' =&gt; 'fruit', 'validated' =&gt; true, 'extension' =&gt; 'jpg' ],]; taptap 123456return collect($photos) -&gt;where('validated', true) -&gt;tap(function ($validated) &#123; return var_dump($validated-&gt;pluck('file_name')); &#125;);&#125;);  1234wallpaperspringmacfruit tap VS PipeLaraveltappipetappipe 123456return collect($photos) -&gt;where('validated', true) -&gt;pipe(function ($validated) &#123; return $validated-&gt;where('extension', 'jpg')-&gt;pluck('file_name'); &#125;);&#125;);  12wallpaperfruit  123456return collect($photos) -&gt;where('validated', true) -&gt;tap(function ($validated) &#123; return $validated-&gt;where('extension', 'jpg')-&gt;pluck('file_name'); &#125;);&#125;); true  12345678910111213141516171819200: &#123; file_name: &quot;wallpaper&quot;, validated: true, extension: &quot;jpg&quot;&#125;,1: &#123; file_name: &quot;spring&quot;, validated: true, extension: &quot;png&quot;&#125;,3: &#123; file_name: &quot;mac&quot;, validated: true, extension: &quot;png&quot;&#125;,7: &#123; file_name: &quot;fruit&quot;, validated: true, extension: &quot;jpg&quot;&#125; 1234$user = User::find(1);$data = [...];$user-&gt;update($data);$user-&gt;notify(); tap 1tap(User::find(1))-&gt;update($data)-&gt;notify();  LaravelAuthenticateSession@handle() 12345$response = $next($request); $this-&gt;storePasswordHashInSession($request); return $response; tap() 123return tap($next($request), function () use ($request) &#123; $this-&gt;storePasswordHashInSession($request);&#125;); Illuminate\Cache\Repositorypullpull 12345678public function pull($key, $default = null)&#123; $value = $this-&gt;get($key, $default); $this-&gt;forget($key) // returns a boolean; return $value;&#125; $this-&gt;forget()$valuetap() 123456public function pull($key, $default = null)&#123; return tap($this-&gt;get($key, $default), function ($value) use ($key) &#123; $this-&gt;forget($key); &#125;);&#125; Eloquentcreateupdate[timestamps=&gt;false] 123456789101112// Method defined in App\Model that App\Message extends.public function keepingTimestamps(callable $callback)&#123; try &#123; $timestamps = $this-&gt;timestamps; $this-&gt;timestamps = false; return tap($this, $callback); &#125; finally &#123; $this-&gt;timestamps = $timestamps; &#125;&#125; Message 123request()-&gt;user()-&gt;latestMessage-&gt;keepingTimestamps(function ($message) &#123; $message-&gt;markRead(); // updates a 'read_at' timestamp instead&#125;); // returns the latestMessage DB::transaction()Laravel 5.4tap()  CollectionLaravel 5.4Collectiontap()Laravel 5.3Collection macroAppServiceProvider@boot() LaravelCarbon&#60;option&#62; 12345678910111213141516171819public function monthOptions()&#123; return collect(range(1, 12)) -&gt;keyByValue() // custom Collection macro -&gt;tap(function () &#123; if (App::getLocale() === 'fr') &#123; setlocale(LC_TIME, 'fr_CA'); &#125; &#125;) -&gt;map(function ($month) &#123; return sprintf('%02d - %s', $month, Carbon::now()-&gt;month($month)-&gt;formatLocalized('%B')); &#125;) -&gt;tap(function () &#123; if (App::getLocale() === 'fr') &#123; setlocale(LC_TIME, ''); &#125; &#125;);&#125; / Collection tap()handle() 12345678910111213141516171819202122232425public function handle()&#123; Club::findOrFail($this-&gt;option('club')) -&gt;members() -&gt;subscribed() -&gt;get() -&gt;tap(function ($members) &#123; $this-&gt;output-&gt;progressStart($members-&gt;count()); &#125;) -&gt;each(function ($member) &#123; Mail::to($member)-&gt;queue(new Newsletter($member, $this-&gt;matchReport()); $this-&gt;output-&gt;progressAdvance(); &#125;) -&gt;tap(function () &#123; $this-&gt;output-&gt;progressFinish(); &#125;);&#125; public function matchReport()&#123; return once(function () &#123; return MatchReport::ofRound($this-&gt;option('round'))-&gt;firstOrFail(); &#125;);&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Funnel]]></title>
    <url>%2F2020%2F04%2F10%2FLaravel-Funnel%2F</url>
    <content type="text"><![CDATA[ ConcurrencyLimiterBuilderBuilder  funnel 1234567Redis::funnel('key')-&gt;limit(1)-&gt;then(function () &#123; // Job logic...&#125;, function () &#123; // Could not obtain lock... return $this-&gt;release(10);&#125;); 12345678910111213141516171819202122232425262728&lt;?phpnamespace Illuminate\Redis\Connections;use Closure;use Illuminate\Contracts\Events\Dispatcher;use Illuminate\Redis\Events\CommandExecuted;use Illuminate\Redis\Limiters\ConcurrencyLimiterBuilder;use Illuminate\Redis\Limiters\DurationLimiterBuilder;use Illuminate\Support\Traits\Macroable;abstract class Connection&#123; use Macroable &#123; __call as macroCall; &#125; /** * Funnel a callback for a maximum number of simultaneous executions. * * @param string $name * @return \Illuminate\Redis\Limiters\ConcurrencyLimiterBuilder */ public function funnel($name) &#123; return new ConcurrencyLimiterBuilder($this, $name); &#125;&#125; Illuminate\Contracts\Redis\LimiterTimeoutException.php 12345678910&lt;?phpnamespace Illuminate\Contracts\Redis;use Exception;class LimiterTimeoutException extends Exception&#123; //&#125; Illuminate\Redis\Limiters\ConcurrencyLimiter.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166&lt;?phpnamespace Illuminate\Redis\Limiters;use Exception;use Illuminate\Contracts\Redis\LimiterTimeoutException;use Illuminate\Support\Str;class ConcurrencyLimiter&#123; /** * The Redis factory implementation. * * @var \Illuminate\Redis\Connections\Connection */ protected $redis; /** * The name of the limiter. * * @var string */ protected $name; /** * The allowed number of concurrent tasks. * * @var int */ protected $maxLocks; /** * The number of seconds a slot should be maintained. * * @var int */ protected $releaseAfter; /** * Create a new concurrency limiter instance. * * @param \Illuminate\Redis\Connections\Connection $redis * @param string $name * @param int $maxLocks * @param int $releaseAfter * @return void */ public function __construct($redis, $name, $maxLocks, $releaseAfter) &#123; $this-&gt;name = $name; $this-&gt;redis = $redis; $this-&gt;maxLocks = $maxLocks; $this-&gt;releaseAfter = $releaseAfter; &#125; /** * Attempt to acquire the lock for the given number of seconds. * * @param int $timeout * @param callable|null $callback * @return bool * * @throws \Illuminate\Contracts\Redis\LimiterTimeoutException * @throws \Exception */ public function block($timeout, $callback = null) &#123; $starting = time(); $id = Str::random(20); while (! $slot = $this-&gt;acquire($id)) &#123; if (time() - $timeout &gt;= $starting) &#123; throw new LimiterTimeoutException; &#125; usleep(250 * 1000); &#125; if (is_callable($callback)) &#123; try &#123; return tap($callback(), function () use ($slot, $id) &#123; $this-&gt;release($slot, $id); &#125;); &#125; catch (Exception $exception) &#123; $this-&gt;release($slot, $id); throw $exception; &#125; &#125; return true; &#125; /** * Attempt to acquire the lock. * * @param string $id A unique identifier for this lock * @return mixed */ protected function acquire($id) &#123; $slots = array_map(function ($i) &#123; return $this-&gt;name.$i; &#125;, range(1, $this-&gt;maxLocks)); return $this-&gt;redis-&gt;eval(...array_merge( [$this-&gt;lockScript(), count($slots)], array_merge($slots, [$this-&gt;name, $this-&gt;releaseAfter, $id]) )); &#125; /** * Get the Lua script for acquiring a lock. * * KEYS - The keys that represent available slots * ARGV[1] - The limiter name * ARGV[2] - The number of seconds the slot should be reserved * ARGV[3] - The unique identifier for this lock * * @return string */ protected function lockScript() &#123; return &lt;&lt;&lt;'LUA'for index, value in pairs(redis.call('mget', unpack(KEYS))) do if not value then redis.call('set', KEYS[index], ARGV[3], "EX", ARGV[2]) return ARGV[1]..index endendLUA; &#125; /** * Release the lock. * * @param string $key * @param string $id * @return void */ protected function release($key, $id) &#123; $this-&gt;redis-&gt;eval($this-&gt;releaseScript(), 1, $key, $id); &#125; /** * Get the Lua script to atomically release a lock. * * KEYS[1] - The name of the lock * ARGV[1] - The unique identifier for this lock * * @return string */ protected function releaseScript() &#123; return &lt;&lt;&lt;'LUA'if redis.call('get', KEYS[1]) == ARGV[1]then return redis.call('del', KEYS[1])else return 0endLUA; &#125;&#125; ConcurrencyLimiterBuilder Illuminate\Redis\Limiters\ConcurrencyLimiterBuilder.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121&lt;?phpnamespace Illuminate\Redis\Limiters;use Illuminate\Contracts\Redis\LimiterTimeoutException;use Illuminate\Support\InteractsWithTime;class ConcurrencyLimiterBuilder&#123; use InteractsWithTime; /** * The Redis connection. * * @var \Illuminate\Redis\Connections\Connection */ public $connection; /** * The name of the lock. * * @var string */ public $name; /** * The maximum number of entities that can hold the lock at the same time. * * @var int */ public $maxLocks; /** * The number of seconds to maintain the lock until it is automatically released. * * @var int */ public $releaseAfter = 60; /** * The amount of time to block until a lock is available. * * @var int */ public $timeout = 3; /** * Create a new builder instance. * * @param \Illuminate\Redis\Connections\Connection $connection * @param string $name * @return void */ public function __construct($connection, $name) &#123; $this-&gt;name = $name; $this-&gt;connection = $connection; &#125; /** * Set the maximum number of locks that can obtained per time window. * * @param int $maxLocks * @return $this */ public function limit($maxLocks) &#123; $this-&gt;maxLocks = $maxLocks; return $this; &#125; /** * Set the number of seconds until the lock will be released. * * @param int $releaseAfter * @return $this */ public function releaseAfter($releaseAfter) &#123; $this-&gt;releaseAfter = $this-&gt;secondsUntil($releaseAfter); return $this; &#125; /** * Set the amount of time to block until a lock is available. * * @param int $timeout * @return $this */ public function block($timeout) &#123; $this-&gt;timeout = $timeout; return $this; &#125; /** * Execute the given callback if a lock is obtained, otherwise call the failure callback. * * @param callable $callback * @param callable|null $failure * @return mixed * * @throws \Illuminate\Contracts\Redis\LimiterTimeoutException */ public function then(callable $callback, callable $failure = null) &#123; try &#123; return (new ConcurrencyLimiter( $this-&gt;connection, $this-&gt;name, $this-&gt;maxLocks, $this-&gt;releaseAfter ))-&gt;block($this-&gt;timeout, $callback); &#125; catch (LimiterTimeoutException $e) &#123; if ($failure) &#123; return $failure($e); &#125; throw $e; &#125; &#125;&#125; Illuminate\Support\InteractsWithTime.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364&lt;?phpnamespace Illuminate\Support;use DateInterval;use DateTimeInterface;trait InteractsWithTime&#123; /** * Get the number of seconds until the given DateTime. * * @param \DateTimeInterface|\DateInterval|int $delay * @return int */ protected function secondsUntil($delay) &#123; $delay = $this-&gt;parseDateInterval($delay); return $delay instanceof DateTimeInterface ? max(0, $delay-&gt;getTimestamp() - $this-&gt;currentTime()) : (int) $delay; &#125; /** * Get the "available at" UNIX timestamp. * * @param \DateTimeInterface|\DateInterval|int $delay * @return int */ protected function availableAt($delay = 0) &#123; $delay = $this-&gt;parseDateInterval($delay); return $delay instanceof DateTimeInterface ? $delay-&gt;getTimestamp() : Carbon::now()-&gt;addRealSeconds($delay)-&gt;getTimestamp(); &#125; /** * If the given value is an interval, convert it to a DateTime instance. * * @param \DateTimeInterface|\DateInterval|int $delay * @return \DateTimeInterface|int */ protected function parseDateInterval($delay) &#123; if ($delay instanceof DateInterval) &#123; $delay = Carbon::now()-&gt;add($delay); &#125; return $delay; &#125; /** * Get the current system time as a UNIX timestamp. * * @return int */ protected function currentTime() &#123; return Carbon::now()-&gt;getTimestamp(); &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHPLeague\Pipeline]]></title>
    <url>%2F2020%2F04%2F06%2FPHP%E7%AE%A1%E9%81%93%E6%8F%92%E4%BB%B6League-Pipeline%2F</url>
    <content type="text"><![CDATA[  Pipeline Pipeline (processes) processes  Illuminate\Pipeline1234567891011121314151617181920212223public function demo(Request $request)&#123; $pipe1 = function ($payload, Closure $next) &#123; $payload = $payload + 1; return $next($payload); &#125;; $pipe2 = function ($payload, Closure $next) &#123; $payload = $payload * 3; return $next($payload); &#125;; $data = $request-&gt;input('data', 0); $pipeline = new Pipeline(); return $pipeline -&gt;send($data) -&gt;through([$pipe1, $pipe2]) -&gt;then(function ($data) &#123; return $data; &#125;);&#125; League\Pipeline 1composer require league/pipeline demo 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152use League\Pipeline\Pipeline;// $pipe1 = function ($payload) &#123; return $payload + 1;&#125;;$pipe2 = function ($payload) &#123; return $payload * 3;&#125;;$route-&gt;map( 'GET', '/demo', function (ServerRequestInterface $request, ResponseInterface $response ) use ($service, $pipe1, $pipe2) &#123; $params = $request-&gt;getQueryParams(); //  $pipeline1 = (new Pipeline) -&gt;pipe($pipe1) -&gt;pipe($pipe2); $callback1 = $pipeline1-&gt;process($params['data']); $response-&gt;getBody()-&gt;write("&lt;h1&gt;&lt;/h1&gt;"); $response-&gt;getBody()-&gt;write("&lt;p&gt;$callback1&lt;/p&gt;"); //  $pipeline2 = (new Pipeline()) -&gt;pipe($pipe1) -&gt;pipe($pipe2); $callback2 = $pipeline2($params['data']); $response-&gt;getBody()-&gt;write("&lt;h1&gt;&lt;/h1&gt;"); $response-&gt;getBody()-&gt;write("&lt;p&gt;$callback2&lt;/p&gt;"); //  Builder $builder = new PipelineBuilder(); $pipeline3 = $builder -&gt;add($pipe1) -&gt;add($pipe2) -&gt;build(); $callback3 = $pipeline3($params['data']); $response-&gt;getBody()-&gt;write("&lt;h1&gt; Builder&lt;/h1&gt;"); $response-&gt;getBody()-&gt;write("&lt;p&gt;$callback3&lt;/p&gt;"); return $response; &#125;);   PipelineInterface 1234567891011121314151617181920212223242526&lt;?phpdeclare(strict_types=1);namespace League\Pipeline;interface PipelineInterface extends StageInterface&#123; /** * Create a new pipeline with an appended stage. * * @return static */ public function pipe(callable $operation): PipelineInterface;&#125;interface StageInterface&#123; /** * Process the payload. * * @param mixed $payload * * @return mixed */ public function __invoke($payload);&#125; pipe  mixed __invoke ([ $ ] )__invoke ()   1234567891011&lt;?phpclass CallableClass &#123; function __invoke($x) &#123; var_dump($x); &#125;&#125;$obj = new CallableClass;$obj(5);var_dump(is_callable($obj));?&gt;  123int(5)bool(true)Pipeline 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpdeclare(strict_types=1);namespace League\Pipeline;class Pipeline implements PipelineInterface&#123; /** * @var callable[] */ private $stages = []; /** * @var ProcessorInterface */ private $processor; public function __construct(ProcessorInterface $processor = null, callable ...$stages) &#123; $this-&gt;processor = $processor ?? new FingersCrossedProcessor; $this-&gt;stages = $stages; &#125; public function pipe(callable $stage): PipelineInterface &#123; $pipeline = clone $this; $pipeline-&gt;stages[] = $stage; return $pipeline; &#125; public function process($payload) &#123; return $this-&gt;processor-&gt;process($payload, ...$this-&gt;stages); &#125; public function __invoke($payload) &#123; return $this-&gt;process($payload); &#125;&#125;  Pipeline  pipe process ($payload)Processor  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// $stagesclass FingersCrossedProcessor implements ProcessorInterface&#123; public function process($payload, callable ...$stages) &#123; foreach ($stages as $stage) &#123; $payload = $stage($payload); &#125; return $payload; &#125;&#125;// checkclass InterruptibleProcessor implements ProcessorInterface&#123; /** * @var callable */ private $check; public function __construct(callable $check) &#123; $this-&gt;check = $check; &#125; public function process($payload, callable ...$stages) &#123; $check = $this-&gt;check; foreach ($stages as $stage) &#123; $payload = $stage($payload); if (true !== $check($payload)) &#123; return $payload; &#125; &#125; return $payload; &#125;&#125;interface ProcessorInterface&#123; /** * Process the payload using multiple stages. * * @param mixed $payload * * @return mixed */ public function process($payload, callable ...$stages);&#125;  PipelineBuilder Builder 12345678910111213141516171819202122232425262728293031323334353637class PipelineBuilder implements PipelineBuilderInterface&#123; /** * @var callable[] */ private $stages = []; /** * @return self */ public function add(callable $stage): PipelineBuilderInterface &#123; $this-&gt;stages[] = $stage; return $this; &#125; public function build(ProcessorInterface $processor = null): PipelineInterface &#123; return new Pipeline($processor, ...$this-&gt;stages); &#125;&#125;interface PipelineBuilderInterface&#123; /** * Add an stage. * * @return self */ public function add(callable $stage): PipelineBuilderInterface; /** * Build a new Pipeline object. */ public function build(ProcessorInterface $processor = null): PipelineInterface;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Pipeline]]></title>
    <url>%2F2020%2F04%2F06%2FLaravel-Pipeline%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[ (new Pipeline) LaravelHTTP LaravelIlluminate\Pipeline 12345678910111213141516171819202122232425262728293031323334353637383940414243444546&lt;?phpuse Illuminate\Pipeline\Pipeline;use Closure;$pipe1 = function ($poster, Closure $next) &#123; $poster += 1; echo "pipe1: $poster\n"; return $next($poster);&#125;;$pipe2 = function ($poster, Closure $next) &#123; if ($poster &gt; 7) &#123; return $poster; &#125; $poster += 3; echo "pipe2: $poster\n"; return $next($poster);&#125;;$pipe3 = function ($poster, Closure $next) &#123; $result = $next($poster); echo "pipe3: $result\n"; return $result * 2;&#125;;$pipe4 = function ($poster, Closure $next) &#123; $poster += 2; echo "pipe4 : $poster\n"; return $next($poster);&#125;;$pipes = [$pipe1, $pipe2, $pipe3, $pipe4];function dispatcher($poster, $pipes)&#123; echo "result: " . (new Pipeline)-&gt;send($poster)-&gt;through($pipes)-&gt;then(function ($poster) &#123; echo "received: $poster\n"; return 3; &#125;) . "\n";&#125;echo "==&gt; action 1:\n";dispatcher(5, $pipes);echo "==&gt; action 2:\n";dispatcher(7, $pipes);  12345678910==&gt; action 1:pipe1: 6pipe2: 9pipe4 : 11received: 11pipe3: 3result: 6==&gt; action 2:pipe1: 8result: 8 Pipeline :  --->  --->  --->  --->  pipe1pipe2pipe3pipe41243 51243 7122 LaravelRequestRequestSession/CookieHeader Pipeline   array_reduce 12345678910public function then(Closure $destination)&#123; $firstSlice = $this-&gt;getInitialSlice($destination); $callable = array_reduce( array_reverse($this-&gt;pipes), $this-&gt;getSlice(), $firstSlice ); return $callable($this-&gt;passable);&#125; Pipelinethensendthroughsendthrough then $this-&gt;getInitialSlice()Slicearray_reduce  array_reduce PipelinePipelinearray_reversearray_reduce array_reducePipelinegetInitalSlice array_reduce$this-&gt;getSlice() array_reduce$this-&gt;getSlice()getSlice 1234567891011function ($stack, $pipe) &#123; return function ($passable) use ($stack, $pipe) &#123; if ($pipe instanceof Closure) &#123; return call_user_func($pipe, $passable, $stack); &#125; //   //  // Laravel // ifhandle~~ &#125;;&#125;; return function() {  };functionreturn  array_reduce $stack$pipe $stack$pipe $pipethensend  1234567891011121314151617181920212223&lt;?phpuse Illuminate\Pipeline\Pipeline;$pipes = [ function ($poster, $callback) &#123; $poster += 1; return $callback($poster); &#125;, function ($poster, $callback) &#123; $result = $callback($poster); return $result - 1; &#125;, function ($poster, $callback) &#123; $poster += 2; return $callback($poster); &#125;];echo (new Pipeline)-&gt;send(0)-&gt;through($pipes)-&gt;then(function ($poster) &#123; return $poster;&#125;); //  2  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152poster = 0f^0 = f(z)-&gt;&#123; z &#125; // f^1 = f(z, y)-&gt;&#123; f^y( z + 1 ) &#125; //  1f^2 = f(z, y)-&gt;&#123; result = f^y(z); result - 1 &#125; //  2f^3 = f(z, y)-&gt;&#123; f^y( z + 2 ) &#125; //  3f^getSlice = f(y, x)-&gt;&#123; f(z)-&gt;&#123; call( f^x(z, y) ) &#125;&#125;callback = array_reduce([f^3, f^2, f^1], f^getSlice, f^0);callback(poster)&gt;&gt;&gt; exec^1: //  reducey x  //  f^a y = f^0(z); x = f^3; f^a = f(z)-&gt;&#123; call( f^x(z, y) ) &#125;exec^2: // y  f^ax  y = f^a; x = f^2; f^b = f(z)-&gt;&#123; call( f^x(z, y) ) &#125;exec^3: //  //  y = f^b; x = f^1; f^c = f(z)-&gt;&#123; call( f^x(z, y) ) &#125;exec^4: //  z = poster = 1 //  z  1 xy  exec^3 call( f^c(0) ) = call( f^1(0, f^b) )exec^5: //  call( f^b(0 + 1) ) = call( f^2(0 + 1, f^a) )exec^6: //  2  result = f^a(0 + 1); result - 1exec^7: result = call( f^3(0 + 1 , f^0) ); result - 1exec^8: result = call( f^0(0 + 1 + 2) ); result - 1exec^9: result = 3; result - 1// result: 2 array_reverse   Pipeline array_reduce LaravelPHPPHPPHP]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Pipeline]]></title>
    <url>%2F2020%2F04%2F05%2FLaravel-Pipeline%2F</url>
    <content type="text"><![CDATA[  array_reduce array_reverse Laravel Pipeline  LaravelPipeline LaravelLaravel    Unixshell 1cat helloworld.txt | grep "hello world" | rev | &gt; output.txt hello worldoutput.txt Laravel CookieCSRF HTTP          LaravelLaravelIlluminate\Pipeline\PipelineIlluminate\Contracts\Container\Container 1$pipeline = app('Illuminate\Pipeline\Pipeline');  1$pipeline-&gt;send($request);  1$pipeline-&gt;through($middleware);  123$pipeline-&gt;then(function ($request) &#123; // Do something&#125;); HTTP LaravelLaravel LaravelLaravelarray_reducearray_reduce array_reducearray_reduce()callbackarray 1mixed array_reduce ( array $array , callable $callback [, mixed $initial = NULL ] ) 1.array array 2.callback 1mixed callback ( mixed $carry , mixed $item ) $carryinitialitem 3.initial initial array_reducecallback  12345$arr = ['AAAA', 'BBBB', 'CCCC'];$res = array_reduce($arr, function($carry, $item)&#123; return $carry . $item;&#125;); 3 $carry=null$item=AAAAAAAA$carry=AAAA$item=BBBBAAAABBBB$carry=AAAABBBB$item=CCCCAAAABBBBCCCC AAAABBBBCCCC 12345$arr = ['AAAA', 'BBBB', 'CCCC'];$res = array_reduce($arr, function($carry, $item)&#123; return $carry . $item;&#125;, 'INITIAL-'); $carry = INITIAL-$item = AAAAINITIAL-AAAA$carry = INITIAL-AAAA$item = BBBB INITIAL-AAAABBBB$carry = INITIAL-AAAABBBB$item = CCCCINITIAL-AAAABBBBCCCC INITIAL-AAAABBBBCCCC 12345678$arr = ['AAAA', 'BBBB', 'CCCC'];// $res = array_reduce($arr, function($carry, $item)&#123; return function() use ($item)&#123; // useitem return strtolower($item) . '-'; &#125;;&#125;); $carrynull$item=AAAAuse$item=AAAA$carryuse$item=AAAA$item=BBBBuse$item=BBBB$carryuse$item=BBBB$item=CCCCuse$item=CCCC $res()CCCC- use($item)useitem USE123456789$arr = ['AAAA'];$res = array_reduce($arr, function($carry, $item)&#123; return function () use ($carry, $item) &#123; if (is_null($carry)) &#123; return 'Carry IS NULL' . $item; &#125; &#125;;&#125;); 1 1use($carry = null, $item = AAAA)$res()Carry IS NULLAAAA  123456789101112$arr = ['AAAA', 'BBBB'];$res = array_reduce($arr, function($carry, $item)&#123; return function () use ($carry, $item) &#123; if (is_null($carry)) &#123; return 'Carry IS NULL' . $item; &#125; if ($carry instanceof \Closure) &#123; return $carry() . $item; &#125; &#125;;&#125;);  $carrynull$itemAAAA 123456789// function () use ($carry = null, $item = AAAA) &#123; if (is_null($carry)) &#123; return 'Carry IS NULL' . $item; &#125; if ($carry instanceof \Closure) &#123; return $carry() . $item; &#125;&#125; Carry IS NULLAAAA $carry$itemBBBB$carry instanceof \ClosureCarry IS NULLAAAABBBB Laravelarray_reversearray_reverselaravelarray_reverse phparray_reducecallbackClosureInitial Laravel 12345678910111213141516// Illuminate\Foundation\Http\Kernel.phpprotected function sendRequestThroughRouter($request)&#123; return (new Pipeline($this-&gt;app)) -&gt;send($request) -&gt;through($this-&gt;app-&gt;shouldSkipMiddleware() ? [] : $this-&gt;middleware) -&gt;then($this-&gt;dispatchToRouter());&#125;protected function dispatchToRouter()&#123; return function ($request) &#123; $this-&gt;app-&gt;instance('request', $request); return $this-&gt;router-&gt;dispatch($request); &#125;;&#125; $requestmiddlewaredispatchToRouter Closure 12Illuminate\Foundation\Http\Middleware\CheckForMaintenanceMode::class,App\Http\Middleware\AllowOrigin::class, //  Illuminate\Pipeline\Pipelinelaravel Illuminate\Pipeline\Pipelinethen$destinationdispatchToRouterpipespassableRequest 1234567public function then(Closure $destination)&#123; $pipeline = array_reduce( array_reverse($this-&gt;pipes), $this-&gt;carry(), $this-&gt;prepareDestination($destination) ); return $pipeline($this-&gt;passable);&#125; array_reverse$this-&gt;carry()dispatchToRouter  12345678910111213141516171819202122232425protected function prepareDestination(Closure $destination)&#123; return function ($passable) use ($destination) &#123; return $destination($passable); &#125;;&#125;protected function carry()&#123; return function ($stack, $pipe) &#123; return function ($passable) use ($stack, $pipe) &#123; if ($pipe instanceof Closure) &#123; return $pipe($passable, $stack); &#125; elseif (! is_object($pipe)) &#123; // list($name, $parameters) = $this-&gt;parsePipeString($pipe); $pipe = $this-&gt;getContainer()-&gt;make($name); $parameters = array_merge([$passable, $stack], $parameters); &#125; else &#123; $parameters = [$passable, $stack]; &#125; return $pipe-&gt;&#123;$this-&gt;method&#125;(...$parameters); &#125;; &#125;;&#125; use$stack$pipe$stack$pipeApp\Http\Middleware\AllowOrigin::classarray_reverse $pipeString!is_object($pipe)makehandle$this-&gt;methodhandlerequest 1234public function handle($request, Closure $next)&#123; //......&#125; handlereturn $next($request)array_reducedispatchToRouter 1234567protected function dispatchToRouter()&#123; return function ($request) &#123; $this-&gt;app-&gt;instance('request', $request); return $this-&gt;router-&gt;dispatch($request); &#125;;&#125; use$stack$pipe$stack$pipe Illuminate\Foundation\Http\Middleware\CheckForMaintenanceMode::class then 1return $pipeline($this-&gt;passable); use$pipeIlluminate\Foundation\Http\Middleware\CheckForMaintenanceMode::class!is_object($pipe)makeCheckForMaintenanceModehandlehandle CheckForMaintenanceModehandlereturn $next($request)$nextmake App\Http\Middleware\AllowOriginhandleAllowOriginhandleAllowOriginreturn $next($request)dispatchToRouter 1.array_reverse 2. 3.$next($request) Pipeline Illuminate\Contracts\Pipeline\Hub.php 123456789101112131415&lt;?phpnamespace Illuminate\Contracts\Pipeline;interface Hub&#123; /** * Send an object through one of the available pipelines. * * @param mixed $object * @param string|null $pipeline * @return mixed */ public function pipe($object, $pipeline = null);&#125; Illuminate\Contracts\Pipeline\Pipeline.php 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpnamespace Illuminate\Contracts\Pipeline;use Closure;interface Pipeline&#123; /** * Set the traveler object being sent on the pipeline. * * @param mixed $traveler * @return $this */ public function send($traveler); /** * Set the stops of the pipeline. * * @param dynamic|array $stops * @return $this */ public function through($stops); /** * Set the method to call on the stops. * * @param string $method * @return $this */ public function via($method); /** * Run the pipeline with a final destination callback. * * @param \Closure $destination * @return mixed */ public function then(Closure $destination);&#125; Illuminate\Pipeline\PipelineServiceProvider.php 12345678910111213141516171819202122232425262728293031323334&lt;?phpnamespace Illuminate\Pipeline;use Illuminate\Contracts\Pipeline\Hub as PipelineHubContract;use Illuminate\Contracts\Support\DeferrableProvider;use Illuminate\Support\ServiceProvider;class PipelineServiceProvider extends ServiceProvider implements DeferrableProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton( PipelineHubContract::class, Hub::class ); &#125; /** * Get the services provided by the provider. * * @return array */ public function provides() &#123; return [ PipelineHubContract::class, ]; &#125;&#125; Illuminate\Pipeline\Pipeline.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244namespace Illuminate\Pipeline;use Closure;use Illuminate\Contracts\Container\Container;use Illuminate\Contracts\Pipeline\Pipeline as PipelineContract;use RuntimeException;use Throwable;class Pipeline implements PipelineContract&#123; /** * The container implementation. * * @var \Illuminate\Contracts\Container\Container */ protected $container; /** * The object being passed through the pipeline. * * @var mixed */ protected $passable; /** * The array of class pipes. * * @var array */ protected $pipes = []; /** * The method to call on each pipe. * * @var string */ protected $method = 'handle'; /** * Create a new class instance. * * @param \Illuminate\Contracts\Container\Container|null $container * @return void */ public function __construct(Container $container = null) &#123; $this-&gt;container = $container; &#125; /** * Set the object being sent through the pipeline. * * @param mixed $passable * @return $this */ public function send($passable) &#123; $this-&gt;passable = $passable; return $this; &#125; /** * Set the array of pipes. * * @param array|mixed $pipes * @return $this */ public function through($pipes) &#123; $this-&gt;pipes = is_array($pipes) ? $pipes : func_get_args(); return $this; &#125; /** * Set the method to call on the pipes. * * @param string $method * @return $this */ public function via($method) &#123; $this-&gt;method = $method; return $this; &#125; /** * Run the pipeline with a final destination callback. * * @param \Closure $destination * @return mixed */ public function then(Closure $destination) &#123; $pipeline = array_reduce( array_reverse($this-&gt;pipes()), $this-&gt;carry(), $this-&gt;prepareDestination($destination) ); return $pipeline($this-&gt;passable); &#125; /** * Run the pipeline and return the result. * * @return mixed */ public function thenReturn() &#123; return $this-&gt;then(function ($passable)&#123; return $passable; &#125;); &#125; /** * Get the final piece of the Closure onion. * * @param \Closure $destination * @return \Closure */ protected function prepareDestination(Closure $destination) &#123; return function ($passable) use ($destination) &#123; try &#123; return $destination($passable); &#125; catch (Throwable $e) &#123; return $this-&gt;handleException($passable, $e); &#125; &#125; &#125; /** * Get a Closure that represents a slice of the application onion. * * @return \Closure */ protected function carry() &#123; return function($stack, $pipe) &#123; return function ($passable) use ($stack, $pipe) &#123; try &#123; if (is_callable($pipe)) &#123; // If the pipe is a callable, then we will call it directly, but otherwise we // will resolve the pipes out of the dependency container and call it with // the appropriate method and arguments, returning the results back out. return $pipe($passable, $stack); &#125; elseif (! is_object($pipe)) &#123; [$name, $parameters] = $this-&gt;parsePipeString($pipe); // If the pipe is a string we will parse the string and resolve the class out // of the dependency injection container. We can then build a callable and // execute the pipe function giving in the parameters that are required. $pipe = $this-&gt;getContainer()-&gt;make($name); $parameters = array_merge([$passable, $stack], $parameters); &#125; else &#123; // If the pipe is already an object we'll just make a callable and pass it to // the pipe as-is. There is no need to do any extra parsing and formatting // since the object we're given was already a fully instantiated object. $parameters = [$passable, $stack]; &#125; $carry = method_exists($pipe, $this-&gt;method) ? $pipe-&gt;&#123;$this-&gt;method&#125;(...$parameters) : $pipe(...$parameters); return $this-&gt;handleCarry($carry); &#125; catch (Throwable $e) &#123; return $this-&gt;handleException($passable, $e); &#125; &#125; &#125; &#125; /** * Parse full pipe string to get name and parameters. * * @param string $pipe * @return array */ protected function parsePipeString($pipe) &#123; [$name, $parameters] = array_pad(explode(':', $pipe, 2), 2, []); if (is_string($parameters)) &#123; $parameters = explode(',', $parameters); &#125; return [$name, $parameters]; &#125; /** * Get the array of configured pipes. * * @return array */ protected function pipes() &#123; return $this-&gt;pipes; &#125; /** * Get the container instance. * * @return \Illuminate\Contracts\Container\Container * * @throws \RuntimeException */ protected function getContainer() &#123; if (! $this-&gt;container) &#123; throw new RuntimeException('A container instance has not been passed to the Pipeline.'); &#125; return $this-&gt;container; &#125; /** * Handle the value returned from each pipe before passing it to the next. * * @param mixed $carry * @return mixed */ protected function handleCarry($carry) &#123; return $carry; &#125; /** * Handle the given exception. * * @param mixed $passable * @param \Throwable $e * @return mixed * * @throws \Throwable */ protected function handleException($passable, Throwable $e) &#123; throw $e; &#125;&#125; 1.thenPHParray_reduce($array, $callback, $initial)closure 2.$passableRequestPython 3.response $this-&gt;method = handle via handle($request, Closure $next)2 1return $pipe($passable, $stack) Laravel 12345678910111213141516171819202122232425262728293031function f1($f)&#123; return function($x) use ($f)&#123; echo 'middleware 1 begin.'.PHP_EOL; $x += 1; $x = $f($x); echo 'middleware 1 end.'.PHP_EOL; return $x; &#125;;&#125;function f2($f)&#123; return function($x) use($f)&#123; echo 'middleware 2 begin: '.PHP_EOL; $x += 2; $x = $f($x); echo 'middleware 2 end.'.PHP_EOL; return $x; &#125;;&#125;function respond()&#123; return function($x)&#123; echo 'Generate some response.'.PHP_EOL; return $x; &#125;;&#125;$x = 1;$response = f2(f1(respond()))($x);echo $response;  123456middleware 2 begin:middleware 1 begin.Generate some response.middleware 1 end.middleware 2 end.4 LaravelPipeline  array_reduce12345678910111213141516171819202122232425262728293031$f1 = function($x, $f)&#123; echo 'middleware 1 begin.'.PHP_EOL; $x += 1; $x = $f($x); echo 'middleware 1 end.'.PHP_EOL; return $x; &#125;;$f2 = function($x, $f)&#123; echo 'middleware 2 begin: '.PHP_EOL; $x += 2; $x = $f($x); echo 'middleware 2 end.'.PHP_EOL; return $x;&#125;;$respond = function($x)&#123; echo 'Generate some response.'.PHP_EOL; return $x;&#125;;$middlewares = [$f1, $f2];$initial = $respond;$foo = array_reduce($middlewares, function($stack, $item)&#123; return function($request) use ($stack, $item)&#123; return $item($request, $stack); &#125;;&#125;, $initial);$x = 1;echo $foo($x);  12345middleware 2 begin:middleware 1 begin.Generate some response.middleware 1 end.middleware 2 end.]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Dispatcher]]></title>
    <url>%2F2020%2F04%2F03%2FLaravel-Dispatcher%2F</url>
    <content type="text"><![CDATA[ Dispatcher$listeners[]$this-&gt;listeners[$event][]=closure; listen($events,$listener)$listeners[]dispatch(); Laravel Event- Illuminate\Contracts\Events\Dispatcher.php  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182&lt;?phpnamespace Illuminate\Contracts\Events;interface Dispatcher&#123; /** * Register an event listener with the dispatcher. * * @param string|array $events * @param mixed $listener * @return void */ public function listen($events, $listener); /** * Determine if a given event has listeners. * * @param string $eventName * @return bool */ public function hasListeners($eventName); /** * Register an event subscriber with the dispatcher. * * @param object|string $subscriber * @return void */ public function subscribe($subscriber); /** * Dispatch an event until the first non-null response is returned. * * @param string|object $event * @param mixed $payload * @return array|null */ public function until($event, $payload = []); /** * Dispatch an event and call the listeners. * * @param string|object $event * @param mixed $payload * @param bool $halt * @return array|null */ public function dispatch($event, $payload = [], $halt = false); /** * Register an event and payload to be fired later. * * @param string $event * @param array $payload * @return void */ public function push($event, $payload = []); /** * Flush a set of pushed events. * * @param string $event * @return void */ public function flush($event); /** * Remove a set of listeners from the dispatcher. * * @param string $event * @return void */ public function forget($event); /** * Forget all of the queued listeners. * * @return void */ public function forgetPushed();&#125; Illuminate\Events\Dispatcher.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609&lt;?phpnamespace Illuminate\Events;use Exception;use Illuminate\Container\Container;use Illuminate\Contracts\Broadcasting\Factory as BroadcastFactory;use Illuminate\Contracts\Broadcasting\ShouldBroadcast;use Illuminate\Contracts\Container\Container as ContainerContract;use Illuminate\Contracts\Events\Dispatcher as DispatcherContract;use Illuminate\Contracts\Queue\ShouldQueue;use Illuminate\Support\Arr;use Illuminate\Support\Str;use Illuminate\Support\Traits\Macroable;use ReflectionClass;class Dispatcher implements DispatcherContract&#123; use Macroable; /** * The IoC container instance. * * @var \Illuminate\Contracts\Container\Container */ protected $container; /** * The registered event listeners. * * @var array */ protected $listeners = []; /** * The wildcard listeners. * * @var array */ protected $wildcards = []; /** * The cached wildcard listeners. * * @var array */ protected $wildcardsCache = []; /** * The queue resolver instance. * * @var callable */ protected $queueResolver; /** * Create a new event dispatcher instance. * * @param \Illuminate\Contracts\Container\Container|null $container * @return void */ public function __construct(ContainerContract $container = null) &#123; $this-&gt;container = $container ?: new Container; &#125; /** * Register an event listener with the dispatcher. * * @param string|array $events * @param \Closure|string $listener * @return void */ public function listen($events, $listener) &#123; foreach ((array) $events as $event) &#123; if (Str::contains($event, '*')) &#123; $this-&gt;setupWildcardListen($event, $listener); &#125; else &#123; $this-&gt;listeners[$event][] = $this-&gt;makeListener($listener); &#125; &#125; &#125; /** * Setup a wildcard listener callback. * * @param string $event * @param \Closure|string $listener * @return void */ protected function setupWildcardListen($event, $listener) &#123; $this-&gt;wildcards[$event][] = $this-&gt;makeListener($listener, true); $this-&gt;wildcardsCache = []; &#125; /** * Determine if a given event has listeners. * * @param string $eventName * @return bool */ public function hasListeners($eventName) &#123; return isset($this-&gt;listeners[$eventName]) || isset($this-&gt;wildcards[$eventName]) || $this-&gt;hasWildcardListeners($eventName); &#125; /** * Determine if the given event has any wildcard listeners. * * @param string $eventName * @return bool */ public function hasWildcardListeners($eventName) &#123; foreach ($this-&gt;wildcards as $key =&gt; $listeners) &#123; if (Str::is($key, $eventName)) &#123; return true; &#125; &#125; return false; &#125; /** * Register an event and payload to be fired later. * * @param string $event * @param array $payload * @return void */ public function push($event, $payload = []) &#123; $this-&gt;listen($event.'_pushed', function () use ($event, $payload) &#123; $this-&gt;dispatch($event, $payload); &#125;); &#125; /** * Flush a set of pushed events. * * @param string $event * @return void */ public function flush($event) &#123; $this-&gt;dispatch($event.'_pushed'); &#125; /** * Register an event subscriber with the dispatcher. * * @param object|string $subscriber * @return void */ public function subscribe($subscriber) &#123; $subscriber = $this-&gt;resolveSubscriber($subscriber); $events = $subscriber-&gt;subscribe($this); if (is_array($events)) &#123; foreach ($events as $event =&gt; $listeners) &#123; foreach ($listeners as $listener) &#123; $this-&gt;listen($event, $listener); &#125; &#125; &#125; &#125; /** * Resolve the subscriber instance. * * @param object|string $subscriber * @return mixed */ protected function resolveSubscriber($subscriber) &#123; if (is_string($subscriber)) &#123; return $this-&gt;container-&gt;make($subscriber); &#125; return $subscriber; &#125; /** * Fire an event until the first non-null response is returned. * * @param string|object $event * @param mixed $payload * @return array|null */ public function until($event, $payload = []) &#123; return $this-&gt;dispatch($event, $payload, true); &#125; /** * Fire an event and call the listeners. * * @param string|object $event * @param mixed $payload * @param bool $halt * @return array|null */ public function dispatch($event, $payload = [], $halt = false) &#123; // When the given "event" is actually an object we will assume it is an event // object and use the class as the event name and this event itself as the // payload to the handler, which makes object based events quite simple. [$event, $payload] = $this-&gt;parseEventAndPayload( $event, $payload ); if ($this-&gt;shouldBroadcast($payload)) &#123; $this-&gt;broadcastEvent($payload[0]); &#125; $responses = []; foreach ($this-&gt;getListeners($event) as $listener) &#123; $response = $listener($event, $payload); // If a response is returned from the listener and event halting is enabled // we will just return this response, and not call the rest of the event // listeners. Otherwise we will add the response on the response list. if ($halt &amp;&amp; ! is_null($response)) &#123; return $response; &#125; // If a boolean false is returned from a listener, we will stop propagating // the event to any further listeners down in the chain, else we keep on // looping through the listeners and firing every one in our sequence. if ($response === false) &#123; break; &#125; $responses[] = $response; &#125; return $halt ? null : $responses; &#125; /** * Parse the given event and payload and prepare them for dispatching. * * @param mixed $event * @param mixed $payload * @return array */ protected function parseEventAndPayload($event, $payload) &#123; if (is_object($event)) &#123; [$payload, $event] = [[$event], get_class($event)]; &#125; return [$event, Arr::wrap($payload)]; &#125; /** * Determine if the payload has a broadcastable event. * * @param array $payload * @return bool */ protected function shouldBroadcast(array $payload) &#123; return isset($payload[0]) &amp;&amp; $payload[0] instanceof ShouldBroadcast &amp;&amp; $this-&gt;broadcastWhen($payload[0]); &#125; /** * Check if event should be broadcasted by condition. * * @param mixed $event * @return bool */ protected function broadcastWhen($event) &#123; return method_exists($event, 'broadcastWhen') ? $event-&gt;broadcastWhen() : true; &#125; /** * Broadcast the given event class. * * @param \Illuminate\Contracts\Broadcasting\ShouldBroadcast $event * @return void */ protected function broadcastEvent($event) &#123; $this-&gt;container-&gt;make(BroadcastFactory::class)-&gt;queue($event); &#125; /** * Get all of the listeners for a given event name. * * @param string $eventName * @return array */ public function getListeners($eventName) &#123; $listeners = $this-&gt;listeners[$eventName] ?? []; $listeners = array_merge( $listeners, $this-&gt;wildcardsCache[$eventName] ?? $this-&gt;getWildcardListeners($eventName) ); return class_exists($eventName, false) ? $this-&gt;addInterfaceListeners($eventName, $listeners) : $listeners; &#125; /** * Get the wildcard listeners for the event. * * @param string $eventName * @return array */ protected function getWildcardListeners($eventName) &#123; $wildcards = []; foreach ($this-&gt;wildcards as $key =&gt; $listeners) &#123; if (Str::is($key, $eventName)) &#123; $wildcards = array_merge($wildcards, $listeners); &#125; &#125; return $this-&gt;wildcardsCache[$eventName] = $wildcards; &#125; /** * Add the listeners for the event's interfaces to the given array. * * @param string $eventName * @param array $listeners * @return array */ protected function addInterfaceListeners($eventName, array $listeners = []) &#123; foreach (class_implements($eventName) as $interface) &#123; if (isset($this-&gt;listeners[$interface])) &#123; foreach ($this-&gt;listeners[$interface] as $names) &#123; $listeners = array_merge($listeners, (array) $names); &#125; &#125; &#125; return $listeners; &#125; /** * Register an event listener with the dispatcher. * * @param \Closure|string $listener * @param bool $wildcard * @return \Closure */ public function makeListener($listener, $wildcard = false) &#123; if (is_string($listener)) &#123; return $this-&gt;createClassListener($listener, $wildcard); &#125; if (is_array($listener) &amp;&amp; isset($listener[0]) &amp;&amp; is_string($listener[0])) &#123; return $this-&gt;createClassListener($listener, $wildcard); &#125; return function ($event, $payload) use ($listener, $wildcard) &#123; if ($wildcard) &#123; return $listener($event, $payload); &#125; return $listener(...array_values($payload)); &#125;; &#125; /** * Create a class based listener using the IoC container. * * @param string $listener * @param bool $wildcard * @return \Closure */ public function createClassListener($listener, $wildcard = false) &#123; return function ($event, $payload) use ($listener, $wildcard) &#123; if ($wildcard) &#123; return call_user_func($this-&gt;createClassCallable($listener), $event, $payload); &#125; return call_user_func_array( $this-&gt;createClassCallable($listener), $payload ); &#125;; &#125; /** * Create the class based event callable. * * @param array|string $listener * @return callable */ protected function createClassCallable($listener) &#123; [$class, $method] = is_array($listener) ? $listener : $this-&gt;parseClassCallable($listener); if ($this-&gt;handlerShouldBeQueued($class)) &#123; return $this-&gt;createQueuedHandlerCallable($class, $method); &#125; return [$this-&gt;container-&gt;make($class), $method]; &#125; /** * Parse the class listener into class and method. * * @param string $listener * @return array */ protected function parseClassCallable($listener) &#123; return Str::parseCallback($listener, 'handle'); &#125; /** * Determine if the event handler class should be queued. * * @param string $class * @return bool */ protected function handlerShouldBeQueued($class) &#123; try &#123; return (new ReflectionClass($class))-&gt;implementsInterface( ShouldQueue::class ); &#125; catch (Exception $e) &#123; return false; &#125; &#125; /** * Create a callable for putting an event handler on the queue. * * @param string $class * @param string $method * @return \Closure */ protected function createQueuedHandlerCallable($class, $method) &#123; return function () use ($class, $method) &#123; $arguments = array_map(function ($a) &#123; return is_object($a) ? clone $a : $a; &#125;, func_get_args()); if ($this-&gt;handlerWantsToBeQueued($class, $arguments)) &#123; $this-&gt;queueHandler($class, $method, $arguments); &#125; &#125;; &#125; /** * Determine if the event handler wants to be queued. * * @param string $class * @param array $arguments * @return bool */ protected function handlerWantsToBeQueued($class, $arguments) &#123; $instance = $this-&gt;container-&gt;make($class); if (method_exists($instance, 'shouldQueue')) &#123; return $instance-&gt;shouldQueue($arguments[0]); &#125; return true; &#125; /** * Queue the handler class. * * @param string $class * @param string $method * @param array $arguments * @return void */ protected function queueHandler($class, $method, $arguments) &#123; [$listener, $job] = $this-&gt;createListenerAndJob($class, $method, $arguments); $connection = $this-&gt;resolveQueue()-&gt;connection( $listener-&gt;connection ?? null ); $queue = method_exists($listener, 'viaQueue') ? $listener-&gt;viaQueue() : $listener-&gt;queue ?? null; isset($listener-&gt;delay) ? $connection-&gt;laterOn($queue, $listener-&gt;delay, $job) : $connection-&gt;pushOn($queue, $job); &#125; /** * Create the listener and job for a queued listener. * * @param string $class * @param string $method * @param array $arguments * @return array */ protected function createListenerAndJob($class, $method, $arguments) &#123; $listener = (new ReflectionClass($class))-&gt;newInstanceWithoutConstructor(); return [$listener, $this-&gt;propagateListenerOptions( $listener, new CallQueuedListener($class, $method, $arguments) )]; &#125; /** * Propagate listener options to the job. * * @param mixed $listener * @param mixed $job * @return mixed */ protected function propagateListenerOptions($listener, $job) &#123; return tap($job, function ($job) use ($listener) &#123; $job-&gt;tries = $listener-&gt;tries ?? null; $job-&gt;retryAfter = method_exists($listener, 'retryAfter') ? $listener-&gt;retryAfter() : ($listener-&gt;retryAfter ?? null); $job-&gt;timeout = $listener-&gt;timeout ?? null; $job-&gt;timeoutAt = method_exists($listener, 'retryUntil') ? $listener-&gt;retryUntil() : null; &#125;); &#125; /** * Remove a set of listeners from the dispatcher. * * @param string $event * @return void */ public function forget($event) &#123; if (Str::contains($event, '*')) &#123; unset($this-&gt;wildcards[$event]); &#125; else &#123; unset($this-&gt;listeners[$event]); &#125; foreach ($this-&gt;wildcardsCache as $key =&gt; $listeners) &#123; if (Str::is($event, $key)) &#123; unset($this-&gt;wildcardsCache[$key]); &#125; &#125; &#125; /** * Forget all of the pushed listeners. * * @return void */ public function forgetPushed() &#123; foreach ($this-&gt;listeners as $key =&gt; $value) &#123; if (Str::endsWith($key, '_pushed')) &#123; $this-&gt;forget($key); &#125; &#125; &#125; /** * Get the queue implementation from the resolver. * * @return \Illuminate\Contracts\Queue\Queue */ protected function resolveQueue() &#123; return call_user_func($this-&gt;queueResolver); &#125; /** * Set the queue resolver implementation. * * @param callable $resolver * @return $this */ public function setQueueResolver(callable $resolver) &#123; $this-&gt;queueResolver = $resolver; return $this; &#125;&#125; Illuminate\Events\EventServiceProvider.php 1234567891011121314151617181920212223&lt;?phpnamespace Illuminate\Events;use Illuminate\Contracts\Queue\Factory as QueueFactoryContract;use Illuminate\Support\ServiceProvider;class EventServiceProvider extends ServiceProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton('events', function ($app) &#123; return (new Dispatcher($app))-&gt;setQueueResolver(function () use ($app) &#123; return $app-&gt;make(QueueFactoryContract::class); &#125;); &#125;); &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP]]></title>
    <url>%2F2020%2F04%2F02%2FPHP%E5%AE%9E%E7%8E%B0%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F04%2F02%2F%E9%AB%98%E6%80%A7%E8%83%BD%E5%BA%94%E7%94%A8%E7%9A%84%E7%AD%96%E7%95%A5%2F</url>
    <content type="text"><![CDATA[ Listing 5-1 manual.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;?php$time1 = microtime(true);$memory1 = memory_get_usage();$a_string = (function () &#123; $output = ''; for ($counter = 0; $counter &lt; 10; $counter++) &#123; usleep(10); $output .= 'a'; &#125;; return $output;&#125;)(); $memory2 = memory_get_usage();$time2 = microtime(true);$b_string = (function () &#123; $output = ''; for ($counter = 0; $counter &lt; 10; $counter++) &#123; usleep(100); $output .= str_repeat('abc',1000); &#125;; return $output;&#125;)(); $memory3 = memory_get_usage();$time3 = microtime(true);echo "1st function : ".($time2-$time1)." secs, ". ($memory2-$memory1)." bytes\n";echo "2nd function : ".($time3-$time2)." secs, ". ($memory3-$memory2)." bytes\n";echo ("Peak memory usage : ". memory_get_peak_usage()." bytes\n"); Listing 5-2 manual-output.txt 1231st function : 0.0007178783416748 secs, 40 bytes2nd function : 0.0016269683837891 secs, 32768 bytesPeak memory usage : 392504 bytes usleepstr_repeat(abc1000000) WebAPIPhil Karlton  5-3IO monad Listing 5-3 memoize.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106&lt;?php# We're going to cache our results on disk, so let's# define a directory and file prefixdefine('CACHE_PREFIX', sys_get_temp_dir().'/memo-cache-');# This is a helper function to read a cached file# from disk. I've broken it out as a separate function# as it is necessarily impure. You can replace it# with an IO monad or similar in production if you wish$get_value = function($hash) &#123; # return null if the file doesn't exist if (!file_exists(CACHE_PREFIX.$hash)) &#123; return null; &#125; # read the file into $value $value = file_get_contents(CACHE_PREFIX.$hash); # return null if the file exists but couldn't be read if ($value === false) &#123; return null; &#125; # return our value if all is good return $value;&#125;;# Likewise, this is an impure helper function to write# the value to a cache file.$store_value = function($hash, $value) &#123; if (file_put_contents(CACHE_PREFIX.$hash, $value) === false) &#123; $value = null; &#125; # return the value that was stored, or null if the # storage failed return $value;&#125;;# Finally, this is our actual memoization function.# It returns a closure which is a "memoized" version# of the function you call it on, i.e. a version# of your function which automatically caches return# values and automatically uses those cached values# without further coding from you.# $func is the function (closure or other callable) that# you want to memoize$memoize = function($func) use ($get_value, $store_value)&#123; # We're returning a memoized function return function() use ($func, $get_value, $store_value) &#123; # Get the parameters you (the end user) call # your memoized function with $params = func_get_args(); # Get a unique hash of those parameters, to # use as our cache's key. We needs to convert # the params array to a string first, we use # json_encode rather than serialize here as # it is a lot faster in most cases $hash = sha1( json_encode( $params ) ); # Check the cache for any return value that # has already been cached for that particular # set of input parameters (as identified by # its hash) $value = $get_value($hash); # If there was no pre-cached version available, # $value will be null. We check this with the ?? # null coalescing operator, returning either : # a) the cached $value if it's not null, or # b) the results of actually calling the user # function. Note that we wrap the call in the # $store_value function to cache the results, # and $store_value passes the value back # through as its result and so it is also # returned to the user in this case return $value ?? $store_value( $hash, call_user_func_array($func, $params) ); &#125;;&#125;; JSON implode |$ params 12func("Hello","|There");func("Hello|","There"); Hello || TherePHPserializejson_encodeserializePHPJSONSHA1 MD5SHA1call_user_func_arraypureintpureint 10, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, 10946 and so on nn$fibonacci7131370$ memoize $ memoize  PCusleep  5-45-5 Listing 5-4 memo_example.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;?php# Get our memoize function and helpersrequire('memoize.php');# Define a plain old recursive fibonacci function$fibonacci = function ($n) use (&amp;$fibonacci) &#123; usleep(100000); # make this time-expensive! return ($n &lt; 2) ? $n : $fibonacci($n - 1) + $fibonacci($n - 2); &#125;;# Define the same fibonacci function again in exactly the# same way (except for the name), but this time wrap the# function body in a call to $memoize to get a memoized version$memo_fibonacci = $memoize( function ($n) use (&amp;$memo_fibonacci) &#123; usleep(100000); return ($n &lt; 2) ? $n : $memo_fibonacci($n - 1) + $memo_fibonacci($n - 2); &#125;);# Let's define a timer function, to time a run of a function,# and return the parameters, results and timings.$timer = function($func, $params) &#123; $start_time = microtime(true); $results = call_user_func_array($func, $params); $time_taken = round(microtime(true) - $start_time, 2); return [ "Param" =&gt; implode($params), "Result" =&gt; $results, "Time" =&gt; $time_taken ];&#125;;# And now let's do a set of runs of both our# ordinary function and it's memoized sister.# I've added an extra * parameter to the# non-memoized runs so that you can spot them# easier in the output (the '*' isn't used# by the fibonacci functions, it's just passed# through to the output of the timer function)print_r( $timer( $fibonacci, [6, '*'] ) );print_r( $timer( $memo_fibonacci, [6] ) );print_r( $timer( $fibonacci, [6, '*'] ) );print_r( $timer( $memo_fibonacci, [6] ) );print_r( $timer( $memo_fibonacci, [10] ) );print_r( $timer( $memo_fibonacci, [11] ) );print_r( $timer( $memo_fibonacci, [8] ) ); Listing 5-5. memo_example-output.txt 123456789101112131415161718192021222324252627282930313233343536373839404142Array( [Param] =&gt; 6* [Result] =&gt; 8 [Time] =&gt; 2.5)Array( [Param] =&gt; 6 [Result] =&gt; 8 [Time] =&gt; 0.7)Array( [Param] =&gt; 6* [Result] =&gt; 8 [Time] =&gt; 2.5)Array( [Param] =&gt; 6 [Result] =&gt; 8 [Time] =&gt; 0)Array( [Param] =&gt; 10 [Result] =&gt; 55 [Time] =&gt; 0.4)Array( [Param] =&gt; 11 [Result] =&gt; 89 [Time] =&gt; 0.1)Array( [Param] =&gt; 8 [Result] =&gt; 21 [Time] =&gt; 0) 5-52.50.762.5600.461231078910110.180100/ tmp / memo-cache- *5-61211012 Listing 5-6. cache_files.txt 123456789101112131415161718192021222324252627282930313233343536::::::::::::::/tmp/memo-cache-10ae24979c5028fa873651bca338152dc04842455::::::::::::::/tmp/memo-cache-1184f5b8d4b6dd08709cf1513f26744167065e0d0::::::::::::::/tmp/memo-cache-1fb0856518ee0490ff78e43d1b6dae12ad6ec68621::::::::::::::/tmp/memo-cache-2499831338ca5dc8c44f3d063e076799bea9bdff1::::::::::::::/tmp/memo-cache-3ad009a144b1e8e065a75ca775c76b2fc2e5ff7689::::::::::::::/tmp/memo-cache-4a0a63ce33cc030f270c607ea7bf90a6717572bb8::::::::::::::/tmp/memo-cache-7a60554107407bfe358bedce2bfcb95c90a8ea0d34::::::::::::::/tmp/memo-cache-8f4e345e7cd51e4e633816f5a52a47df465da1893::::::::::::::/tmp/memo-cache-bd703dc0b11593277a5a82dd893f2880b8d0f32a13::::::::::::::/tmp/memo-cache-e9310b0c165be166c43d717718981dd6c9379fbe55::::::::::::::/tmp/memo-cache-f1e31df9806ce94c5bdbbfff9608324930f4d3f12::::::::::::::/tmp/memo-cache-f629ae44b7b3dcfed444d363e626edf411ec69a81   PHP 5-75-8$ sta$ glo$ $ nor Listing 5-7. static.php 123456789101112131415161718192021222324&lt;?php$my_func = function ($par) &#123; static $sta; global $glo; var_dump( "static : ". $sta += 1 ); var_dump( "global : ". $glo += 1 ); var_dump( "param : ". $par += 1 ); var_dump( "normal : ". $nor += 1 ); return $sta;&#125;;while ( $my_func(1) &lt; 5) &#123; echo "-----\n"; &#125;;echo "*****\n";var_dump( "static : ". $sta );var_dump( "global : ". $glo );var_dump( "param : ". $par );var_dump( "normal : ". $nor ); Listing 5-8. static-output.txt 1234567891011121314151617181920212223242526272829string(10) &quot;static : 1&quot;string(10) &quot;global : 1&quot;string(10) &quot;param : 2&quot;string(10) &quot;normal : 1&quot;-----string(10) &quot;static : 2&quot;string(10) &quot;global : 2&quot;string(10) &quot;param : 2&quot;string(10) &quot;normal : 1&quot;-----string(10) &quot;static : 3&quot;string(10) &quot;global : 3&quot;string(10) &quot;param : 2&quot;string(10) &quot;normal : 1&quot;-----string(10) &quot;static : 4&quot;string(10) &quot;global : 4&quot;string(10) &quot;param : 2&quot;string(10) &quot;normal : 1&quot;-----string(10) &quot;static : 5&quot;string(10) &quot;global : 5&quot;string(10) &quot;param : 2&quot;string(10) &quot;normal : 1&quot;*****string(9) &quot;static : &quot;string(10) &quot;global : 5&quot;string(9) &quot;param : &quot;string(9) &quot;normal : &quot; 1my_func$sta     5-9  Listing 5-9. memoize-mem.php 12345678910111213141516&lt;?php$memoize = function($func)&#123; return function() use ($func) &#123; static $cache; $params = func_get_args(); $hash = sha1( json_encode( $params ) ); $cache["$hash"] = $cache["$hash"] ?? call_user_func_array($func, $params); return $cache["$hash"]; &#125;;&#125;; $ cachestatic memoize-example.php5-10 Listing 5-10. memo_mem_example-output.txt 123456789101112131415161718192021222324252627282930313233343536373839404142Array( [Param] =&gt; 6* [Result] =&gt; 8 [Time] =&gt; 2.51)Array( [Param] =&gt; 6 [Result] =&gt; 8 [Time] =&gt; 0.7)Array( [Param] =&gt; 6* [Result] =&gt; 8 [Time] =&gt; 2.51)Array( [Param] =&gt; 6 [Result] =&gt; 8 [Time] =&gt; 0)Array( [Param] =&gt; 10 [Result] =&gt; 55 [Time] =&gt; 0.4)Array( [Param] =&gt; 11 [Result] =&gt; 89 [Time] =&gt; 0.1)Array( [Param] =&gt; 8 [Result] =&gt; 21 [Time] =&gt; 0) I / O0.1RAMLinuxtmpfsPHP tmpfsI / OPHPtmpfsPHPRAMLinuxtmpfs5-11shell5-12tmpfs RAM Listing 5-11. ramdisk.sh 1234567#!/usr/bin/env bashmkdir /tmp/myMemoryDrivesudo mount -t tmpfs /mnt/tmpfs /tmp/myMemoryDrivephp -r "file_put_contents('/tmp/myMemoryDrive/test.txt',\"Hello\n\");"cat /tmp/myMemoryDrive/test.txtsudo umount /mnt/tmpfscat /tmp/myMemoryDrive/test.txt Listing 5-12. ramdisk-output.txt 12Hellocat: /tmp/myMemoryDrive/test.txt: No such file or directory 5-11/ tmp / myMemoryDrivePHPHellomounttmpfsfstabtmpfstmpfsLinuxtmpfstmpfsWindowsRAMGUIWikipedia I / OAPIID/SAN PHP  1if ( do_something_easy() OR do_something_hard() ) &#123; return &#125; do_something_easydo_something_hardtruetruedo_something_easytruedo_something_harddo_something_easyfalsePHP array_filter1010010filterarray_slice10010 PHPPHP 5.5 array_filter some_function(); array_filter another_function(); array_slice 0, 10;   lazy_filter some_function(); lazy_filter another_function(); lazy_slice 0, 10; lazy_slice sliceanother_functionsome_functionlazy_slicelazy_filterPC5-13 Listing 5-13 repeat.php 12345678910111213&lt;?php// // $ args$func $n$repeat = function ($func, $n, ...$args) &#123; for ($i=0; $i &lt; $n; $i++) &#123; $result = $func(...$args); &#125; return $result;&#125;; 5-145-15yieldreturn yieldPHPrange$ start$ end$ step gen_range 11000123 Listing 5-14 generators.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;?php# Get our repeat functionrequire('repeat.php');# PHP's native function range() takes a# $start int, $end in and $step value, and# returns an array of ints from $start to $end# stepping up by $step each time. We'll create# a generator version that takes the same# parameters and does the same task, called gen_range()function gen_range($start, $end, $step) &#123; for ($i = $start; $i &lt;= $end; $i += $step) &#123; # yield turns this function into a generator yield $i; &#125;&#125;;# We'll create a function to run either range() or# gen_range() (as specified in $func) with the# same paramters, and to iterate through the# returned values until we find a number exactly# divisible by 123 (which in this case is 369)$run = function ($func) &#123; # Get a range from 1 to ten million in steps of 4, # so 1,4,9,13,18,...,9999989,9999993,9999997 foreach ( $func(1, 10000000, 4) as $n ) &#123; if ($n % 123 == 0) &#123; # exit the function once we've found one, reporting # back the memory in use (as it will be freed once # we have returned). return memory_get_usage(); &#125;; &#125;;&#125;;# A function to get the time/memory use for the runs$profile = function ($func, ...$args) &#123; $start = [ "mem" =&gt; memory_get_usage(), "time" =&gt; microtime(true) ]; $end = [ "mem" =&gt; $func(...$args), "time" =&gt; microtime(true) ]; return [ "Memory" =&gt; $end["mem"] - $start["mem"], "Time" =&gt; $end["time"] - $start["time"] ];&#125;;# Finally let's run each of range() and gen_range() 100 times,# and output the time taken for each and memory usedEcho "*** range() ***\n";print_r ( $profile($repeat, $run, 100, 'range') );Echo "*** gen_range() ***\n";print_r ( $profile($repeat, $run, 100, 'gen_range') ); Listing 5-15. generators-output.txt 123456789101112*** range() ***Array( [Memory] =&gt; 134222280 [Time] =&gt; 8.9564578533173)*** gen_range() ***Array( [Memory] =&gt; 4952 [Time] =&gt; 0.0016660690307617) rangerangeforeachgen_range gen_range369range$ runmemory_get_usage605-165-17 Listing 5-16. filter.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192&lt;?php# Borrow some functions from Chapter 3,# and our repeat functionrequire('../Chapter 3/compose.php');require('../Chapter 3/partial_generator.php');require('repeat.php');# A helper function to fix parameters from the right,# as we'll otherwise call partial(reverse()) a lot below.$partial_right = function ($func, ...$params) &#123; return partial(reverse($func), ...$params);&#125;;# Get the start time, to see how long the script takes$start_time = microtime(true);# A function to return true if $word is in $str# (not comprehensive, but matches a word bounded# by non-A-Z chars, so matches "hero" but not "heroes")$match_word = function($word, $str) &#123; return preg_match("/[^a-z]$&#123;word&#125;[^a-z]/i", $str);&#125;;# A function to return true if $str is longer than $len chars$longer_than = function($len, $str) &#123; return strlen($str) &gt; $len;&#125;;# A partial function, fixing hero as the word to search for$match_hero = partial($match_word, 'hero');# Another partial function, picking out strings longer than 60 chars$over_sixty = partial($longer_than, 60);# A partial function which uses array_filter to apply $match_hero# to all elements of an array and return only those with 'hero' in$filter_hero = $partial_right('array_filter', $match_hero );# Similarly, we'll filter an array with the $over_sixty function$filter_sixty = $partial_right('array_filter', $over_sixty );# A function to grab the first 3 elements from an array$first_three = $partial_right('array_slice', 3, 0);# Let's now compose the function above to create a# function which grabs the first three long# sentences mentioning hero.$three_long_heros = compose( $filter_hero, $filter_sixty, $first_three );# Finally, let's actually call our composed function 100 times# on the contents of all_shakespeare.txt# Note that calling file() as a parameter means that it is# only evaluated once (and not 100 times), so the time for disk# IO won't be a major element of our timings$result = $repeat( $three_long_heros, file('all_shakespeare.txt'), 100 );# Print out the result of the last call (which should be the# same as all of the rest, as all of our composed functions are# pure and are called on exactly the same input parameter)print_r($result);# and the time takenecho 'Time taken : '.(microtime(true) - $start_time); Listing 5-17. filter-output.txt 12345678Array([0] =&gt; Enter DON PEDRO, DON JOHN, LEONATO, FRIAR FRANCIS, CLAUDIO, BENEDICK, HERO,BEATRICE, and Attendants[1] =&gt; Sweet Hero! She is wronged, she is slandered, she is undone.[2] =&gt; Think you in your soul the Count Claudio hath wronged Hero?)Time taken : 6.2691030502319 1006 5-185-19 Listing 5-18. lazy_filter.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110&lt;?php# Again we'll borrow some functions from Chapter 3,# and our repeat functionrequire('../Chapter 3/compose.php');require('../Chapter 3/partial_generator.php');require('repeat.php');# and start timing$start_time = microtime(true);# We'll now define a lazy version of array_filter, using# a generator (note the yield statement)$lazy_filter = function ($func, $array) &#123;# Loop through the array foreach ($array as $item) &#123; # Call the function on the array item, and # if it evaluates to true, return the item if ( $func($item) ) &#123; yield $item; &#125; &#125;;&#125;;# The following functions are exactly the same as# in the non-lazy filter.php example$match_word = function($word, $str) &#123; return preg_match("/[^a-z]$&#123;word&#125;[^a-z]/i", $str);&#125;;$longer_than = function($len, $str) &#123; return strlen($str) &gt; $len;&#125;;$match_hero = partial($match_word, 'hero');$over_sixty = partial($longer_than, 60);# Our $filter_hero function is almost the same,# but note that it calls $lazy_filter instead of# array_filter (and it uses partial() rather than# $partial_right, as I've implemented $lazy_filter# with the parameters in the opposite order to# array_filter.$filter_hero = partial($lazy_filter, $match_hero );# Again $filter_sixty uses $lazy_filter rather than array_filter$filter_sixty = partial($lazy_filter, $over_sixty );# As the output from filter_sixty will be a generator object# rather than an array, we can't use array_slice to# get the first three items (as data doesn't exist in a# generator until you call for it). Instead, we'll create# a $gen_slice function which calls the generator $n times# and returns the $n returned values as an array. We'll take# advantage of that fact that a generator is an iterable object,# and so has current() and next() methods to get each value.# We'll practice our recursion, rather than just using# a for loop!$gen_slice = function ($n, $output = [], $generator) use (&amp;$gen_slice) &#123; $output[] = $generator-&gt;current(); $generator-&gt;next(); if ($n &gt; 1) &#123; $output = $gen_slice(--$n, $output, $generator); &#125;return $output;&#125;;# $first_three uses $gen_slice rather than array_slice$first_three = partial($gen_slice, 3, []);# We'll compose them together, repeatedly call them# and output the results using exactly the same# code as in the non-lazy version$three_long_heros = compose( $filter_hero, $filter_sixty, $first_three );$result = $repeat( $three_long_heros, file('all_shakespeare.txt'), 100 );print_r($result);echo 'Time taken : '.(microtime(true) - $start_time); Listing 5-19. lazy_filter-output.txt 12345678Array([0] =&gt; Enter DON PEDRO, DON JOHN, LEONATO, FRIAR FRANCIS, CLAUDIO, BENEDICK, HERO,BEATRICE, and Attendants[1] =&gt; Sweet Hero! She is wronged, she is slandered, she is undone.[2] =&gt; Think you in your soul the Count Claudio hath wronged Hero?)Time taken : 2.1842160224915 2  lazy_filter PHPforeach gen_slicecurrentnext PHP compose     generators.php12399999895-205-21 Listing 5-20. generators2-output.txt 123456789101112*** range() ***Array( [Memory] =&gt; 134222280 [Time] =&gt; 26.05708694458)*** gen_range() ***Array( [Memory] =&gt; 4952 [Time] =&gt; 41.604923009872) range26gen_range419999989foreachrangePHPPHPC  123  PC/PHPPHPPHP PHPparallel.phpclient.phpfunctions.php100 Listing 5-21. parallel.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374&lt;?php# Get a set of functions that we'll look at shortlyrequire('functions.php');# The text to work on.$shakespeare = file_get_contents('all_shakespeare.txt');# How many times we're going to run each function, for# benchmarking purposes$repeats = 100;# Compose our single process "standard" function.$analyze_single = compose( $only_letters_and_spaces, # simplify the text 'strtolower', # all lowercase, please $analyze_words, # do the analysis $sort_results, # sort the results 'array_reverse', # get the results in descending order $top_ten # return the top ten results);# Run the single process version $repeats time on $shakespeare input# Time the runs$checkpoint1 = microtime(true);print_r( $repeat($analyze_single, $repeats, $shakespeare) );$checkpoint2 = microtime(true);# Now create a parallel process version$analyze_parallel = compose ( $launch_clients, # Launch a set of client processes to do # the analysis $report_clients, # Tell us how many clients were launched $get_results, # Get the results back from the clients $combine_results, # Combine their results into one set $sort_results, # sort the combined results 'array_reverse', # get the results in descending order $top_ten # return the top ten results);# Run the parallel version and time it$checkpoint3 = microtime(true);print_r ( $repeat($analyze_parallel, $repeats, $shakespeare) );$checkpoint4 = microtime(true);# Finally, dump the timings for comparisonvar_dump( 'Single : '.($checkpoint2 - $checkpoint1));var_dump( 'Parallel : '.($checkpoint4- $checkpoint3)); $ analyse_parallel$ launch_clients5-22 Listing 5-22. client.php 1234567891011121314151617181920212223242526272829303132333435&lt;?phprequire('functions.php');# Get the chunk of text for the client to analyze# by reading the contents of STDIN which are piped to# this script by the fwrite($clients[$key]["pipes"][0], $string)# line in the $launch_clients function in the parent process$string = stream_get_contents(STDIN);# Compose a function to do the analysis. This is the same# as the first three steps of the single process analysis# function, with a step to encode the results as JSON at# the end so we can safely pass them back$client_analyze = compose( $only_letters_and_spaces, 'strtolower', $analyze_words, 'json_encode');# Run the function and write the results to STDOUT,# which will be read by the stream_get_contents($client["pipes"][1])# line in the $get_results function in the parent process. In most cases# you can use echo to write to STDOUT, but sometimes it can be# redirected, and so explicitly writing like this is better practicefwrite(STDOUT, $client_analyze($string) ); 5-23functions.php  Listing 5-23. functions.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225&lt;?php# Borrow some utility functions from previous examplesrequire('../Chapter 3/compose.php');require('repeat.php');# To simplify our analysis, replace anything that's not# a letter with a space.$only_letters_and_spaces = function($string) &#123; return preg_replace('/[^A-Za-z]+/', ' ', $string);&#125;;# This is the "expensive" deliberately un-optimized function# that does our "analysis".$analyze_words = function ($string) &#123; # Split our text into an array, one word per element $array = preg_split('/ /i', $string, -1, PREG_SPLIT_NO_EMPTY); # Filter our array for words that... $filtered = array_filter($array, function ($word) &#123; return ( # ... contain any of the letters from the word shakespeare preg_match('/[shakespeare]/', $word) != false) # ... AND has at least 1 character in common with this sentence &amp;&amp; (similar_text($word, 'William is the best bard bar none') &gt; 1) # ... AND sound like the word "bard" &amp;&amp; (metaphone($word) == metaphone('bard')) # ... AND have more than three characters in them &amp;&amp; ( (strlen($word) &gt; 3 ) ); &#125;); # Finally, count up the number of times each of the filtered # words appears in the analyzed text, and return that return array_count_values($filtered);&#125;;# Slice the top 10 items off the top of the array$top_ten = function ($array) &#123; return array_slice($array, 0 ,10);&#125;;# Sort the results numerically# asort mutates the array, so we wrap it in a function$sort_results = function($array) &#123; asort($array, SORT_NUMERIC); return $array;&#125;;# The following functions manage the execution of parallel client scripts# A function to split the text into chunks and launch the# appropriate number of clients to process it$launch_clients = function ($string) &#123; # Split the string into chunks of 1 million characters, # a value which I found by trial and error to give the # best results on this machine for this process $strings = str_split($string, 1000000); # An array to hold the resource identifiers for the client scripts $clients = []; # Descriptors for "pipes" to read/write the data to/from our client # scripts $descriptors = [ 0 =&gt; ["pipe", "r"], #STDIN, to get data 1 =&gt; ["pipe", "w"] #STDOUT, to send data ]; # Iterate through the chunks... foreach ($strings as $key =&gt; $string) &#123; # $key will be the array index, 0, 1, 2, 3... etc. # We'll use it as a handy way to number our clients # Define the command that runs the client $command = "php client.php"; # Open the clients with proc_open. This returns a resource identifier. # We'll store it, although our script won't actually use it. $clients[$key]["resource"] = proc_open( $command, $descriptors, $clients[$key]["pipes"] ); # Note the third parameter above is a variable passed by reference. # This is used by proc_open to store an array of file pointers # identifying PHP's end of the pipes that are created. # We use that info here to write our text chunk to. This writes # it to STDOUT, and our client script reads it in through STDIN # at its end of the pipe. fwrite($clients[$key]["pipes"][0], $string); # Close the pipe now we're done writing to this client. fclose($clients[$key]["pipes"][0]); &#125;; # Once all of the clients have been launched, return their # resource identifiers and pipe details return $clients;&#125;;# Simple impure function to report how many clients were# launched. You could use a writer monad instead if you wanted$report_clients = function ($clients) &#123; # The escape code at the end minimizes our output when # when running the script many times, by going up one line # and overwriting the output each time. echo("Launched ".sizeof($clients)." clients\n\033[1A"); return $clients;&#125;;# A function to get the results back from the clients.# The clients will send a JSON encoded array back to us$get_results = function ($clients) &#123; # An array to gather the results. Each clients' result # will be stored as an element of the array $results = []; # Iterate through the client resource identifiers foreach ($clients as $key =&gt; $client) &#123; # Clients write output to STDOUT, which corresponds to the # STDIN Pipe at our end. We'll read that JSON data and # decode it to a PHP array. Each client's results will be # stored as a separate element of the $results array. $results[] = json_decode( stream_get_contents($client["pipes"][1]), true); # We've done reading from the client, so we can close the pipe. fclose($clients[$key]["pipes"][1]); &#125;; # And finally return all of the results from all of the clients return $results;&#125;;# This function takes the results array from $get_results above and# combines it into a single array$combine_results = function ($results) &#123;# Reduce and return the input array by... return array_reduce($results, function($output, $array) &#123; #... iterating over each individual clients results array # and either creating or adding the count for each word to # the output depending on whether that word already exists in # the output foreach ($array as $word =&gt; $count) &#123; isset($output[$word]) ? $output[$word] += $count : $output[$word] = $count ; &#125; # return $output through to the next iteration of array_reduce return $output; &#125;, []); # starting with a blank array [] as output&#125;; parallel.php5-24 Listing 5-24. parallel-output.txt 1234567891011121314151617181920212223242526272829Array( [beard] =&gt; 76 [bright] =&gt; 43 [buried] =&gt; 43 [bred] =&gt; 36 [breed] =&gt; 35 [bird] =&gt; 34 [bride] =&gt; 30 [broad] =&gt; 15 [bread] =&gt; 15 [board] =&gt; 15)Launched 4 clientsAArray( [beard] =&gt; 76 [bright] =&gt; 43 [buried] =&gt; 43 [bred] =&gt; 36 [breed] =&gt; 35 [bird] =&gt; 34 [bride] =&gt; 30 [broad] =&gt; 15 [bread] =&gt; 15 [board] =&gt; 15)string(24) &quot;Single : 48.808692932129&quot;string(25) &quot;Parallel : 25.10250711441&quot;   $ analyze_words PHP 100,000385-25 Listing 5-25. parallel-output2.txt 1234567891011121314151617181920212223242526272829Array( [beard] =&gt; 76 [bright] =&gt; 43 [buried] =&gt; 43 [bred] =&gt; 36 [breed] =&gt; 35 [bird] =&gt; 34 [bride] =&gt; 30 [broad] =&gt; 15 [bread] =&gt; 15 [board] =&gt; 15)Launched 38 clientsArray( [beard] =&gt; 76 [bright] =&gt; 43 [buried] =&gt; 43 [bred] =&gt; 36 [breed] =&gt; 35 [bird] =&gt; 34 [bride] =&gt; 30 [broad] =&gt; 15 [bread] =&gt; 15 [board] =&gt; 15)string(24) &quot;Single : 49.230798959732&quot;string(26) &quot;Parallel : 145.74519586563&quot; array_filterPHPpreg_matchstrlenmetaphonebardstrpbrk PHPpreg_match   PHPPthreads PthreadsOOPPthreadsPHPPHP LinuxPHPPHPAWindowsPHPPthreads PHPSPLPHPPHPSPLPHPPHPPHPSPLSplFixedArraySPL SPL 5-26iterator_to_arraySplFixedArrayFilterIterator Listing 5-26. spl.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152&lt;?php# Borrow our simple generator examplefunction gen_range($start, $end, $step) &#123; for ($i = $start; $i &lt;= $end; $i += $step) &#123; yield $i; &#125;&#125;;# Call the generator...$gen_obj = gen_range(1,10,1);# ... and check what we have is a generator objectprint_r($gen_obj);# Generators are iterators, so when we need a full array# of data instead of a generator, we can convert# it to an array using SPL's iterator_to_array function$array = iterator_to_array($gen_obj);print_r($array);# An SplFixedArray is SPLs fixed size array data structure.# Let's create an empty SPL fixed array and a standard PHP array.# Note we need to specify a size for the SPL array$spl_array = new SplFixedArray(10000);$std_array = [];# Let's create a function to fill an array with data. As both# array types can be written to in the same way, we can# use the same function here for both$fill_array = function($array, $i = 0) use (&amp;$fill_array) &#123; # recursively fill the $array with data if ($i &lt; 10000) &#123; $array[$i] = $i * 2; return $fill_array($array, ++$i); &#125;; return ($array);&#125;;# Let's do some operations with the arrays. We'll measure# the memory in use before and after each operation.$mem1 = memory_get_usage();# Fill the standard array with data$std_array = $fill_array($std_array);$mem2 = memory_get_usage(); # 528384 bytes# Fill the SPL array with data$spl_array = $fill_array($spl_array);$mem3 = memory_get_usage(); # 0 bytes# It took no memory to fill!# This is because this type of array allocates all of its memory# up-front when you create it# Create a new SPL array and fill with data$spl_array2 = new SplFixedArray(10000);$spl_array2 = $fill_array($spl_array2);$mem4 = memory_get_usage(); # 163968 bytes# This time it did, as we declared it within the section we# were measuring# Create a new empty standard array$std_array2 = [];$mem5 = memory_get_usage(); # 56 bytes - a small amount# Create a new empty SPL array$spl_array3 = new SplFixedArray(10000);$mem6 = memory_get_usage(); # 163968 bytes - for an empty array!# This shows that you need to use it with care. A Standard# array may use more memory for the same amount of data, but# the memory also shrinks with the array contents too.echo "Filled Standard Array : ".($mem2 - $mem1). " bytes \n";echo "1st Filled SPLFixedArray : ".($mem3 - $mem2). " bytes \n";echo "2nd Filled SPLFixedArray : ".($mem4 - $mem3). " bytes \n";echo "Empty Standard Array : ".($mem5 - $mem4). " bytes \n";echo "Empty SPLFixedArray : ".($mem6 - $mem5). " bytes \n";# The SPL provides various iterator classes that you can extend# to work with iterable structures like the SPLFixedArray and# generators# Let's create a class to filter for values that are divisible by threeclass by_three extends FilterIterator &#123; # We extend the FilterIterator class, and implement the accept() class # with our filtering function public function accept() &#123; $value = $this-&gt;current(); if ($value % 3 == 0) &#123; # return true to include the value in the output return true; &#125; # or false to filter it out return false; &#125;&#125;;# Let's use it to filter our previous SPL array$nums = new by_three($spl_array);var_dump(iterator_count($nums)); # int(3334) (~third of the array is returned)   ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F03%2F31%2F%E5%9C%A8%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%92%8C%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[    PHPreferential transparency math function  y=f(x)sin  0 f(x)=x/2 f(10)  100  1000  5.  1234int counter = 0;int count()&#123; return ++counter;&#125;  referential transparency   mapkeyvalue  OO7-1  7-1 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;?php# Create a class to encapsulate a valueclass my_class&#123; # The value we want to encapsulate private $value = 0; # Constructor to set the value (or default to -1) public function __construct($initial_value = -1) &#123; $this-&gt;value = $initial_value; &#125; # Method to get the value public function get_value() &#123; return $this-&gt;value; &#125; # Method to set the value public function set_value($new_value) &#123; $this-&gt;value = $new_value; &#125;&#125;# Let's create a new object with a value of 20$my_object = new my_class(20);# Check the valuevar_dump ($my_object-&gt;get_value()); # int(20)# Demonstrate we can mutate the value to 30$my_object-&gt;set_value(30);var_dump ($my_object-&gt;get_value()); # int (30)# Now let's create a function which doubles the value# of the object. Note that the function parameter# doesn't have a "&amp;" to indicate it's passed by reference$double_object = function ($an_object) &#123; # Get the value from $an_object, double it and set it back $an_object-&gt;set_value( $an_object-&gt;get_value() * 2 ); # return the object return $an_object;&#125;;# Now we call the function on our $my_object object from# above, and assign the returned object to a new variable$new_object = $double_object($my_object);# Check that the returned object has double the value (30)# of the object we passed in as a parametervar_dump( $new_object-&gt;get_value() ); # int(60)# Let's just check the value on the original objectvar_dump( $my_object-&gt;get_value()); # int(60)# It's also changed. Let's var_dump the original object# and returned object, and check their object reference number# (look for the number after the #)var_dump ($my_object); # #1var_dump ($new_object); # #1# They're both the same. Just for clarity, create a new# object from scratch and check it's reference number$last_object = new my_class();var_dump ($last_object); # #3 (#2 was our closure object $double_object) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;?php# use our trusty compose functioninclude('../Chapter 3/compose.php');# The same class as before, but with an added static methodclass new_class&#123; private $value = 0; public function __construct($initial_value = -1) &#123; $this-&gt;value = $initial_value; &#125; public function get_value() &#123; return $this-&gt;value; &#125; public function set_value($new_value) &#123; $this-&gt;value = $new_value; &#125; # a static method to halve the provided value public static function halve($value) &#123; return $value / 2; &#125;&#125;# Let's create a new object with an initial value of 25$my_object = new new_class(73.4);# Let's stack some math functions together including our# static method above$do_math = compose ( 'acosh', 'new_class::halve', 'floor');# Now let's actually do the math. We set the object value# to the result of $do_math being called on the original value.$my_object-&gt;set_value( $do_math( $my_object-&gt;get_value() ) );# Show that our object value has been changed. Note that nothing changed# while we were in our functional (compose) code.var_dump ( $my_object-&gt;get_value() ); # float(2) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&lt;?php# use our trusty compose functioninclude('../Chapter 3/compose.php');# The same class as previouslyclass my_class&#123; private $value = 0; public function __construct($initial_value = -1) &#123; $this-&gt;value = $initial_value; &#125; public function get_value() &#123; return $this-&gt;value; &#125; public function set_value($new_value) &#123; $this-&gt;value = $new_value; &#125;&#125;# A function to triple the value of the object$triple_object = function ($an_object) &#123; # First clone it to make sure we don't mutate the object that # $an_object refers to $cloned_object = clone $an_object; # Then set the value to triple the current value $cloned_object-&gt;set_value( $cloned_object-&gt;get_value() * 3 ); # and return the new object return $cloned_object;&#125;;# A function to multiply the value of the object by Pi.# Again we clone the object first and return the mutated clone$multiply_object_by_pi = function ($an_object) &#123; $cloned_object = clone $an_object; $cloned_object-&gt;set_value( $cloned_object-&gt;get_value() * pi() ); return $cloned_object;&#125;;# Let's create an object encapsulating the value 10.$my_object = new my_class(10);# We'll compose the above functions together$more_maths = compose( $triple_object, $multiply_object_by_pi, $triple_object);# and then call that composition on our object.var_dump ( $more_maths($my_object) );# Let's check our original object remains unchangedvar_dump ($my_object); 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150&lt;?php# Create a class to represent an immutable array# Make the clas "final" so that it can't be extended to add# methods to mutate our arrayfinal class const_array &#123; # Our array property, we use a private property to prevent # outside access private $stored_array; # Our constructor is the one and only place that we set the value # of our array. We'll use a type hint here to make sure that we're # getting an array, as it's the only "way in" to set/change the # data, our other methods can be sure they are then only dealing # with an array type public function __construct(array $an_array) &#123; # PHP allows us to call the __construct method of an already created # object whenever we want as if it was a normal method. We # don't want this, as it would allow our array to be over written # with a new one, so we'll throw an exception if it occurs if (isset($this-&gt;stored_array)) &#123; throw new BadMethodCallException( 'Constructor called on already created object' ); &#125;; # And finally store the array passed in as our immutable array. $this-&gt;stored_array = $an_array; &#125; # A function to get the array public function get_array() &#123; return $this-&gt;stored_array; &#125; # We don't want people to be able to set additional properties on this # object, as it de facto mutates it by doing so. So we'll throw an # exception if they try to public function __set($key,$val) &#123; throw new BadMethodCallException( 'Attempted to set a new property on immutable class.' ); &#125; # Likewise, we don't want people to be able to unset properties, so # we'll do the same again. As it happens, we don't have any public # properties, and the methods above stop the user adding any, so # it's redundant in this case, but here for completeness. public function __unset($key) &#123; throw new BadMethodCallException( 'Attempted to unset a property on immutable object.' ); &#125;&#125;# Let's create a normal array$mutable_array = ["country" =&gt; "UK", "currency" =&gt; "GBP", "symbol" =&gt; ""];# and create an const_array object from it$immutable_array = new const_array($mutable_array);var_dump ($immutable_array);# Let's mutate our original array$mutable_array["currency"] = "EURO";# our const_array is unaffectedvar_dump ($immutable_array);# We can read the array values like normalforeach ( $immutable_array-&gt;get_array() as $key =&gt; $value) &#123; echo "Key [$key] is set to value [$value] \n\n";&#125;;# And use dereferencing to get individual elementsecho "The currency symbol is ". $immutable_array-&gt;get_array()["symbol"]."\n\n";# Need to copy it? Just clone it like any other object, and the methods# which make it immutable will be cloned too.$new_array = clone $immutable_array;var_dump ($new_array);# The following operations aren't permitted though, and will throw exceptions# $immutable_array-&gt;stored_array = [1,2,3];# BadMethodCallException: Attempted to set a new property on immutable class# $immutable_array-&gt;__construct([1,2,3]);# BadMethodCallException: Constructor called on already created object# unset($immutable_array-&gt;get_array);# BadMethodCallException: Attempted to unset a property on immutable object.# $immutable_array-&gt;new_prop = [1,2,3];# BadMethodCallException: Attempted to set a new property on immutable class# $test = new const_array();# TypeError: Argument 1 passed to const_array::__construct()# must be of the type array, none given# class my_mutable_array extends const_array &#123;## function set_array ($new_array) &#123;## $this-&gt;stored_array = $new_array;## &#125;## &#125;;# Fatal error: Class my_mutable_array may not inherit from final# class (const_array)# Unfortunately, there is no practical way to stop us overwriting the object# completely, either by unset()ing it or by assigning a new value to the# object variable, such as by creating a new const_array on it$immutable_array = new const_array([1,2,3]);var_dump($immutable_array); # new values stored 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889&lt;?php# Get our compose functionrequire '../Chapter 3/compose.php';# This class will provide a set of methods to work with taxclass tax_functions &#123; # Store the rate of tax private $tax_rate; # Our constructor sets the tax rate initially public function __construct($rate) &#123; $this-&gt;tax_rate = $rate; &#125; # Provide a method to set the tax rate at any point public function set_rate($rate) &#123; $this-&gt;tax_rate = $rate; &#125; # A method to add tax at the $tax_rate to the $amount public function add_tax($amount) &#123; return $amount * (1 + $this-&gt;tax_rate / 100); &#125; # A method to round the $amount down to the nearest penny public function round_to($amount) &#123; return floor($amount * 100) / 100; &#125; # A function to format the $amount for display public function display_price($amount) &#123; return ''.$amount.' inc '.$this-&gt;tax_rate.'% tax'; &#125;&#125;# So let's create an object for our program containing the# methods, with the tax rate set at 10%$funcs = new tax_functions(10);# Now let's compose our methods into a flow that adds tax, rounds# the figure and then formats it for display.# Note that to pass a method of an object as a callable, you need# to give an array of the object and method name. If you are using# static class methods, you can use the class::method notation instead$add_ten_percent = compose ( [$funcs, 'add_tax'], [$funcs, 'round_to'], [$funcs, 'display_price'] );# We've composed our $add_ten_percent function, but we may not want to use it# until much later in our script.# In the mean-time, another programmer inserts the following line in our# code in between...$funcs-&gt;set_rate(-20);# and then we try to use our $add_ten_percent function to add# tax to 19.99, hopefully getting the answer 21.98 inc 10% taxvar_dump( $add_ten_percent(19.99) ); # 15.99 inc -20% tax 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172&lt;?php# Grab our compose functionrequire('../Chapter 3/compose.php');# Define some maths functions$add_two = function ( $a ) &#123; return $a + 2;&#125;;$triple = function ( $a ) &#123; return $a * 3;&#125;;# Now we're going to create a "dirty" function to do some logging.$log_value = function ( $value ) &#123; # Do our impure stuff. echo "Impure Logging : $value\n"; # Oops, we mutated the parameter value... $value = $value * 234; # ...and returned it even more mutated return $value.' is a number';&#125;;# Now we're going to create a higher-order function which returns a# wrapped function which executes our impure function but returns# the original input parameter rather than any output from our impure# function. Note that we must pass $value to $impure_func by value and# not by reference (&amp;) to ensure it doesn't mess with it. Also see# the sections on the mutability of objects if you pass those through,# as the same concerns will apply here.$transparent = function ($impure_func) &#123; return function ($value) use ($impure_func) &#123; $impure_func($value); return $value; &#125;;&#125;;# Compose the maths functions together, with the $log_value impure function# made transparent by our wrapper function$do_sums = compose( $add_two, $transparent($log_value), $triple, $transparent($log_value) );# We should get the expected resultvar_dump( $do_sums(5) ); # 21 123456789101112131415161718192021&lt;?php# This is some typical procedural codeecho ("a is $a\n");$number = $a + 5;$number = $number * 2;for ($i = 0; $i &lt; 5; $i++) &#123; echo "We're doing procedural stuff here\n";&#125;;$b = 50;# Note the addition of a return statement.return $number; 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?php# First set some variables in global scope$a = 25;$b = 0;# Do a simple require of the file.$return_value = require "procedural.php";var_dump ( $return_value ); #60 - the script operated on our $a value of 25var_dump ( $a ); # 25var_dump ( $b ); # 50 - the script has mutated $b in the global scope# Reset $b$b = 0;# This function executes the file as if it were a function, within the# scope of the function. You can pass in a set of parameters as an array,# and the extract line creates variables in the function scope which# the code in the file can access. Finally, it requires the file and# returns the files return value as its own.$file_as_func = function ($filename, $params) &#123; extract ($params); return require $filename;&#125;;# We'll call it on our procedural.php file, with a couple of parameters# that have the same name but different values to our global $a and $bvar_dump ( $file_as_func( 'procedural.php', ['a'=&gt;50, 'b'=&gt;100] ) ); # 110# this clearly operated on our parameter "a" and not the global $avar_dump ( $a ); # 25var_dump ( $b ); # 0 - unchanged this time]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F03%2F31%2F%E7%94%A8%E5%87%BD%E6%95%B0%E5%BC%8F%E5%BC%80%E5%8F%91%E5%95%86%E4%B8%9A%E9%80%BB%E8%BE%91%2F</url>
    <content type="text"><![CDATA[   Listing 6-1 business_data.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990&lt;?php# First let's create core business data.# Rather than just define arrays, we're going to create functions# that return arrays. We'll discuss why in the chapter.# Every sale is either local, within our own country, or beyond$locations = function () &#123; return [ 'local', 'country', 'global' ];&#125;;# Each category of products that we sell has a different tax rate,# and that rate varies depending on where our purchaser is located$rates = function () &#123; return [ 'clothes' =&gt; [ 'local' =&gt; 0, 'country' =&gt; 5, 'global' =&gt; 10 ], 'books' =&gt; [ 'local' =&gt; 0, 'country' =&gt; 5, 'global' =&gt; 5 ], 'cheeses' =&gt; [ 'local' =&gt; 20, 'country' =&gt; 17.5, 'global' =&gt; 2 ] ];&#125;;# A list of our products, with their category and price$products = function () &#123; return [ 'T-shirt' =&gt; [ 'Category' =&gt; 'clothes', 'Price' =&gt; 15.99 ], 'Shorts' =&gt; [ 'Category' =&gt; 'clothes', 'Price' =&gt; 9.99 ], 'The Dictionary' =&gt; [ 'Category' =&gt; 'books', 'Price' =&gt; 4.99 ], 'War and Peace' =&gt; [ 'Category' =&gt; 'books', 'Price' =&gt; 29.45 ], 'Camembert' =&gt; [ 'Category' =&gt; 'cheeses', 'Price' =&gt; 3.50 ], 'Brie' =&gt; [ 'Category' =&gt; 'cheeses', 'Price' =&gt; 7.00 ] ];&#125;;# We only sell in dollars, but we format the prices differently# depending on the location of the purchaser.$price_formats = function () &#123; return [ 'local' =&gt; [ 'symbol' =&gt; '$', 'separator' =&gt; '.' ], 'country' =&gt; [ 'symbol' =&gt; '$', 'separator' =&gt; '.' ], 'global' =&gt; [ 'symbol' =&gt; 'USD ', 'separator' =&gt; ',' ] ];&#125;; Listing 6-2 business_logic.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889&lt;?php# Now we're going to create a set of functions which describe our business# logic. We're going to keep them as simple as possible, and reference# other functions within this file where possible to keep a# "single source of truth" for when we need to update them.# Load our business datarequire('business_data.php');# Fetch the details of a single product from the list of products$get_product_details = function ($product) use ($products) &#123; return $products()[$product];&#125;;# Get the category name from the details of a single product$get_category = function ($product_details) &#123; return $product_details['Category'];&#125;;# Get the tax rate for a category of products based on the location# of the purchaser$get_tax_rate = function ($category, $location) use ($rates)&#123; return $rates()[$category][$location];&#125;;# Get the net (tax exclusive) price of a product by name.$get_net_price = function ($product) use ($get_product_details) &#123; return $get_product_details($product)["Price"];&#125;;# Roll the above functions together to create a function that gets# the gross (tax inclusive) price for a certain quantity of products# based on the location of our purchaser.# Note that the tax is rounded using the PHP_ROUND_HALF_DOWN constant# to indicate the particular rounding method.$get_gross_price = function ($product, $quantity, $location) use ( $get_net_price, $get_tax_rate, $get_category, $get_product_details ) &#123; return round( $get_net_price($product) * $quantity * ( 1 + ( $get_tax_rate( $get_category( $get_product_details($product) ), $location) /100 ) ), 2, PHP_ROUND_HALF_DOWN );&#125;;# A function to get the actual amount of tax charged. Note that this doesn't# simply use the tax rate, as the actual amount charged may differ depending on# the rounding performed and any future logic added to $get_gross_price.# Instead we call $get_net_price and $get_gross_price and return the difference.$get_tax_charged = function ($product, $quantity, $location) use ($get_gross_price, $get_net_price) &#123; return $get_gross_price($product, $quantity, $location) - ( $quantity * $get_net_price($product) );&#125;;# Finally, a function to format a string to display the price, based# on the purchasers location.$format_price = function ($price, $location) use ($price_formats) &#123; $format = $price_formats()[$location]; return $format["symbol"] . str_replace('.', $format["separator"], (string) $price );&#125;; Listing 6-3 shopping.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384&lt;?php# Import our set of pure functions which encapsulate our business logic.require('business_logic.php');# Now we can use them in our not so pure, not so functional code, safe in the# knowledge that they (should) provide us with consistent, correct results# regardless of what we do to the global or external state here.# Let's generate a shopping cart of products for a user in Bolivia$cart = ['Brie' =&gt; 3, 'Shorts' =&gt; 1, 'The Dictionary' =&gt; 2 ];$user = ["location" =&gt; 'global'];# One common function is to list the contents of the cart. Let's do# that hereecho "Your shopping cart contains :\n\n";echo "Item - Quantity - Net Price Each - Total Price inc. Tax\n";echo "=======================================================\n\n";foreach ($cart as $product =&gt; $quantity) &#123; $net_price = $get_net_price($product); $total = $get_gross_price($product, $quantity, $user["location"]); echo "$product - $quantity - $net_price - $total \n";&#125;;echo "=======================================================\n\n";# In a confirmation e-mail we may want to just list a (formatted) total price...$total_price = array_reduce( array_keys($cart), # loop through the cart and add gross price for each item function ($running_total, $product) use ( $user, $get_gross_price, $cart ) &#123; return $running_total + $get_gross_price( $product, $cart[$product], $user["location"] );&#125;, 0);echo "Thank you for your order.\n";echo $format_price($total_price, $user["location"]).' will ';echo "be charged to your card when your order is dispatched.\n\n";# And on the backend system we may have a routine that keeps details of# all the tax charged, ready to send to the Government. Let's create a# summary of the tax for this order.$tax_summary = array_reduce( array_keys($cart), # Loop through each item and add the tax charged to the relevant category function ($taxes, $product) use ( $user, $get_tax_charged, $cart, $get_category, $get_product_details ) &#123; $category = $get_category($get_product_details($product)); $tax = $get_tax_charged($product, $cart[$product], $user["location"]); isset($taxes[$category]) ? $taxes[$category] =+ $tax : $taxes[$category] = $tax; return $taxes;&#125;, []);echo "Tax Summary for this order :\n\n";var_dump($tax_summary);  Listing 6-5 install_event.txt 12345678910111213141516171819202122# Install the libevent library and it header filessudo apt-get install libevent-2.0-5 libevent-dev# Ensure that PECL (which comes as part of the PEAR package)# and the phpize command which PECL needs are installedsudo apt-get install php-pear php-dev# Install the event extensionsudo pecl install event# Finally make the extension available to the PHP CLI binary# by editing php.inisudo nano /etc/php/7.0/cli/php.ini# and adding the following line in the section where other .so# extensions are includeextension=event.so Listing 6-6 server_functions.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232&lt;?php# We'll create a set of functions that implement the logic that should# occur in response to the events that we'll handle.# Use our trusty partial function generatorrequire('../Chapter 3/partial_generator.php');# A generic function to output an HTTP header. $req is an object representing# the current HTTP request, which ensures that our function deals with the# right request at all times.$header = function ($name, $value, $req) &#123; $req-&gt;addHeader( $name , $value, EventHttpRequest::OUTPUT_HEADER );&#125;;# We are going to be serving different types of content (html, images etc.)# so we need to output a content header each time. Let's create a# partial function based on $header...$content_header = partial($header, 'Content-Type' );# and then make it specific for each type of content...$image_header = partial($content_header, "image/jpeg");$text_header = partial($content_header, "text/plain; charset=ISO-8859-1");$html_header = partial($content_header, "text/html; charset=utf-8");# The following function creates a "buffer" to hold our $content and# then sends it to the browser along with an appropriate HTTP status# code (Let's assume our requests always work fine so send 200 for everything).# Note that it's a pure function right up until we call sendReply. You could# return the EventBuffer instead, and wrap it all into an IO or Writer monad to# put the impure sendReply at the end if you wish.$send_content = function($req, $content) &#123; $output = new EventBuffer; $output-&gt;add($content); $req-&gt;sendReply(200, "OK", $output);&#125;;# The input parameters for our maths functions are held in the URI parameters.# The URI is held in the $req request object as a string. Let's get the# URI and parse out the parameters into an associative array.$parse_uri_params = function ($req) &#123; $uri = $req-&gt;getUri(); parse_str ( # Grab just the parameters (everything after the ?) substr( $uri, strpos( $uri, '?' ) + 1 ), # and parse it into $params array $params ); return $params;&#125;;# Get the URI "value" parameter$current_value = function($req) use ($parse_uri_params) &#123; return $parse_uri_params($req)["value"];&#125;;# Get the URL "amount" parameter$amount = function($req) use ($parse_uri_params) &#123; return $parse_uri_params($req)["amount"];&#125;;# A function to send the results of one of our maths functions which follow.$send_sum_results = function($req, $result) use ( $html_header, $send_content) &#123; # Create some HTML output, with the current result, plus some links # to perform more maths functions. Note the uri parameters contain # all of the state needed for the function to give a deterministic, # reproducable result each time. We also include some links to # the other utility functions. When you visit them, note that you # can use your browser back button to come back to the maths functions # and carry on where you left off, as the parameters the functions # need are provided by the URI parameters and no "state" has been # altered of lost $output = &lt;&lt;&lt;ENDCONTENT &lt;p&gt;&lt;b&gt;The current value is : $result&lt;/b&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/add?value=$result&amp;amount=3"&gt;Add 3&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/add?value=$result&amp;amount=13"&gt;Add 13&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/add?value=$result&amp;amount=50"&gt;Add 50&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/subtract?value=$result&amp;amount=2"&gt;Subtract 2&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/subtract?value=$result&amp;amount=5"&gt;Subtract 5&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/multiply?value=$result&amp;amount=2"&gt;Multiply by 2&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/multiply?value=$result&amp;amount=4"&gt;Multiply by 4&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/divide?value=$result&amp;amount=2"&gt;Divide by 2&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/divide?value=$result&amp;amount=3"&gt;Divide by 3&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/floor?value=$result"&gt;Floor&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;A href="/show_headers"&gt;[Show headers]&lt;/a&gt;&amp;nbsp; &lt;a href="/really/cute"&gt;[Get cat]&lt;/a&gt;&amp;nbsp; &lt;a href="/close_server"&gt;[Close down server]&lt;/a&gt;&lt;/p&gt;ENDCONTENT; # Send the content header and content. $html_header($req); $send_content($req, $output);&#125;;# These are our key maths functions. Each one operates like a good Functional# function by only using the values supplied as input parameters, in this# case as part of $req. We call a couple of helper functions ($current_value# and $amount) to help extract those values, $req isn't necessarily# immutable (we could alter values or call methods), but we'll use# our discipline to keep it so right up until we're ready to send_contents.# While we don't formally "return" a value, $send_sum_results effectively# acts a return statement for us. Any return value would simply go back to# libevent (which is the caller, and it just ignore it).# If we want to keep to strictly using explicit return statements, we could# wrap this in another function that does the same as $send_sum_results, (and# for the same reason wouldn't have a return statement) or we could create an# Writer monad or similar to gather the results and only output to the browser# at the end. For this simple example we'll go with using $send_sum_results# though for simplicity and clarity.$add = function ($req) use ($send_sum_results, $current_value, $amount) &#123; $send_sum_results($req, $current_value($req) + $amount($req) );&#125;;$subtract = function ($req) use ($send_sum_results, $current_value, $amount) &#123; $send_sum_results($req, $current_value($req) - $amount($req) );&#125;;$multiply = function ($req) use ($send_sum_results, $current_value, $amount) &#123; $send_sum_results($req, $current_value($req) * $amount($req) );&#125;;$divide = function ($req) use ($send_sum_results, $current_value, $amount) &#123; $send_sum_results($req, $current_value($req) / $amount($req) );&#125;;$floor = function ($req) use ($send_sum_results, $current_value) &#123; $send_sum_results($req, floor($current_value($req)) );&#125;;# Now we'll define some utility functions# Grab the HTTP headers from the current request and return them as an array$get_input_headers = function ($req) &#123; return $req-&gt;getInputHeaders();&#125;;# A recursive function to loop through an array of headers and return# an HTML formatted string$format_headers = function ($headers, $output = '') use (&amp;$format_headers) &#123; # if we've done all the headers, return the $output if (!$headers) &#123; return $output; &#125; else &#123; # else grab a header off the top of the array, add it to the # $output and recursively call this function on the remaining headers. $output .= '&lt;pre&gt;'.array_shift($headers).'&lt;/pre&gt;'; return $format_headers($headers, $output); &#125;;&#125;;# Use the function above to format the headers of the current request for# viewing$show_headers = function ($req) use ($html_header, $send_content, $format_headers) &#123; $html_header($req); $send_content($req, $format_headers( $req-&gt;getInputHeaders() ) );&#125;;# Let's handle all requests, so there are no 404's$default_handler = function ($req) use ($html_header, $send_content) &#123; $html_header($req); $output = '&lt;h1&gt;This is the default response&lt;/h1&gt;'; $output .= '&lt;p&gt;Why not try &lt;a href="/add?value=0&amp;amount=0"&gt;some math&lt;/a&gt;&lt;/p&gt;'; $send_content($req, $output);&#125;;# Ensure that there are sufficient supplies of cat pictures available# in all corners of the Internet$send_cat = function($req) use ($image_header, $send_content) &#123; # Note we send a different header so that the browser knows # a binary image is coming $image_header($req); # An impure function, you could alway use an IO monad or # embed the image binary data here! $send_content($req, file_get_contents('cat.jpg'));&#125;;# A function to shut down the web server script by visiting a particular URI.$close_server = function($req, $base) use ($html_header, $send_content) &#123; $html_header($req); $send_content($req, '&lt;h1&gt;Server is now shutting down&lt;/h1&gt;'); $base-&gt;exit();&#125;; Listing 6-7 web_server.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&lt;?php# Let's get all of our functions that implement our# business logicrequire('server_functions.php');# Now we're ready to build up our event framework# First we create an "EventBase", which is libevent's vehicle for holding# and polling a set of events.$base = new EventBase();# Then we add an EventHttp object to the base, which is the Event# extension's helper for HTTP connections/events.$http = new EventHttp($base);# We'll choose to respond to just GET HTTP requests$http-&gt;setAllowedMethods( EventHttpRequest::CMD_GET );# Next we'll tie our functions we created above to specific URIs using# function callbacks. We've created them all as anonymous/closure functions# and so we just bind the variable holding them to the URI. We# could use named functions if we want, suppling the name in "quotes".# In fact, you can use any kind of callable here. All will be called# with the EventHttpRequest object representing the current request as# the first paramter. If you need other parameters here for your callback,# you can specify them as an optional third parameter below.# Our set of maths functions...$http-&gt;setCallback("/add", $add);$http-&gt;setCallback("/subtract", $subtract);$http-&gt;setCallback("/multiply", $multiply);$http-&gt;setCallback("/divide", $divide);$http-&gt;setCallback("/floor", $floor);# A function to shut down the server, which needs access to the server $base$http-&gt;setCallback("/close_server", $close_server, $base);# A utility function to explore the headers your browser is sending$http-&gt;setCallback("/show_headers", $show_headers);# And a compulsory function for all internet connected devices$http-&gt;setCallback("/really/cute", $send_cat);# Finally we'll add a default function callback to handle all other URIs.# You could, in fact, just specify this default handler and not those# above, and then handle URIs as you wish from inside this function using# it as a router function.$http-&gt;setDefaultCallback($default_handler);# We'll bind our script to an address and port to enable it to listen for# connections. In this case, 0.0.0.0 will bind it to the localhost, and# we'll choose port 12345$http-&gt;bind("0.0.0.0", 12345);# Then we start our event loop using the loop() function of our base. Our# script will remain in this loop indefinitely, servicing http requests# with the functions above, until we exit it by killing the script or,# more ideally, calling $base-&gt;exit() as we do in the close_server()# function above.$base-&gt;loop();# We'll only hit this point in the script if some code has called# $base-&gt;exit();echo "Server has been gracefully closed\n";]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP7]]></title>
    <url>%2F2020%2F03%2F31%2FPHP7%E7%9A%84%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[  PHP          Listing 2-3 backtrace.php 123456789101112131415161718192021222324&lt;?phpfunction prepare_text($text) &#123; return make_headline($text);&#125;function make_headline($text) &#123; return add_h_tags( upper_case($text) );&#125;function upper_case($text) &#123; return strtoupper($text);&#125;function add_h_tags($text) &#123; debug_print_backtrace(); return '&lt;h1&gt;'.$text.'&lt;/h1&gt;';&#125;$title = prepare_text('testing');echo $title; Listing 2-4 backtrace-output.txt 1234#0 add_h_tags(TESTING) called at [backtrace.php:12]#1 make_headline(testing) called at [backtrace.php:6]#2 prepare_text(testing) called at [backtrace.php:30]&lt;h1&gt;TESTING&lt;/h1&gt;    PHPdefineconst defineconst  2-7 2-8 Listing 2-7. constant-func.php 12345678910&lt;?php$double = function ($input) &#123; return $input * 2;&#125;;define('DOUBLE', $double);echo "Double 2 is " . $double(2) . "\n";echo "Double 2 is " . DOUBLE(2) . "\n"; Listing 2-8. constant-func-output.txt 12345678PHP Warning: Constants may only evaluate to scalar values or arrays in constant-func.php online 8Double 2 is 4PHP Fatal error: Uncaught Error: Call to undefined function DOUBLE() in constant-func.php:12Stack trace:#0 &#123;main&#125;thrown in constant-func.php on line 12 defineDOUBLE PHPPHPPHPPHP PHPPHPsortsort2-92-10 Listing 2-9. sort.php 123456789101112131415161718192021&lt;?phpfunction immutable_sort($array) &#123; sort($array); return $array;&#125;$vegetables = ['Carrot', 'Beetroot', 'Asparagus'];# Sort using our immutable function$ordered = immutable_sort( $vegetables );print_r( $ordered );# Check that $vegetables remains unmutatedprint_r( $vegetables );# Do it the mutable waysort( $vegetables );# And see that the original array is mutatedprint_r( $vegetables ); Listing 2-10. sort-output.txt 123456789101112131415161718Array( [0] =&gt; Asparagus [1] =&gt; Beetroot [2] =&gt; Carrot)Array( [0] =&gt; Carrot [1] =&gt; Beetroot [2] =&gt; Asparagus)Array( [0] =&gt; Asparagus [1] =&gt; Beetroot [2] =&gt; Carrot) PHP  PHPsort    7  PHP PHPPHP    PHP      call_user_func()2-152-16 Listing 2-15. userfunc.php 1234567891011&lt;?phpfunction list_fruit($item) &#123;return ['apple','orange','mango'][$item];&#125;function list_meat($item) &#123;return ['pork','beef','human'][$item];&#125;$the_list = 'list_fruit';var_dump( call_user_func($the_list, 2) );$the_list = 'list_meat';var_dump( call_user_func($the_list, 1) ); Listing 2-16. userfunc-output.txt 12string(5) &quot;mango&quot;string(4) &quot;beef&quot; call_user_funccall_user_func$ the_listcall_user_func PHP 7.0PHPfromCallable 2-172-18 123456789101112131415161718192021222324252627282930313233343536&lt;?phpfunction a() &#123; function b() &#123; return "a -&gt; b"; &#125; return "a";&#125;function c() &#123; function d() &#123; function e() &#123; return "c -&gt; d -&gt; e"; &#125; return "c -&gt; d"; &#125; return "c";&#125;var_dump( a() );var_dump( b() );var_dump( c() );var_dump( d() );var_dump( e() ); Listing 2-18. name-scope-output.txt 12345string(1) &quot;a&quot;string(6) &quot;a -&gt; b&quot;string(1) &quot;c&quot;string(6) &quot;c -&gt; d&quot;string(11) &quot;c -&gt; d -&gt; e&quot; Listing 2-19. name-scope2.php 12345678910111213141516171819202122232425262728&lt;?phpfunction a() &#123; function b() &#123; return "a -&gt; b"; &#125; return "a";&#125;function c() &#123; function d() &#123; function e() &#123; return "c -&gt; d -&gt; e"; &#125; return "c -&gt; d"; &#125; return "c";&#125;var_dump( a() );var_dump( b() );var_dump( d() );var_dump( c() );var_dump( e() ); Listing 2-20. name-scope2-output.txt 123456string(1) &quot;a&quot;string(6) &quot;a -&gt; b&quot;PHP Fatal error: Uncaught Error: Call to undefined function d() in name-scope2.php:38Stack trace:#0 &#123;main&#125;thrown in name-scope2.php on line 38 Listing 2-21. name-scope3.php 12345678910111213141516171819202122&lt;?phpfunction f() &#123; function g() &#123; return "1st g()"; &#125;; return "f()";&#125;function h() &#123; function g() &#123; return "2nd g()"; &#125;; return "h()";&#125;var_dump( f() );var_dump( g() );var_dump( h() ); Listing 2-22. name-scope3-output.txt 1234string(3) &quot;f()&quot;string(7) &quot;1st g()&quot;PHP Fatal error: Cannot redeclare g() (previously declared in name-scope3.php:7) in name-scope3.php on line 17 Listing 2-23. variable.php 1234567891011121314151617181920212223242526272829303132&lt;?phpfunction vehicles( $index ) &#123; $types = ["car", "motorbike", "tractor"]; return $types[$index];&#125;function animals( $index ) &#123; $types = ["cow", "pig", "chicken", "horse"]; return $types[$index];&#125;$get_thing = 'animals'; # string with the name of a functionvar_dump( $get_thing(2) ); # add ($index) to call it$get_thing = 'vehicles'; # change the functionvar_dump( $get_thing(2) ); #same "code", different function# Just to show that $get_thing is just a# standard string, and nothing special...$get_thing = strrev('selcihev'); # do string thingsvar_dump( $get_thing ); # it's a stringvar_dump( $get_thing(2) ); # call itvar_dump( $get_thing ); # afterwards, still just a stringunset( $get_thing ); # we can destroy it, because it's a stringvar_dump( $get_thing );var_dump( vehicles(2) ); # But the function still exists# However, it needs to be set to a function that exists$get_thing = 'people';var_dump( $get_thing(2) ); Listing 2-24. variable-output.txt 123456789101112string(7) &quot;chicken&quot;string(7) &quot;tractor&quot;string(8) &quot;vehicles&quot;string(7) &quot;tractor&quot;string(8) &quot;vehicles&quot;PHP Notice: Undefined variable: get_thing in variable.php on line 41NULLstring(7) &quot;tractor&quot;PHP Fatal error: Uncaught Error: Call to undefined function people() in variable.php:49Stack trace:#0 &#123;main&#125;thrown in variable.php on line 49 Listing 2-25. constructs.php 123&lt;?php$var_func = 'echo';$var_func('hello world!'); Listing 2-26. constructs-output.php 1234PHP Fatal error: Uncaught Error: Call to undefined function echo() in constructs.php:5Stack trace:#0 &#123;main&#125;thrown in constructs.php on line 5 Listing 2-27. constructs2.php 1234567&lt;?phpfunction my_echo($string) &#123; echo $string;&#125;$var_func = 'my_echo';$var_func('hello world!'); Listing 2-28. constructs2-output.php 1hello world! Listing 2-29. null-return.php 12345678910111213141516171819202122&lt;?phpfunction reverse($string) &#123; $string = strrev($string);&#125;function capitals($string) &#123; if ($string != 'banana') &#123; $string = strtoupper($string); return $string; &#125;&#125;# no return statementvar_dump( reverse('hello') );# returns a valuevar_dump( capitals('peaches') );# execution flow misses return statementvar_dump( capitals('banana') ); Listing 2-30. null-return-output.txt 123NULLstring(7) &quot;PEACHES&quot;NULL Listing 2-31. null-return2.php 12345678910111213141516&lt;?phpfunction fruits($type) &#123; if ($type == 'mango') &#123; return 'Yummy!'; &#125; else &#123; return; &#125;&#125;var_dump( fruits('kiwi') );var_dump( fruits('pomegranate') );var_dump( fruits('mango') ); Listing 2-32. null-return2-output.txt 123NULLNULLstring(6) &quot;Yummy!&quot; Listing 2-33. return.php 1234567891011&lt;?phpfunction my_funct() &#123; $a = 23; return $a; $a = 45; return $a;&#125;var_dump( my_funct() ); Listing 2-34. return-output.txt 1int(23)]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F03%2F30%2F%E9%AB%98%E7%BA%A7%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8A%80%E5%B7%A7%2F</url>
    <content type="text"><![CDATA[ PHPcurringmonad (Currying) : 1def add(x:Int,y:Int)=x+y add(1,2)  1def add(x:Int)(y:Int) = x + y add(1)(2),3 add(1)(2)  xy  1def add(x:Int)=(y:Int)=&gt;x+y  xIntyx+y 1val result = add(1) resultresult(y:Int)=&gt;1+y result 1val sum = result(2) 3  1234567891011object Test &#123; def main(args: Array[String]) &#123; val str1:String = "Hello, " val str2:String = "Scala!" println( "str1 + str2 = " + strcat(str1)(str2) ) &#125; def strcat(s1: String)(s2: String) = &#123; s1 + s2 &#125;&#125;  $ scalac Test.scala$ scala Teststr1 + str2 = Hello, Scala!  123456789101112131415var bind = function(fn, a)&#123; return function(b)&#123; return fn(a, b) &#125;&#125;var mult = function(a, b)&#123; return a*b&#125;// multa2var time2 = bind(mult, 2)// time2time(1) // 2time(3) // 6 currying   var concat3Words = function (a, b, c) { return a+b+c;}; var concat3WordsCurrying = function(a) { return function (b) { return function (c) { return a+b+c; }; };};console.log(concat3Words(foo ,bar ,baza)); // foo bar bazaconsole.log(concat3WordsCurrying(foo )); // [Function]console.log(concat3WordsCurrying(foo )(bar )(baza)); // foo bar baza concat3WordsCurrying(foo )  FunctionPS 3  var add = function(items){ return items.reduce(function(a,b){ return a+b });};console.log(add([1,2,3,4]));10 12345678var add = function (items,multi) &#123; return items.map(function (item) &#123; return item*multi; &#125;).reduce(function (a, b) &#123; return a + b &#125;);&#125;;console.log(add([1, 2, 3, 4],10));  map  reduce 1,map  1234567891011121314151617181920var adder = function () &#123; var _args = []; return function () &#123; if (arguments.length === 0) &#123; return _args.reduce(function (a, b) &#123; return a + b; &#125;); &#125; [].push.apply(_args, [].slice.call(arguments)); return arguments.callee; &#125;&#125;; var sum = adder();console.log(sum); // Functionsum(100,200)(300); // sum(400);console.log(sum()); // 1000  `  adder  10,  123456789101112131415161718192021222324var currying = function (fn) &#123; var _args = []; return function () &#123; if (arguments.length === 0) &#123; return fn.apply(this, _args); &#125; Array.prototype.push.apply(_args, [].slice.call(arguments)); return arguments.callee; &#125;&#125;;var multi=function () &#123; var total = 0; for (var i = 0, c; c = arguments[i++];) &#123; total += c; &#125; return total;&#125;;var sum = currying(multi); sum(100,200)(300);sum(400);console.log(sum()); // 1000   sum = currying(multi) sum(1,2,3)sum(1)(2)(3) high-order function,   1234567891011var addEvent = function(el, type, fn, capture) &#123; if (window.addEventListener) &#123; el.addEventListener(type, function(e) &#123; fn.call(el, e); &#125;, capture); &#125; else if (window.attachEvent) &#123; el.attachEvent("on" + type, function(e) &#123; fn.call(el, e); &#125;); &#125; &#125;;  ifelse 123456789101112131415var addEvent = (function()&#123; if (window.addEventListener) &#123; return function(el, sType, fn, capture) &#123; el.addEventListener(sType, function(e) &#123; fn.call(el, e); &#125;, (capture)); &#125;; &#125; else if (window.attachEvent) &#123; return function(el, sType, fn, capture) &#123; el.attachEvent("on" + sType, function(e) &#123; fn.call(el, e); &#125;); &#125;; &#125;&#125;)();  ifelse  ararcurryingHaskell Currycurryingcurrying/ currying curryingMatteo Giachinophp-curryGitHub[https://github.com/matteosister/php-curry]Composer4-14-2 Listing 4-1. currying.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;?phpinclude('Curry/Placeholder.php');include('Curry/functions.php');use Cypress\Curry as C;# Let's make a function place an order with our chef# for some delicious curry (the food, not the function)$make_a_curry = function($meat, $chili, $amount, $extras, $where) &#123;return ["Meat type"=&gt;$meat,"Chili hotness"=&gt;$chili,"Quantity to make"=&gt;$amount,"Extras"=&gt;$extras,"Eat in or take out"=&gt;$where];&#125;;# We think that everyone will want a mild Rogan Josh, so# let's curry the function with the first two parameters$rogan_josh = C\curry($make_a_curry, 'Lamb','mild');# $rogan_josh is now a closure that will continue to# curry with the arguments we give it$dishes = $rogan_josh("2 portions");# likewise $dishes is now a closure that will continue# to curry$meal = $dishes('Naan bread');# and so on for meal. However, we only have 1 parameter# which we've not used, $where, and so when we add# that, rather than returning another closure, $meal# will execute and return the result of $make_a_curry$order = $meal('Eat in');print_r( $order );# To show that our original function remains unmutated, when# we realize that actually people only want 1 portion of curry# at a time, with popadoms, and they want to eat it at home, we# can curry it again. This time, the parameters we want to bind# are at the end, so we use curry_right.$meal_type = C\curry_right($make_a_curry, 'Take out', 'Poppadoms', '1 portion');$madrass = $meal_type('hot', 'Chicken');print_r( $madrass );# We could curry the function with all of the parameters# provided, this creates a parameter-less closure but doesn't# execute it until we explicitly do so.$korma = C\curry($make_a_curry,'Chicken', 'Extra mild', 'Bucket full', 'Diet cola', 'Eat in');print_r($korma()); Listing 4-2. currying-output.txt 123456789101112131415161718192021222324Array( [Meat type] =&gt; Lamb [Chili hotness] =&gt; mild [Quantity to make] =&gt; 2 portions [Extras] =&gt; Naan bread [Eat in or take out] =&gt; Eat in)Array( [Meat type] =&gt; Chicken [Chili hotness] =&gt; hot [Quantity to make] =&gt; 1 portion [Extras] =&gt; Poppadoms [Eat in or take out] =&gt; Take out)Array( [Meat type] =&gt; Chicken [Chili hotness] =&gt; Extra mild [Quantity to make] =&gt; Bucket full [Extras] =&gt; Diet cola [Eat in or take out] =&gt; Eat in)]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2020%2F03%2F29%2F%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[ mapfilterreduceforeach  Map,Filter,Reduce Listing 3-1 map_filter_reduce.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677&lt;?php// $ingredients = [ "cod", //  "beef", "kiwi", //  "egg", "vinegar" // ];// $dish_types = [ "pie", "smoothie", //  "tart", //  "ice cream", "crumble" //  ];// $baked = [ "pie", "tart", "crumble", "cake"];# $make_recipe = function ($ingredient, $dish) &#123; return $ingredient.' '.$dish;&#125;;# $baked$is_baked = function ($recipe) use ($baked) &#123; return array_filter($baked, function($item) use ($recipe) &#123; return strpos($recipe, $item) !== false; &#125; );&#125;;# $get_longest = function ($current_longest, $recipe) &#123; return strlen($recipe) &gt; strlen($current_longest) ? $recipe : $current_longest;&#125;;# PHPshuffle# $reshuffle# shuffle// shuffle $reshuffle = function ($array) &#123; shuffle($array); return $array;&#125;;$all_recipes = array_map($make_recipe, $reshuffle($ingredients), $reshuffle($dish_types));print_r($all_recipes);$baking_recipes = array_filter($all_recipes, $is_baked);print_r($baking_recipes);$best_recipe = array_reduce($baking_recipes, $get_longest, '');print_r($best_recipe); Listing 3-2 map_filter_reduce-output.txt 123456789101112131415Array( [0] =&gt; vinegar ice cream [1] =&gt; kiwi tart [2] =&gt; cod crumble [3] =&gt; egg smoothie [4] =&gt; beef pie)Array( [1] =&gt; kiwi tart [2] =&gt; cod crumble [4] =&gt; beef pie)cod crumble  Listing 3-3 shopping_list1.php 1234567891011121314151617&lt;?php$shopping = [ "fruits" =&gt; [ "apples" =&gt; 7, "pears" =&gt; 4, //  "bananas" =&gt; 6 ], "bakery" =&gt; [ //  "bread" =&gt; 1, "apple pie" =&gt; 2 ], "meat" =&gt; [ "sausages" =&gt; 10, //  "steaks" =&gt; 3, "chorizo" =&gt; 1 //  ]]; Listing 3-4 foreach.php 1234567891011121314&lt;?phprequire('shopping_list1.php');$total = 0;foreach ($shopping as $group) &#123; foreach ($group as $food =&gt; $count) &#123; $total += $count; &#125;&#125;echo "Total items to purchase : $total\n"; Listing 3-5 foreach-output.txt 1Total items to purchase : 34 Listing 3-6 shopping_list2.php 1234567891011121314151617181920&lt;?php$shopping = [ "fruits" =&gt; [ "apples" =&gt; [ "red" =&gt; 3, "green" =&gt; 4 ], "pears" =&gt; 4, "bananas" =&gt; 6 ], "bakery" =&gt; [ "bread" =&gt; 1, "apple pie" =&gt; 2 ], "meat" =&gt; [ "sausages" =&gt; 10, "steaks" =&gt; 3, "chorizo" =&gt; 1 ]]; Listing 3-7 foreach2-output.txt 1234PHP Fatal error: Uncaught Error: Unsupported operand types in foreach.php:11Stack trace:#0 &#123;main&#125;thrown in foreach.php on line 11 Listing 3-8 recursive.php 1234567891011121314151617181920212223242526272829&lt;?phpfunction count_total($list) &#123; #  $total = 0; #  foreach ($list as $food =&gt; $value) &#123; #  if (is_array ($value)) &#123; # $total  $total += count_total ($value); &#125; else &#123; $total += $value; &#125; &#125; return $total;&#125;require('shopping_list1.php');echo "List 1 : ".count_total($shopping)."\n";require('shopping_list2.php');echo "List 2 : ".count_total($shopping)."\n"; Listing 3-9 recursive-output.txt 123List 1 : 34List 2 : 34List 3 : 34  Listing 3-10 recursive_stack.php 12345678910111213141516&lt;?phpfunction sum($start) &#123; echo "---\n"; debug_print_backtrace(); if ($start &lt; 2) &#123; return 1; &#125; else &#123; return $start + sum($start-1); &#125;&#125;echo "The result is : ".sum(4); Listing 3-11 recursive_stack-output.txt 123456789101112131415---#0 sum(4) called at [recursive_stack.php:17]---#0 sum(3) called at [recursive_stack.php:13]#1 sum(4) called at [recursive_stack.php:17]---#0 sum(2) called at [recursive_stack.php:13]#1 sum(3) called at [recursive_stack.php:13]#2 sum(4) called at [recursive_stack.php:17]---#0 sum(1) called at [recursive_stack.php:13]#1 sum(2) called at [recursive_stack.php:13]#2 sum(3) called at [recursive_stack.php:13]#3 sum(4) called at [recursive_stack.php:17]The result is : 10  Listing 3-12 forever.php 123456789&lt;?phpini_set('memory_limit','1G');function forever() &#123; forever();&#125;forever(); Listing 3-13 forever-output.txt 1PHP Fatal error: Allowed memory size of 1073741824 bytes exhausted (tried to allocate 262144 bytes) in forever.php on line 6 ini_setWebPHP CLI  PHP   Listing 3-14 all_recipes.php 12345678910111213141516171819202122232425262728&lt;?php$ingredients = [ "cod", "beef", "kiwi", "egg", "vinegar"];$dish_types = [ "pie", "smoothie", "tart", "ice cream", "crumble"];$all_recipes = [];foreach ($ingredients as $ingredient) &#123; foreach ($dish_types as $dish) &#123; $all_recipes[] = $ingredient.' '.$dish; &#125;&#125;print_r($all_recipes); Listing 3-15 all_recipes-output.txt 12345678910111213141516171819202122232425262728Array( [0] =&gt; cod pie [1] =&gt; cod smoothie [2] =&gt; cod tart [3] =&gt; cod ice cream [4] =&gt; cod crumble [5] =&gt; beef pie [6] =&gt; beef smoothie [7] =&gt; beef tart [8] =&gt; beef ice cream [9] =&gt; beef crumble [10] =&gt; kiwi pie [11] =&gt; kiwi smoothie [12] =&gt; kiwi tart [13] =&gt; kiwi ice cream [14] =&gt; kiwi crumble [15] =&gt; egg pie [16] =&gt; egg smoothie [17] =&gt; egg tart [18] =&gt; egg ice cream [19] =&gt; egg crumble [20] =&gt; vinegar pie [21] =&gt; vinegar smoothie [22] =&gt; vinegar tart [23] =&gt; vinegar ice cream [24] =&gt; vinegar crumble) Listing 3-16 recipe_functions.php 12345678910111213141516171819202122232425262728&lt;?phpfunction combine($a,$b) &#123; $combinations = []; if (is_array($a)) &#123; foreach ($a as $i) &#123; $combinations = array_merge( $combinations, combine($i, $b) ); &#125; &#125; else &#123; foreach ($b as $i) &#123; $combinations[] = $a.' '.$i; &#125; &#125; return $combinations;&#125;function print_first($items, $count) &#123; for ($counter=0; $counter&lt;$count; $counter++) &#123; echo "$counter. $&#123;items[$counter]&#125; \n"; &#125;&#125; Listing 3-17 all_recipes_recursive.php 123456789101112131415161718192021&lt;?phprequire_once('recipe_functions.php');$ingredients = [ "cod", "beef", "kiwi", "egg", "vinegar"];$dish_types = [ "pie", "smoothie", "tart", "ice cream", "crumble"];$all_recipes = combine($ingredients, $dish_types);print_first($all_recipes, 5); Listing 3-18 all_recipes_recursive_output.txt 123456Showing 5 of 25 items:1. cod pie2. cod smoothie3. cod tart4. cod ice cream5. cod crumble Listing 3-19 new_ingredients.php 12345678910111213141516171819202122232425&lt;?phprequire_once('recipe_functions.php');$ingredients = [ [ "ham", "beef" ], [ "apple", "kumquat" ], "vinegar"];$dish_types = [ "pie", "smoothie", "tart", "ice cream", "crumble"];$all_recipes = combine($ingredients, $dish_types);print_first($all_recipes, 11); Listing 3-20 new_ingredients-output.txt 123456789101112Showing 11 of 25 items:1. ham pie2. ham smoothie3. ham tart4. ham ice cream5. ham crumble6. beef pie7. beef smoothie8. beef tart9. beef ice cream10. beef crumble11. apple pie 1OOPSOLIDISPrecipe_functions.phpprint_firsttheTopFiveBestEverListsOfStuff.comprint_first$ list551045110$ count5$ count = 10$ count   3-213-22 Listing 3-21 top_five.php 12345678910111213141516171819&lt;?phprequire_once('print_first.php');# Some data ...$best_names = ["Rob", "Robert", "Robbie", "Izzy", "Ellie", "Indy", "Parv", "Mia", "Joe", "Surinder", "Lesley"];# Calling the function in fullprint_first($best_names, 5);# Now let's define a partial function, print_top_list, which# binds the value 5 to the second parameter of print_firstfunction print_top_list($list) &#123; print_first($list, 5);&#125;;# Calling the new partial function will give the same# output as the full function call above.print_top_list($best_names); Listing 3-22 top_five-output.txt 123456789101112Showing 5 of 11 items:1. Rob2. Robert3. Robbie4. Izzy5. EllieShowing 5 of 11 items:1. Rob2. Robert3. Robbie4. Izzy5. Ellie print_top_lista510bprint_firstcprint_first/partial3-233-243-25 Listing 3-23 partial_generator.php 12345678910111213141516171819202122232425262728293031&lt;?php# Our function to create a partial function. $func is# a "callable", i.e. a closure or the name of a function, and# $args is one or more arguments to bind to the function.function partial($func, ...$args) &#123; # We return our partial function as a closure return function() use ($func, $args) &#123; # The partial function we return consists of # a call to the full function using "call_user_func_array" # with a list of arguments made up of our bound # argument(s) in $args plus any others supplied at # calltime (via func_get_args) return call_user_func_array($func, array_merge($args, func_get_args() ) ); &#125;;&#125;# The partial function generator above binds the given# n arguments to the *first* n arguments. In our case# we want to bind the *last* argument, so we'll create# another function that returns a function with the# arguments reversed.function reverse($func) &#123; return function() use ($func) &#123; return call_user_func_array($func, array_reverse(func_get_args()) ); &#125;;&#125; Listing 3-24 partial.php 12345678910&lt;?phprequire_once('print_first.php');require_once('partial_generator.php');$foods = ["mango", "apple pie", "cheese", "steak", "yoghurt", "chips"];$print_top_five = partial(reverse('print_first'), 5);$print_top_five($foods);$print_best = partial(reverse('print_first'), 1);$print_best($foods); Listing 3-25 partial-output.txt 12345678Showing 5 of 6 items:1. mango2. apple pie3. cheese4. steak5. yoghurtShowing 1 of 6 items:1. mango named   $ print_top_five$ print_best  3-26Arity42 3-27 Listing 3-26 concatenate.php 12345678910&lt;?phprequire_once("partial_generator.php");$concatenate = function ($a, $b, $c, $d) &#123; return $a.$b.$c.$d;&#125;;echo $concatenate("what ", "is ", "your ", "name\n");$whatis = partial($concatenate, "what ", "is ");echo $whatis("happening ", "here\n"); Listing 3-27 concatenate-output.txt 12what is your namewhat is happening here    curring   incdec PHP++- 3-283-29 Listing 3-28 inc_dec.php 123456789101112131415&lt;?phpfunction inc($number) &#123; $number++; return $number;&#125;function dec($number) &#123; $number--; return $number;&#125;var_dump( inc(3) );var_dump( dec(3) ); Listing 3-29 inc_dec-output.txt 12int(4)int(2)  3-303-31 Listing 3-30 inc_dec_partial.php 123456789101112131415161718192021222324&lt;?phprequire_once('partial_generator.php');# First define a generic adding functionfunction add($a,$b) &#123; return $a + $b;&#125;# Then create our inc and dec as partial functions# of the add() function.$inc = partial('add', 1);$dec = partial('add', -1);var_dump( $inc(3) );var_dump( $dec(3) );# Creating variations is then a simple one-liner$inc_ten = partial('add', 10);var_dump( $inc_ten(20) );# and we still have our add function. We can start# to build more complex functional expressions$answer = add( $inc(3), $inc_ten(20) );var_dump ( $answer ); Listing 3-31 inc_dec_partial-output.txt 1234int(4)int(2)int(30)int(34)   12133-323-33 Listing 3-32 dsl.php 12345678910111213141516&lt;?phprequire_once('partial_generator.php');# Define a multiply functionfunction multiply($a,$b) &#123; return $a * $b;&#125;# And then create two ways to count in# dozens, depending on your industry$programmers_dozens = partial('multiply', 12);$bakers_dozens = partial('multiply', 13);var_dump( $programmers_dozens(2) );var_dump( $bakers_dozens(2) ); Listing 3-33 dsl-output.txt 12int(24)int(26) DSL DSL # 612-122-10CPHPmango_temp3-343-35 Listing 3-34 sums1.php 1234567891011121314151617181920212223242526272829&lt;?phpfunction double($number) &#123; return $number * 2; &#125;;function negate($number) &#123; return -$number; &#125;;function add_two($number) &#123; return $number + 2; &#125;;function mango_temp ($num_mangos) &#123; return add_two( negate ( double ( $num_mangos ) ) );&#125;;echo mango_temp(6)."C\n"; Listing 3-35 sums1-output.txt 1-10C   PHPPHP3-36 Listing 3-36 compose.php 1234567891011121314151617181920212223242526272829303132&lt;?php# This is a special function which simply returns it's input,# and is called the "identity function" in functional programming.function identity ($value) &#123; return $value; &#125;;# This function takes a list of "callables" (function names, closures etc.)# and returns a function composed of all of them, using array_reduce to# reduce them into a single chain of nested functions.function compose(...$functions)&#123; return array_reduce( # This is the array of functions, that we are reducing to one. $functions, # This is the function that operates on each item in $functions and # returns a function with the chain of functions thus far wrapped in # the current one. function ($chain, $function) &#123; return function ($input) use ($chain, $function) &#123; return $function( $chain($input) ); &#125;; &#125;, # And this is the starting point for the reduction, which is where # we use our $identity function as it effectively does nothing 'identity' );&#125; Listing 3-37 sums2.php 123456789101112131415161718192021222324252627&lt;?phpinclude('compose.php');function double($number) &#123; return $number * 2; &#125;;function negate($number) &#123; return -$number; &#125;;function add_two($number) &#123; return $number + 2; &#125;;$mango_temp = compose( 'double', 'negate', 'add_two');echo $mango_temp(6)."C\n\n ";print_r ($mango_temp); Listing 3-38 sums2-output.txt 1234567891011121314151617181920212223242526272829303132333435-10CClosure Object( [static] =&gt; Array ( [chain] =&gt; Closure Object ( [static] =&gt; Array ( [chain] =&gt; Closure Object ( [static] =&gt; Array ( [chain] =&gt; identity [function] =&gt; double ) [parameter] =&gt; Array ( [$input] =&gt; &lt;required&gt; ) ) [function] =&gt; negate ) [parameter] =&gt; Array ( [$input] =&gt; &lt;required&gt; ) ) [function] =&gt; add_two ) [parameter] =&gt; Array ( [$input] =&gt; &lt;required&gt; )) 1  3-39 Listing 3-39 example2.php 123456789101112131415&lt;?phprequire_once('image_functions.php');require_once('stats_functions.php');require_once('data_functions.php');require_once('compose.php');$csv_data = file_get_contents('my_data.csv');$make_chart = compose( 'data_to_array', 'generate_stats', 'make_chart_image');file_put_contents('my_chart.png', $make_chart( $csv_data ) ); composecompose3-403-41PHPstr_repeat Listing 3-40 strrepeat.php 12345678910111213141516171819202122232425262728293031&lt;?phpinclude('compose.php');# A function to format a string for displayfunction display($string) &#123; echo "The string is : ".$string."\n";&#125;;# Our function to wrap str_repeat.# Note it takes one parameter, the $countfunction repeat_str($count) &#123; # This function returns another (closure) function, # which binds $count, and accepts a single parameter # $string. Note that *this* returned closure is the # actual function that gets used in compose(). return function ($string) use ($count) &#123; return str_repeat($string, $count); &#125;;&#125;;# Now let's compose those two functions together.$ten_chars = compose( repeat_str(10), 'display');# and run our composed functionecho $ten_chars('*'); Listing 3-41 strrepeat-output.txt 1The string is : ********** repeat_str10compose repeat_str10repeat_str10 repeat_str10compose$ string$ count10 repeat_ten_times$ stringarar    ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Provider]]></title>
    <url>%2F2020%2F03%2F24%2FLaravel-Provider%2F</url>
    <content type="text"><![CDATA[ LaravelLaravel  Laravelconfig/app.phpproviders Laravel Illuminate\Support\ServiceProviderregisterbootregister Artisanmake:provider 1php artisan make:provider RiakServiceProvider registerregister $app 1234567891011121314151617181920&lt;?phpnamespace App\Providers;use Riak\Connection;use Illuminate\Support\ServiceProvider;class RiakServiceProvider extends ServiceProvider&#123; /** * . * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton(Connection::class, function ($app) &#123; return new Connection(config('riak')); &#125;); &#125;&#125; registerRiak\Connection bindingssingletons bindingssingletons 1234567891011121314151617181920212223242526272829303132&lt;?phpnamespace App\Providers;use App\Contracts\ServerProvider;use App\Contracts\DowntimeNotifier;use App\Services\ServerToolsProvider;use Illuminate\Support\ServiceProvider;use App\Services\PingdomDowntimeNotifier;use App\Services\DigitalOceanServerProvider;class AppServiceProvider extends ServiceProvider&#123; /** * All of the container bindings that should be registered. * * @var array */ public $bindings = [ ServerProvider::class =&gt; DigitalOceanServerProvider::class, ]; /** * All of the container singletons that should be registered. * * @var array */ public $singletons = [ DowntimeNotifier::class =&gt; PingdomDowntimeNotifier::class, ServerToolsProvider::class =&gt; ServerToolsProvider::class, ];&#125; bootComposerboot 12345678910111213141516171819&lt;?phpnamespace App\Providers;use Illuminate\Support\ServiceProvider;class ComposerServiceProvider extends ServiceProvider&#123; /** * Perform post-registration booting of services. * * @return void */ public function boot() &#123; view()-&gt;composer('view', function () &#123; // &#125;); &#125;&#125; boot boot 1234567use Illuminate\Contracts\Routing\ResponseFactory;public function boot(ResponseFactory $response)&#123; $response-&gt;macro('caps', function ($value) &#123; // &#125;);&#125; config/app.phpproviders Laravel  1234'providers' =&gt; [ //  App\Providers\ComposerServiceProvider::class,],  LaravelLaravel \Illuminate\Contracts\Support\DeferrableProviderprovidesprovides 1234567891011121314151617181920212223242526272829303132&lt;?phpnamespace App\Providers;use Riak\Connection;use Illuminate\Support\ServiceProvider;use Illuminate\Contracts\Support\DeferrableProvider;class RiakServiceProvider extends ServiceProvider implements DeferrableProvider&#123; /** * Register the service provider. * * @return void */ public function register() &#123; $this-&gt;app-&gt;singleton(Connection::class, function ($app) &#123; return new Connection($app['config']['riak']); &#125;); &#125; /** * Get the services provided by the provider. * * @return array */ public function provides() &#123; return [Connection::class]; &#125;&#125;  Illuminate\Support\ServiceProvider.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306&lt;?phpnamespace Illuminate\Support;use Illuminate\Console\Application as Artisan;use Illuminate\Contracts\Support\DeferrableProvider;abstract class ServiceProvider&#123; /** * The application instance. * * @var \Illuminate\Contracts\Foundation\Application */ protected $app; /** * The paths that should be published. * * @var array */ public static $publishes = []; /** * The paths that should be published by group. * * @var array */ public static $publishGroups = []; /** * Create a new service provider instance. * * @param \Illuminate\Contracts\Foundation\Application $app * @return void */ public function __construct($app) &#123; $this-&gt;app = $app; &#125; /** * Register any application services. * * @return void */ public function register() &#123; // &#125; /** * Merge the given configuration with the existing configuration. * * @param string $path * @param string $key * @return void */ protected function mergeConfigFrom($path, $key) &#123; if (! $this-&gt;app-&gt;configurationIsCached()) &#123; $this-&gt;app['config']-&gt;set($key, array_merge( require $path, $this-&gt;app['config']-&gt;get($key, []) )); &#125; &#125; /** * Load the given routes file if routes are not already cached. * * @param string $path * @return void */ protected function loadRoutesFrom($path) &#123; if (! $this-&gt;app-&gt;routesAreCached()) &#123; require $path; &#125; &#125; /** * Register a view file namespace. * * @param string|array $path * @param string $namespace * @return void */ protected function loadViewsFrom($path, $namespace) &#123; if (is_array($this-&gt;app-&gt;config['view']['paths'])) &#123; foreach ($this-&gt;app-&gt;config['view']['paths'] as $viewPath) &#123; if (is_dir($appPath = $viewPath.'/vendor/'.$namespace)) &#123; $this-&gt;app['view']-&gt;addNamespace($namespace, $appPath); &#125; &#125; &#125; $this-&gt;app['view']-&gt;addNamespace($namespace, $path); &#125; /** * Register a translation file namespace. * * @param string $path * @param string $namespace * @return void */ protected function loadTranslationsFrom($path, $namespace) &#123; $this-&gt;app['translator']-&gt;addNamespace($namespace, $path); &#125; /** * Register a JSON translation file path. * * @param string $path * @return void */ protected function loadJsonTranslationsFrom($path) &#123; $this-&gt;app['translator']-&gt;addJsonPath($path); &#125; /** * Register a database migration path. * * @param array|string $paths * @return void */ protected function loadMigrationsFrom($paths) &#123; $this-&gt;app-&gt;afterResolving('migrator', function ($migrator) use ($paths) &#123; foreach ((array) $paths as $path) &#123; $migrator-&gt;path($path); &#125; &#125;); &#125; /** * Register paths to be published by the publish command. * * @param array $paths * @param mixed $groups * @return void */ protected function publishes(array $paths, $groups = null) &#123; $this-&gt;ensurePublishArrayInitialized($class = static::class); static::$publishes[$class] = array_merge(static::$publishes[$class], $paths); foreach ((array) $groups as $group) &#123; $this-&gt;addPublishGroup($group, $paths); &#125; &#125; /** * Ensure the publish array for the service provider is initialized. * * @param string $class * @return void */ protected function ensurePublishArrayInitialized($class) &#123; if (! array_key_exists($class, static::$publishes)) &#123; static::$publishes[$class] = []; &#125; &#125; /** * Add a publish group / tag to the service provider. * * @param string $group * @param array $paths * @return void */ protected function addPublishGroup($group, $paths) &#123; if (! array_key_exists($group, static::$publishGroups)) &#123; static::$publishGroups[$group] = []; &#125; static::$publishGroups[$group] = array_merge( static::$publishGroups[$group], $paths ); &#125; /** * Get the paths to publish. * * @param string $provider * @param string $group * @return array */ public static function pathsToPublish($provider = null, $group = null) &#123; if (! is_null($paths = static::pathsForProviderOrGroup($provider, $group))) &#123; return $paths; &#125; return collect(static::$publishes)-&gt;reduce(function ($paths, $p) &#123; return array_merge($paths, $p); &#125;, []); &#125; /** * Get the paths for the provider or group (or both). * * @param string|null $provider * @param string|null $group * @return array */ protected static function pathsForProviderOrGroup($provider, $group) &#123; if ($provider &amp;&amp; $group) &#123; return static::pathsForProviderAndGroup($provider, $group); &#125; elseif ($group &amp;&amp; array_key_exists($group, static::$publishGroups)) &#123; return static::$publishGroups[$group]; &#125; elseif ($provider &amp;&amp; array_key_exists($provider, static::$publishes)) &#123; return static::$publishes[$provider]; &#125; elseif ($group || $provider) &#123; return []; &#125; &#125; /** * Get the paths for the provider and group. * * @param string $provider * @param string $group * @return array */ protected static function pathsForProviderAndGroup($provider, $group) &#123; if (! empty(static::$publishes[$provider]) &amp;&amp; ! empty(static::$publishGroups[$group])) &#123; return array_intersect_key(static::$publishes[$provider], static::$publishGroups[$group]); &#125; return []; &#125; /** * Get the service providers available for publishing. * * @return array */ public static function publishableProviders() &#123; return array_keys(static::$publishes); &#125; /** * Get the groups available for publishing. * * @return array */ public static function publishableGroups() &#123; return array_keys(static::$publishGroups); &#125; /** * Register the package's custom Artisan commands. * * @param array|mixed $commands * @return void */ public function commands($commands) &#123; $commands = is_array($commands) ? $commands : func_get_args(); Artisan::starting(function ($artisan) use ($commands) &#123; $artisan-&gt;resolveCommands($commands); &#125;); &#125; /** * Get the services provided by the provider. * * @return array */ public function provides() &#123; return []; &#125; /** * Get the events that trigger this service provider to register. * * @return array */ public function when() &#123; return []; &#125; /** * Determine if the provider is deferred. * * @return bool */ public function isDeferred() &#123; return $this instanceof DeferrableProvider; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Container]]></title>
    <url>%2F2020%2F03%2F22%2FLaravel-Container%2F</url>
    <content type="text"><![CDATA[ $a = Container::getInstance(A); boundbind LaravelLaravelLaravel Laravelsetter  12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpnamespace App\Http\Controllers;use App\User;use App\Repositories\UserRepository;use App\Http\Controllers\Controller;class UserController extends Controller&#123; /** * The user repository implementation. * * @var UserRepository */ protected $users; /** * Create a new controller instance. * * @param UserRepository $users * @return void */ public function __construct(UserRepository $users) &#123; $this-&gt;users = $users; &#125; /** * Show the profile for the given user. * * @param int $id * @return Response */ public function show($id) &#123; $user = $this-&gt;users-&gt;find($id); return view('user.profile', ['user' =&gt; $user]); &#125;&#125; UserControllerUserRepositoryEloquentUserRepositoryUserRepository  PHP  $this-&gt;appbind 1234// APIHttpClient$this-&gt;app-&gt;bind('HelpSpot\API', function ($app) &#123; return new HelpSpot\API($app-&gt;make('HttpClient'));&#125;);   singleton 123$this-&gt;app-&gt;singleton('HelpSpot\API', function ($app) &#123; return new HelpSpot\API($app-&gt;make('HttpClient'));&#125;);  instance 123$api = new HelpSpot\API(new HttpClient);$this-&gt;app-&gt;instance('HelpSpot\API', $api);   123$this-&gt;app-&gt;when('App\Http\Controllers\UserController') -&gt;needs('$variableName') -&gt;give($value); EventPusherRedisEventPusherRedisEventPusher 1234$this-&gt;app-&gt;bind( 'App\Contracts\EventPusher', 'App\Services\RedisEventPusher'); EventPusherRedisEventPusherEventPusher 123456789101112use App\Contracts\EventPusher;/** *  * * @param EventPusher $pusher * @return void */public function __construct(EventPusher $pusher)&#123; $this-&gt;pusher = $pusher;&#125; Illuminate\Contracts\Filesystem\FilesystemLaravel 12345678910111213141516use Illuminate\Support\Facades\Storage;use App\Http\Controllers\VideoController;use App\Http\Controllers\PhotoControllers;use Illuminate\Contracts\Filesystem\Filesystem;$this-&gt;app-&gt;when(PhotoController::class) -&gt;needs(Filesystem::class) -&gt;give(function () &#123; return Storage::disk('local'); &#125;);$this-&gt;app-&gt;when(VideoController::class) -&gt;needs(Filesystem::class) -&gt;give(function () &#123; return Storage::disk('s3'); &#125;); ReportReporttag 123456789$this-&gt;app-&gt;bind('SpeedReport', function () &#123; //&#125;);$this-&gt;app-&gt;bind('MemoryReport', function () &#123; //&#125;);$this-&gt;app-&gt;tag(['SpeedReport', 'MemoryReport'], 'reports'); tagged 123$this-&gt;app-&gt;bind('ReportAggregator', function ($app) &#123; return new ReportAggregator($app-&gt;tagged('reports'));&#125;); extendextend 123$this-&gt;app-&gt;extend(Service::class, function($service) &#123; return new DecoratedService($service);&#125;); make make 1$fooBar = $this-&gt;app-&gt;make('HelpSpot\API'); $appresolve 1$api = resolve('HelpSpot\API'); makeWith 1$api = $this-&gt;app-&gt;makeWith('HelpSpot\API', ['id' =&gt; 1]);  handle  12345678910111213141516171819202122232425262728293031323334&lt;?phpnamespace App\Http\Controllers;use App\Users\Repository as UserRepository;class UserController extends Controller&#123; /** *  */ protected $users; /** *  * * @param UserRepository $users * @return void */ public function __construct(UserRepository $users) &#123; $this-&gt;users = $users; &#125; /** * ID * * @param int $id * @return Response */ public function show($id) &#123; // &#125;&#125; resolving 1234567$this-&gt;app-&gt;resolving(function ($object, $app) &#123; // Called when container resolves object of any type...&#125;);$this-&gt;app-&gt;resolving(HelpSpot\API::class, function ($api, $app) &#123; // Called when container resolves objects of type "HelpSpot\API"...&#125;);  PSR-11LaravelPSR-11PSR-11Laravel 1234567use Psr\Container\ContainerInterface;Route::get('/', function (ContainerInterface $container) &#123; $service = $container-&gt;get('Service'); //&#125;); Psr\Container\NotFoundExceptionInterfacePsr\Container\ContainerExceptionInterface Container.php ArrayAccessArrayAccess 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;?phpnamespace Illuminate\Container;use ArrayAccess;class Container implements ArrayAccess&#123; /** * Determine if a given offset exists. * * @param string $key * @return bool */ public function offsetExists($key) &#123; return $this-&gt;bound($key); &#125; /** * Get the value at a given offset. * * @param string $key * @return mixed */ public function offsetGet($key) &#123; return $this-&gt;make($key); &#125; /** * Set the value at a given offset. * * @param string $key * @param mixed $value * @return void */ public function offsetSet($key, $value) &#123; $this-&gt;bind($key, $value instanceof Closure ? $value : function () use ($value) &#123; return $value; &#125;); &#125; /** * Unset the value at a given offset. * * @param string $key * @return void */ public function offsetUnset($key) &#123; unset($this-&gt;bindings[$key], $this-&gt;instances[$key], $this-&gt;resolved[$key]); &#125; /** * Dynamically access container services. * * @param string $key * @return mixed */ public function __get($key) &#123; return $this[$key]; &#125; /** * Dynamically set container services. * * @param string $key * @param mixed $value * @return void */ public function __set($key, $value) &#123; $this[$key] = $value; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788&lt;?phpnamespace Illuminate\Container;use ArrayAccess;class Container implements ArrayAccess&#123; /** * The current globally available container (if any). * * Container * * @var static */ protected static $instance; /** * Drop all of the stale instances and aliases. * * @param string $abstract * @return void */ protected function dropStaleInstances($abstract) &#123; unset($this-&gt;instances[$abstract], $this-&gt;aliases[$abstract]); &#125; /** * Remove a resolved instance from the instance cache. * * @param string $abstract * @return void */ public function forgetInstance($abstract) &#123; unset($this-&gt;instances[$abstract]); &#125; /** * Clear all of the instances from the container. * * @return void */ public function forgetInstances() &#123; $this-&gt;instances = []; &#125; /** * Flush the container of all bindings and resolved instances. * * @return void */ public function flush() &#123; $this-&gt;aliases = []; $this-&gt;resolved = []; $this-&gt;bindings = []; $this-&gt;instances = []; $this-&gt;abstractAliases = []; &#125; /** * Get the globally available instance of the container. * * @return static */ public static function getInstance() &#123; if (is_null(static::$instance)) &#123; static::$instance = new static; &#125; return static::$instance; &#125; /** * Set the shared instance of the container. * * @param \Illuminate\Contracts\Container\Container|null $container * @return \Illuminate\Contracts\Container\Container|static */ public static function setInstance(ContainerContract $container = null) &#123; return static::$instance = $container; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123&lt;?phpnamespace Illuminate\Container;use ArrayAccess;class Container implements ArrayAccess&#123; /** * An array of the types that have been resolved. * * @var bool[] */ protected $resolved = []; /** * The container's bindings. * * @var array[] */ protected $bindings = []; /** * The container's method bindings. * * @var \Closure[] */ protected $methodBindings = []; /** * The container's shared instances. * * Container * * * @var object[] */ protected $instances = []; /** * The registered type aliases. * * @var string[] */ protected $aliases = []; /** * The registered aliases keyed by the abstract name. * * @var array[] */ protected $abstractAliases = []; /** * The extension closures for services. * * @var array[] */ protected $extenders = []; /** * All of the registered tags. * * @var array[] */ protected $tags = []; /** * The stack of concretions currently being built. * * @var array[] */ protected $buildStack = []; /** * The parameter override stack. * * @var array[] */ protected $with = []; /** * The contextual binding map. * * @var array[] */ public $contextual = []; /** * All of the registered rebound callbacks. * * @var array[] */ protected $reboundCallbacks = []; /** * All of the global resolving callbacks. * * @var \Closure[] */ protected $globalResolvingCallbacks = []; /** * All of the global after resolving callbacks. * * @var \Closure[] */ protected $globalAfterResolvingCallbacks = []; /** * All of the resolving callbacks by class type. * * @var array[] */ protected $resolvingCallbacks = []; /** * All of the after resolving callbacks by class type. * * @var array[] */ protected $afterResolvingCallbacks = [];&#125; build buildbuildpublicprotected  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215/** * Instantiate a concrete instance of the given type. * * @param \Closure|string $concrete * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException */public function build($concrete)&#123; // If the concrete type is actually a Closure, we will just execute it and // hand back the results of the functions, which allows functions to be // used as resolvers for more fine-tuned resolution of these objects. //  if ($concrete instanceof Closure) &#123; return $concrete($this, $this-&gt;getLastParameterOverride()); &#125; try &#123; $reflector = new ReflectionClass($concrete); &#125; catch (ReflectionException $e) &#123; throw new BindingResolutionException("Target class [$concrete] does not exist.", 0, $e); &#125; // If the type is not instantiable, the developer is attempting to resolve // an abstract type such as an Interface or Abstract Class and there is // no binding registered for the abstractions so we need to bail out. if (! $reflector-&gt;isInstantiable()) &#123; // Instantiable able   return $this-&gt;notInstantiable($concrete); //  &#125; $this-&gt;buildStack[] = $concrete; // buildStackstring concrete $constructor = $reflector-&gt;getConstructor(); // If there are no constructors, that means there are no dependencies then // we can just resolve the instances of the objects right away, without // resolving any other types or dependencies out of these containers. if (is_null($constructor)) &#123; array_pop($this-&gt;buildStack); //  return new $concrete; &#125; $dependencies = $constructor-&gt;getParameters(); // Once we have all the constructor's parameters we can create each of the // dependency instances and then use the reflection instances to make a // new instance of this class, injecting the created dependencies in. try &#123; $instances = $this-&gt;resolveDependencies($dependencies); &#125; catch (BindingResolutionException $e) &#123; array_pop($this-&gt;buildStack); throw $e; &#125; array_pop($this-&gt;buildStack); return $reflector-&gt;newInstanceArgs($instances);&#125;/** * Resolve all of the dependencies from the ReflectionParameters. * *  * * @param \ReflectionParameter[] $dependencies * @return array * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function resolveDependencies(array $dependencies)&#123; $results = []; foreach ($dependencies as $dependency) &#123; // If the dependency has an override for this particular build we will use // that instead as the value. Otherwise, we will continue with this run // of resolutions and let reflection attempt to determine the result. if ($this-&gt;hasParameterOverride($dependency)) &#123; $results[] = $this-&gt;getParameterOverride($dependency); continue; &#125; // If the class is null, it means the dependency is a string or some other // primitive type which we can not resolve since it is not a class and // we will just bomb out with an error since we have no-where to go. $result = is_null(Util::getParameterClassName($dependency)) //  ? $this-&gt;resolvePrimitive($dependency) //  : $this-&gt;resolveClass($dependency); //  if ($dependency-&gt;isVariadic()) &#123; // Variadic   //  function demo( ...$parameter)&#123;&#125; $results = array_merge($results, $result); &#125; else &#123; $results[] = $result; &#125; &#125; return $results;&#125;/** * Resolve a non-class hinted primitive dependency. * * @param \ReflectionParameter $parameter * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function resolvePrimitive(ReflectionParameter $parameter)&#123; if (! is_null($concrete = $this-&gt;getContextualConcrete('$'.$parameter-&gt;getName()))) &#123; return $concrete instanceof Closure ? $concrete($this) : $concrete; &#125; if ($parameter-&gt;isDefaultValueAvailable()) &#123; return $parameter-&gt;getDefaultValue(); &#125; $this-&gt;unresolvablePrimitive($parameter);&#125;/** * Resolve a class based dependency from the container. * * @param \ReflectionParameter $parameter * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function resolveClass(ReflectionParameter $parameter)&#123; try &#123; return $parameter-&gt;isVariadic() ? $this-&gt;resolveVariadicClass($parameter) : $this-&gt;make(Util::getParameterClassName($parameter)); &#125; // If we can not resolve the class instance, we will check to see if the value // is optional, and if it is we will return the optional parameter value as // the value of the dependency, similarly to how we do this with scalars. catch (BindingResolutionException $e) &#123; if ($parameter-&gt;isDefaultValueAvailable()) &#123; return $parameter-&gt;getDefaultValue(); &#125; if ($parameter-&gt;isVariadic()) &#123; return []; &#125; throw $e; &#125;&#125;/** * Resolve a class based variadic dependency from the container. * * @param \ReflectionParameter $parameter * @return mixed */protected function resolveVariadicClass(ReflectionParameter $parameter)&#123; $className = Util::getParameterClassName($parameter); $abstract = $this-&gt;getAlias($className); if (! is_array($concrete = $this-&gt;getContextualConcrete($abstract))) &#123; return $this-&gt;make($className); &#125; return array_map(function ($abstract) &#123; return $this-&gt;resolve($abstract); &#125;, $concrete);&#125;/** * Throw an exception that the concrete is not instantiable. * * @param string $concrete * @return void * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function notInstantiable($concrete)&#123; if (! empty($this-&gt;buildStack)) &#123; $previous = implode(', ', $this-&gt;buildStack); $message = "Target [$concrete] is not instantiable while building [$previous]."; &#125; else &#123; $message = "Target [$concrete] is not instantiable."; &#125; throw new BindingResolutionException($message);&#125;/** * Throw an exception for an unresolvable primitive. * * @param \ReflectionParameter $parameter * @return void * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function unresolvablePrimitive(ReflectionParameter $parameter)&#123; $message = "Unresolvable dependency resolving [$parameter] in class &#123;$parameter-&gt;getDeclaringClass()-&gt;getName()&#125;"; throw new BindingResolutionException($message);&#125; Resolve 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667/** * Resolve the given type from the container. * * @param string $abstract * @param array $parameters * @param bool $raiseEvents * @return mixed * * @throws \Illuminate\Contracts\Container\BindingResolutionException */protected function resolve($abstract, $parameters = [], $raiseEvents = true)&#123; $abstract = $this-&gt;getAlias($abstract); $concrete = $this-&gt;getContextualConcrete($abstract); $needsContextualBuild = ! empty($parameters) || ! is_null($concrete); // If an instance of the type is currently being managed as a singleton we'll // just return an existing instance instead of instantiating new instances // so the developer can keep using the same objects instance every time. if (isset($this-&gt;instances[$abstract]) &amp;&amp; ! $needsContextualBuild) &#123; return $this-&gt;instances[$abstract]; &#125; $this-&gt;with[] = $parameters; if (is_null($concrete)) &#123; $concrete = $this-&gt;getConcrete($abstract); &#125; // We're ready to instantiate an instance of the concrete type registered for // the binding. This will instantiate the types, as well as resolve any of // its "nested" dependencies recursively until all have gotten resolved. if ($this-&gt;isBuildable($concrete, $abstract)) &#123; $object = $this-&gt;build($concrete); &#125; else &#123; $object = $this-&gt;make($concrete); &#125; // If we defined any extenders for this type, we'll need to spin through them // and apply them to the object being built. This allows for the extension // of services, such as changing configuration or decorating the object. foreach ($this-&gt;getExtenders($abstract) as $extender) &#123; $object = $extender($object, $this); &#125; // If the requested type is registered as a singleton we'll want to cache off // the instances in "memory" so we can return it later without creating an // entirely new instance of an object on each subsequent request for it. if ($this-&gt;isShared($abstract) &amp;&amp; ! $needsContextualBuild) &#123; $this-&gt;instances[$abstract] = $object; &#125; if ($raiseEvents) &#123; $this-&gt;fireResolvingCallbacks($abstract, $object); &#125; // Before returning, we will also set the resolved flag to "true" and pop off // the parameter overrides for this build. After those two things are done // we will be ready to return back the fully constructed class instance. $this-&gt;resolved[$abstract] = true; array_pop($this-&gt;with); return $object;&#125; with 123456789101112131415161718192021222324252627282930313233/** * Determine if the given dependency has a parameter override. * * @param \ReflectionParameter $dependency * @return bool */protected function hasParameterOverride($dependency)&#123; return array_key_exists( $dependency-&gt;name, $this-&gt;getLastParameterOverride() );&#125;/** * Get a parameter override for a dependency. * * @param \ReflectionParameter $dependency * @return mixed */protected function getParameterOverride($dependency)&#123; return $this-&gt;getLastParameterOverride()[$dependency-&gt;name];&#125;/** * Get the last parameter override. * * @return array */protected function getLastParameterOverride()&#123; return count($this-&gt;with) ? end($this-&gt;with) : [];&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP]]></title>
    <url>%2F2020%2F03%2F12%2FPHP%E4%B8%AD%E7%9A%84%E9%97%AD%E5%8C%85%2F</url>
    <content type="text"><![CDATA[ Closure useclone Closurebind $this PHP 123$sayHello = function($name)&#123; echo("Hello $name");&#125;; PHPClosure 1$sayHello("world");  1Hello world 1var_dump($sayHello instanceof Closure);  1boolean(true) useclone 1234567891011$name = 'world'; $sayHello = function() use($name)&#123; echo("Hello $name");&#125;; // ; $sayHello(); // (), Hello world $name = 'zj'; $sayHello();// Hello world use&amp; 1234567891011$name = 'world'; $sayHello = function() use(&amp;$name)&#123; //  echo("Hello $name");&#125;;//; $sayHello(); // (), Hello world $name = 'zj'; $sayHello();// Hello zj Closurebind()bindTo() Closure::bind  $this Closure::bindTo  $this bing 1234567891011121314151617181920Class User&#123; public $name = 'Tom'; public $age = 10; private $action = []; //...&#125;$sayHello = function()&#123; echo("Hello &#123;$this-&gt;name&#125;\n");&#125;; $swimming = function()&#123; echo("&#123;$this-&gt;name&#125; is swimming\n");&#125;; $bindSayHello = Closure::bind($sayHello, new User());$bindSwimming = Closure::bind($swimming, new User());$bindSayHello();$bindSwimming();  12Hello Tom Tom is swimming  123456789101112131415161718192021222324252627282930313233343536Class user&#123; public $name = 'Tom'; public $age = 10; private $action = []; public function addAction($actionName, $actionFunction)&#123; $this-&gt;action[$actionName] = Closure::bind($actionFunction, $this); &#125; public function doAction()&#123; foreach ($this-&gt;action as $actionFunction) &#123; $actionFunction($this-&gt;name); &#125; &#125;&#125; $sayHello = function()&#123; echo("Hello &#123;$this-&gt;name&#125;\n");&#125;; $swimming = function()&#123; echo("&#123;$this-&gt;name&#125; is swimming\n");&#125;; $bindSayHello = Closure::bind($sayHello, new user());$bindSayHello(); $user = new user(); $user-&gt;addAction('sayHello', $sayHello);$user-&gt;addAction('swimming', $swimming);$user-&gt;doAction();// // Hello Tom // Hello Tom // Tom is swimming bindTobind bindbindTo  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?php// $application = function($name) &#123; echo "this is a &#123;$name&#125; application\n";&#125;; // $auth = function($handler) &#123; return function($name) use ($handler) &#123; echo "&#123;$name&#125; need a auth middleware\n"; return $handler($name); &#125;;&#125;; // $filter = function($handler) &#123; return function($name) use ($handler) &#123; echo "&#123;$name&#125; need a filter middleware\n"; return $handler($name); &#125;;&#125;; // $log = function($handler) &#123; return function($name) use ($handler) &#123; $return = $handler($name); echo "&#123;$name&#125; need a log middleware\n"; return $return; &#125;;&#125;; // $stack = []; // function pack_middleware($handler, $stack)&#123; foreach (array_reverse($stack) as $key =&gt; $middleware) &#123; $handler = $middleware($handler); &#125; return $handler;&#125; // // $stack['log'] = $log;$stack['filter'] = $filter;$stack['auth'] = $auth; $run = pack_middleware($application, $stack);  1234Laravle need a filter middlewareLaravle need a auth middlewarethis is a Laravle applicationLaravle need a log middleware  (pack_middleware): 12$run = $log($filter($auth($application)));$run('Laravle');  (handler) return $handler($name)  php phpClosure  12345$closure = function ($name) &#123; return sprintf('Hello %s', $name);&#125;; echo $closure('Yee Jason');  Hello Yee Jason. $closure__invoke()()php__invoke()  phparray_mappreg_replace_callback()php 12345$numberPlusOne = array_map(function($number) &#123; return $number + 1;&#125;, [1, 2, 3]); print_r($numberPlusOne); PHP, php php 1234567function incrementNumber($number)&#123; return $number + 1;&#125; $numberPlusOne = array_map('incrementNumber', [1, 2, 3]);print_r($numberPlusOne);  1Array ( [0] =&gt; 2 [1] =&gt; 3 [2] =&gt; 4 )  phpjavascriptphpphpjavascriptphpbindTo()usephp useuse 12345678910function enclosePerson($name)&#123; return function ($doCommand) use ($name) &#123; return sprintf('%s, %s', $name, $doCommand); &#125;;&#125; $clay = enclosePerson('Clay'); echo $clay('get me sweet tea!'); Clay get me sweet tea use enclosePerson()$name $name  enclosePerson()$name$name bindTo php php$this __invoke()bindTo()bindTo() ClosurebindTo() php phpbindTo()URL$this  123456789101112131415161718192021222324252627class APP&#123; protected $routes = array(); protected $responseStatus = '200 ok'; protected $responseContentType = 'text/html'; protected $responseBody = 'hello world'; public function addRoute($routePath, $routeCallback) &#123; $this-&gt;routes[$routePath] = $routeCallback-&gt;bindTo($this, __CLASS__); &#125; public function dispath($currentPath) &#123; foreach ($this-&gt;routes as $routePath =&gt; $callback) &#123; if ($routePath == $currentPath) &#123; $callback(); &#125; &#125; header('HTTP/1.1'. $this-&gt;responseStatus); header('Content-type' . $this-&gt;responseContentType); header('Content-length' . $this-&gt;responseBody); echo $this-&gt;responseBody; &#125;&#125; addRoutedispatch() HTTP  AppApp  123456$app = new App();$app-&gt;addRoute('/users/josh', function () &#123; $this-&gt;responseContentType = 'application/json; charset=utf8'; $this-&gt;responseBody = '&#123;"name" : "yee Jason"&#125;';&#125;);$app-&gt;dispatch('/users/josh'); closuresPHP 123$func = function() &#123; &#125;; //  123456$func = function( $param ) &#123; echo $param;&#125;;$func( 'some string' );////some string PHPcreate function   12345678910111213141516171819202122232425262728293031323334////function printStr() &#123; $func = function( $str ) &#123; echo $str; &#125;; $func( 'some string' );&#125;printStr();////function getPrintStrFunc() &#123; $func = function( $str ) &#123; echo $str; &#125;; return $func;&#125;$printStrFunc = getPrintStrFunc();$printStrFunc( 'some string' );////function callFunc( $func ) &#123; $func( 'some string' );&#125;$printStrFunc = function( $str ) &#123; echo $str;&#125;;callFunc( $printStrFunc );//jscallFunc( function( $str ) &#123; echo $str;&#125;); USE 12345678910111213function getMoney() &#123; $rmb = 1; $dollar = 6; $func = function() use ( $rmb ) &#123; echo $rmb; echo $dollar; &#125;; $func();&#125;getMoney();////1//dorllar PHPuse  dollaruse  1234567891011121314function getMoney() &#123; $rmb = 1; $func = function() use ( $rmb ) &#123; echo $rmb; //$rmb1 $rmb++; &#125;; $func(); echo $rmb;&#125;getMoney();////1//1 use  &amp;  1234567891011121314function getMoney() &#123; $rmb = 1; $func = function() use ( &amp;$rmb ) &#123; echo $rmb; //$rmb1 $rmb++; &#125;; $func(); echo $rmb;&#125;getMoney();////1//2 use 12345678910111213141516function getMoneyFunc() &#123; $rmb = 1; $func = function() use ( &amp;$rmb ) &#123; echo $rmb; //$rmb1 $rmb++; &#125;; return $func;&#125;$getMoney = getMoneyFunc();$getMoney();$getMoney();$getMoney();////1//2//3 PHPCLASSjsPHPpreg_replace_callback (), $thisstaticself . 12Closure::bind($cl1, null, 'A'); //Closure::bind($cl2, new A(), 'A'); // $this, ::., , $this. Closure 12345678910111213141516171819202122232425262728//  $f$f = function () &#123; return 7;&#125;// $f(); // 7// ()function testClosure (Closure $callback) &#123; return $callback();&#125;// $f  testClosuretestClosuretestClosure($f);// testClosure (function () &#123; return 7;&#125;);// function getClosure () &#123; return function () &#123; return 7; &#125;;&#125;$c = getClosure(); //  $c $c(); //  7 ClosureClosureClosure  1234Closure &#123; public static Closure bind (Closure $closure , object $newthis [, mixed $newscope = 'static' ]) public Closure bindTo (object $newthis [, mixed $newscope = 'static' ]) &#125; Closure::bind  $this Closure::bindTo  $this Closure::bindClosure::bindToclosurenewthis NULL newscopestatic  Closure  FALSE 123456789101112131415161718192021222324252627282930313233343536class Animal &#123; private static $cat = "cat"; private $dog = "dog"; public $pig = "pig"; &#125; /* * Animal */ $cat = static function() &#123; return Animal::$cat; &#125;; /* * Animal */ $dog = function() &#123; return $this-&gt;dog; &#125;; /* * Animal */ $pig = function() &#123; return $this-&gt;pig; &#125;; $bindCat = Closure::bind($cat, null, new Animal());// Animal$this $bindDog = Closure::bind($dog, new Animal(), 'Animal');// AnimalAnimal$this $bindPig = Closure::bind($pig, new Animal());// Animal$this, echo $bindCat(),'&lt;br&gt;';// Animal echo $bindDog(),'&lt;br&gt;';// $this(Animal)Animal echo $bindPig(),'&lt;br&gt;';// $thisAnimal// bindTobind$bindCat = $cat-&gt;bindTo(null, 'Animal');  123catdogpig USE PHP use  12345678910111213function getMoney() &#123; $rmb = 1; $dollar = 6; $func = function() use ( $rmb ) &#123; echo $rmb; echo $dollar; &#125;; $func();&#125;getMoney();////1//dorllar dollaruse  1234567891011121314function getMoney() &#123; $rmb = 1; $func = function() use ( $rmb ) &#123; echo $rmb; //$rmb1 $rmb++; &#125;; $func(); echo $rmb;&#125;getMoney();////1//1 use &amp;  1234567891011121314151617function getMoneyFunc() &#123; $rmb = 1; $func = function() use ( &amp;$rmb ) &#123; echo $rmb; //$rmb1 $rmb++; &#125;; return $func;&#125;$getMoney = getMoneyFunc();$getMoney();$getMoney();$getMoney();////1//2//3  php5.3 1 2      PHPuse2 2$funcuse$paramcFunc()123$paramparams:456 123 use golang golangPHPgolang PHP ClosurePHPClosure  123456789Closure &#123;/*  */__construct ( void )public static bind ( Closure $closure , object $newthis [, mixed $newscope = 'static' ] ) : Closurepublic bindTo ( object $newthis [, mixed $newscope = 'static' ] ) : Closure Closure::__construct   Closure::bind  $thisClosure::bindTo  $thisClosure::bind$this closure newthis  NULL   $this  newscope  static  $this    staticprivateprotectedpublic   1234567891011bind catstring(3) &quot;cat&quot;bind dogstring(3) &quot;dog&quot;bind dog2Fatal error: Using $this when not in object context Closure::bindToClosure::bind() PHPuseClosureClosure::bind()Swoole  PHPuse PHPPHP  Closure Closure  ()(finally )  closuresPHP 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185$func = function() &#123; &#125;; //``` ```php$func = function( $param ) &#123; echo $param;&#125;;$func( 'some string' ); ////some string``` PHPcreate function  USEPHPuse```phpfunction getMoney() &#123; $rmb = 1; $func = function() use ( $rmb ) &#123; echo $rmb; //$rmb1 $rmb++; &#125;; $func(); echo $rmb; //&#125;getMoney(); ////1//1``` use( &amp; ```phpfunction getMoney() &#123; $rmb = 1; $func = function() use ( &amp;$rmb ) &#123; echo $rmb; //$rmb1 $rmb++; &#125;; $func(); echo $rmb;&#125;getMoney(); ////1//2```  use ()use()&amp;PHP Closure  PHP 5.3 Closure```phpClosure &#123; __construct ( void ) public static Closure bind (Closure $closure , object $newthis [, mixed $newscope = 'static' ]) public Closure bindTo (object $newthis [, mixed $newscope = 'static' ])&#125;``` Closure::\_\_construct  Closure::bind  $thisClosure::bindTo  $this  \_\_invoke  \_\_invoke()  closurenewthisNULLnewscope 'static'   Closure FALSE Closure::bindClosure::bindTo ```phpclass Animal &#123; public $cat = 'cat'; public static $dog = 'dog'; private $pig = 'pig'; private static $duck = 'duck';&#125; // $this // ::self,static, $cat = function() &#123; return $this-&gt;cat;&#125;; $dog = static function () &#123; return Animal::$dog;&#125;; $pig = function() &#123; return $this-&gt;pig;&#125;; $duck = static function() &#123; //return Animal::$duck;  return self::$duck; // return static::$duck&#125;; $bindCat = Closure::bind($cat, new Animal(), 'Animal');$bindCat2 = Closure::bind($cat, new Animal(), new Animal());echo $bindCat() . PHP_EOL;echo $bindCat2() . PHP_EOL; $bindDog = Closure::bind($dog, null, 'Animal');$bindDog2 = Closure::bind($dog, null, new Animal());echo $bindDog() . PHP_EOL;echo $bindDog2() . PHP_EOL; $bindPig = Closure::bind($pig, new Animal(), 'Animal');$bindPig2 = Closure::bind($pig, new Animal(), new Animal());echo $bindPig() . PHP_EOL;echo $bindPig2() . PHP_EOL; $bindDuck = Closure::bind($duck, null, 'Animal');$bindDuck2 = Closure::bind($duck, null, new Animal());echo $bindDuck() . PHP_EOL;echo $bindDuck2() . PHP_EOL;```  1.  $this,  $this  Closure::bind() 2null ($this,) static2.  static,Closure::bind()2null, 3staic.phpClosurePHP5.3useuse```php$a = function() use($b) &#123; &#125; 1 foreachhttp://php.net/manual/en/functions.anonymous.php Cart 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071&lt;?php// // closureclass Cart&#123; const PRICE_BUTTER = 1.00; const PRICE_MILK = 3.00; const PRICE_EGGS = 6.95; protected $products = array(); public function add($product, $quantity) &#123; $this-&gt;products[$product] = $quantity; &#125; public function getQuantity($product) &#123; return isset($this-&gt;products[$product]) ? $this-&gt;products[$product] : FALSE; &#125; public function getTotal($tax) &#123; $total = 0.00; $callback = function ($quantity, $product) use ($tax, &amp;$total) &#123; $pricePerItem = constant(__CLASS__ . "::PRICE_" . strtoupper($product)); $total += ($pricePerItem * $quantity) * ($tax + 1.0); &#125;; array_walk($this-&gt;products, $callback); return round($total, 2);; &#125;&#125; $my_cart = new Cart; // $my_cart-&gt;add('butter', 1);$my_cart-&gt;add('milk', 3);$my_cart-&gt;add('eggs', 6); //  5% .print $my_cart-&gt;getTotal(0.05) . "\n";// The result is 54.29?&gt;``` getTotalforeach 2 ```phpfunction html ($code , $id="", $class="")&#123; if ($id !== "") $id = " id = \"$id\"" ; $class = ($class !== "")? " class =\"$class\"":"&gt;"; $open = "&lt;$code$id$class"; $close = "&lt;/$code&gt;"; return function ($inner = "") use ($open, $close)&#123; return "$open$inner$close";&#125;; &#125; innerhtml 3  123456789101112131415161718192021&lt;?php $fib = function($n) use(&amp;$fib) &#123; if($n == 0 || $n == 1) return 1; return $fib($n - 1) + $fib($n - 2); &#125;; echo $fib(2) . "\n"; // 2 $lie = $fib; $fib = function()&#123;die('error');&#125;;//rewrite $fib variable echo $lie(5); // error because $fib is referenced by closure``` use&amp;&amp;fib(n-1)functionfib```php&lt;?php$recursive = function () use (&amp;$recursive)&#123;// The function is now available as $recursive&#125;  4 useuse 1234567891011121314151617&lt;?php$result = 0; $one = function()&#123; var_dump($result); &#125;; $two = function() use ($result)&#123; var_dump($result); &#125;; $three = function() use (&amp;$result)&#123; var_dump($result); &#125;; $result++; $one(); // outputs NULL: $result is not in scope$two(); // outputs int(0): $result was copied$three(); // outputs int(1)  PHP ClosurePHP5.3Closure 12345Closure &#123; __construct ( void ) public static Closure bind (Closure $closure , object $newthis [, mixed $newscope = 'static' ]) public Closure bindTo (object $newthis [, mixed $newscope = 'static' ])&#125;  Closure::__construct   Closure::bind  $this Closure::bindTo  $this __invoke __invoke()  Closure::bindClosure::bindTo Closure::bindClosure::bindTo 1public static Closure bind (Closure $closure , object $newthis [, mixed $newscope = 'static' ]) closure newthisNULL newscope static  ClosureFALSE  12345678910111213141516171819202122232425262728293031323334353637383940&lt;?php/** * $this * * @author  */class Animal &#123; private static $cat = "cat"; private $dog = "dog"; public $pig = "pig";&#125; /* * Animal */$cat = static function() &#123; return Animal::$cat;&#125;; /* * Animal */$dog = function() &#123; return $this-&gt;dog;&#125;; /* * Animal */$pig = function() &#123; return $this-&gt;pig;&#125;; $bindCat = Closure::bind($cat, null, new Animal());// Animal$this$bindDog = Closure::bind($dog, new Animal(), 'Animal');// AnimalAnimal$this$bindPig = Closure::bind($pig, new Animal());// Animal$this,echo $bindCat(),'&lt;br&gt;';// Animalecho $bindDog(),'&lt;br&gt;';// $this(Animal)Animalecho $bindPig(),'&lt;br&gt;';// $thisAnimal?&gt;  123catdogpig Closure::bindTo  $this 1public Closure Closure::bindTo (object $newthis [, mixed $newscope = 'static' ]) newthisNULLnewscope static $this$thisnewscope 1 12345678&lt;?phpfunction __autoload($class) &#123; require_once "$class.php";&#125; $template = new Template;$template-&gt;render(new Article, 'tpl.php');?&gt; Template.php  12345678910111213141516171819202122232425&lt;?php/** *  * * @author  */class Template&#123; /** *  * * @access public * @param obj  * @param string  */ public function render($context, $tpl)&#123; $closure = function($tpl)&#123; ob_start(); include $tpl; return ob_end_flush(); &#125;; $closure = $closure-&gt;bindTo($context, $context); $closure($tpl); &#125; &#125; Article.php  12345678910&lt;?php/** *  * * @author  */class Article&#123; private $title = ""; private $content = "";&#125; tpl.php  12345678910&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt; &lt;head&gt; &lt;meta http-equiv="Content-Type" content="text/html;charset=UTF-8"&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;&lt;?php echo $this-&gt;title;?&gt;&lt;/h1&gt; &lt;p&gt;&lt;?php echo $this-&gt;content;?&gt;&lt;/p&gt; &lt;/body&gt;&lt;/html&gt;  12 2 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?php/** *  * * @author  */trait DynamicTrait &#123; /** *  */ public function __call($name, $args) &#123; if(is_callable($this-&gt;$name))&#123; return call_user_func($this-&gt;$name, $args); &#125;else&#123; throw new \RuntimeException("Method &#123;$name&#125; does not exist"); &#125; &#125; /** *  */ public function __set($name, $value) &#123; $this-&gt;$name = is_callable($value)? $value-&gt;bindTo($this, $this): $value; &#125;&#125; /** *  * * @author  */class Animal &#123; use DynamicTrait; private $dog = 'dog';&#125; $animal = new Animal; // $dog$animal-&gt;getdog = function() &#123; return $this-&gt;dog;&#125;; echo $animal-&gt;getdog(); ?&gt;  1dog 3 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;?php/** *  * * @author  */class Cart &#123; //  const PRICE_BUTTER = 1.00; const PRICE_MILK = 3.33; const PRICE_EGGS = 8.88; protected $products = array(); /** *  * * @access public * @param string  * @param string  */ public function add($item, $quantity) &#123; $this-&gt;products[$item] = $quantity; &#125; /** *  * * @access public * @param string  */ public function getQuantity($item) &#123; return isset($this-&gt;products[$item]) ? $this-&gt;products[$item] : FALSE; &#125; /** *  * * @access public * @param string  */ public function getTotal($tax) &#123; $total = 0.00; $callback = function ($quantity, $item) use ($tax, &amp;$total) &#123; $pricePerItem = constant(__CLASS__ . "::PRICE_" . strtoupper($item)); $total += ($pricePerItem * $quantity) * ($tax + 1.0); &#125;; array_walk($this-&gt;products, $callback); return round($total, 2);; &#125;&#125; $my_cart = new Cart; // $my_cart-&gt;add('butter', 10);$my_cart-&gt;add('milk', 3);$my_cart-&gt;add('eggs', 12); //  5% .echo $my_cart-&gt;getTotal(0.05); ?&gt;  1132.88 USE  PHP- 123456function increment($value)&#123; return $value + 1;&#125;array_map('increment', [1, 2, 3]);  123array_map(function($value)&#123; return $value + 1;&#125;, [1, 2, 3]); PHP  12345$greet = function(string $name)&#123; echo "hello &#123;$name&#125;";&#125;$greet("jack") // hello jack Closure 1$greet instanceof Closure // true use 1234567$num = 1;$func = function() use($num)&#123; $num = $num + 1; echo $num;&#125;$func(); // 2echo $num; //  1  1234567$num = 1;$func = function() use(&amp;$num)&#123; $num = $num + 1; echo $num;&#125;$func(); // 2echo $num; // 2 PHP5.4$this 123456789101112class Foo &#123; public function bar() &#123; return function() &#123; return $this; &#125;; &#125;&#125;$foo = new Foo();$obj = $foo-&gt;bar(); // Closure()$obj(); // Foo  1234567891011class Foo &#123; public function bar() &#123; return static function() &#123; return $this; &#125;; &#125;&#125;$foo = new Foo();$obj = $foo-&gt;bar(); // Closure()$obj(); // Using $this when not in object context Closure 1234567Closure &#123; private __construct ( void ) public static bind ( Closure $closure , object $newthis [, mixed $newscope = "static" ] ) : Closure public bindTo ( object $newthis [, mixed $newscope = "static" ] ) : Closure public call ( object $newthis [, mixed $... ] ) : mixed public static fromCallable ( callable $callable ) : Closure&#125; __construct -  12$closure = new \Closure();// PHP Error: Instantiation of 'Closure' is not allowed Closure::bindTo -  $this  123456789101112131415161718192021222324// class Good &#123; private $price; public function __construct(float $price) &#123; $this-&gt;price = $price; &#125;&#125;// $addDiscount = function(float $discount = 0.8)&#123; return $this-&gt;price * $discount;&#125;$good = new Good(100);//  $good  Good$count = $addDiscount-&gt;bindTo($good, Good::class); $count(); // 80//  $good  $good $count = $addDiscount-&gt;bindTo($good); $count(); //  Closure::bind - bindTo  bindTo 1$count = \Closure::bind($addDiscount, $good, Good::class);  null 123456789101112131415//  10class Good &#123; static $num = 10;&#125;// $sell = static function() &#123; return"". --static::$num ;&#125;;//  Good $sold = \Closure::bind($sell, null, Good::class);$sold(); //  9$sold(); //  8 call - PHP7call 123456// call $addDiscount-&gt;call($good, 0.5); //  0.5 50// bindTo $count = $addDiscount-&gt;bindTo($good, Good::class); $count(0.5); // 50 fromCallable -  callable  123456789101112131415161718class Good &#123; private $price; public function __construct(float $price) &#123; $this-&gt;price = $price; &#125;&#125;function addDiscount(float $discount = 0.8)&#123; return $this-&gt;price * $discount;&#125;$closure = \Closure::fromCallable('addDiscount');$good = new Good(100);$count = $closure-&gt;bindTo($good); $count = $closure-&gt;bindTo($good, Good::class); // $count(); //  fromCallable  12$reflexion = new ReflectionFunction('addDiscount');$closure = $reflexion-&gt;getClosure(); fromCallable bindTo  1Cannot rebind scope of closure created by ReflectionFunctionAbstract::getClosure()]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel-Facade]]></title>
    <url>%2F2020%2F03%2F10%2FLaravel-Facade%2F</url>
    <content type="text"><![CDATA[ LaravelLaravel LaravelIlluminate\Support\Facades 12345use Illuminate\Support\Facades\Cache;Route::get('/cache', function () &#123; return Cache::get('key');&#125;); Laravel LaravelPHP  LaravelLaravelLaravelLaravel  vs.   12345use Illuminate\Support\Facades\Cache;Route::get('/cache', function () &#123; return Cache::get('key');&#125;);  Cache::get  12345678910111213141516use Illuminate\Support\Facades\Cache;/** * A basic functional test example. * * @return void */public function testBasicExample()&#123; Cache::shouldReceive('get') -&gt;with('key') -&gt;andReturn('value'); $this-&gt;visit('/cache') -&gt;see('value');&#125;  vs. Laravel HTTP  12return View::make('profile');return view('profile');  123Route::get('/cache', function () &#123; return cache('key');&#125;); cacheCacheget 12345678910111213141516use Illuminate\Support\Facades\Cache;/** * A basic functional test example. * * @return void */public function testBasicExample()&#123; Cache::shouldReceive('get') -&gt;with('key') -&gt;andReturn('value'); $this-&gt;visit('/cache') -&gt;see('value');&#125; LaravelFacadeLaravelIlluminate\Support\Facades\Facade getFacadeAccessorgetFacadeAccessorFacade__callStatic() LaravelCache get 123456789101112131415161718192021&lt;?phpnamespace App\Http\Controllers;use Cache;use App\Http\Controllers\Controller;class UserController extends Controller&#123; /** *  * * @param int $id * @return Response */ public function showProfile($id) &#123; $user = Cache::get('user:'.$id); return view('profile', ['user' =&gt; $user]); &#125;&#125; CacheIlluminate\Contracts\Cache\FactoryLaravel Illuminate\Support\Facades\Cacheget 1234567891011class Cache extends Facade&#123; /** *  * * @return string */ protected static function getFacadeAccessor() &#123; return 'cache'; &#125;&#125; CacheFacadegetFacadeAccessorCacheLaravelcache get PodcastpublishPublisher 12345678910111213141516171819202122&lt;?phpnamespace App;use App\Contracts\Publisher;use Illuminate\Database\Eloquent\Model;class Podcast extends Model&#123; /** * Publish the podcast. * * @param Publisher $publisher * @return void */ public function publish(Publisher $publisher) &#123; $this-&gt;update(['publishing' =&gt; now()]); $publisher-&gt;publish($this); &#125;&#125;  publish PublisherFacades 123456789101112131415161718192021&lt;?phpnamespace App;use Facades\App\Contracts\Publisher;use Illuminate\Database\Eloquent\Model;class Podcast extends Model&#123; /** * Publish the podcast. * * @return void */ public function publish() &#123; $this-&gt;update(['publishing' =&gt; now()]); Publisher::publish($this); &#125;&#125; FacadesLaravel 123456789101112131415161718192021222324252627&lt;?phpnamespace Tests\Feature;use App\Podcast;use Tests\TestCase;use Facades\App\Contracts\Publisher;use Illuminate\Foundation\Testing\RefreshDatabase;class PodcastTest extends TestCase&#123; use RefreshDatabase; /** * A test example. * * @return void */ public function test_podcast_can_be_published() &#123; $podcast = factory(Podcast::class)-&gt;create(); Publisher::shouldReceive('publish')-&gt;once()-&gt;with($podcast); $podcast-&gt;publish(); &#125;&#125; Facade123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137namespace Illuminate\Support\Facades;use Closure;use Mockery;use Mockery\MockInterface;use RuntimeException;abstract class Facade&#123; /** * The application instance being facaded. * * @var \Illuminate\Contracts\Foundation\Application */ protected static $app; //  /** * The resolved object instances. * * @var array */ protected static $resolvedInstance; //  public static function resolved(Closure $callback) &#123; $accessor = static::getFacadeAccessor(); if (static::$app-&gt;resolved($accessor) === true) &#123; $callback(static::getFacadeRoot()); &#125; &#125; /** * Get the registered name of the component. * * @return string * * @throws \RuntimeException */ protected static function getFacadeAccessor() &#123; throw new RuntimeException('Facade does not implement getFacadeAccessor method.'); &#125; /** * Get the root object behind the facade. * * @return mixed */ public static function getFacadeRoot() &#123; return static::resolveFacadeInstance(static::getFacadeAccessor()); &#125; /** * Resolve the facade root instance from the container. * * @param object|string $name * @return mixed */ protected static function resolveFacadeInstance($name) &#123; if (is_object($name)) &#123; return $name; &#125; if (isset(static::$resolvedInstance[$name])) &#123; return static::$resolvedInstance[$name]; &#125; if (static::$app) &#123; return static::$resolvedInstance[$name] = static::$app[$name]; &#125; &#125; /** * Clear a resolved facade instance. * * @param string $name * @return void */ public static function clearResolvedInstance($name) &#123; unset(static::$resolvedInstance[$name]); &#125; /** * Clear all of the resolved instances. * * @return void */ public static function clearResolvedInstances() &#123; static::$resolvedInstance = []; &#125; /** * Get the application instance behind the facade. * * @return \Illuminate\Contracts\Foundation\Application */ public static function getFacadeApplication() &#123; return static::$app; &#125; /** * Set the application instance. * * @param \Illuminate\Contracts\Foundation\Application $app * @return void */ public static function setFacadeApplication($app) &#123; static::$app = $app; &#125; /** * Handle dynamic, static calls to the object. * * @param string $method * @param array $args * @return mixed * * @throws \RuntimeException */ public static function __callStatic($method, $args) &#123; $instance = static::getFacadeRoot(); if (! $instance) &#123; throw new RuntimeException('A facade root has not been set.'); &#125; return $instance-&gt;$method(...$args); &#125;&#125; Event12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&lt;?phpnamespace Illuminate\Support\Facades;use Illuminate\Database\Eloquent\Model;use Illuminate\Support\Testing\Fakes\EventFake;/** * @method static void listen(string|array $events, \Closure|string $listener) * @method static bool hasListeners(string $eventName) * @method static void push(string $event, array $payload = []) * @method static void flush(string $event) * @method static void subscribe(object|string $subscriber) * @method static array|null until(string|object $event, mixed $payload = []) * @method static array|null dispatch(string|object $event, mixed $payload = [], bool $halt = false) * @method static array getListeners(string $eventName) * @method static \Closure makeListener(\Closure|string $listener, bool $wildcard = false) * @method static \Closure createClassListener(string $listener, bool $wildcard = false) * @method static void forget(string $event) * @method static void forgetPushed() * @method static \Illuminate\Events\Dispatcher setQueueResolver(callable $resolver) * @method static void assertDispatched(string $event, callable|int $callback = null) * @method static void assertDispatchedTimes(string $event, int $times = 1) * @method static void assertNotDispatched(string $event, callable|int $callback = null) * * @see \Illuminate\Events\Dispatcher */class Event extends Facade&#123; /** * Replace the bound instance with a fake. * * @param array|string $eventsToFake * @return \Illuminate\Support\Testing\Fakes\EventFake */ public static function fake($eventsToFake = []) &#123; static::swap($fake = new EventFake(static::getFacadeRoot(), $eventsToFake)); Model::setEventDispatcher($fake); Cache::refreshEventDispatcher(); return $fake; &#125; /** * Replace the bound instance with a fake during the given callable's execution. * * @param callable $callable * @param array $eventsToFake * @return callable */ public static function fakeFor(callable $callable, array $eventsToFake = []) &#123; $originalDispatcher = static::getFacadeRoot(); static::fake($eventsToFake); return tap($callable(), function () use ($originalDispatcher) &#123; static::swap($originalDispatcher); Model::setEventDispatcher($originalDispatcher); Cache::refreshEventDispatcher(); &#125;); &#125; /** * Get the registered name of the component. * * @return string */ protected static function getFacadeAccessor() &#123; return 'events'; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP]]></title>
    <url>%2F2020%2F03%2F06%2FPHP%E4%B8%AD%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E8%AE%A4%E8%AF%86%2F</url>
    <content type="text"><![CDATA[  12345function fun()&#123; fun1(); fun2();&#125; fun1()fun2()fun() fun function fun(){}HH : 1234567// $h = config_item("parser_fun");function fun($data)&#123; global $h; return $h();&#125; PHPPHP 123$c=get_class_name(); //$m=get_method_name(); //$k=$c-&gt;$m(); // 12    ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[php]]></title>
    <url>%2F2020%2F03%2F05%2F%E5%88%A9%E7%94%A8php%E6%95%B0%E7%BB%84%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[  forforeachwhile foreacharray_walk array_reduce 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647for ($index = 0; $index &lt; count($scope) -1; $index++) &#123; $total = 0; $online = []; $tmp_k = []; foreach ($rs as $k =&gt; $v) &#123; if ($max == 0) &#123; $max = $v['online']; $data['max']['value'] = $v['online']; $data['max']['time'] = $v['time']; &#125; else &#123; if ($max &lt;= $v['online']) &#123; $data['max']['value'] = $v['online']; $data['max']['time'] = $v['time']; $max = $v['online']; &#125; &#125; $stamp = $v['stamp']; if ($stamp &gt; $scope[$index] &amp;&amp; $stamp &lt; $scope[$index + 1]) &#123; array_push($online, $v['online']); array_push($tmp_k, $k); &#125; else &#123; break; &#125; &#125; foreach ($tmp_k as $key) &#123; unset($rs[$key]); &#125; if(count($online)) &#123; array_push($data['info'], max($online)); &#125; else &#123; array_push($data['info'], 'null'); &#125;&#125;    SQLJOINJOIN  123456789101112131415161718192021$maxInfo = array_reduce($rs, function($result, $item)&#123; if ($result['value'] &lt; $item['online']) &#123; $result['value'] = $item['online']; $result['time'] = $item['time']; &#125; return $result;&#125;, ['value' =&gt; 0]);$onlineInfo = array_map(function($item) use ($rs, $interval)&#123; $result = array_reduce($rs, function($value, $onlineItem) use ($item)&#123; $0 = abs($item - $onlineItem['stamp']); if($diff &lt;= $value['diff']) &#123; $value['diff'] = $diff; $value['val'] = $onlineItem['online']; &#125; return $value; &#125;, ['diff' =&gt; $interval, 'val' =&gt; 'null']); return $result['val'];&#125;, $scope);   PHParray_maparray_reducePHP4 array_filter array_map array_walk array_reduce 4 forforeachwhilePHP array_filter1234567891011121314151617181920$data = [ ['id' =&gt; 1, 'name' =&gt; '', '' =&gt; '', 'age' =&gt; 20], ['id' =&gt; 2, 'name' =&gt; '', '' =&gt; '', 'age' =&gt; 21], ['id' =&gt; 3, 'name' =&gt; '', '' =&gt; '', 'age' =&gt; 22], ['id' =&gt; 4, 'name' =&gt; '', '' =&gt; '', 'age' =&gt; 20], ['id' =&gt; 5, 'name' =&gt; '', '' =&gt; '', 'age' =&gt; 27], ['id' =&gt; 6, 'name' =&gt; '', '' =&gt; '', 'age' =&gt; 19], ['id' =&gt; 7, 'name' =&gt; '', '' =&gt; '', 'age' =&gt; 18],];$result = [];foreach ($data as $item) &#123; if ($item[''] == '') &#123; array_push($result, $item); &#125;&#125;  dataphp SQL 1select * from data where ='';  SQLSQLSQL PHPPHP PHP 123$result = array_filter($data, function($item)&#123; return $item[''] == '';&#125;); array_filter   SQLSQLwherearray_filterSQLwhere SQLPHP lambda SQLwherePHPwhereorandphpphpSQL array_map12345678$result = [];foreach ($data as $item) &#123; $item['gender'] = $item[''] == '' ? 'male' : 'female'; unset($item['']); array_push($result, $item); &#125;  SQL 1select id, name case  when '' then 'male' else 'female' end as gender from data; SQLcase when SQLPHP 1234567$result = array_map(function($item)&#123; return [ 'id' =&gt; $item['id'], 'name' =&gt; $item['name'], 'gender' =&gt; $item[''] == '' ? 'male' : 'female' ]&#125;, $data); PHP  array_mapSQLselectselectselectselectselectSQLphparray_map array_map  array_map() 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081&lt;?php$arr = [ 'goods' =&gt; '', 'spec' =&gt; [ 'attr' =&gt; [ '', '', ''], 'value' =&gt; [ '', '', 'The `` is hot' ] ]];print_r($arr);/*Array( [goods] =&gt;  [spec] =&gt; Array ( [attr] =&gt; Array ( [0] =&gt;  [1] =&gt;  [2] =&gt;  ) [value] =&gt; Array ( [0] =&gt;  [1] =&gt;  [2] =&gt; The `` is hot ) ))*/$arr['spec'] = array_map(function($item, $key)&#123; return [ 'attr' =&gt; $key, 'value' =&gt; $item, ]; &#125;, $arr['spec']['value'], $arr['spec']['attr']);print_r($arr);/*Array( [goods] =&gt;  [spec] =&gt; Array ( [0] =&gt; Array ( [attr] =&gt;  [value] =&gt;  ) [1] =&gt; Array ( [attr] =&gt;  [value] =&gt;  ) [2] =&gt; Array ( [attr] =&gt;  [value] =&gt; The `` is hot ) ))*/ array_walkarray_walkarray_maparray_filter array_walkforforeach 12345678foreach ($data as $item) &#123; echo $item['id'];&#125;array_walk($data, funcname($item)&#123; echo $item['id'];&#125;) foreacharray_walkarray_walkforeach  array_walkusearray_walkforeacharray_walkarray_walk array_filterarray_map array_walkforeach 3 1array_walk(array, myfunction, parameter...) 3 123456789$color = [ "a" =&gt; "red", "b" =&gt; "green", "c" =&gt; "blue"];array_walk($color, function($value, $key, $p)&#123; echo "$key $p $value&lt;br&gt;";&#125;, "has the value");  123a has the value redb has the value greenc has the value blue  12345678910111213141516171819202122$addDataArr = [ [ 'order_id' =&gt; 6, 'add_time' =&gt; "2020-03-05 19:50:05", 'add_time_sync' =&gt; "0000-00-00 00:00:00", 'status' =&gt; 0, 'item_id' =&gt; 24353454 ], [ 'order_id' =&gt; 7, 'add_time' =&gt; "2020-03-05 19:55:12", 'add_time_sync' =&gt; "0000-00-00 00:00:00", 'status' =&gt; 0, 'item_id' =&gt; 12454758 ]];$appendArr = ['add_time_sync' =&gt; date('Y-m-d H:i:s')];array_walk($addDataArr, function(&amp;$val, $k, $appendArr)&#123; $val = array_merge($val, $appendArr);&#125;, $appendArr);  1234567891011121314151617181920Array( [0] =&gt; Array ( [order_id] =&gt; 6 [add_time] =&gt; 2020-03-05 19:50:05 [add_time_sync] =&gt; 2020-03-05 19:54:17 [status] =&gt; 0 [item_id] =&gt; 24353454 ) [1] =&gt; Array ( [order_id] =&gt; 7 [add_time] =&gt; 2020-03-05 19:52:12 [add_time_sync] =&gt; 2020-03-05 19:54:17 [status] =&gt; 0 [item_id] =&gt; 12454758 )) array_reducearray_reducearray_reduce php 12345678910111213141516171819202122// $maxAge = 0;$result = null;foreach ($data as $item) &#123; if($item['age'] &gt; $maxAge) &#123; $maxAge = $item['age']; $result = $item; &#125;&#125;// $total = 0;foreach ($data as $item) &#123; $total += $item['age'];&#125;$avg = $total / count($data); PHP array_filterarray_walkarray_map array_reduce 1234567$result = array_reduce($data, function($curr, $item)&#123; return $curr['age'] &lt; $item['age'] ? $item : $curr;&#125;, ['age' =&gt; 0]);$avg = array_reduce($data, function($curr, $item)&#123; return $curr + $item['age'];&#125;, 0) / count($data); array_reduce 12345678function array_reduce($data, $callback, $initial)&#123; foreach ($data as $index =&gt; $val) &#123; $initial = $callback($initial, $val); &#125; return $initial;&#125; array_reduce33 $data $callback $initial$callback array_reduce 12345678910function array_reduce($data, $callback, $initial)&#123; if(count($data) == 0) &#123; return $initial; &#125; $item = array_shift($data); $initial = $callback($initial, $item); return array_reduce($data, $callback, $initial);&#125; array_reduceforeachforwhile 123456789$arr = [ ["id" =&gt; 1, 'name' =&gt; "a"], ["id" =&gt; 2, "name" =&gt; "c"], ["id" =&gt; 3, "name" =&gt; "d"]];echo ltrim(array_reduce($arr , function($result , $v)&#123; return $result.','.$v['id'];&#125;), ',');  array_walkarray_map1array_mapphptrimarray_walk 2array_maparray_walkecho 3mapwalk 1. 2.  3. 4. 5. 44]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hyperf-AOP]]></title>
    <url>%2F2020%2F03%2F05%2FHyperf-AOP%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[  AOPAspect Oriented ProgrammingAOP  OOP  Hyperf  AOP  Hyperf(Aspect) hyperf/di AOP  AOP  hyperf/di   AOP  (Around)  (Aspect) (ProxyClass)  (Aspect) (Aspect)(Aspect)  Hyperf\Di\Aop\AroundInterface public$classes$annotations  Hyperf\Di\Aop\AbstractAspect  123456789101112131415161718192021222324252627282930313233343536&lt;?phpnamespace App\Aspect;use App\Service\SomeClass;use App\Annotation\SomeAnnotation;use Hyperf\Di\Annotation\Aspect;use Hyperf\Di\Aop\AbstractAspect;use Hyperf\Di\Aop\ProceedingJoinPoint;/** * @Aspect */class FooAspect extends AbstractAspect&#123; //  ::  *  public $classes = [ SomeClass::class, 'App\Service\SomeClass::someMethod', 'App\Service\SomeClass::*Method', ]; //  public $annotations = [ SomeAnnotation::class, ]; public function process(ProceedingJoinPoint $proceedingJoinPoint) &#123; //  // $proceedingJoinPoint  process()  //  $result = $proceedingJoinPoint-&gt;process(); //  return $result; &#125;&#125;  (Aspect)  @Aspect  config/autoload/aspects.php   @Aspect  use Hyperf\Di\Annotation\Aspect;   AOP ./runtime/container/proxy/Aspect  Hyperf  php bin/hyperf.php di:init-proxy  vendor/bin/init-proxy.sh &amp;&amp; php bin/hyperf.php start ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Hyperf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hyperf-]]></title>
    <url>%2F2020%2F03%2F05%2FHyperf-%E6%B3%A8%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ PHPC#  Hyperf    Hyperfdoctrine/annotations  123/** * @AnnotationClass() */ @AnnotationClass()AnnotationClass use  HyperfHyperf\Di\Annotation\AnnotationCollector 3  class  @Controller  @AutoController  @ClassAnnotation  Foo  1234/** * @ClassAnnotation() */class Foo &#123;&#125;  @RequestMapping  @MethodAnnotation  Foo::bar()  12345678910class Foo&#123; /** * @MethodAnnotation() */ public function bar() &#123; // some code &#125;&#125;  @Value  @Inject  @PropertyAnnotation  Foo  $bar  1234567class Foo&#123; /** * @PropertyAnnotation() */ private $bar;&#125;  @DemoAnnotation(value) @DemoAnnotation(key1=value1, key2=value2) @DemoAnnotation(key={value1, value2})  123456789101112131415161718192021namespace App\Annotation;use Hyperf\Di\Annotation\AbstractAnnotation;/** * @Annotation * @Target(&#123;"METHOD","PROPERTY"&#125;) */class Bar extends AbstractAnnotation&#123; // some code&#125;/** * @Annotation * @Target("CLASS") */class Foo extends AbstractAnnotation&#123; // some code&#125;  @Annotation  @Target  use  @Target  METHOD PROPERTY CLASS ALL  Hyperf\Di\Annotation\AbstractAnnotation  Hyperf  Hyperf\Di\Annotation\AnnotationInterface  AnnotationCollector   Hyperf\Di\Annotation\AnnotationInterface  3  public function collectClass(string $className): void; public function collectMethod(string $className, ?string $target): void; public function collectProperty(string $className, ?string $target): void  Hyperf\Di\Annotation\AnnotationCollector ]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Hyperf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP]]></title>
    <url>%2F2020%2F03%2F05%2FPHP%E7%9A%84%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[ function a() { return (function(){}); }    if else  12345678&lt;?phpdeclare(strict_types=1);for ($i=0; $i &lt; 101; $i++) &#123; $results[] = $i;&#125; Generator 12345678910111213141516171819202122232425262728/** *  * */function handleArrYield1(array $data)&#123; return (function ($data) &#123; foreach ($data as $value) &#123; yield $value; &#125; &#125;);&#125;$yield1 = handleArrYield1($results);print_r($yield1); // Closure Object ( [parameter] =&gt; Array ( [$data] =&gt; ) )print_r($yield1($results)); // Generator Object ( )echo '&lt;br/&gt;';foreach ($yield1($results) as $key =&gt; $value) &#123; echo $value; echo "&lt;br/&gt;";&#125;  12345678910111213$data = function ($results)&#123; foreach ($results as $v) &#123; yield $v; &#125;&#125;;foreach ($data($results) as $key =&gt; $value) &#123; echo $value; echo "&lt;br/&gt;";&#125;  12345678910111213$data = function () use ($results)&#123; foreach ($results as $v) &#123; yield $v; &#125;&#125;;foreach ($data() as $key =&gt; $value) &#123; echo $value; echo "&lt;br/&gt;";&#125; 1234567891011121314151617181920212223242526/** *  * */function handleArrYield2(array $data)&#123; return (function ($data) &#123; foreach ($data as $value) &#123; yield $value; &#125; &#125;)($data);&#125;$yield2 = handleArrYield2($results);print_r($yield2); // Generator Object ( )echo "&lt;br/&gt;";foreach ($yield2 as $key =&gt; $value) &#123; echo $value; echo "&lt;br/&gt;";&#125; closure   PHP array_walkarray_map Object-oriented programmingProcedural programming  mapreduceMapReduce  PHP 1234567891011121314151617$grade = [ [ 'id' =&gt; 1, 'subject' =&gt; 'chinese', 'score' =&gt; 82 ], [ 'id' =&gt; 2, 'subject' =&gt; 'math', 'score' =&gt; 98 ], [ 'id' =&gt; 3, 'subject' =&gt; 'english', 'score' =&gt; 78 ],]; array_filter   1234// 80$arrayFilter = array_filter($grade, function($item)&#123; return $item['score'] &gt; 80 ;&#125;); array_map() -  123456789// $arrayMap = array_map(function($item)&#123; return [ 'id' =&gt; $item['id'], 'subject' =&gt; $item['subject'], 'score' =&gt; $item['score'], 'grade' =&gt; $item['score'] &gt;= 60 ? '' : '', ];&#125;, $grade); array_reduce() -  123456789// ,$maxScore = array_reduce($grade, function($init, $val)&#123; return $init['score'] &gt; $val['score'] ? $init : $val;&#125;, ['score' =&gt; 0]); // $avgScore = array_reduce($grade, function($init, $item)&#123; return $init + $item['score'];&#125;, 0) / count($grade); array_walk() -  1234// array_walk($grade, function(&amp;$item, $index)&#123; $item['grade'] = $item['score'] &gt;= 60 ? '' : '';&#125;); programming paradigm  First-class value  first class  expressionstatement computationI/O I/OI/O unit testingdebugging     whilefor]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP]]></title>
    <url>%2F2020%2F03%2F05%2FPHP%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%88%86%E6%B2%BB%E6%B3%95%2F</url>
    <content type="text"><![CDATA[   O(n)O(n)     1 12345678910111213141516171819202122232425262728293031323334class TreeNode&#123; public $val; public $left; public $right; function __construct($val, $left = null, $right = null) &#123; $this-&gt;val = intval($val); $this-&gt;left = $left; $this-&gt;right = $right; &#125;&#125;function preorder(TreeNode $root = null)&#123; $result = []; //  if ($root == null) &#123; return $result; &#125; //  $left = preorder($root-&gt;left); $right = preorder($root-&gt;right); // val $result[] = $root-&gt;val; $result = array_merge($result, $left, $right); return $result;&#125; 2   12345678910111213141516171819202122function maxPathSum(TreeNode $root = null)&#123; // 0 if ($root == null) &#123; return 0; &#125; //  $left = maxPathSum($root-&gt;left); $right = maxPathSum($root-&gt;right); //  if ($left &lt; 0 &amp;&amp; $right &lt; 0) &#123; return $root-&gt;val; &#125; else &#123; return $root-&gt;val + max($left, $right); &#125;&#125; 3 (LCA) 123456789101112131415161718192021222324252627function lca(TreeNode $root = null, TreeNode $A, TreeNode $B)&#123; if ($root == null || $root == $A || $root == $B) &#123; return $root; &#125; $left = lca($root-&gt;left, $A, $B); $right = lca($root-&gt;right, $A, $B); if ($left &amp;&amp; $right) &#123; return $root; &#125; elseif($left) &#123; return $left; &#125; elseif($right) &#123; return $right; &#125; else &#123; return null; &#125;&#125; 4 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?php $arr = [25,133,452,364,5876,293,607,365,8745,534,18,33]; function quick_sort($arr)&#123; //  if (count($arr) &lt;= 1) &#123; return $arr; &#125; $middle = $arr[0]; //  $left = array(); //  $right = array();//  //  for ($i=1; $i &lt; count($arr); $i++) &#123; if ($middle &lt; $arr[$i]) &#123; //  $right[] = $arr[$i]; &#125; else &#123; //  $left[] = $arr[$i]; &#125; &#125; //  $left = quick_sort($left); $right = quick_sort($right); //  return array_merge($left, array($middle), $right);&#125; var_dump($arr);var_dump(quick_sort($arr));]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP]]></title>
    <url>%2F2020%2F03%2F04%2FPHP%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%2F</url>
    <content type="text"><![CDATA[    PHP 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172class A&#123; protected $bObj; /** *  *  ABBC * * @param B $b [B] */ public function __construct(B $b) &#123; $this-&gt;bObj = $b; &#125; /** *  * * @param C $c [C] * @param string $param [] * @return void */ public function aa(C $c, $param) &#123; $c-&gt;cc(); echo "&lt;br/&gt;"; echo 'params:' . $param; &#125; /** *  * @return void */ public function aaa() &#123; $this-&gt;bObj-&gt;bbc(); &#125;&#125;class B&#123; protected $cObj; /** *  * * @param C $c [C] */ public function __construct(C $c) &#123; $this-&gt;cObj = $c; &#125; public function bb() &#123; echo 'this is B-&gt;bb()'; &#125; public function bbc() &#123; $this-&gt;cObj-&gt;cc(); &#125;&#125;class C&#123; public function cc() &#123; echo 'this is C-&gt;cc()'; &#125;&#125;  12345678910111213141516171819// IOCAABBC$aObj = IOC::getInstance('A');$aObj-&gt;aaa(); // this is C-&gt;cc()  // $aObjprint_r($aObj);// ABBC/*A Object( [bObj:protected] =&gt; B Object ( [cObj:protected] =&gt; C Object ( ) ))*/  123456789$methodResult = IOC::make('A', 'aa', ['this is param a']);print_r($methodResult);// /*this is C-&gt;cc()params:this is param a*/  php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135/** *  * */class IOC&#123; /* *  * * @param string $className [] * @return object  */ public static function getInstance($className) &#123; $paramArr = self::getMethodParams($className); return (new ReflectionClass($className))-&gt;newInstanceArgs($paramArr); /* A Object ( [bObj:protected] =&gt; B Object ( [cObj:protected] =&gt; C Object ( ) ) ) */ &#125; /** *  * * @param string $className [] * @param string $methodName [] * @param array $params [] * @return */ public static function make($className, $methodName, $params = []) &#123; //  $instance = self::getInstance($className); //  $paramArr = self::getMethodParams($className, $methodName); return $instance-&gt;&#123;$methodName&#125;(...array_merge($paramArr, $params)); &#125; /** *  * * @param string $className [] * @param string $methodsName [] * @return array [] */ protected static function getMethodParams($className, $methodsName = '__construct') &#123; //  $class = new ReflectionClass($className); // ReflectionClass Object ( [name] =&gt; A ) $paramArr = []; //  //  if ($class-&gt;hasMethod($methodsName)) &#123; //  $construct = $class-&gt;getMethod($methodsName); // ReflectionMethod Object ( [name] =&gt; __construct [class] =&gt; A ) //  $params = $construct-&gt;getParameters(); // Array ( [0] =&gt; ReflectionParameter Object ( [name] =&gt; b ) ) if (count($params) &gt; 0) &#123; //  foreach ($params as $key =&gt; $param) &#123; if ($paramClass = $param-&gt;getClass()) // ReflectionClass Object ( [name] =&gt; B ) &#123; //  $paramClassName = $paramClass-&gt;getName(); // B //  //  $args = self::getMethodParams($paramClassName); // print_r($args); /* Array ( ) Array ( [0] =&gt; C Object ( ) ) */ $paramArr[] = (new ReflectionClass($paramClass-&gt;getName()))-&gt;newInstanceArgs($args); // $argsarray &#125; &#125; &#125; &#125; // print_r($paramArr); /* Array ( ) Array ( [0] =&gt; C Object ( ) ) Array ( [0] =&gt; B Object ( [cObj:protected] =&gt; C Object ( ) ) ) */ return $paramArr; &#125;&#125; laravel 12345678910class Foo &#123; public $bar; public function __construct() &#123; $this-&gt;bar = new Bar(); &#125;&#125;$foo = new Foo(); Bar  123456789101112class Foo &#123; public $bar; public function __construct($bar) &#123; $this-&gt;bar = $bar; &#125;&#125;$bar = new Bar();$foo = new Foo($bar); BarFooBar laravel 1234567class SomeController &#123; public function index(Request $request) &#123; dd($request-&gt;all()); &#125;&#125; Request $request$request laravelPHP$request = new Request  1234567891011$method = new ReflectionMethod('SomeController', 'index');$args = [];foreach($method-&gt;getParameters() as $parameter) &#123; if ($class = $parameter-&gt;getClass()) &#123; $args[] = new $class-&gt;name; //$request = new Request &#125;&#125;$method-&gt;invokeArgs(new SomeController, $args); ReflectionMethodReflectionMethod::invokeArgs  new ReflectionClass(className) ReflectionMethod php]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hyperf-]]></title>
    <url>%2F2020%2F03%2F03%2FHyperf-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%2F</url>
    <content type="text"><![CDATA[   Hyperfhyperf/dihyperf/diAOP Hyperf IndexControllerUserServicegetInfoById(int $id) 12345678910namespace App\Service;class UserService&#123; public function getInfoById(int $id) &#123; // Info return (new Info())-&gt;fill($id); &#125;&#125; 123456789101112131415161718192021222324namespace App\Controller;use App\Service\UserService;class IndexController&#123; /** * @var UserService */ private $userService; //  public function __construct(UserService $userService) &#123; $this-&gt;userService = $userService; &#125; public function index() &#123; $id = 1; //  return $this-&gt;userService-&gt;getInfoById($id); &#125;&#125; IndexControllerDIControllerDInew nullablenullDInull 12345678910111213141516171819202122232425262728&lt;?phpnamespace App\Controller;use App\Service\UserService;class IndexController&#123; /** * @var null|UserService */ private $userService; //  nullable public function __construct(?UserService $userService) &#123; $this-&gt;userService = $userService; &#125; public function index() &#123; $id = 1; if ($this-&gt;userService instanceof UserService) &#123; //  $userService  return $this-&gt;userService-&gt;getInfoById($id); &#125; return null; &#125;&#125; @Inject1234567891011121314151617181920212223&lt;?phpnamespace App\Controller;use App\Service\UserService;use Hyperf\Di\Annotation\Inject;class IndexController&#123; /** *  `@Inject`  `@var`  * * @Inject * @var UserService */ private $userService; public function index() &#123; $id = 1; //  return $this-&gt;userService-&gt;getInfoById($id); &#125;&#125; @Injectuse Hyperf\Di\Annotation\Inject; Required Required1.1.0 @Injectrequiredtruefalse@varDInull 123456789101112131415161718192021222324252627&lt;?phpnamespace App\Controller;use App\Service\UserService;use Hyperf\Di\Annotation\Inject;class IndexController&#123; /** *  `@Inject`  `@var`  *  UserService  DI  null * * @Inject(required=false) * @var UserService */ private $userService; public function index() &#123; $id = 1; if ($this-&gt;userService instanceof UserService) &#123; //  $userService  return $this-&gt;userService-&gt;getInfoById($id); &#125; return null; &#125;&#125; ControllerUserServiceUserServiceInterfaceconfig/autoload/dependencies.php  1234567&lt;?phpnamespace App\Service;interface UserServiceInterface&#123; public function getInfoById(int $id);&#125; UserService 1234567891011&lt;?phpnamespace App\Service;class UserService implements UserServiceInterface&#123; public function getInfoById(int $id) &#123; //  Info  return (new Info())-&gt;fill($id); &#125;&#125; config/autoload/dependencies.php 1234&lt;?phpreturn [ \App\Service\UserServiceInterface::class =&gt; \App\Service\UserService::class]; UserServiceInterfaceUserService 123456789101112131415161718192021&lt;?phpnamespace App\Controller;use App\Service\UserServiceInterface;use Hyperf\Di\Annotation\Inject;class IndexController&#123; /** * @Inject * @var UserServiceInterface */ private $userService; public function index() &#123; $id = 1; //  return $this-&gt;userService-&gt;getInfoById($id); &#125;&#125; UserServiceUserServiceUserService UserService 123456789101112131415161718&lt;?php namespace App\Service;use Hyperf\Contract\ConfigInterface;use Psr\Container\ContainerInterface;class UserServiceFactory&#123; //  __invoke()  public function __invoke(ContainerInterface $container) &#123; $config = $container-&gt;get(ConfigInterface::class); //  key  cache.enable $enableCache = $config-&gt;get('cache.enable', false); // make(string $name, array $parameters = [])  new  make()  AOP  new  AOP  return make(UserService::class, compact('enableCache')); &#125;&#125; UserService  12345678910111213141516171819202122&lt;?phpnamespace App\Service;class UserService implements UserServiceInterface&#123; /** * @var bool */ private $enableCache; public function __construct(bool $enableCache) &#123; //  $this-&gt;enableCache = $enableCache; &#125; public function getInfoById(int $id) &#123; return (new Info())-&gt;fill($id); &#125;&#125;  config/autoload/dependencies.php  1234&lt;?phpreturn [ \App\Service\UserServiceInterface::class =&gt; \App\Service\UserServiceFactory::class];  UserServiceInterface  UserServiceFactory   @Value  Hyperf    Listener  EventDispatcherInterface  Psr\Container\ContainerInterface  container  PSR-11 :    PHP Hyperf DI   Hyperf\Di\Listener\LazyLoaderBootApplicationListener  config/autoload/listeners.php   BootApplication  lazy_loader  spl_autoload_register  12345678910111213141516171819&lt;?phpdeclare(strict_types=1);return [ Hyperf\Di\Listener\LazyLoaderBootApplicationListener::class,];Copy to clipboardErrorCopied config/autoload/lazy_loader.php &lt;?phpreturn [ /** *  =&gt;  * Hyperfruntime *  */ 'App\Service\LazyUserService' =&gt; \App\Service\UserServiceInterface::class];  App\Service\LazyUserService    12345678use App\Service\LazyUserService;class Foo&#123; public $service; public function __construct(LazyUserService $sevice)&#123; $this-&gt;service = $service; &#125;&#125;  @Inject(lazy=true)  12345678910use Hyperf\Di\Annotation\Inject;use App\Service\UserServiceInterface;class Foo&#123; /** * @Inject(lazy=true) * @var UserServiceInterface */ public $service;&#125;  1234567891011121314// $proxy-&gt;someMethod();// echo $proxy-&gt;someProperty;// $proxy-&gt;someProperty = 'foo';// isset($proxy-&gt;someProperty);// unset($proxy-&gt;someProperty);  DI         Hyperf\Utils\Context  new  make(string $name, array $parameters = [])  $name  $userService = make(UserService::class, [enableCache =&gt; true]);Copy to clipboardErrorCopied $name  get()   (Container) RPC  (Container)  (Container)  (Constructor)  @Inject  Psr\Container\ContainerInterface  Hyperf\Di\Container  12345678910111213141516171819&lt;?phpnamespace App\Controller;use Hyperf\HttpServer\Annotation\AutoController;use Psr\Container\ContainerInterface;class IndexController&#123; /** * @var ContainerInterface */ private $container; //  public function __construct(ContainerInterface $container) &#123; $this-&gt;container = $container; &#125;&#125;  (Container)  (Container)  \Hyperf\Utils\ApplicationContext::getContaienr()  (Container)  1$container = \Hyperf\Utils\ApplicationContext::getContainer(); 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phpdeclare(strict_types=1);/** * This file is part of Hyperf. * * @link https://www.hyperf.io * @document https://doc.hyperf.io * @contact group@hyperf.io * @license https://github.com/hyperf/hyperf/blob/master/LICENSE */namespace Hyperf\Di;interface MetadataCollectorInterface&#123; /** * Retrieve the metadata via key. * @param null|mixed $default */ public static function get(string $key, $default = null); /** * Set the metadata to holder. * @param mixed $value */ public static function set(string $key, $value): void; /** * Serialize the all metadata to a string. */ public static function serialize(): string; /** * Deserialize the serialized metadata and set the metadata to holder. */ public static function deserialize(string $metadata): bool; /** * Return all metadata array. */ public static function list(): array;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475&lt;?phpdeclare(strict_types=1);/** * This file is part of Hyperf. * * @link https://www.hyperf.io * @document https://doc.hyperf.io * @contact group@hyperf.io * @license https://github.com/hyperf/hyperf/blob/master/LICENSE */namespace Hyperf\Di;use Hyperf\Utils\Arr;abstract class MetadataCollector implements MetadataCollectorInterface&#123; /** * Subclass MUST override this property. * * @var array */ protected static $container = []; /** * Retrieve the metadata via key. * @param null|mixed $default */ public static function get(string $key, $default = null) &#123; return Arr::get(static::$container, $key) ?? $default; &#125; /** * Set the metadata to holder. * @param mixed $value */ public static function set(string $key, $value): void &#123; Arr::set(static::$container, $key, $value); &#125; /** * Determine if the metadata exist. * If exist will return true, otherwise return false. */ public static function has(string $key): bool &#123; return Arr::has(static::$container, $key); &#125; /** * Serialize the all metadata to a string. */ public static function serialize(): string &#123; return serialize(static::$container); &#125; /** * Deserialize the serialized metadata and set the metadata to holder. */ public static function deserialize(string $metadata): bool &#123; $data = unserialize($metadata); static::$container = $data; return true; &#125; public static function list(): array &#123; return static::$container; &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&lt;?phpdeclare(strict_types=1);/** * This file is part of Hyperf. * * @link https://www.hyperf.io * @document https://doc.hyperf.io * @contact group@hyperf.io * @license https://github.com/hyperf/hyperf/blob/master/LICENSE */namespace Hyperf\Di;use InvalidArgumentException;use ReflectionClass;use ReflectionMethod;use ReflectionProperty;class ReflectionManager extends MetadataCollector&#123; /** * @var array */ protected static $container = []; public static function reflectClass(string $className): ReflectionClass &#123; if (! isset(static::$container['class'][$className])) &#123; if (! class_exists($className) &amp;&amp; ! interface_exists($className)) &#123; throw new InvalidArgumentException("Class &#123;$className&#125; not exist"); &#125; static::$container['class'][$className] = new ReflectionClass($className); &#125; return static::$container['class'][$className]; &#125; public static function reflectMethod(string $className, string $method): ReflectionMethod &#123; $key = $className . '::' . $method; if (! isset(static::$container['method'][$key])) &#123; // TODO check interface_exist if (! class_exists($className)) &#123; throw new InvalidArgumentException("Class &#123;$className&#125; not exist"); &#125; static::$container['method'][$key] = static::reflectClass($className)-&gt;getMethod($method); &#125; return static::$container['method'][$key]; &#125; public static function reflectProperty(string $className, string $property): ReflectionProperty &#123; $key = $className . '::' . $property; if (! isset(static::$container['property'][$key])) &#123; if (! class_exists($className)) &#123; throw new InvalidArgumentException("Class &#123;$className&#125; not exist"); &#125; static::$container['property'][$key] = static::reflectClass($className)-&gt;getProperty($property); &#125; return static::$container['property'][$key]; &#125; public static function clear(): void &#123; static::$container = []; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Hyperf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[6]]></title>
    <url>%2F2020%2F01%2F18%2F%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E6%A0%91%2F</url>
    <content type="text"><![CDATA[          1                         nn15 0  17       2 2  3 3  4  BinaryTree()  getLeftChild()  getRightChild()  setRootVal(val) val getRootVal()  insertLeft(val)  insertRight(val)   3  1leftrightBinaryTreeBinaryTreeself.leftChild 1 BinaryTree 12345class BinaryTree: def __init__(self, rootObj): self.key = rootObj self.leftChild = None self.rightChild = None 136BinaryTree left2insertLeft 2  1234567def insertLeft(self, newNode): if self.leftChild == None: self.leftChild = BinaryTree(newNode) else: t = BinaryTree(newNode) t.left = self.leftChild self.leftChild = t 2else insertRight3insertRight 3  1234567def insertRight(self, newNode): if self.rightChild == None: self.rightChild = BinaryTree(newNode) else: t = BinaryTree(newNode) t.right = self.rightChild self.rightChild = t 4 4  1234567891011def getRightChild(self): return self.rightChilddef getLeftChild(self): return self.leftChilddef setRootVal(self, obj): self.key = objdef getRootVal(self): return self.key abcPythonkeyleftrightBinaryTree 1234567891011121314151617181920&gt;&gt;&gt; from pythonds.trees import BinaryTree&gt;&gt;&gt; r = BinaryTree('a')&gt;&gt;&gt; r.getRootVal()'a'&gt;&gt;&gt; print(r.getLeftChild())None&gt;&gt;&gt; r.insertLeft('b')&gt;&gt;&gt; print(r.getLeftChild())&lt;__main__.BinaryTree instance at 0x6b238&gt;&gt;&gt;&gt; print(r.getLeftChild().getRootVal())b&gt;&gt;&gt; r.insertRight('c')&gt;&gt;&gt; print(r.getRightChild())&lt;__main__.BinaryTree instance at 0x6b9e0&gt;&gt;&gt;&gt; print(r.getRightChild().getRootVal())c&gt;&gt;&gt; r.getRightChild().setRootVal('hello')&gt;&gt;&gt; print(r.getRightChild().getRootVal())hello&gt;&gt;&gt; 4 4  4 ((7 + 3) * (5 - 2))5 5 ((7 + 3) * (5 - 2)) 1036 6 ((7 + 3) * (5 - 2))     4 4 (1) ( (2) [+, -, /, *] (3)  (4) ) Python(3 + (4 * 5))[(, 3, +, (, 4, *, 5, ), )]7 7  7 (a)  (b) (1 (c) 333 (d) +2+ (e) (1 (f) 434 (g) *2* (h) 535 (i) )4* (j) )4++ getLeftChildgetRightChild StackBinaryTreePython5 5  1234567891011121314151617181920212223242526272829from pythonds.basic import Stackfrom pythonds.trees import BinaryTreedef buildParseTree(fpexp): fplist = fpexp.split() pStack = Stack() eTree = BinaryTree('') pStack.push(eTree) currentTree = eTree for i in fplist: if i == '(': currentTree.insertLeft('') pStack.push(currentTree) currentTree = currentTree.getLeftChild() elif i not in '+-*/)': currentTree.setRootVal(eval(i)) parent = pStack.pop() currentTree = parent elif i in '+-*/': currentTree.setRootVal(i) currentTree.insertRight('') pStack.push(currentTree) currentTree = currentTree.getRightChild() elif i == ')': currentTree = pStack.pop() else: raise ValueError("Unknown Operator: " + i) return eTree 511151924if4BinaryTreeStackelseValueError 78 evaluateevaluate 810330 evaluate10None7 6  1234567891011def evaluate(parseTree): opers = &#123;'+':operator.add, '-':operator.sub, '*':operator.mul, '/':operator.truediv&#125; leftC = parseTree.getLeftChild() rightC = parseTree.getRightChild() if leftC and rightC: fn = opers[parseTree.getRootVal()] return fn(evaluate(leftC), evaluate(rightC)) else: return parseTree.getRootVal() +-*/operatorfunction(param1, param2)opers[\+\](2, 2)operator.add(2, 2) 9evaluateevaluateparseTree9+operator.addPythonPythonevaluateevaluate3 operator.add*45operator.mul(4, 5)+operator.add(3, 20)(3 + (4 * 5))23 33       10 10  1preorder1preorder1.111.21.2.11.2.21.212  11treeNone 11  12345def preorder(tree): if tree: print(tree.getRootVal()) preorder(tree.getLeftChild()) preorder(tree.getRightChild()) preorderBinaryTree12selftreepreorder 12 BinaryTree 123456def preorder(self): print(self.key) if self.leftChild: self.left.preorder() if self.rightChild: self.right.preorder() preorder 13postorderpreorderprint 13  12345def postorder(tree): if tree != None: postorder(tree.getLeftChild()) postorder(tree.getRightChild()) print(tree.getRootVal()) 1013 14  123456789101112def postordereval(tree): opers = &#123;'+':operator.add, '-':operator.sub, '*':operator.mul, '/':operator.truediv&#125; res1 = None res2 = None if tree: res1 = postordereval(tree.getLeftChild()) res2 = postordereval(tree.getRightChild()) if res1 and res2: return opers[tree.getRootVal()](res1, res2) else: return tree.getRootVal() 14137810 153print 15  12345def inorder(tree): if tree != None: inorder(tree.getLeftChild()) print(tree.getRootVal()) inorder(tree.getRightChild()) 16 16  1234567def printexp(tree): sVal = "" if tree: sVal = '(' + printexp(tree.getLeftChild()) sVal = sVal + str(tree.getRootVal()) sVal = sVal + printexp(tree.getRightChild()) + ')' return sVal Pythonprintexppostordereval 1234567891011121314&gt;&gt;&gt; from pythonds.trees import BinaryTree&gt;&gt;&gt; x = BinaryTree('*')&gt;&gt;&gt; x.insertLeft('+')&gt;&gt;&gt; l = x.getLeftChild()&gt;&gt;&gt; l.insertLeft(4)&gt;&gt;&gt; l.insertRight(5)&gt;&gt;&gt; x.insertRight(7)&gt;&gt;&gt;&gt;&gt;&gt; print(printexp(x))(((4) + (5)) * (7))&gt;&gt;&gt;&gt;&gt;&gt; print(postordereval(x))63&gt;&gt;&gt; printexpprintexp 37 O(n)O(n log n)O(log n)    BinaryHeap() insert(k) findMin() delMin() isEmpty()TrueFalse size() buildHeap(list)  Python 12345678910111213&gt;&gt;&gt; from pythonds.trees import BinaryHeap&gt;&gt;&gt; bh = BinaryHeap()&gt;&gt;&gt; bh.insert(5)&gt;&gt;&gt; bh.insert(7)&gt;&gt;&gt; bh.insert(3)&gt;&gt;&gt; bh.insert(11)&gt;&gt;&gt; print(bh.delMin())3&gt;&gt;&gt; print(bh.delMin())5&gt;&gt;&gt; print(bh.delMin())7&gt;&gt;&gt; print(bh.delMin()) 1. 6.7.311 11  p2p2p+1Python n n/26-15 12  2. xppx12 3. currentSize17PythonheapList0 17  123def __init__(self): self.heapList = [0] self.currentSize = 0 insert 16 13  18percUpheapList02 18 percUp 1234567def percUp(self, i): while i // 2 &gt; 0: if self.heapList[i] &lt; self.heapList[i // 2]: tmp = self.heapList[i // 2] self.heapList[i // 2] = self.heapList[i] self.heapList[i] = tmp i = i // 2 insert19PythoninsertpercUppercUp 19  1234def insert(self, k): self.heapList.append(k) self.currentSize = self.currentSize + 1 self.percUp(self.currentSize) insertdelMindelMin6-17 14  20percDownminChildPython 20 percDownminChild 1234567891011121314151617def percDown(self, i): while (i * 2) &lt;= self.currentSize: mc = self.minChild(i) if self.heapList[i] &gt; self.heapList[mc]: tmp = self.heapList[i] self.heapList[i] = self.heapList[mc] self.heapList[mc] = tmp i = mcdef minChild(self, i): if i * 2 + 1 &gt; self.currentSize: return i * 2 else: if self.heapList[i*2] &lt; self.heapList[i*2+1]: return i * 2 else: return i * 2 + 1 delMin21percDown 21  1234567def delMin(self): retval = self.heapList[1] self.heapList[1] = self.heapList[self.currentSize] self.currentSize = self.currentSize - 1 self.heapList.pop() self.percDown(1) return retval O(log n)O(n)nO(n log n)O(n)22 22  1234567def buildHeap(self, alist): i = len(alist) // 2 self.currentSize = len(alist) self.heapList = [0] + alist[:] while (i &gt; 0): self.percDown(i) i = i  1 15 [9, 6, 5, 2, 3] 15buildHeappercDowni=19percDown923916 16 [9, 6, 5, 2, 3] O(n)log nbuildHeaplog n O(n)O(n log n)  Python Map() put(key, val) get(key)keykeyNone deldel map[key] len() inkey in mapTrueFalse  6-20 6-20  6-207031939414237370317070937070319394709393147031312331311414 BinarySearchTreeTreeNodeBinarySearchTreeTreeNodeBinarySearchTree23BinarySearchTree 23 BinarySearchTree 1234567891011121314class BinarySearchTree: def __init__(self): self.root = None self.size = 0 def length(self): return self.size def __len__(self): return self.size def __iter__(self): return self.root.__iter__() TreeNodeBinarySearchTree24TreeNode 24 TreeNode 12345678910111213141516171819202122232425262728293031323334353637383940414243class TreeNode: def __init__(self, key, val, left=None, right=None, parent=None): self.key = key self.payload = val self.leftChild = left self.rightChild = right self.parent = parent def hasLeftChild(self): return self.leftChild def hasRightChild(self): return self.rightChild def isLeftChild(self): return self.parent and \ self.parent.leftChild == self def isRightChild(self): return self.parent and \ self.parent.rightChild == self def isRoot(self): return not self.parent def isLeaf(self): return not (self.rightChild or self.leftChild) def hasAnyChildren(self): return self.rightChild or self.leftChild def hasBothChildren(self): return self.rightChild and self.leftChild def replaceNodeData(self, key, value, lc, rc): self.key = key self.payload = value self.leftChild = lc self.rightChild = rc if self.hasLeftChild(): self.leftChild.parent = self if self.hasRightChild(): self.rightChild.parent = self TreeNode6.4.2BinaryTreedel TreeNodePythonTreeNodeparentchildTreeNodeTreeNodeparentchild BinarySearchTreeTreeNodeputputBinarySearchTreeTreeNode_put   TreeNode 25_putcurrentNode 25  123456789101112131415161718def put(self, key, val): if self.root: self._put(key, val, self.root) else: self.root = TreeNode(key, val) self.size = self.size + 1def _put(self, key, val, currentNode): if key &lt; currentNode.key: if currentNode.hasLeftChild(): self._put(key, val, currentNode.leftChild) else: currentNode.leftChild = TreeNode(key, val, parent=currentNode) else: if currentNode.hasRightChild(): self._put(key, val, currentNode.rightChild) else: currentNode.rightChild = TreeNode(key, val, parent=currentNode)  put__setitem__put[]myZipTree[Plymouth] = 55446PythonPython__setitem__26 26 __setitem__ 12def __setitem__(self, k, v): self.put(k, v) 6-21 getput 6-21 19 get_get__getitem__27_get_put_getTreeNodegetBinarySearchTreeTreeNode_get __getitem__Pythonz = myZipTree[Fargo]27__getitem__get 27  12345678910111213141516171819202122def get(self, key): if self.root: res = self._get(key, self.root) if res: return res.payload else: return None else: return Nonedef _get(self, key, currentNode): if not currentNode: return None elif currentNode.key == key: return currentNode elif key &lt; currentNode.key: return self._get(key, currentNode.leftChild) else: return self._get(key, currentNode.rightChild)def __getitem__(self, key): return self.get(key) getBinarySearchTree__contains__in__contains__getgetTruegetNoneFalse28__contains__ 28  12345def __contains__(self, key): if self._get(key, self.root): return True else: return False __contains__in 12if 'Northfield' in myZipTree: print("oom ya ya") _getTreeNodedelete29 29 delete 12345678910111213141516def delete(self, key): if self.size &gt; 1: nodeToRemove = self._get(key, self.root) if nodeToRemove: self.remove(nodeToRemove) self.size = self.size  1 else: raise KeyError('Error, key not in tree') elif self.size == 1 and self.root.key == key: self.root = None self.size = self.size  1 else: raise KeyError('Error, key not in tree')def __delitem__(self, key): self.delete(key) 3 (1)22 6-22 16 (2)23 6-23 25 (3)24 6-24 5 130 30 1 12345if currentNode.isLeaf(): if currentNode == currentNode.parent.leftChild: currentNode.parent.leftChild = None else: currentNode.parent.rightChild = None 2316 (1) (2) (3)replaceNodeDatakeypayloadleftChildrightChild 31 2 12345678910111213141516171819202122232425else: #  if currentNode.hasLeftChild(): if currentNode.isLeftChild(): currentNode.leftChild.parent = currentNode.parent currentNode.parent.leftChild = currentNode.leftChild elif currentNode.isRightChild(): currentNode.leftChild.parent = currentNode.parent currentNode.parent.rightChild = currentNode.leftChild else: currentNode.replaceNodeData(currentNode.leftChild.key, currentNode.leftChild.payload, currentNode.leftChild.leftChild, currentNode.leftChild.rightChild) else: if currentNode.isLeftChild(): currentNode.rightChild.parent = currentNode.parent currentNode.parent.leftChild = currentNode.rightChild elif currentNode.isRightChild(): currentNode.rightChild.parent = currentNode.parent currentNode.parent.rightChild = currentNode.rightChild else: currentNode.replaceNodeData(currentNode.rightChild.key, currentNode.rightChild.payload, currentNode.rightChild.leftChild, currentNode.rightChild.rightChild) 3 332findSuccessorfindMinspliceOut34spliceOutdelete 32 3 12345elif currentNode.hasBothChildren(): #  succ = currentNode.findSuccessor() succ.spliceOut() currentNode.key = succ.key currentNode.payload = succ.payload 33TreeNode3 (1) (2) (3) findSuccessor findMinfindMinleftChild35remove 33  12345678910111213141516171819def findSuccessor(self): succ = None if self.hasRightChild(): succ = self.rightChild.findMin() else: if self.parent: if self.isLeftChild(): succ = self.parent else: self.parent.rightChild = None succ = self.parent.findSuccessor() self.parent.rightChild = self return succdef findMin(self): current = self while current.hasLeftChild(): current = current.leftChild return current 34 spliceOut 12345678910111213141516171819def spliceOut(self): if self.isLeaf(): if self.isLeftChild(): self.parent.leftChild = None else: self.parent.rightChild = None elif self.hasAnyChildren(): if self.hasLeftChild(): if self.isLeftChild(): self.parent.leftChild = self.leftChild else: self.parent.rightChild = self.leftChild self.leftChild.parent = self.parent else: if self.isLeftChild(): self.parent.leftChild = self.rightChild else: self.parent.rightChild = self.rightChild self.rightChild.parent = self.parent 35 remove 1234567891011121314151617181920212223242526272829303132333435363738def remove(self, currentNode):if currentNode.isLeaf(): #  if currentNode == currentNode.parent.leftChild: currentNode.parent.leftChild = Noneelse: currentNode.parent.rightChild = Noneelif currentNode.hasBothChildren(): # succ = currentNode.findSuccessor()succ.spliceOut()currentNode.key = succ.keycurrentNode.payload = succ.payloadelse: # if currentNode.hasLeftChild(): if currentNode.isLeftChild(): currentNode.leftChild.parent = currentNode.parentcurrentNode.parent.leftChild = currentNode.leftChildelif currentNode.isRightChild():currentNode.leftChild.parent = currentNode.parentcurrentNode.parent.rightChild = currentNode.leftChildelse: currentNode.replaceNodeData(currentNode.leftChild.key, currentNode.leftChild.payload,currentNode.leftChild.leftChild,currentNode.leftChild.rightChild) else:if currentNode.isLeftChild(): currentNode.rightChild.parent = currentNode.parentcurrentNode.parent.leftChild = currentNode.rightChildelif currentNode.isRightChild():currentNode.rightChild.parent = currentNode.parentcurrentNode.parent.rightChild = currentNode.rightChildelse: currentNode.replaceNodeData(currentNode.rightChild.key, currentNode.rightChild.payload,currentNode.rightChild.leftChild,currentNode.rightChild.rightChild)  Pythonyieldreturnyieldyield 36 __iter__ for x inTreeNode__iter__TreeNode  6-36  123456789def __iter__(self):if self:if self.hasLeftChild(): for elem in self.leftChild: yield elemyield self.key if self.hasRightChild():for elem in self.rightChild:yield elem put6.3 log2nn112242h+1-1h putO(log2n)nlog2nput n6-25putO(n) 25  putgetindelgetdelO(n)  6.7get  put  ( ) O n  AVL  G. M. Adelson-Velskii E. M. Landis AVLAVL ( ) ( ) balanceFactor height left SubTree height rightSubTree  AVL10 126 26  AVL 101O012 327 27  AVL   0 1 1 21 + 1 = 2 2 41 + 1 + 2 = 4 3 71 + 2 + 4 = 7 hhN    AVL i  F F    = iF  / 5iiF   hN N h = F h+2 1, h1   2 h  AVL1.44AVL (log ) O N  AVL  AVL     AVL  BinarySearchTree _putupdateBalance 6-37  8  15 updateBalance  _put  6-25  6-37  12345678910111213141516171819202122232425262728def _put(self, key, val, currentNode):if key &lt; currentNode.key:if currentNode.hasLeftChild():self._put(key, val, currentNode.leftChild) else:currentNode.leftChild = TreeNode(key, val,parent=currentNode) self.updateBalance(currentNode.leftChild) else: if currentNode.hasRightChild(): self._put(key, val, currentNode.rightChild) else: currentNode.rightChild = TreeNode(key, val, parent=currentNode) self.updateBalance(currentNode.rightChild) def updateBalance(self, node): if node.balanceFactor &gt; 1 or node.balanceFactor &lt; -1: self.rebalance(node) return if node.parent != None: if node.isLeftChild(): node.parent.balanceFactor += 1 elif node.isRightChild(): node.parent.balanceFactor -= 1 if node.parent.balanceFactor != 0: self.updateBalance(node.parent) updateBalanceupdateBalance 18updateBalance  AVLAVL 6-282 A 28    B  A BA B A A  29  2  C  E  C D E C  E  E  29382  10~13 6-28 rotateRight  rotateLeft   6-38  12345678910111213141516171819def rotateLeft(self, rotRoot): newRoot = rotRoot.rightChild rotRoot.rightChild = newRoot.leftChild if newRoot.leftChild != None: newRoot.leftChild.parent = rotRoot newRoot.parent = rotRoot.parent if rotRoot.isRoot(): self.root = newRoot else: if rotRoot.isLeftChild(): rotRoot.parent.leftChild = newRoot else: rotRoot.parent.rightChild = newRoot newRoot.leftChild = rotRoot rotRoot.parent = newRoot rotRoot.balanceFactor = rotRoot.balanceFactor + 1 \ - min(newRoot.balanceFactor, 0) newRoot.balanceFactor = newRoot.balanceFactor + 1 \ + max(rotRoot.balanceFactor, 0) 16~19 30  30 B  D ACE  x xh ( )( )A CA DnewBal B h holdBal B h h  D  1 max( , )C Eh h   D Ch Eh  2  ( ) (1 max( , ))A C EoldBal B h h h     ( ) newBal B ( ) ( ) ( (1 max( , )))( ) ( ) (1 max( , ))( ) ( ) 1 max( , )( ) ( ) 1 max( , )A C A C EA C A C EA A C E CC E CnewBal B oldBal B h h h h hnewBal B oldBal B h h h h hnewBal B oldBal B h h h h hnewBal B oldBal B h h h                   ( ) oldBal B  max( , ) max( , ) a b c a c b c     ( ) ( ) 1 max( , )C C E CnewBal B oldBal B h h h h     E Ch h   ( ) oldBal D   max( , ) min( , ) a b a b     ( ) ( ) 1 max(0, ( ))( ) ( ) 1 min(0, ( ))newBal B oldbal B oldBal DnewBal B oldBal B oldBal D    BrotRootDnewRoot6-3816 12rotRoot.balanceFactor = rotRoot.balanceFactor + 1 \- min(newRoot.balanceFactor, 0) D 31A2A 31  3231 32     333132CA 33  rebalance6-392if18elif2 6.11 6-39  12345678910111213def rebalance(self, node): if node.balanceFactor &lt; 0: if node.rightChild.balanceFactor &gt; 0: self.rotateRight(node.rightChild) self.rotateLeft(node) else: self.rotateLeft(node) elif node.balanceFactor &gt; 0: if node.leftChild.balanceFactor &lt; 0: self.rotateLeft(node.leftChild) self.rotateRight(node) else: self.rotateRight(node) get$O(\log_2n)$putput$\log_2n$$O(1)$put$O(\log_2n)$ AVL 5AVL6-1 6-1     AVL put $O(n)$ $O(1)$ $O(n)$ $O(\log_2n)$ get $O(\log_2n)$ $O(1)$ $O(n)$ $O(\log_2n)$ in $O(\log_2n)$ $O(1)$ $O(n)$ $O(\log_2n)$ del $O(n)$ $O(1)$ $O(n)$ $O(\log_2n)$    AVL   AVL                   / 1. 123456789101112&gt;&gt;&gt; r = BinaryTree(3)&gt;&gt;&gt; insertLeft(r, 4)[3, [4, [], []], []]&gt;&gt;&gt; insertLeft(r, 5)[3, [5, [4, [], []], []], []]&gt;&gt;&gt; insertRight(r, 6)[3, [5, [4, [], []], []], [6, [], []]]&gt;&gt;&gt; insertRight(r, 7)[3, [5, [4, [], []], []], [7, [], [6, [], []]]]&gt;&gt;&gt; setRootVal(r, 9)&gt;&gt;&gt; insertLeft(r, 11)[9, [11, [5, [4, [], []], []], []], [7, [], [6, [], []]]] 2. (4 * 8) / 6 - 3 3. [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] 4. [10, 9, 8, 7, 6, 5, 4, 3, 2, 1] 5.6. buildHeap 7.68886189945047666828.9. [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] 10. [10, 9, 8, 7, 6, 5, 4, 3, 2, 1] 11.preorder12.13.14.30 D  1.buildParseTree 2.buildParseTreeevaluateandornotnot 3.findSuccessor 4. 5. 6.nn 7.printexp 8.buildHeap$O(n\log n)$ 9. 10. 11.BinaryHeapPriorityQueuePriorityQueueenqueuedequeue 12.AVLdelete]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Python2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2]]></title>
    <url>%2F2020%2F01%2F16%2F%E7%AC%AC2%E7%AB%A0%EF%BC%9A%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[   O PythonO Python Python  1 2-1n0n 2-1 n 123456def sumOfN(n): theSum = 0 for i in range(1, n+1): theSum = theSum + i return theSum 2-2 2-2 n 1234567def foo(tom): fred = 0 for bill in range(1, tom+1): barney = bill fred = fred + barney return fred sumOfNfoo   sumOfNPythontimetime 2-3sumOfNtime510 000 12345678&gt;&gt;&gt; for i in range(5): print("Sum is %d required %10.7f seconds" % sumOfN(10000))Sum is 50005000 required 0.0018950 secondsSum is 50005000 required 0.0018620 secondsSum is 50005000 required 0.0019171 secondsSum is 50005000 required 0.0019162 secondsSum is 50005000 required 0.0019360 seconds&gt;&gt;&gt; 2-3  123456789101112import timedef sumOfN2(n): start = time.time() theSum = 0 for i in range(1, n+1): theSum = theSum + i end = time.time() return theSum, end-start 0.0019100 000 12345678&gt;&gt;&gt; for i in range(5): print("Sum is %d required %10.7f seconds" % sumOfN(100000))Sum is 5000050000 required 0.0199420 secondsSum is 5000050000 required 0.0180972 secondsSum is 5000050000 required 0.0194821 secondsSum is 5000050000 required 0.0178988 secondsSum is 5000050000 required 0.0188949 seconds&gt;&gt;&gt; 10n1 000 000 12345678&gt;&gt;&gt; for i in range(5): print("Sum is %d required %10.7f seconds" % sumOfN(1000000))Sum is 500000500000 required 0.1948988 secondsSum is 500000500000 required 0.1850290 secondsSum is 500000500000 required 0.1809771 secondsSum is 500000500000 required 0.1729250 secondsSum is 500000500000 required 0.1646299 seconds&gt;&gt;&gt; 10 2-4sumOfN3n $$\sum^n_{i=1}i=\frac{(n)(n+1)}{2}$$ 2-4 n 12def sumOfN3(n): return (n*(n+1))/2 sumOfN3n510 000100 0001 000 00010 000 000100 000 000 12345Sum is 50005000 required 0.00000095 secondsSum is 5000050000 required 0.00000191 secondsSum is 500000500000 required 0.00000095 secondsSum is 50000005000000 required 0.00000095 secondsSum is 5000000050000000 required 0.00000119 seconds nsumOfN3 nsumOfN3  O sumOfN1theSum = 0ntheSum = theSum + i$T$$T(n)=1+n$nn$T(n)$$1+n$ 100 0001000 $T(n)$$T(n)$n$T(n)$order of magnitude$\boldsymbol{O}$Oorder$O(f(n))$$f(n)$$T(n)$ $T(n)=1+n$n1$T(n)$1$O(n)$1$T(n)$n1 $T(n)=5n^2+27n+1005$n121005n$n^2$n$5n^2$n5$T(n)$$f(n)=n^2$$O(n^2)$  2-1$T(n)$n2-12-1nn 2-1 $\boldsymbol{O}$ $\boldsymbol{f(n)}$  $1$  $\log n$  $n$  $n\log n$  $n^2$  $n^3$  $2^n$  2-1 O 2-5Python 2-5 Python 123456789101112a = 5b = 6c = 10for i in range(n): for j in range(n): x = i * i y = j * j z = i * jfor k in range(n): w = a * k + 45 v = b * bd = 33 4$T(n)=3+3n^2+2n+1$1332$3n^2$3$n^2$3$2n$n41 $$T(n)=3+3n^2+2n+1=3n^2+2n+4$$ $n^2$$O(n^2)$n 2-2O$T(n)$$T(n)$n$T(n)$ 2-2 $T(n)$O heartearthpythontyphon26 1 12PythonNonePython212-6 2-6  1234567891011121314151617181920212223def anagramSolution1(s1, s2): alist = list(s2) pos1 = 0 stillOK = True while pos1 &lt; len(s1) and stillOK: pos2 = 0 found = False while pos2 &lt; len(alist) and not found: if s1[pos1] == alist[pos2]: found = True else: pos2 = pos2 + 1 if found: alist[pos2] = None else: stillOK = False pos1 = pos1 + 1 return stillOK s1ns2ns1n1n $$\sum^n_{i=1}i=\frac{n(n+1)}{2}=\frac{1}{2}n^2+\frac{1}{2}n$$ n$n^2$$\frac{1}{2}$$O(n^2)$ 2 s1s22-7Pythonsort 2-7  1234567891011121314151617def anagramSolution2(s1, s2): alist1 = list(s1) alist2 = list(s2) alist1.sort() alist2.sort() pos = 0 matches = True while pos &lt; len(s1) and matches: if alist1[pos] == alist2[pos]: pos = pos + 1 else: matches = False return matches $O(n)$$n$sort$O(n^2)$$O(n\log n)$ 3 s1s2s11n2$n-1$3$n-2$$n*(n-1)*(n-2)*\cdots*3*2*1$$n!$$n!$ n$n!$$2^n$s120$20!=2432902008176640000$77 146 816 596 4 abc262612-8 2-8  123456789101112131415161718192021def anagramSolution4(s1, s2): c1 = [0] * 26 c2 = [0] * 26 for i in range(len(s1)): pos = ord(s1[i]) - ord('a') c1[pos] = c1[pos] + 1 for i in range(len(s2)): pos = ord(s2[i]) - ord('a') c2[pos] = c2[pos] + 1 j = 0 stillOK = True while j &lt; 26 and stillOK: if c1[j] == c2[j]: j = j + 1 else: stillOK = False return stillOK 1n32626$T(n)=2n+26$$O(n)$ 4  PythonOPythonOPython Python  k$O(k)$ 0n4forrange2-94listfuns.py 2-9 4 123456789101112131415def test1(): l = [] for i in range(1000): l = l + [i]def test2(): l = [] for i in range(1000): l.append(i)def test3(): l = [i for i in range(1000)]def test4(): l = list(range(1000)) PythontimeitPython timeitTimerPython1Python2timeittimeit1001001timeitnumber1000 12345678910111213141516t1 = Timer("test1()", "from __main__ import test1")print("concat ", t1.timeit(number=1000), "milliseconds")t2 = Timer("test2()", "from __main__ import test2")print("append ", t2.timeit(number=1000), "milliseconds")t3 = Timer("test3()", "from __main__ import test3")print("comprehension ", t3.timeit(number=1000), "milliseconds")t4 = Timer("test4()", "from __main__ import test4")print("list range ", t4.timeit(number=1000), "milliseconds")# concat 6.54352807999 milliseconds# append 0.306292057037 milliseconds# comprehension 0.147661924362 milliseconds# list range 0.0655000209808 milliseconds test1()test2()fromimportPythonfrom __main__ import test1test1__main__timeittimeit 0.306.54rangefor 46.546.54 2-2OpoppoppopPythonPython2-2Python 2-2 Python$\boldsymbol{O}$  $\boldsymbol{O}$  $O(1)$  $O(1)$  $O(1)$ pop() $O(1)$ pop(i) $O(n)$ insert(i, item) $O(n)$  $O(n)$  $O(n)$  $O(n)$  $O(k)$  $O(n)$  $O(n+k)$  $O(n)$  $O(k)$  $O(n\log n)$  $O(nk)$ pop()pop(i)timeit 2-100.00034.821420016 000 from __main__ import xxpop10002000.05% 2-10 pop 12345678910popzero = timeit.Timer("x.pop(0)", "from __main__ import x")popend = timeit.Timer("x.pop()", "from __main__ import x")x = list(range(2000000))popzero.timeit(number=1000)# 4.8213560581207275x = list(range(2000000))popend.timeit(number=1000)# 0.0003161430358886719 pop(0)pop()pop(0)$O(n)$pop()$O(1)$2-11 2-11 pop(0)pop() 123456789popzero = Timer("x.pop(0)", "from __main__ import x")popend = Timer("x.pop()", "from __main__ import x")print("pop(0) pop()")for i in range(1000000, 100000001, 1000000): x = list(range(i)) pt = popend.timeit(number=1000) x = list(range(i)) pz = popzero.timeit(number=1000) print("%15.5f, %15.5f" % (pz, pt)) 2-3pop(0)pop()$O(n)$$O(1)$ 2-3 pop(0)pop() 1000 Python2-3O$O(n)$ 2-3 Python$\boldsymbol{O}$  $\boldsymbol{O}$  $O(n)$  $O(1)$  $O(1)$  $O(1)$  $O(1)$  $O(n)$ $O(n)$$O(1)$2-2  2-127x9x 2-12  12345678910import timeitimport randomfor i in range(10000, 1000001, 20000): t = timeit.Timer("random.randrange(%d) in x" % i, "from __main__ import random, x") x = list(range(i)) lst_time = t.timeit(number=1000) x = &#123;j:None for j in range(i)&#125; d_time = t.timeit(number=1000) print("%d, %10.3f, %10.3f" % (i, lst_time, d_time)) 2-410 00089.4990 00011 603$O(n)$10 0000.004990 0000.004 2-4    O          O 123for i in range(n): for j in range(n): k = 2 + 2 O 12for i in range(n): k = 2 + 2 O 1234i = nwhile i &gt; 0: k = 2 + 2 i = i // 2 O 1234for i in range(n): for j in range(n): for k in range(n): k = 2 + 2 O 1234i = nwhile i &gt; 0: k = 2 + 2 i = i // 2 O 123456for i in range(n): k = 2 + 2for j in range(n): k = 2 + 2for k in range(n): k = 2 + 2  1. 2. 3.del 4.k 5.$O(n\log n)$]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Python2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Laravel Facade]]></title>
    <url>%2F2020%2F01%2F14%2F%E7%BB%93%E5%90%88Laravel-Facade%E7%9C%8B%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%E6%80%8E%E4%B9%88%E7%94%A8%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[  facadelaravelfacade: laravelfacadeFacadeIlluminate\Support\Facades\Facade Auth::guard(customer)guarduse Illuminate\Support\Facades\Auth;Illuminate\Support\Facades\Authphp__callstatic() \vendor\laravel\framework\src\Illuminate\Support\Facades.php 12345678910public static function __callStatic($method, $args)&#123; $instance = static::getFacadeRoot(); if (! $instance) &#123; throw new RuntimeException('A facade root has not been set.'); &#125; return $instance-&gt;$method(...$args);&#125; $instance=static::getFacadeRoot();__callstatic 1234public static function getFacadeRoot()&#123; return static::resolveFacadeInstance(static::getFacadeAccessor());&#125; resolveFacadeInstance(static::getFacadeAccessor()) 1234protected static function getFacadeAccessor()&#123; throw new RuntimeException('Facade does not implement getFacadeAccessor method.');&#125; static::getFacadeAccessor()FacadeIlluminate\Support\Facades\Auth 1234protected static function getFacadeAccessor()&#123; return 'auth';&#125; resolveFacadeInstance($name) 123456789101112131415 protected static function resolveFacadeInstance($name)&#123; // laravelfacadegetFacadeAccessor if (is_object($name)) &#123; return $name; &#125; // , if (isset(static::$resolvedInstance[$name])) &#123; return static::$resolvedInstance[$name]; &#125; // ?!$resolvedInstance return static::$resolvedInstance[$name] = static::$app[$name];&#125; $applaravelioc laravelauth]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHPyield]]></title>
    <url>%2F2020%2F01%2F14%2FPHP%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%88%A9%E5%99%A8%EF%BC%9A%E7%94%9F%E6%88%90%E5%99%A8yield%E7%90%86%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ yield yieldforeach PythonC#PHPPHP5.5.0  PHP PHP   PHP 1234567891011function createRange($number)&#123; $data = []; for($i = 0; $i &lt; $number; $i++) &#123; $data[] = time(); &#125; return $data;&#125; PHP 1. 2.for$data 3.for$data  1234567$result = createRange(10); // foreach($result as $value)&#123; sleep(1); // 1 echo $value.'&lt;br/&gt;';&#125;  sleep(1) createRange$number10100000001000 createRangefor10001000$data$data   1234567function createRange($number)&#123; for($i = 0; $i &lt; $number; $i++) &#123; yield time(); &#125;&#125; $datatime()yield  1234567$result = createRange(10); // foreach($result as $value)&#123; sleep(1); echo $value.'&lt;br /&gt;';&#125; 1 sleep(1) createRangefor$dataforeach createRangeforeachforeachfor    123456789101112131415function createRange($number)&#123; for($i = 0; $i &lt; $number; $i++) &#123; yield time(); &#125;&#125;$result = createRange(10); // foreach($result as $value)&#123; sleep(1); echo $value.'&lt;br /&gt;';&#125;  1.createRange10forforeach 2.foreach$resultsleep(1)for 3.foreachfor 4.forforeach. 5.foreachforeachsleep(1)for1  $number   yield foreachPHPGeneratorforeachPHPGenerator foreach forforeachfor PHP PHPcsvtext5G text text 12345678910111213141516171819&lt;?phpheader("content-type:text/html;charset=utf-8");function readTxt()&#123; # code... $handle = fopen("./test.txt", 'rb'); while (feof($handle)===false) &#123; # code... yield fgets($handle); &#125; fclose($handle);&#125;foreach (readTxt() as $key =&gt; $value) &#123; # code... echo $value.'&lt;br /&gt;';&#125;   G yieldphp5.5yieldIterator yieldforeach  123456789101112131415161718192021222324252627/** *  * @param $start * @param $stop * @return Generator */ function squares($start, $stop) &#123; if ($start &lt; $stop) &#123; for ($i = $start; $i &lt;= $stop; $i++) &#123; yield $i =&gt; $i * $i; &#125; &#125; else &#123; for ($i = $start; $i &gt;= $stop; $i--) &#123; yield $i =&gt; $i * $i; // = &#125; &#125; &#125; foreach (squares(3, 15) as $n =&gt; $square) &#123; echo $n . squared is . $square . &lt;br&gt;; &#125;  12343 squared is 9 4 squared is 16 5 squared is 25 ... 2 1234567891011121314151617181920212223242526272829303132333435363738394041// $numbers = array(nike =&gt; 200, jordan =&gt; 500, adiads =&gt; 800); // function rand_weight($numbers) &#123; $total = 0; foreach ($numbers as $number =&gt; $weight) &#123; $total += $weight; $distribution[$number] = $total; &#125; $rand = mt_rand(0, $total-1); foreach ($distribution as $num =&gt; $weight) &#123; if ($rand &lt; $weight) return $num; &#125; &#125; //yield function mt_rand_weight($numbers) &#123; $total = 0; foreach ($numbers as $number =&gt; $weight) &#123; $total += $weight; yield $number =&gt; $total; &#125; &#125; function mt_rand_generator($numbers) &#123; $total = array_sum($numbers); $rand = mt_rand(0, $total -1); foreach (mt_rand_weight($numbers) as $num =&gt; $weight) &#123; if ($rand &lt; $weight) return $num; &#125; &#125; Laravel + ElasticSearch123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127/** * es * @param $container * @param $logger * @param $type */public static function syncUsersToEs($container, $logger, $type)&#123; list($builder, $currentTime) = [ $container-&gt;get(ClientBuilderFactory::class)-&gt;create(), time(), ]; $client = $builder-&gt;setHosts([env('ES_HOSTS', '')])-&gt;build(); $esFun = function ($data, $client) use ($type) &#123; $list = []; foreach ($data as $k =&gt; $va) &#123; if (count($list) &gt;= 500) &#123; $client-&gt;bulk([ 'index' =&gt; Users::ES_INDEX_NAME, 'type' =&gt; 'users', 'body' =&gt; $list ]); $list = []; &#125; else &#123; switch ($type) &#123; //  case 'update': array_push( $list, [ 'update' =&gt; [ '_id' =&gt; (int)$va['id'], '_index' =&gt; Users::ES_INDEX_NAME, '_type' =&gt; '_doc', ] ], ['doc' =&gt; $va] ); break; // es case 'create': array_push( $list, [ 'create' =&gt; [ '_id' =&gt; (int)$va['id'], '_index' =&gt; Users::ES_INDEX_NAME, '_type' =&gt; '_doc', ] ], $va ); break; &#125; &#125; &#125; if (!empty($list)) &#123; $res = $client-&gt;bulk(['index' =&gt; Videos::ES_INDEX_NAME, 'type' =&gt; 'sv_videos', 'body' =&gt; $list]); &#125; unset($list); &#125;; switch ($type) &#123; // es case 'create': Users::query() -&gt;select(['id', 'name', 'avatar', 'gender', 'mobile']) -&gt;where([ ['created_at', '&gt;=', date('Y-m-d H:i:s', $currentTime - 3600)] ]) -&gt;chunkById(1000, function ($results) use ($client, $esFun) &#123; //  $data = function () use ($results) &#123; foreach ($results-&gt;toArray() as $v) &#123; yield [ 'id' =&gt; (int)$v['id'], 'name' =&gt; (string)$v['name'], 'avatar' =&gt; (string)$v['avatar'], 'gender' =&gt; (int)$v['gender'], 'mobile' =&gt; (string)$v['mobile'], ]; &#125; &#125;; $esFun($data(), $client); &#125;); break; //  case 'update': Users::query() -&gt;select(['id', 'name', 'avatar', 'gender', 'mobile']) -&gt;where([ ['updated_at', '&gt;=', date('Y-m-d H:i:s', $currentTime - 3600)] ]) -&gt;chunkById(1000, function ($results) use ($client, $esFun) &#123; //  $data = function () use ($results) &#123; foreach ($results-&gt;toArray() as $v) &#123; yield [ 'id' =&gt; (int)$v['id'], 'name' =&gt; (string)$v['name'], 'avatar' =&gt; (string)$v['avatar'], 'gender' =&gt; (int)$v['gender'], 'mobile' =&gt; (string)$v['mobile'], ]; &#125; &#125;; $esFun($data(), $client); &#125;); break; &#125;&#125;]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[6 ]]></title>
    <url>%2F2020%2F01%2F08%2F%E7%AC%AC6%E7%AB%A0-%E6%A0%91%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[Database Sharding]]></title>
    <url>%2F2020%2F01%2F06%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E7%89%87%EF%BC%88Database-Sharding%EF%BC%89%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[  Sharding Shardinghorizontal partitioning horizontal partitioningvertical partitioning Shardinglogical shardslogical shardsphysical shardsphysical shardslogical shards Database shards Sharding Sharding horizontal scalingscaling outvertical scalingscaling upCPU   outage   AMNZGA-MN-ZA-M  PostgreSQLPostgreSQLPostgresPostgreSQLMySQL ClusterMongoDB Atlas       Range based sharding    Delivery Zone;               ]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F26%2F%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[  schoolGirl      1234567891011121314151617181920212223// class Pursuit&#123; SchoolGirl mm; public Pursuit(SchoolGirl mm) &#123; this.mm = mm; &#125; public void GiveDolls() &#123; Console.WriteLine(mm.Name + " "); &#125; public void GiveFlowers() &#123; Console.WriteLine(mm.Name + " "); &#125; public void GiveChocolate() &#123; Console.WriteLine(mm.Name + " "); &#125;&#125;  12345678910//class SchoolGirl&#123; private string name; public string Name &#123; get &#123; return name; &#125; set &#123; name = value; &#125; &#125;&#125;  1234567891011121314151617class Program&#123; static void Main(string[] args) &#123; SchoolGirl jiaojiao = new SchoolGirl(); jiaojiao.Name = ""; Pursuit zhuojiayi = new Pursuit(jiaojiao); zhuojiayi.GiveDolls(); zhuojiayi.GiveFlowers(); zhuojiayi.GiveChocolate(); Console.Read(); &#125;&#125;     1234567891011121314151617class Program&#123; static void Main(string[] args) &#123; SchoolGirl jiaojiao = new SchoolGirl(); jiaojiao.Name = ""; Proxy daili = new Proxy(jiaojiao); daili.GiveDolls(); daili.GiveFlowers(); daili.GiveChocolate(); Console.Read(); &#125;&#125; PursuitProxyPursuitPursuitProxySchoolGirlPursuitProxyProxyPursuitPursuit    1234567//interface GiveGift&#123; void GiveDolls(); void GiveFlowers(); void GiveChocolate();&#125;  12345678910111213141516171819202122class Pursuit : GiveGift&#123; SchoolGirl mm; public Pursuit(SchoolGirl mm) &#123; this.mm = mm; &#125; public void GiveDolls() &#123; Console.WriteLine(mm.Name + " "); &#125; public void GiveFlowers() &#123; Console.WriteLine(mm.Name + " "); &#125; public void GiveChocolate() &#123; Console.WriteLine(mm.Name + " "); &#125;&#125;  123456789101112131415161718192021222324class Proxy : GiveGift&#123; Pursuit gg; public Proxy(SchoolGirl mm) &#123; gg = new Pursuit(mm); &#125; public void GiveDolls() &#123; gg.GiveDolls(); &#125; public void GiveFlowers() &#123; gg.GiveFlowers(); &#125; public void GiveChocolate() &#123; gg.GiveChocolate(); &#125;&#125;  1234567891011121314151617class Program&#123; static void Main(string[] args) &#123; SchoolGirl jiaojiao = new SchoolGirl(); jiaojiao.Name = ""; Proxy daili = new Proxy(jiaojiao); daili.GiveDolls(); daili.GiveFlowers(); daili.GiveChocolate(); Console.Read(); &#125;&#125; 12 Proxy SubjectRealSubjectProxyRealSubjectProxy 1234abstract class Subject&#123; public abstract void Request();&#125; RealSubjectProxy 1234567class RealSubject : Subject&#123; public override void Request() &#123; Console.WriteLine(""); &#125;&#125; ProxySubject 12345678910111213class Proxy : Subject&#123; RealSubject realSubject; public override void Request() &#123; if (realSubject == null) &#123; realSubject = new RealSubject(); &#125; realSubject.Request(); &#125;&#125;  12345678910class Program&#123; static void Main(string[] args) &#123; Proxy proxy = new Proxy(); proxy.Request(); Console.Read(); &#125;&#125;   HTML  ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F25%2F%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[   .NET Framework         .NET 1 1  Aggregate Classes   1 Cursor 2 2  24 (1)IteratorFirst()Next()HasNext()CurrentItem() (2)ConcreteIterator (3)AggregateCreateIterator() (4)ConcreteAggregateCreateIterator()Concretelterator    1234567interface Iterator&#123; void First(); //  void Next(); //  bool HasNext(); //  object CurrentItem(); // &#125;  1234567891011121314151617181920212223242526272829303132class ConcreteIterator : Iterator &#123; private ConcreteAggregate objects; //  private int cursor; //  public ConcreteIterator(ConcreteAggregate objects) &#123; this.objects = objects; &#125; public void First() &#123; //  &#125; public void Next() &#123; //  &#125; public bool HasNext() &#123; //  return false; &#125; public object CurrentItem() &#123; //  return null; &#125;&#125;   1234interface Aggregate&#123; Iterator CreateIterator();&#125; CreateIterator() 123456789class ConcreteAggregate : Aggregate &#123; //...... public Iterator CreateIterator() &#123; return new ConcreteIterator(this); &#125; //......&#125;  1. AbstractObjectListAbstractObjectList3 3 AbstractObjectList 3Listobjects1 1 AbstractObjectList   AbstractObjectList() objects AddObject()  RemoveObject()  GetObjects()  Next()  IsLast()  Previous()  IsFirst()  GetNextItem()  GetPreviousItem()  AbstractObjectListProductListCustomerListAbstractObjectListAbstractObjectList 2. 4 4  4AbstractObjectListProductListAbstractlteratorProductlterator 3. (1)AbstractObjectList 1234567891011121314151617181920212223242526272829303132using System.Collections.Generic;namespace IteratorSample&#123; abstract class AbstractObjectList &#123; protected List&lt;object&gt; objects = new List&lt;object&gt;(); public AbstractObjectList(List&lt;object&gt; objects) &#123; this.objects = objects; &#125; public void AddObject(object obj) &#123; this.objects.Add(obj); &#125; public void RemoveObject(object obj) &#123; this.objects.Remove(obj); &#125; public List&lt;object&gt; GetObjects() &#123; return this.objects; &#125; //  public abstract AbstractIterator CreateIterator(); &#125;&#125; (2)ProductList 1234567891011121314151617using System.Collections.Generic;namespace IteratorSample&#123; class ProductList : AbstractObjectList &#123; public ProductList(List&lt;object&gt; products) : base(products) &#123; &#125; //  public override AbstractIterator CreateIterator() &#123; return new ProductIterator(this); &#125; &#125;&#125; (3)AbstractIterator 123456789101112namespace IteratorSample&#123; interface AbstractIterator &#123; void Next(); //  bool IsLast(); //  void Previous(); //  bool IsFirst(); //  object GetNextItem(); //  object GetPreviousItem(); //  &#125;&#125; (4)ProductIterator 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556using System.Collections.Generic;namespace IteratorSample&#123; class ProductIterator : AbstractIterator &#123; private ProductList productList; private List&lt;object&gt; products; private int cursor1; //  private int cursor2; //  public ProductIterator(ProductList list) &#123; this.productList = list; this.products = list.GetObjects(); //  cursor1 = 0; //  cursor2 = products.Count - 1; //  &#125; public void Next() &#123; if (cursor1 &lt; products.Count) &#123; cursor1++; &#125; &#125; public bool IsLast() &#123; return (cursor1 == products.Count); &#125; public void Previous() &#123; if (cursor2 &gt; -1) &#123; cursor2--; &#125; &#125; public bool IsFirst() &#123; return (cursor2 == -1); &#125; public object GetNextItem() &#123; return products[cursor1]; &#125; public object GetPreviousItem() &#123; return products[cursor2]; &#125; &#125;&#125; (5)Program 1234567891011121314151617181920212223242526272829303132333435363738394041424344using System;using System.Collections;using System.Collections.Generic;namespace IteratorSample&#123; class Program &#123; static void Main(string[] args) &#123; List&lt;object&gt; products = new List&lt;object&gt;(); products.Add(""); products.Add(""); products.Add(""); products.Add(""); products.Add(""); AbstractObjectList list; AbstractIterator iterator; list = new ProductList(products); //  iterator = list.CreateIterator(); //  Console.WriteLine(""); while(!iterator.IsLast()) &#123; Console.Write(iterator.GetNextItem() + ""); iterator.Next(); &#125; Console.WriteLine(); Console.WriteLine("-----------------------------"); Console.WriteLine(""); while(!iterator.IsFirst()) &#123; Console.Write(iterator.GetPreviousItem() + ""); iterator.Previous(); &#125; Console.Read(); &#125; &#125;&#125; 4.  12345 -----------------------------  ProductList 2 19.3ProductListProductlteratorProductList 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465using System.Collections.Generic;namespace IteratorSample&#123; class ProductListNew : AbstractObjectList &#123; public ProductListNew(List&lt;object&gt; products) : base(products) &#123; &#125; public override AbstractIterator CreateIterator() &#123; return new ProductIterator(); &#125; //  private class ProductIterator : AbstractIterator &#123; private int cursor1; private int cursor2; public ProductIterator() &#123; cursor1 = 0; cursor2 = objects.Count - 1; &#125; public void Next() &#123; if(cursor1 &lt; objects.Count) &#123; cursor1++; &#125; &#125; public bool IsLast() &#123; return (cursor1 == objects.Count); &#125; public void Previous() &#123; if(cursor2 &gt; -1) &#123; cursor2--; &#125; &#125; public bool IsFirst() &#123; return (cursor2 == -1); &#125; public object GetNextItem() &#123; return objects[cursor1]; &#125; public object GetPreviousItem() &#123; return objects[cursor2]; &#125; &#125; &#125;&#125; C#staticAbstractObjectListobjects 123...protected static List&lt;object&gt; objects = new List&lt;object&gt;();... this Createlterator() .NET.NET FrameworkSystem.Collections.IEnumeratorSystem.Collections.IEnumerableC#foreachIEnumerableIEnumerator .NetIEnumerable 1234public interface IEnumerable&#123; IEnumerator GetEnumerator(); // &#125; IEnumerator 123456789public interface IEnumerator&#123; object Current&#123; //  get; &#125; bool MoveNext(); //  void Reset(); // &#125; IEnumerableIEnumeratorIEnumerableNETICollectionIEnumerableIListICollectionArrayListIListGetEnumerator()ArrayListEnumeratorSimple ArrayList 123456789public class ArrayList : IList, ICloneable&#123; ... public virtual IEnumerator GetEnumerator() &#123; return new ArrayListEnumeratorSimple(this); &#125; ...&#125; ArrayListGetEnumerator()ArrayListIEnumerator .NETArrayListEnumeratorSimple 1234567891011121314151617181920212223[Serializable]private class ArrayListEnumeratorSimple : IEnumerator, ICloneable&#123; // Methods internal ArrayListEnumeratorSimple(ArrayList list) &#123; this.list = list; this.index = -1; this.version = list._version; this.currentElement = list; &#125; public object Clone()&#123;&#125;; public virtual bool MoveNext()&#123;&#125;; public virtual void Reset()&#123;&#125;; public virtual bool Current()&#123;&#125;; // Fields private object currentElement; private int index; private ArrayList list; private int version;&#125; ArrayListEnumeratorSimpleIEnumeratorMoveNext()Reset()CurrentinternalArrayListMoveNext()CurrentReset()ArrayList IEnumerableIEnumeratorArrayListArrayListEnumeratorSimple C#.NET Framework.NET Framework 12345678910111213141516171819202122232425262728293031323334using System;using System.Collections;using System.Collections.Generic;namespace IteratorSample&#123; class Program &#123; static void Process(IEnumerable e) &#123; IEnumerator i = e.GetEnumerator(); //  while (i.MoveNext()) &#123; Console.WriteLine(i.Current.ToString()); &#125; &#125; static void Main(string[] args) &#123; IList persons; persons = new ArrayList(); // ArrayList persons.Add(""); persons.Add(""); persons.Add(""); persons.Add(""); persons.Add(""); persons.Add(""); Process(persons); Console.Read(); &#125; &#125;&#125; Process()1EnumeratorIEnumerable 123456      C#Java C#Java  (1) (2) (3)  (1) (2)  (1) (2) (3) (1) (2)4 (3) (4): (5) (6).NET FrameworkIEnumeratorIEnumerable.NET Framework]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F25%2F%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[            //11+2+3-4+13 1 / C#C+Java1+2+3-4+1  : 1   /1+2+3-4+13 123expression ::= value | operationoperation ::= expression &apos;+&apos; expression | expression &apos;-&apos; expressionvalue ::= an integer // 3valueoperationoperationvalue::=operationvalue |{}*0|boolValue::=0|1boolValue01 Abstract Syntax TreeAST/1+2+3-4+12 2  valueoperation2 3 3  34 (1)AbstractExpression (2)TerminalExpression (3)NonterminalExpression (4)Context   1234abstract class AbstractExpression&#123; public abstract void Interpret(Context ctx);&#125;  1234567class TerminalExpression : AbstractExpression &#123; public override void Interpret(Context ctx) &#123; // &#125;&#125;  1234567891011121314151617class NonterminalExpression : AbstractExpression &#123; private AbstractExpression left; private AbstractExpression right; public NonterminalExpression(AbstractExpression left,AbstractExpression right) &#123; this.left=left; this.right=right; &#125; public override void Interpret(Context ctx) &#123; //interpret() // &#125; &#125; ContextHashtableListHashtablekey/value 12345678910111213141516class Context&#123; private Hashtable ht = new Hashtable(); // public void Assign(string key, string value) &#123; ht.Add(key,value); &#125; // public string Lookup(string key) &#123; return (string)ht[key]; &#125;&#125; ContextInterpret()  1. expressiondirectionactiondistanceupdownleftrightmoverunandcompositeup move 55down run 10 and left move 201020 2.  12345expression ::= direction action distance | composite //composite ::= expression &apos;and&apos; expression //direction ::= &apos;up&apos; | &apos;down&apos; | &apos;left&apos; | &apos;right&apos; //action ::= &apos;move&apos; | &apos;run&apos; //distance ::= an integer // 55directionactiondistanceexpressioncomposite 55directionactiondiatanceDirectionNodeActionNodeDistanceNodeexpressioncompositeSentenceNodeAndNode down run 10 and left move 204 4  5 5  5AbstractNodeDirectionNodeActionNodeDistanceNodeAndNodeSentenceNode 3. (1)AbstractNode 1234567namespace InterpreterSample&#123; abstract class AbstractNode &#123; public abstract string Interpret(); &#125;&#125; (2)AndNodeAnd 1234567891011121314151617181920namespace InterpreterSample&#123; class AndNode : AbstractNode &#123; private AbstractNode left; //And private AbstractNode right; //And public AndNode(AbstractNode left, AbstractNode right) &#123; this.left = left; this.right = right; &#125; //And public override string Interpret() &#123; return left.Interpret() + "" + right.Interpret(); &#125; &#125;&#125; (3)SentenceNode 12345678910111213141516171819202122namespace InterpreterSample&#123; class SentenceNode : AbstractNode &#123; private AbstractNode direction; private AbstractNode action; private AbstractNode distance; public SentenceNode(AbstractNode direction,AbstractNode action,AbstractNode distance) &#123; this.direction = direction; this.action = action; this.distance = distance; &#125; // public override string Interpret() &#123; return direction.Interpret() + action.Interpret() + distance.Interpret(); &#125; &#125;&#125; (4)DirectionNode 12345678910111213141516171819202122232425262728293031323334353637namespace InterpreterSample&#123; class DirectionNode : AbstractNode &#123; private string direction; public DirectionNode(string direction) &#123; this.direction = direction; &#125; // public override string Interpret() &#123; if (direction.Equals("up")) &#123; return ""; &#125; else if (direction.Equals("down")) &#123; return ""; &#125; else if (direction.Equals("left")) &#123; return ""; &#125; else if (direction.Equals("right")) &#123; return ""; &#125; else &#123; return ""; &#125; &#125; &#125;&#125; (5)ActionNode 1234567891011121314151617181920212223242526272829namespace InterpreterSample&#123; class ActionNode : AbstractNode &#123; private string action; public ActionNode(string action) &#123; this.action = action; &#125; // public override string Interpret() &#123; if (action.Equals("move")) &#123; return ""; &#125; else if (action.Equals("run")) &#123; return ""; &#125; else &#123; return ""; &#125; &#125; &#125;&#125; (6)DistanceNode 123456789101112131415161718namespace InterpreterSample&#123; class DistanceNode : AbstractNode &#123; private string distance; public DistanceNode(string distance) &#123; this.distance = distance; &#125; // public override string Interpret() &#123; return this.distance; &#125; &#125;&#125; (7)InstructionHandler123andand123andAnd 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354using System;using System.Collections;namespace InterpreterSample&#123; class InstructionHandler &#123; private AbstractNode node; public void Handle(string instruction) &#123; AbstractNode left = null, right = null; AbstractNode direction = null, action = null, distance = null; Stack stack = new Stack(); // string[] words = instruction.Split(' '); // for (int i = 0; i &lt; words.Length; i++) &#123; //andSentenceNodeandandand if (words[i].Equals("and")) &#123; left = (AbstractNode)stack.Pop(); // string word1= words[++i]; direction = new DirectionNode(word1); string word2 = words[++i]; action = new ActionNode(word2); string word3 = words[++i]; distance = new DistanceNode(word3); right = new SentenceNode(direction,action,distance); // stack.Push(new AndNode(left,right)); // &#125; //SentenceNode else &#123; string word1 = words[i]; direction = new DirectionNode(word1); string word2 = words[++i]; action = new ActionNode(word2); string word3 = words[++i]; distance = new DistanceNode(word3); left = new SentenceNode(direction,action,distance); stack.Push(left); // &#125; &#125; this.node = (AbstractNode)stack.Pop(); // &#125; public string Output() &#123; string result = node.Interpret(); // return result; &#125; &#125;&#125; (8)Program 1234567891011121314151617181920using System;namespace InterpreterSample&#123; class Program &#123; static void Main(string[] args) &#123; //string instruction = "down run 10 and left move 20"; string instruction = "up move 5 and down run 10 and left move 5"; InstructionHandler handler = new InstructionHandler(); handler.Handle(instruction); string outString; outString = handler.Output(); Console.WriteLine(outString); Console.Read(); &#125; &#125;&#125; 4. : 11020 up move 5 and down run 10 and left move 5 15105  XML  (1) (2) (3) (4)  (1) (2)  (1) (2) (3) (4) (1) (2)4 (3) (4) (5)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F25%2F%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[            1 1  1   : 1  2 2  25 (1)Visitor (2)ConcreteVisitor (3)ElementAccept() (4)ConcreteElementAccept()Accept() (5)Objectistructure,  VisitElementA(ElementA elementA)Visit()Visit() 12345678910abstract class Visitor&#123; public abstract void Visit(ConcreteElementA elementA); public abstract void Visit(ConcreteElementB elementB); public void Visit(ConcreteElementC elementC) &#123; //ConcreteElementC &#125;&#125; Visit()VisitorConcreteVisitor 123456789101112class ConcreteVisitor : Visitor &#123; public override void Visit(ConcreteElementA elementA) &#123; //ConcreteElementA &#125; public override void Visit(ConcreteElementB elementB) &#123; //ConcreteElementB &#125;&#125; Accept() 1234interface Element&#123; void Accept(Visitor visitor);&#125; VisitorVisit()ElementAccept() 123456789101112class ConcreteElementA : Element &#123; public void Accept(Visitor visitor) &#123; visitor.Visit(this); &#125; public void OperationA() &#123; // &#125;&#125; ConcreteElementAAccept()VisitorVisit()Visit() (1)Accept(Visitor visitor)Visitor (2)Accept(Visitor visitor)VisitorVisit()Visit(ConcreteElementA elementA)(this)visitor.Visit(this) (3)VisitorVisit() ,Accept()VisitorVisit()  1234567891011121314151617181920212223242526using System;using System.Collections.Generic;class ObjectStructure&#123; private List&lt;Element&gt; list = new List&lt;Element&gt;(); // // public void Accept(Visitor visitor) &#123; foreach (Object obj in list) &#123; ((Element)obj).Accept(visitor); // &#125; &#125; public void AddElement(Element element) &#123; list.Add(element); &#125; public void RemoveElement(Element element) &#123; list.Remove(element); &#125;&#125; Accept()  1. OA(1)4040100/4080/(2)C# 2. 3 3  3FADepartmentHRDepartmentDepartmentEmployeeListFulltimeEmployeeParttimeEmployeeEmployee 3. (1)Employee 1234567namespace VisitorSample&#123; interface Employee &#123; void Accept(Department handler); // &#125;&#125; (2)FulltimeEmployee 123456789101112131415161718192021222324252627282930313233343536373839namespace VisitorSample&#123; class FulltimeEmployee : Employee &#123; private string name; // private double weeklyWage; // private int workTime; // public FulltimeEmployee(string name, double weeklyWage, int workTime) &#123; this.name = name; this.weeklyWage = weeklyWage; this.workTime = workTime; &#125; public string Name &#123; get &#123; return name; &#125; set &#123; name = value; &#125; &#125; public double WeeklyWage &#123; get &#123; return weeklyWage; &#125; set &#123; weeklyWage = value; &#125; &#125; public int WorkTime &#123; get &#123; return workTime; &#125; set &#123; workTime = value; &#125; &#125; public void Accept(Department handler) &#123; handler.Visit(this); // &#125; &#125;&#125; (3)ParttimeEmployee 123456789101112131415161718192021222324252627282930313233343536373839namespace VisitorSample&#123; class ParttimeEmployee : Employee &#123; private string name; // private double hourWage; // private int workTime; // public ParttimeEmployee(string name, double hourWage, int workTime) &#123; this.name = name; this.hourWage = hourWage; this.workTime = workTime; &#125; public string Name &#123; get &#123; return name; &#125; set &#123; name = value; &#125; &#125; public double HourWage &#123; get &#123; return hourWage; &#125; set &#123; hourWage = value; &#125; &#125; public int WorkTime &#123; get &#123; return workTime; &#125; set &#123; workTime = value; &#125; &#125; public void Accept(Department handler) &#123; handler.Visit(this); // &#125; &#125;&#125; (4)Department 123456789namespace VisitorSample&#123; abstract class Department &#123; // public abstract void Visit(FulltimeEmployee employee); public abstract void Visit(ParttimeEmployee employee); &#125;&#125; (5)FADepartment 1234567891011121314151617181920212223242526272829303132333435using System;namespace VisitorSample&#123; class FADepartment : Department &#123; // public override void Visit(FulltimeEmployee employee) &#123; int workTime = employee.WorkTime; double weekWage = employee.WeeklyWage; if(workTime &gt; 40) &#123; weekWage = weekWage + (workTime - 40) * 100; &#125; else if(workTime &lt; 40) &#123; weekWage = weekWage - (40 - workTime) * 80; if(weekWage &lt; 0) &#123; weekWage = 0; &#125; &#125; Console.WriteLine("&#123;0&#125;&#123;1&#125;", employee.Name,weekWage); &#125; // public override void Visit(ParttimeEmployee employee) &#123; int workTime = employee.WorkTime; double hourWage = employee.HourWage; Console.WriteLine("&#123;0&#125;&#123;1&#125;", employee.Name, workTime * hourWage); &#125; &#125;&#125; (6)HRDepartment 1234567891011121314151617181920212223242526272829using System;namespace VisitorSample&#123; class HRDepartment : Department &#123; // public override void Visit(FulltimeEmployee employee) &#123; int workTime = employee.WorkTime; Console.WriteLine("&#123;0&#125;&#123;1&#125;", employee.Name, workTime); if(workTime &gt; 40) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;", employee.Name,workTime - 40); &#125; else if(workTime &lt; 40) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;", employee.Name,40 - workTime); &#125; &#125; // public override void Visit(ParttimeEmployee employee) &#123; int workTime = employee.WorkTime; Console.WriteLine("&#123;0&#125;&#123;1&#125;", employee.Name, workTime); &#125; &#125;&#125; (7)EmployeeList 12345678910111213141516171819202122232425using System;using System.Collections;namespace VisitorSample&#123; class EmployeeList &#123; // private ArrayList list = new ArrayList(); public void AddEmployee(Employee employee) &#123; list.Add(employee); &#125; // public void Accept(Department handler) &#123; foreach(Object obj in list) &#123; ((Employee)obj).Accept(handler); &#125; &#125; &#125;&#125; (8)App.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="visitor" value="VisitorSample.FADepartment"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; (9)Program 123456789101112131415161718192021222324252627282930313233343536using System;using System.Configuration;using System.Reflection;namespace VisitorSample&#123; class Program &#123; static void Main(string[] args) &#123; EmployeeList list = new EmployeeList(); Employee fte1, fte2, fte3, pte1, pte2; fte1 = new FulltimeEmployee("", 3200.00, 45); fte2 = new FulltimeEmployee("", 2000.00, 40); fte3 = new FulltimeEmployee("", 2400.00, 38); pte1 = new ParttimeEmployee("", 80.00, 20); pte2 = new ParttimeEmployee("", 60.00, 18); list.AddEmployee(fte1); list.AddEmployee(fte2); list.AddEmployee(fte3); list.AddEmployee(pte1); list.AddEmployee(pte2); Department dep; // string visitorStr = ConfigurationManager.AppSettings["visitor"]; // dep = (Department)Assembly.Load("VisitorSample").CreateInstance(visitorStr); list.Accept(dep); Console.Read(); &#125; &#125;&#125; 4.  1234537002000224016001080 App.configFADepartmentHRDepartment 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="visitor" value="VisitorSample.HRDepartment"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt;  123456745 5 40 38 2 20 18    4 4  4 XML  (1) (2) (3) : (1) (2)  (1) (2) (3) (1) (2)5Accept()Accept()Accept() (3) (4) (5)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F25%2F%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[                    3123 12 = 363123 + 12 = 15363612121 1  2 2    1 Handle and BodyInterface 3 3  34 (1)AbstractionImplementorImplementor (2)RefinedAbstractionAbstractionAbstractionRefinedAbstractionImplementor (3)ImplementorAbstractionImplementorAbstractionImplementorAbstractionImplementor (4)ConcreteImplementorImplementorConcretelmplementorConcretelmplementor  4 4  4  1234interface Implementor&#123; void OperationImpl();&#125; ImplementorConcreteImplementor 1234567class ConcreteImplementor&#123; public void OperationImpl() &#123; //  &#125;&#125;  1234567891011abstract class Abstraction&#123; protected Implementor impl; //  public void SetImpl(Implementor impl) &#123; this.impl = impl; &#125; public abstract void Operation(); // &#125; AbstractionimplSetterprotectedImplementorRefinedAbstractionRefinedAbstraction 123456789class RefinedAbstraction : Abstraction&#123; public override void Operation() &#123; //  impl.OperationImpl(); //  //  &#125;&#125;   1. BMPJPGGIFPNGWindowsLinuxUNIXMatrix 2. 5 5  5ImageJPGImagePNGImageBMPImageGIFImageImagelmpWindowsImpLinuxImpUnixImp 3. (1)Matrix 1234567namespace BridgeSample&#123; class Matrix &#123; //  &#125;&#125; (2)ImageImp 1234567namespace BridgeSample&#123; interface ImageImp &#123; void DoPaint(Matrix m); // m &#125;&#125; (3)WindowsImpWindows 12345678910111213using System;namespace BridgeSample&#123; class WindowsImp : ImageImp &#123; public void DoPaint(Matrix m) &#123; // Windows Console.Write("Windows"); &#125; &#125;&#125; (4)LinuxImpLinux 12345678910111213using System;namespace BridgeSample&#123; class LinuxImp : ImageImp &#123; public void DoPaint(Matrix m) &#123; // Linux Console.Write("Linux"); &#125; &#125;&#125; (5)UnixImpUNIX 12345678910111213using System;namespace BridgeSample&#123; class UnixImp : ImageImp &#123; public void DoPaint(Matrix m) &#123; // Unix Console.Write("Unix"); &#125; &#125;&#125; (6)Image 123456789101112131415namespace BridgeSample&#123; abstract class Image &#123; protected ImageImp imp; //  public void SetImageImp(ImageImp imp) &#123; this.imp = imp; &#125; public abstract void ParseFile(string fileName); &#125;&#125; (7)JPGImageJPG 123456789101112131415using System;namespace BridgeSample&#123; class JPGImage : Image &#123; public override void ParseFile(string fileName) &#123; // JPGm; Matrix m = new Matrix(); imp.DoPaint(m); Console.WriteLine("&#123;0&#125;JPG",fileName); &#125; &#125;&#125; (8)PNGImagePNG 123456789101112131415using System;namespace BridgeSample&#123; class PNGImage : Image &#123; public override void ParseFile(string fileName) &#123; // PNGm; Matrix m = new Matrix(); imp.DoPaint(m); Console.WriteLine("&#123;0&#125;PNG", fileName); &#125; &#125;&#125; (9)BMPImageBMP 123456789101112131415using System;namespace BridgeSample&#123; class BMPImage : Image &#123; public override void ParseFile(string fileName) &#123; // BMPm; Matrix m = new Matrix(); imp.DoPaint(m); Console.WriteLine("&#123;0&#125;BMP", fileName); &#125; &#125;&#125; (10)GIFImageGIF 123456789101112131415using System;namespace BridgeSample&#123; class GIFImage : Image &#123; public override void ParseFile(string fileName) &#123; // GIFm; Matrix m = new Matrix(); imp.DoPaint(m); Console.WriteLine("&#123;0&#125;GIF", fileName); &#125; &#125;&#125; (11)App.config 123456789&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;!--RefinedAbstraction--&gt; &lt;add key="image" value="BridgeSample.JPGImage"/&gt; &lt;!--ConcreteImplementor--&gt; &lt;add key="os" value="BridgeSample.WindowsImp"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; (12)Program 123456789101112131415161718192021222324252627using System;using System.Configuration;using System.Reflection;namespace BridgeSample&#123; class Program &#123; static void Main(string[] args) &#123; Image image; ImageImp imp; //  string imageType = ConfigurationManager.AppSettings["image"]; string osType = ConfigurationManager.AppSettings["os"]; //  image = (Image)Assembly.Load("BridgeSample").CreateInstance(imageType); imp = (ImageImp)Assembly.Load("BridgeSample").CreateInstance(osType); image.SetImageImp(imp); image.ParseFile(""); Console.Read(); &#125; &#125;&#125; 4.  1WindowsJPG App.config 123456789&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;!--RefinedAbstraction--&gt; &lt;add key="image" value="BridgeSample.BMPImage"/&gt; &lt;!--ConcreteImplementor--&gt; &lt;add key="os" value="BridgeSample.LinuxImp"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; : 1LinuxBMP     ExcelExcelExcelAPIAPIAPI6 6    (1) (2) (3)  (1) (2)  (1) (2) (3) (4) (1) (2)4 (3) (4) (5)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F24%2F%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[    4              1 1    1  2 2  24 (1)Component (2)ConcreteComponent (3)Decorator (4)ConcreteDecorator  1234abstract class Component&#123; public abstract void Operation(); &#125;  1234567class ConcreteComponent : Component&#123; public override void Operation() &#123; //  &#125;&#125;  1234567891011121314151617class Decorator : Component&#123; //  private Component component; //  public Decorator(Component component) &#123; this.component = component; &#125; public override void Operation() &#123; //  component.Operation(); &#125;&#125; DecoratorComponentcomponentSetterComponentDecoratorComponentOperation()DecoratorOperation()componentOperation() DecoratorOperation() 12345678910111213141516171819class ConcreteDecorator : Decorator&#123; public ConcreteDecorator (Component component) : base(component) &#123; &#125; public override void Operation() &#123; base.Operation(); //  AddedBehavior(); //  &#125; //  public void AddedBehavior() &#123; //  &#125;&#125; Operation()AddedBehavior()private DecoratorComponentDecorator  1. VisualComponent 2. 3 3  3VisualComponentWindowTextBoxListBoxVisualComponentComponentDecoratorComponentDecoratorScrollBarDecoratorBlackBorderDecorator 3. (1)VisualComponent 1234567namespace DecoratorSample&#123; abstract class VisualComponent &#123; public abstract void Display(); &#125;&#125; (2)Window 123456789101112using System;namespace DecoratorSample&#123; class Window : VisualComponent &#123; public override void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (3)TextBox 123456789101112using System;namespace DecoratorSample&#123; class TextBox : VisualComponent &#123; public override void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (4)ListBox 123456789101112using System;namespace DecoratorSample&#123; class ListBox : VisualComponent &#123; public override void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (5)ComponentDecorator 123456789101112131415161718namespace DecoratorSample&#123; class ComponentDecorator : VisualComponent &#123; private VisualComponent component; //  //  public ComponentDecorator(VisualComponent component) &#123; this.component = component; &#125; public override void Display() &#123; component.Display(); &#125; &#125;&#125; (6)ScrollBarDecorator 1234567891011121314151617181920212223using System;namespace DecoratorSample&#123; class ScrollBarDecorator : ComponentDecorator &#123; public ScrollBarDecorator(VisualComponent component) : base(component) &#123; &#125; public override void Display() &#123; this.SetScrollBar(); base.Display(); &#125; public void SetScrollBar() &#123; Console.WriteLine(""); &#125; &#125;&#125; (7)BlackBorderDecorator 1234567891011121314151617181920212223using System;namespace DecoratorSample&#123; class BlackBorderDecorator : ComponentDecorator &#123; public BlackBorderDecorator(VisualComponent component) : base(component) &#123; &#125; public override void Display() &#123; this.SetBlackBorder(); base.Display(); &#125; public void SetBlackBorder() &#123; Console.WriteLine(""); &#125; &#125;&#125; (8)Program 1234567891011121314151617using System;namespace DecoratorSample&#123; class Program &#123; static void Main(string[] args) &#123; VisualComponent component, componentSB; //  component = new Window(); //  componentSB = new ScrollBarDecorator(component); //  componentSB.Display(); Console.Read(); &#125; &#125;&#125; 4.  12  WindowcomponentcomponentScrollBarDecoratorcomponentSBcomponentSBDisplay() 1234567891011121314151617using System;namespace DecoratorSample&#123; class Program &#123; static void Main(string[] args) &#123; VisualComponent component, componentSB, componentBB; //  component = new Window(); //  componentSB = new ScrollBarDecorator(component); //  componentBB = new BlackBorderDecorator(componentSB); //  componentBB.Display(); Console.Read(); &#125; &#125;&#125;  123 componentSBBlackBorderDecoratorcomponentBBcomponentBBDisplay()  TransparentSemi-transparent 1.  1234Component component_o, component_d; // component_o = new ConcreteComponent();component_d = new ConcreteDecorator(component_o);component_d.Operation();  12ConcreteComponent component_o; // component_o = new ConcreteComponent();  12ConcreteComponent component_d; // component_d = new ConcreteComponent();  12345678...Component component_o, component_d1,component_d2; // component_o = new ConcreteComponent();component_d1 = new ConcreteDecorator(component_o);component_d2 = new ConcreteDecorator(component_d1);component_d2.Operation();// component_d2AddedBehavior()... Component Operation()Operation()Operation()AddedBehavior()AddedBehavior() 2.  123456789...Component component_o; // component_o = new ConcreteComponent();component_o.Operation();ConcreteDecorator component_d; // component_d = new ConcreteDecorator(component_o);component_d.Operation();component_d.AddedBehavior(); // ... AddedBehavior()AddedBehavior()   (1) (2) (3) (4) : (1) (2)  (1) (2)C#sealed (1) (2)4 (3) (4) (5)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F23%2F%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[                  Windows1 1 Windows 12 2  2.jpg.txtContainerLeaf    1 -Part-Whole 3 3  33 (1)Component (2)Leaf (3)Composite     1234567abstract class Component&#123; public abstract void Add(Component c); //  public abstract void Remove(Component c); //  public abstract Component GetChild(int i); //  public abstract void Operation(); // &#125;   1234567891011121314151617181920212223class Leaf : Component&#123; public override void Add(Component c) &#123; //  &#125; public override void Remove(Component c) &#123; //  &#125; public override Component GetChild(int i) &#123; //  return null; &#125; public override void Operation() &#123; //  &#125;&#125;   12345678910111213141516171819202122232425262728293031using System;using System.Collections.Generic;class Composite : Component&#123; private List&lt;Component&gt; list = new List&lt;Component&gt;(); public override void Add(Component c) &#123; list.Add(c); &#125; public override void Remove(Component c) &#123; list.Remove(c); &#125; public override Component GetChild(int i) &#123; return (Component)list[i]; &#125; public override void Operation() &#123; foreach(Object obj in list) &#123; //  ((Component)obj).Operation(); &#125; &#125;&#125; Add()Remove()GetChild()Operation()Operation()  1. AntiVirusFolderFileImageFileTextFile 2. 4 4  4AbstractFileFolderImageFileTextFileVideoFile 3. (1)AbstractFile 12345678910namespace CompositeSample&#123; abstract class AbstractFile &#123; public abstract void Add(AbstractFile file); public abstract void Remove(AbstractFile file); public abstract AbstractFile GetChild(int i); public abstract void KillVirus(); &#125;&#125; (2)ImageFile 123456789101112131415161718192021222324252627282930313233343536using System;namespace CompositeSample&#123; class ImageFile : AbstractFile &#123; private string name; public ImageFile(string name) &#123; this.name = name; &#125; public override void Add(AbstractFile file) &#123; Console.WriteLine(""); &#125; public override void Remove(AbstractFile file) &#123; Console.WriteLine(""); &#125; public override AbstractFile GetChild(int i) &#123; Console.WriteLine(""); return null; &#125; public override void KillVirus() &#123; //  Console.WriteLine("----'&#123;0&#125;'",name); &#125; &#125;&#125; (3)TextFile 123456789101112131415161718192021222324252627282930313233343536using System;namespace CompositeSample&#123; class TextFile : AbstractFile &#123; private string name; public TextFile(string name) &#123; this.name = name; &#125; public override void Add(AbstractFile file) &#123; Console.WriteLine(""); &#125; public override void Remove(AbstractFile file) &#123; Console.WriteLine(""); &#125; public override AbstractFile GetChild(int i) &#123; Console.WriteLine(""); return null; &#125; public override void KillVirus() &#123; //  Console.WriteLine("----'&#123;0&#125;'",name); &#125; &#125;&#125; (4)VideoFile 123456789101112131415161718192021222324252627282930313233343536using System;namespace CompositeSample&#123; class VideoFile : AbstractFile &#123; private string name; public VideoFile(string name) &#123; this.name = name; &#125; public override void Add(AbstractFile file) &#123; Console.WriteLine(""); &#125; public override void Remove(AbstractFile file) &#123; Console.WriteLine(""); &#125; public override AbstractFile GetChild(int i) &#123; Console.WriteLine(""); return null; &#125; public override void KillVirus() &#123; //  Console.WriteLine("----'&#123;0&#125;'",name); &#125; &#125;&#125; (5)Folder 1234567891011121314151617181920212223242526272829303132333435363738394041424344using System;using System.Collections.Generic;namespace CompositeSample&#123; class Folder : AbstractFile &#123; // fileListAbstractFile private List&lt;AbstractFile&gt; fileList = new List&lt;AbstractFile&gt;(); private string name; public Folder(string name) &#123; this.name = name; &#125; public override void Add(AbstractFile file) &#123; fileList.Add(file); &#125; public override void Remove(AbstractFile file) &#123; fileList.Remove(file); &#125; public override AbstractFile GetChild(int i) &#123; return (AbstractFile)fileList[i]; &#125; public override void KillVirus() &#123; Console.WriteLine("****'&#123;0&#125;'",name); //  // killVirus() foreach(Object obj in fileList) &#123; ((AbstractFile)obj).KillVirus(); &#125; &#125; &#125;&#125; (6)Program 1234567891011121314151617181920212223242526272829303132333435363738using System;using System.Collections.Generic;namespace CompositeSample&#123; class Program &#123; static void Main(string[] args) &#123; //  AbstractFile file1, file2, file3, file4, file5, folder1, folder2, folder3, folder4; folder1 = new Folder(""); folder2 = new Folder(""); folder3 = new Folder(""); folder4 = new Folder(""); file1 = new ImageFile(".jpg"); file2 = new ImageFile(".gif"); file3 = new TextFile(".txt"); file4 = new TextFile(".doc"); file5 = new VideoFile(".rmvb"); folder2.Add(file1); folder2.Add(file2); folder3.Add(file3); folder3.Add(file4); folder4.Add(file5); folder1.Add(folder2); folder1.Add(folder3); folder1.Add(folder4); //  folder1.KillVirus(); Console.Read(); &#125; &#125;&#125; 4.  123456789****&apos;&apos;****&apos;&apos;----&apos;.jpg&apos;----&apos;.gif&apos;****&apos;&apos;----&apos;.txt&apos;----&apos;.doc&apos;****&apos;&apos;----&apos;.rmvb&apos; Add()Remove()ImageFileFolderKillVirus()KillVirus()  1folder1.KillVirus();  1folder3.KillVirus();  123****&apos;&apos; ----&apos;.txt&apos; ----&apos;.doc&apos;   1. ComponentAdd()Remove()GetChild()5 5  Add()Remove()GetChild() 2. ComponentComposite6 6     (1) (2) (3) (4)    (1) (2) (3) (1) (2)3 (3); (4) (5)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F23%2F%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F-3%2F</url>
    <content type="text"><![CDATA[   GOF7  7          /Structural Pattern  GoF71 1        (Adapter Pattern)    (Bridge Pattern)    (Composite Pattern) -   (Decorator Pattern)    (Facade Pattern)    (Flyweight Pattern)    (Proxy Pattern)    220V220VAC Adapter)1 1   AdapterAdaptee   1 Wrapper  2 2  3 3  233 (1)TargetC# (2)AdapterAdapteeTargetAdapterTargetAdapteeTargetAdaptee (3)Adaptee  1. 2AdapteeRequest()SpecificRequest()AdapterTargetRequest()SpecificRequest() 1234567class Adapter : Adaptee, Target&#123; public void Request() &#123; base.SpecificRequest(); &#125;&#125; 2. 3Request()AdapteeSpecificRequest()AdapterRequest()SpecificRequest() 1234567891011121314class Adapter : Target&#123; private Adaptee adaptee; //  public Adapter(Adaptee adaptee) &#123; this.adaptee = adaptee; &#125; public void Request() &#123; adaptee.SpecificRequest(); //  &#125;&#125;    1. ScoreOperationSort(int[])Search(int[], int)QuickSortClassBinarySearchClassQuickSortClassQuickSort(int[])BinarySearchClassBinarySearch(int[], int)ScoreOperationQuickSortClassBinarySearchClassQuickSortClassBinarySearchClassScoreOperation 2. 4 4  4ScoreOperationQuickSortClassBinarySearchClassOperationAdapter 3. (1)ScoreOperation 12345678namespace AdapterSample&#123; interface ScoreOperation &#123; int[] Sort(int[] array); //  int Search(int[] array, int key); //  &#125;&#125; (2)QuickSortClass 123456789101112131415161718192021222324252627282930313233343536373839404142434445namespace AdapterSample&#123; class QuickSortClass &#123; public int[] QuickSort(int[] array) &#123; Sort(array,0,array.Length - 1); return array; &#125; public void Sort(int[] array, int p, int r) &#123; int q = 0; if (p &lt; r) &#123; q = Partition(array,p,r); Sort(array,p,q - 1); Sort(array,q + 1,r); &#125; &#125; public int Partition(int[] a, int p, int r) &#123; int x = a[r]; int j = p - 1; for (int i = p;i &lt;= r - 1;i++) &#123; if (a[i] &lt;= x) &#123; j++; Swap(a,j,i); &#125; &#125; Swap(a,j + 1,r); return j + 1; &#125; public void Swap(int[] a, int i, int j) &#123; int t = a[i]; a[i] = a[j]; a[j] = t; &#125; &#125;&#125; (3)BinarySearchClass 1234567891011121314151617181920212223242526272829namespace AdapterSample&#123; class BinarySearchClass &#123; public int BinarySearch(int[] array, int key) &#123; int low = 0; int high = array.Length -1; while (low &lt;= high) &#123; int mid = (low + high) / 2; int midVal = array[mid]; if (midVal &lt; key) &#123; low = mid +1; &#125; else if (midVal &gt; key) &#123; high = mid -1; &#125; else &#123; return 1; // 1 &#125; &#125; return -1; // -1 &#125; &#125;&#125; (4)OperationAdapter 123456789101112131415161718192021222324namespace AdapterSample&#123; class OperationAdapter : ScoreOperation &#123; private QuickSortClass sortObj; // QuickSortClass private BinarySearchClass searchObj; // BinarySearchClass public OperationAdapter() &#123; sortObj = new QuickSortClass(); searchObj = new BinarySearchClass(); &#125; public int[] Sort(int[] array) &#123; return sortObj.QuickSort(array); // QuickSortClass &#125; public int Search(int[] array, int key) &#123; return searchObj.BinarySearch(array, key); // BinarySearchClass &#125; &#125;&#125; (5)App.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="adapter" value="AdapterSample.OperationAdapter"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; (6)Program 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657using System;using System.Configuration;using System.Reflection;namespace AdapterSample&#123; class Program &#123; static void Main(string[] args) &#123; ScoreOperation operation; //  //  string adapterType = ConfigurationManager.AppSettings["adapter"]; //  operation = (ScoreOperation)Assembly.Load("AdapterSample").CreateInstance(adapterType); int[] scores = &#123;84,76,50,69,90,91,88,96&#125;; //  int[] result; int score; Console.WriteLine(""); result = operation.Sort(scores); //  foreach (int i in result) &#123; Console.Write(i + ","); &#125; Console.WriteLine(); Console.WriteLine("90"); score = operation.Search(result,90); if (score != -1) &#123; Console.WriteLine("90"); &#125; else &#123; Console.WriteLine("90"); &#125; Console.WriteLine("92"); score = operation.Search(result,92); if (score != -1) &#123; Console.WriteLine("92"); &#125; else &#123; Console.WriteLine("92"); &#125; Console.Read(); &#125; &#125;&#125; 4  12345650,69,76,84,88,90,91,96,  90 90  9292 App.config  Default Adapter Pattern 1 5 5  53 (1)ServiceInterface (2)AbstractServiceClass)Servicelnterface (3)ConcreteServiceClass  123456abstract class AbstractServiceClass : ServiceInterface&#123; public void ServiceMethod1()&#123;&#125; //  public void ServiceMethod2()&#123;&#125; //  public void ServiceMethod3()&#123;&#125; // &#125; 6 6   1234567891011121314151617181920212223242526public class Adapter : Target, Adaptee&#123; //  private Target target; private Adaptee adaptee; public Adapter(Target target) &#123; this.target = target; &#125; public Adapter(Adaptee adaptee) &#123; this.adaptee = adaptee; &#125; public void Request() &#123; adaptee.SpecificRequest(); &#125; public void SpecificRequest() &#123; target.Request(); &#125;&#125;  (1) (2) (3)    (1) (2)  (1)C#Java (2)C#sealed (3)C#Java    (1) (2) (1)7 (2) (3)3AdapteeTarget (4); (5); (6)()  (7)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F22%2F%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[               -&gt;-&gt;31 1  )  1   2 2  (1)AbstracClassPrimitive OperationsTemplate Method (2)ConcreteClass  1.  2. 3Abstract MethodConcrete MethodHook Method (1)C#abstract (2) (3)virtual boolIsXXX() 12345678910111213141516171819...// public void TemplateMethod()&#123; Open(); Display(); //  if (IsPrint) &#123; Print(); &#125;&#125;// public bool IsPrint()&#123; return true;&#125;... IsPrint()Print()truefalse   12345678910111213141516171819202122232425abstract class AbstracClass&#123; //  public void TemplateMethod() &#123; PrimitiveOperation1(); PrimitiveOperation2(); PrimitiveOperation3(); &#125; //  public void PrimitiveOperation1() &#123; //  &#125; //  public abstract void PrimitiveOperation2(); //  public virtual void PrimitiveOperation3() &#123; &#125;&#125; TemplateMethod()PrimitiveOperation1()PrimitiveOperation2()PrimitiveOperation1()PrimitiveOperation2()PrimitiveOperation3()  123456789101112class ConcreteClass : AbstracClass&#123; public override void PrimitiveOperation2() &#123; //  &#125; public override void PrimitiveOperation3() &#123; //  &#125;&#125;   1. (1)(2)(3) 2. 3 3  3AccountCurrentAccountSavingAccount 3. (1)Account 123456789101112131415161718192021222324252627282930313233343536373839404142434445using System;namespace TemplateMethodSample&#123; abstract class Account &#123; //  public bool Validate(string account, string password) &#123; Console.WriteLine("&#123;0&#125;", account); Console.WriteLine("&#123;0&#125;", password); //  if (account.Equals("") &amp;&amp; password.Equals("123456")) &#123; return true; &#125; else &#123; return false; &#125; &#125; //  public abstract void CalculateInterest(); //  public void Display() &#123; Console.WriteLine(""); &#125; //  public void Handle(string account, string password) &#123; if (!Validate(account,password)) &#123; Console.WriteLine(""); return; &#125; CalculateInterest(); Display(); &#125; &#125;&#125; (2)CurrentAccount 12345678910111213using System;namespace TemplateMethodSample&#123; class CurrentAccount : Account &#123; //  public override void CalculateInterest() &#123; Console.WriteLine(""); &#125; &#125;&#125; (3)SavingAccount 12345678910111213using System;namespace TemplateMethodSample&#123; class SavingAccount : Account &#123; //  public override void CalculateInterest() &#123; Console.WriteLine(""); &#125; &#125;&#125; (4)App.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="subClass" value="TemplateMethodSample.CurrentAccount"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; (5)Program 123456789101112131415161718192021using System;using System.Configuration;using System.Reflection;namespace TemplateMethodSample&#123; class Program &#123; static void Main(string[] args) &#123; Account account; //  string subClassStr = ConfigurationManager.AppSettings["subClass"]; //  account = (Account)Assembly.Load("TemplateMethodSample").CreateInstance(subClassStr); account.Handle("", "123456"); Console.Read(); &#125; &#125;&#125; 4. : 1234 123456   App.configCurrent AccountSaving AccountCurrentAccountSavingAccount 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="subClass" value="TemplateMethodSample.SavingAccount"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; : 1234 123456    1public virtual void Display()&#123;&#125;  booltruefalse (1)(2)XML(3)XMLXMLXML 3XML(2)XMLIsNotXMLData()4 4   12345678910111213141516171819202122232425262728293031323334353637using System;namespace TemplateMethodSample&#123; abstract class DataViewer &#123; //  public abstract void GetData(); //  public void ConvertData() &#123; Console.WriteLine("XML"); &#125; //  public abstract void DisplayData(); // XML public virtual bool IsNotXMLData() &#123; return true; &#125; //  public void Process() &#123; GetData(); // XML if (IsNotXMLData()) &#123; ConvertData(); &#125; DisplayData(); &#125; &#125;&#125; IsNotXMLData()boolConvertData()trueXMLXMLDataViewer 12345678910111213141516171819202122232425using System;namespace TemplateMethodSample&#123; class XMLDataViewer : DataViewer &#123; //  public override void GetData() &#123; Console.WriteLine("XML"); &#125; //  public override void DisplayData() &#123; Console.WriteLine(""); &#125; //  public override bool IsNotXMLData() &#123; return false; &#125; &#125;&#125; XMLDataViewerIsNotXMLData()falseXMLConvertData() 12345678910111213141516using System;namespace TemplateMethodSample&#123; class Program &#123; static void Main(string[] args) &#123; DataViewer dv; dv = new XMLDataViewer(); dv.Process(); Console.Read(); &#125; &#125;&#125;  12XML    (1) (2) (3) (4) :   (1) (2) (3) (1) (2) (3) (4) (5)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F22%2F%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F-2%2F</url>
    <content type="text"><![CDATA[   C#Exceptior Handlerscatchcatch  GoF11  11          Behavioral Pattern  GoF111 1        Chain of Responsibility Pattern    Command Pattern    Interpreter Pattern    Iterator Pattern    Mediator Pattern    Memento Pattern    Observer Pattern    State Pattern    Strategy Pattern    Template Method Pattern    Visitor Pattern    1 1  1 2  2 (1)Handlersuccessor (2)ConcreteHandler  : 123456789101112abstract class Handler&#123; //  protected Handler successor; public void SetSuccessor(Handler successor) &#123; this.successor = successor; &#125; public abstract void HandleRequest(string request);&#125; protected HandleRequest() 123456789101112131415public ConcreteHandler : Handler&#123; public override void HandleRequest(string request) &#123; if () &#123; //  &#125; else &#123; //  this.successor.HandleRequest(request); &#125; &#125;&#125;   1234567891011...Handler handler1, handler2, handler3;handler1 = new ConcreteHandlerA();handler2 = new ConcreteHandlerB();handler3 = new ConcreteHandlerC();// handler1.SetSuccessor(handler2);handler2.SetSuccessor(handler3);// handler1.HandleRequest("");...  1. SCMSupply Chain Management55510101050505033   2. 4 4  4ApproverDirectorVicePresidentPresidentCongressPurchaseRequest 3. (1)PurchaseRequest 12345678910111213141516171819202122232425262728293031323334namespace CoRSample&#123; class PurchaseRequest &#123; private double amount; //  private int number; //  private string purpose; //  public PurchaseRequest(double amount, int number, string purpose) &#123; this.amount = amount; this.number = number; this.purpose = purpose; &#125; public double Amount &#123; get &#123; return amount; &#125; set &#123; amount = value; &#125; &#125; public int Number &#123; get &#123; return number; &#125; set &#123; number = value; &#125; &#125; public string Purpose &#123; get &#123; return purpose; &#125; set &#123; purpose = value; &#125; &#125; &#125;&#125; (2)Approver 12345678910111213141516171819202122namespace CoRSample&#123; abstract class Approver &#123; protected Approver successor; //  protected string name; //  public Approver(string name) &#123; this.name = name; &#125; //  public void SetSuccessor(Approver successor) &#123; this.successor = successor; &#125; //  public abstract void ProcessRequest(PurchaseRequest request); &#125;&#125; (3)Director 1234567891011121314151617181920212223using System;namespace CoRSample&#123; class Director : Approver &#123; public Director(string name) : base(name) &#123; &#125; //  public override void ProcessRequest(PurchaseRequest request) &#123; if (request.Amount &lt; 50000) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;&#123;2&#125;&#123;3&#125;", this.name, request.Number, request.Amount, request.Purpose); // &#125; else &#123; this.successor.ProcessRequest(request); //  &#125; &#125; &#125;&#125; (4)VicePresident 123456789101112131415161718192021222324using System;namespace CoRSample&#123; class VicePresident : Approver &#123; public VicePresident(string name) : base(name) &#123; &#125; //  public override void ProcessRequest(PurchaseRequest request) &#123; if (request.Amount &lt; 100000) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;&#123;2&#125;&#123;3&#125;", this.name, request.Number, request.Amount, request.Purpose); // &#125; else &#123; this.successor.ProcessRequest(request); //  &#125; &#125; &#125;&#125; (5)President 123456789101112131415161718192021222324using System;namespace CoRSample&#123; class President : Approver &#123; public President(string name) : base(name) &#123; &#125; //  public override void ProcessRequest(PurchaseRequest request) &#123; if (request.Amount &lt; 500000) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;&#123;2&#125;&#123;3&#125;", this.name, request.Number, request.Amount, request.Purpose); // &#125; else &#123; this.successor.ProcessRequest(request); //  &#125; &#125; &#125;&#125; (6)Congress 1234567891011121314151617using System;namespace CoRSample&#123; class Congress : Approver &#123; public Congress(string name) : base(name) &#123; &#125; //  public override void ProcessRequest(PurchaseRequest request) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;&#123;2&#125;",request.Number, request.Amount, request.Purpose); //  &#125; &#125;&#125; (7)Program 12345678910111213141516171819202122232425262728293031323334353637using System;namespace CoRSample&#123; class Program &#123; static void Main(string[] args) &#123; Approver wjzhang, gyang, jguo, meeting; wjzhang = new Director(""); gyang = new VicePresident(""); jguo = new President(""); meeting = new Congress(""); //  wjzhang.SetSuccessor(gyang); gyang.SetSuccessor(jguo); jguo.SetSuccessor(meeting); //  PurchaseRequest pr1 = new PurchaseRequest(45000, 10001, ""); wjzhang.ProcessRequest(pr1); PurchaseRequest pr2 = new PurchaseRequest(60000, 10002, ""); wjzhang.ProcessRequest(pr2); PurchaseRequest pr3 = new PurchaseRequest(160000, 10003, ""); wjzhang.ProcessRequest(pr3); PurchaseRequest pr4 = new PurchaseRequest(800000, 10004, ""); wjzhang.ProcessRequest(pr4); Console.Read(); &#125; &#125;&#125; 4.  12341000145000 1000260000 10003160000 10004800000 Manager588ManagerApproverApprover8 Manager 123456789101112131415161718192021222324using System;namespace CoRSample&#123; class Manager : Approver &#123; public Manager(string name) : base(name) &#123; &#125; //  public override void ProcessRequest(PurchaseRequest request) &#123; if (request.Amount &lt; 80000) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;&#123;2&#125;&#123;3&#125;", this.name, request.Number, request.Amount, request.Purpose); //  &#125; else &#123; this.successor.ProcessRequest(request); //  &#125; &#125; &#125;&#125;   12Approver rhuang;rhuang = new Manager("");  12345// wjzhang.SetSuccessor(rhuang); // rhuang.SetSuccessor(gyang); //gyang.SetSuccessor(jguo);jguo.SetSuccessor(meeting);  12341000145000 1000260000 10003160000 10004800000  1.  2.  JavaScriptEvent BubblingHTMLDIVTABLEBODY WebFilterC#Exceptior Handlerscatchcatch  (1) (2) (3) (4)  (1) (2) (3)  (1) (2) (3) (1)GoF11 (2) (3) (4) (5) (6)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F21%2F%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[            1 1    Proxy 1  2 2  23 (1)Subject (2)Proxy (3)RealSubject   1234abstract class Subject&#123; public abstract void Request();&#125;  1234567class RealSubject : Subject&#123; public override void Request() &#123; //  &#125;&#125;  1234567891011121314151617181920212223class Proxy : Subject&#123; //  private RealSubject realSubject = new RealSubject(); public void PreRequest() &#123; ... &#125; public override void Request() &#123; PreRequest(); //  realSubject.Request(); PostRequest(); &#125; public void PostRequest() &#123; ... &#125;&#125;  (1)Remote ProxyAmbassador (2)Virtual Proxy (3)Protect Proxy (4)Cache Proxy (5)Smart Reference Proxy   1. (1)(2) 2. 3 3  34 4  4AccessValidatorLoggerSearcherRealSearcherProxySearcher 3. (1)AccessValidatorValidate() 123456789101112131415161718192021using System;namespace ProxySample&#123; class AccessValidator &#123; //  public bool Validate(string userId) &#123; Console.WriteLine("'" + userId + "'"); if (userId.Equals("")) &#123; Console.WriteLine("'&#123;0&#125;'",userId); return true; &#125; else &#123; Console.WriteLine("'&#123;0&#125;'", userId); return false; &#125; &#125; &#125;&#125; (2)LoggerLog() 123456789101112using System;namespace ProxySample&#123; class Logger &#123; //  public void Log(string userId) &#123; Console.WriteLine("'&#123;0&#125;'1",userId); &#125; &#125;&#125; (3)SearcherDoSearch() 1234567namespace ProxySample&#123; interface Searcher &#123; string DoSearch(string userId, string keyword); &#125;&#125; (4)RealSearcherDoSearch() 12345678910111213using System;namespace ProxySample&#123; class RealSearcher : Searcher &#123; //  public string DoSearch(string userId, string keyword) &#123; Console.WriteLine("'&#123;0&#125;''&#123;1&#125;'",userId,keyword); return ""; &#125; &#125;&#125; (5)ProxySearcherRealSearcherAccessValidatorLogger 1234567891011121314151617181920212223242526272829303132333435363738namespace ProxySample&#123; class ProxySearcher : Searcher &#123; private RealSearcher searcher = new RealSearcher(); //  private AccessValidator validator; private Logger logger; public string DoSearch(string userId, string keyword) &#123; //  if (this.Validate(userId)) &#123; string result = searcher.DoSearch(userId, keyword); //  this.Log(userId); //  return result; //  &#125; else &#123; return null; &#125; &#125; // Validate() public bool Validate(string userId) &#123; validator = new AccessValidator(); return validator.Validate(userId); &#125; // Log() public void Log(string userId) &#123; logger = new Logger(); logger.Log(userId); &#125; &#125;&#125; (6)App.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="proxy" value="ProxySample.ProxySearcher"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; (7)Program 12345678910111213141516171819202122using System;using System.Configuration;using System.Reflection;namespace ProxySample&#123; class Program &#123; static void Main(string[] args) &#123; //  string proxy = ConfigurationManager.AppSettings["proxy"]; //  Searcher searcher; searcher = (Searcher)Assembly.Load("ProxySample").CreateInstance(proxy); String result = searcher.DoSearch("", ""); Console.Read(); &#125; &#125;&#125; 4.  1234&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;1 ProxySearcher Remote Proxy 5 .NETDCOMDistribute Component Object ModelWeb Service 5  Virtual Proxy  (1) (2)   Cache Proxy PetShop 4.0Business Logic LayerBLLProductCategoryItemData Access LayerDALPetShop 4.0BLL ProductDataProxyCategoryDataProxyItemDataProxyPetShop.BLL.ProductPetShop 4.0ProductDataProxyProductDataProxyGetProductsByCategory()ProductGetProductsByCategory()6 6 PetShop 4.0 ProductDataProxy 12345678910111213141516171819202122232425262728293031public static class ProductDataProxy&#123; private static readonly int productTimeout = int.Parse(ConfigurationManager.AppSettings ["ProductCacheDuration"]); private static readonly bool enableCaching = bool.Parse(ConfigurationManager. AppSettings["EnableCaching"]); public static IList GetProductsByCategory(string category) &#123; Product product = new Product(); // product if (!enableCaching) &#123; return product.GetProductsByCategory(category); &#125; string key = "product_by_category_" + category; //  IList data = (IList )HttpRuntime.Cache[key]; //  if (data == null) &#123; data = product.GetProductsByCategory(category); // AggregateCacheDependency AggregateCacheDependency cd = DependencyFacade.GetProductDependency (); // AggregateCacheDependency HttpRuntime.Cache.Add(key, data, cd, DateTime.Now.AddHours(product Timeout), Cache.NoSlidingExpiration, CacheItemPriority.High, null); &#125; return data; &#125; &#125; AggregateCacheDependency.NET Framework 2.0AggregateCacheDependency ProductGetProductsByCategory()ProductGetProductsByCategory()AggregateCacheDependencyProductDataProxyProductProductProductDataProxyProduct   (1) (2)  (1) (2) (3) (4)  (1) (2)  (1) (2) (3) (4)n (5) (1) (2)3 (3) (4) (5) (6) (7) (8)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F21%2F%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[              Flyweight Pool1 1  Intrinsic StateExtrinsic State (1)aab (2)aaaa   1  2 2  24 (1)Flyweight (2)ConcreteFlyweight (3)UnsharedConcretelyweight (4)FlyweightFactory Flyweight 1234abstract class Flyweight&#123; public abstract void Operation(string extrinsicState);&#125; ConcreteFlyweight 12345678910111213141516class ConcreteFlyweight : Flyweight&#123; // intrinsicState private string intrinsicState; public ConcreteFlyweight(string intrinsicState) &#123; this.intrinsicState = intrinsicState; &#125; // extrinsicState public override void Operation(string extrinsicState) &#123; // &#125; &#125; FlyweightUnsharedConcreteFlyweight 1234567class UnsharedConcreteFlyweight : Flyweight&#123; public override void Operation(string extrinsicState) &#123; //  &#125;&#125; FlyweightFactory 1234567891011121314151617181920class FlyweightFactory&#123; // Hashtable private Hashtable flyweights = new Hashtable(); public Flyweight GetFlyweight(string key) &#123; //  if (flyweights.ContainsKey(key)) &#123; return (Flyweight)flyweights[key]; &#125; else //  &#123; Flyweight fw = new ConcreteFlyweight("state"); flyweights.Add(key,fw); return fw; &#125; &#125;&#125;  1. 33  3 2. 4 4  4IgoChessmanBlackIgoChessmanWhiteIgoChessmanIgoChessmanFactory 3. (1)IgoChessman 1234567891011121314using System;namespace FlyweightSample&#123; abstract class IgoChessman &#123; public abstract string GetColor(); public void Display() &#123; Console.WriteLine("" + this.GetColor()); &#125; &#125;&#125; (2)BlackIgoChessman 12345678910namespace FlyweightSample&#123; class BlackIgoChessman : IgoChessman &#123; public override string GetColor() &#123; return ""; &#125; &#125;&#125; (3)WhiteIgoChessman 12345678910namespace FlyweightSample&#123; class WhiteIgoChessman : IgoChessman &#123; public override string GetColor() &#123; return ""; &#125; &#125;&#125; (4)IgoChessmanFactory 1234567891011121314151617181920212223242526272829303132using System.Collections;namespace FlyweightSample&#123; class IgoChessmanFactory &#123; private static IgoChessmanFactory instance = new IgoChessmanFactory(); private Hashtable ht; // Hashtable private IgoChessmanFactory() &#123; ht = new Hashtable(); IgoChessman black, white; black = new BlackIgoChessman(); ht.Add("b", black); white = new WhiteIgoChessman(); ht.Add("w", white); &#125; //  public static IgoChessmanFactory GetInstance() &#123; return instance; &#125; // keyHashtable public IgoChessman GetIgoChessman(string color) &#123; return (IgoChessman)ht[color]; &#125; &#125;&#125; (5)Program 123456789101112131415161718192021222324252627282930313233343536using System;namespace FlyweightSample&#123; class Program &#123; static void Main(string[] args) &#123; IgoChessman black1,black2,black3,white1,white2; IgoChessmanFactory factory; //  factory = IgoChessmanFactory.GetInstance(); //  black1 = factory.GetIgoChessman("b"); black2 = factory.GetIgoChessman("b"); black3 = factory.GetIgoChessman("b"); Console.WriteLine("" + (black1 == black2)); //  white1 = factory.GetIgoChessman("w"); white2 = factory.GetIgoChessman("w"); Console.WriteLine("" + (white1 == white2)); //  black1.Display(); black2.Display(); black3.Display(); white1.Display(); white2.Display(); Console.Read(); &#125; &#125;&#125; 4.  1234567TrueTrue     33 4Coordinates5 5  5CoordinatesIgoChessmanDisplay()CoordinatesCoordinates 1234567891011121314151617181920212223242526namespace FlyweightSample&#123; class Coordinates &#123; private int x; private int y; public Coordinates(int x, int y) &#123; this.x = x; this.y = y; &#125; public int X &#123; get &#123; return x; &#125; set &#123; x = value; &#125; &#125; public int Y &#123; get &#123; return y; &#125; set &#123; y = value; &#125; &#125; &#125;&#125; IgoChessman 1234567891011121314using System;namespace FlyweightSample&#123; abstract class IgoChessman &#123; public abstract string GetColor(); public void Display(Coordinates coord) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;&#123;2&#125;", this.GetColor(),coord.X,coord.Y); &#125; &#125;&#125;  123456789101112131415161718192021222324252627282930313233343536using System;namespace FlyweightSample&#123; class Program &#123; static void Main(string[] args) &#123; IgoChessman black1,black2,black3,white1,white2; IgoChessmanFactory factory; //  factory = IgoChessmanFactory.GetInstance(); //  black1 = factory.GetIgoChessman("b"); black2 = factory.GetIgoChessman("b"); black3 = factory.GetIgoChessman("b"); Console.WriteLine("" + (black1 == black2)); //  white1 = factory.GetIgoChessman("w"); white2 = factory.GetIgoChessman("w"); Console.WriteLine("" + (white1 == white2)); //  black1.Display(new Coordinates(1, 2)); black2.Display(new Coordinates(3, 4)); black3.Display(new Coordinates(1, 3)); white1.Display(new Coordinates(2, 5)); white2.Display(new Coordinates(2, 4)); Console.Read(); &#125; &#125;&#125;  1234567TrueTrue12 34 132524 Display()  1. 6 6  2. 7 7  CompositeConcreteFlyweightConcreteFlyweight   (1) (2)  (1) (2)  (1) (2) (3) (1) (2)4 (3) (4) (5) (6)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F21%2F%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F-2%2F</url>
    <content type="text"><![CDATA[   QQQQQQ           QQQQ11aQQ1bQQ 1 QQ /QQQQ//  2 2  3 3    1  /4 4  44 (1)Mediator (2)ConcreteMediator (3)Colleague (4)ConcreteColleague  (1) (2)  12345678910111213141516using System.Collections.Generic;abstract class Mediator&#123; //  protected List&lt;Colleague&gt; colleague = new List&lt;Colleague&gt;(); //  public void Register(Colleague colleague) &#123; colleague.Add(colleague); &#125; //  public abstract void Operation();&#125;  12345678910class ConcreteMediator : Mediator&#123; //  public override void Operation() &#123; ... ((Colleague)(colleagues[0])).Method1(); //  .. &#125;&#125;   123456789101112131415161718abstract class Colleague&#123; //  protected Mediator mediator; public Colleague(Mediator mediator) &#123; this.mediator = mediator; &#125; public abstract void Method1(); //  //  public void Method2() &#123; mediator.Operation(); &#125;&#125;  12345678910111213class ConcreteColleague : Colleague&#123; public ConcreteColleague(Mediator mediator) : base(mediator) &#123; &#125; //  public override void Method1() &#123; ... &#125;&#125; ConcreteColleagueMethod1()Self-MethodMethod2()Depend-Method  1. CRM55  5ListComboBox  2. 6 6  67 7  7ComponentButtonListComboBoxTextBoxMediatorConcreteMediatorConcreteMediatorConcreteMediatorButtonTextBox 3. (1)Mediator 1234567namespace MediatorSample&#123; abstract class Mediator &#123; public abstract void ComponentChanged(Component c); &#125;&#125; (2)ConcreteMediator 12345678910111213141516171819202122232425262728293031323334353637383940using System;namespace MediatorSample&#123; class ConcreteMediator : Mediator &#123; //  public Button addButton; public List list; public TextBox userNameTextBox; public ComboBox cb; //  public override void ComponentChanged(Component c) &#123; //  if (c == addButton) &#123; Console.WriteLine("----"); list.Update(); cb.Update(); userNameTextBox.Update(); &#125; //  else if (c == list) &#123; Console.WriteLine("----"); cb.Select(); userNameTextBox.SetText(); &#125; //  else if (c == cb) &#123; Console.WriteLine("----"); cb.Select(); userNameTextBox.SetText(); &#125; &#125; &#125;&#125; (3)Component 1234567891011121314151617181920namespace MediatorSample&#123; abstract class Component &#123; protected Mediator mediator; public void SetMediator(Mediator mediator) &#123; this.mediator = mediator; &#125; //  public void Changed() &#123; mediator.ComponentChanged(this); &#125; public abstract void Update(); &#125;&#125; (4)Button 12345678910namespace MediatorSample&#123; class Button : Component &#123; public override void Update() &#123; //  &#125; &#125;&#125; (5)List 1234567891011121314151617using System;namespace MediatorSample&#123; class List : Component &#123; public override void Update() &#123; Console.WriteLine(""); &#125; public void Select() &#123; Console.WriteLine(""); &#125; &#125;&#125; (6)ComboBox 1234567891011121314151617using System;namespace MediatorSample&#123; class ComboBox : Component &#123; public override void Update() &#123; Console.WriteLine(""); &#125; public void Select() &#123; Console.WriteLine(""); &#125; &#125;&#125; (7)TextBox 1234567891011121314151617using System;namespace MediatorSample&#123; class TextBox : Component &#123; public override void Update() &#123; Console.WriteLine(""); &#125; public void SetText() &#123; Console.WriteLine(""); &#125; &#125;&#125; (8)Program 12345678910111213141516171819202122232425262728293031323334353637using System;namespace MediatorSample&#123; class Program &#123; static void Main(string[] args) &#123; //  ConcreteMediator mediator; mediator = new ConcreteMediator(); //  Button addBT = new Button(); List list = new List(); ComboBox cb = new ComboBox(); TextBox userNameTB = new TextBox(); addBT.SetMediator(mediator); list.SetMediator(mediator); cb.SetMediator(mediator); userNameTB.SetMediator(mediator); mediator.addButton = addBT; mediator.list = list; mediator.cb = cb; mediator.userNameTextBox = userNameTB; addBT.Changed(); Console.WriteLine("-----------------------------"); list.Changed(); Console.Read(); &#125; &#125;&#125; 4.  12345678----   ---------------------------------   Changed()ComponentChanged()ComponentChanged() 8 8  8(Label)  (1)LabelConcreteMediatorLabelComponentChanged()Label (2)(1)LabelConcreteMediatorConcreteMediatorSubConcreteMediatorLabelSubConcreteMediatorComponentChanged()(Label) Label9 9 Label (2)ConcreteMediator(2)Label10 10  10LabelSubConcreteMediator Label.cs  123456789101112using System;namespace MediatorSample&#123; class Label : Component &#123; public override void Update() &#123; Console.WriteLine("1"); &#125; &#125;&#125; SubConcreteMediator.cs  12345678910111213141516171819202122232425262728293031323334353637using System;namespace MediatorSample&#123; class SubConcreteMediator : ConcreteMediator &#123; // Label public Label label; public override void ComponentChanged(Component c) &#123; //  if (c == addButton) &#123; Console.WriteLine("----"); list.Update(); cb.Update(); userNameTextBox.Update(); label.Update(); //  &#125; //  else if (c == list) &#123; Console.WriteLine("----"); cb.Select(); userNameTextBox.SetText(); &#125; //  else if (c == cb) &#123; Console.WriteLine("----"); cb.Select(); userNameTextBox.SetText(); &#125; &#125; &#125;&#125;  1234567891011121314151617181920212223242526272829303132333435363738using System;namespace MediatorSample&#123; class Program &#123; static void Main(string[] args) &#123; //  SubConcreteMediator mediator; mediator = new SubConcreteMediator(); Button addBT = new Button(); List list = new List(); ComboBox cb = new ComboBox(); TextBox userNameTB = new TextBox(); Label label = new Label(); addBT.SetMediator(mediator); list.SetMediator(mediator); cb.SetMediator(mediator); userNameTB.SetMediator(mediator); label.SetMediator(mediator); mediator.addButton = addBT; mediator.list = list; mediator.cb = cb; mediator.userNameTextBox = userNameTB; mediator.label = label; addBT.Changed(); Console.WriteLine("-----------------------------"); list.Changed(); Console.Read(); &#125; &#125;&#125;  123456789----   1---------------------------------   ()  GUI(Graphical User Interface  (1) (2) (3)    (1) (2) (3) (1) (2)4 (3) (4) (5)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F21%2F%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[               UMLH2O31 1 H2O3 ifelse   1 Objects for States 2 23 2  (1)ContextStateState (2)State (3)Concretestate  12345abstract class State&#123; //  public abstract void Handle();&#125;  1234567class ConcreteState : State&#123; public override void Handle() &#123; //  &#125;&#125; SetState() 123456789101112131415161718class Context&#123; private State state; //  private int value; //  //  public void SetState(State state) &#123; this.state = state; &#125; public void Request() &#123; //  state.Handle(); //  //  &#125;&#125; ContextStateContextStateStateContext  (1)StateManager 123456789101112131415...public void ChangeState()&#123; //  if (value == 0) &#123; this.SetState(new ConcreteStateA()); &#125; else if (value == 1) &#123; this.SetState(new ConcreteStateB()); &#125; ...&#125;... (2)ConcreteStateA 123456789101112131415...public void ChangeState(Context ctx)&#123; //  if (ctx.value == 1) &#123; ctx.SetState(new ConcreteStateB()); &#125; else if (ctx.value == 2) &#123; ctx.SetState(new ConcreteStateC()); &#125; ...&#125;...  1. Account3(1)0NormalState(2)0-2000OverdraftState(3)-2000RestrictedState(4)3 2. 3UML 3  3NormalStateOverdraftStateRestrictedState3Deposit()Withdraw()ComputeInterest()StateCheck() 4 4  4AccountAccountStateNormalStateOverdraftStateRestrictedState 3. (1)Account Account.cs 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354using System;namespace StateSample&#123; class Account &#123; private AccountState state; //  private string owner; //  private double balance = 0; //  public Account(string owner, double init) &#123; this.owner = owner; this.balance = init; this.state = new NormalState(this); //  Console.WriteLine("&#123;0&#125;&#123;1&#125;", this.owner ,init); Console.WriteLine("---------------------------------------------"); &#125; public double Balance &#123; get &#123; return balance; &#125; set &#123; balance = value; &#125; &#125; public void SetState(AccountState state) &#123; this.state = state; &#125; public void Deposit(double amount) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;", this.owner,amount); state.Deposit(amount); // Deposit() Console.WriteLine("&#123;0&#125;", this.Balance); Console.WriteLine("&#123;0&#125;",this.state.GetType().ToString()); Console.WriteLine("---------------------------------------------"); &#125; public void Withdraw(double amount) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;",this.owner, amount); state.Withdraw(amount); // Withdraw() Console.WriteLine("&#123;0&#125;", this.Balance); Console.WriteLine("&#123;0&#125;", this.state.GetType().ToString()); Console.WriteLine("---------------------------------------------"); &#125; public void ComputeInterest() &#123; state.ComputeInterest(); // ComputeInterest() &#125; &#125;&#125; (2)AccountState AccountState.cs 1234567891011121314151617namespace StateSample&#123; abstract class AccountState &#123; private Account acc; public Account Acc &#123; get &#123; return acc; &#125; set &#123; acc = value; &#125; &#125; public abstract void Deposit(double amount); public abstract void Withdraw(double amount); public abstract void ComputeInterest(); public abstract void StateCheck(); &#125;&#125; (3)NormalState NormalState.cs 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051using System;namespace StateSample&#123; class NormalState : AccountState &#123; public NormalState(Account acc) &#123; this.Acc = acc; &#125; public NormalState(AccountState state) &#123; this.Acc = state.Acc; &#125; public override void Deposit(double amount) &#123; Acc.Balance = Acc.Balance + amount; StateCheck(); &#125; public override void Withdraw(double amount) &#123; Acc.Balance = Acc.Balance - amount; StateCheck(); &#125; public override void ComputeInterest() &#123; Console.WriteLine(""); &#125; //  public override void StateCheck() &#123; if (Acc.Balance &gt; -2000 &amp;&amp; Acc.Balance &lt;= 0) &#123; Acc.SetState(new OverdraftState(this)); &#125; else if (Acc.Balance == -2000) &#123; Acc.SetState(new RestrictedState(this)); &#125; else if (Acc.Balance &lt; -2000) &#123; Console.WriteLine(""); &#125; &#125; &#125;&#125; (4)OverdraftState OverdraftState.cs 12345678910111213141516171819202122232425262728293031323334353637383940414243444546using System;namespace StateSample&#123; class OverdraftState : AccountState &#123; public OverdraftState(AccountState state) &#123; this.Acc = state.Acc; &#125; public override void Deposit(double amount) &#123; Acc.Balance = Acc.Balance + amount; StateCheck(); &#125; public override void Withdraw(double amount) &#123; Acc.Balance = Acc.Balance - amount; StateCheck(); &#125; public override void ComputeInterest() &#123; Console.WriteLine(""); &#125; //  public override void StateCheck() &#123; if (Acc.Balance &gt; 0) &#123; Acc.SetState(new NormalState(this)); &#125; else if (Acc.Balance == -2000) &#123; Acc.SetState(new RestrictedState(this)); &#125; else if (Acc.Balance &lt; -2000) &#123; Console.WriteLine(""); &#125; &#125; &#125;&#125; (5)RestrictedState RestrictedState.cs 1234567891011121314151617181920212223242526272829303132333435363738394041using System;namespace StateSample&#123; class RestrictedState : AccountState &#123; public RestrictedState(AccountState state) &#123; this.Acc = state.Acc; &#125; public override void Deposit(double amount) &#123; Acc.Balance = Acc.Balance + amount; StateCheck(); &#125; public override void Withdraw(double amount) &#123; Console.WriteLine(""); &#125; public override void ComputeInterest() &#123; Console.WriteLine(""); &#125; //  public override void StateCheck() &#123; if (Acc.Balance &gt; 0) &#123; Acc.SetState(new NormalState(this)); &#125; else if (Acc.Balance &gt; -2000) &#123; Acc.SetState(new OverdraftState(this)); &#125; &#125; &#125;&#125; (6)Program Program.cs 1234567891011121314151617181920using System;namespace StateSample&#123; class Program &#123; static void Main(string[] args) &#123; Account acc = new Account("", 0.0); acc.Deposit(1000); acc.Withdraw(2000); //  acc.Deposit(3000); acc.Withdraw(4000); //  acc.Withdraw(1000); //  acc.ComputeInterest(); Console.Read(); &#125; &#125;&#125; 4.  1234567891011121314151617181920212223240---------------------------------------------10001000StateSample.NormalState---------------------------------------------2000-1000StateSample.OverdraftState---------------------------------------------30002000StateSample.NormalState---------------------------------------------4000-2000StateSample.RestrictedState---------------------------------------------1000-2000StateSample.RestrictedState--------------------------------------------- 3Withdraw()3NormalStateOverdraftStateNormalStateRestrictedState3   5 5   Switch.cs 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849using System;namespace SwitchStateSample&#123; class Switch &#123; private static SwitchState currentState, onState, offState; //  private string name; public Switch(string name) &#123; this.name = name; onState = new OnState(); offState = new OffState(); currentState = onState; &#125; public void SetState(SwitchState state) &#123; currentState = state; &#125; public static SwitchState GetState(string type) &#123; if (type.Equals("on")) &#123; return onState; &#125; else &#123; return offState; &#125; &#125; //  public void On() &#123; Console.Write(name); currentState.On(this); &#125; //  public void Off() &#123; Console.Write(name); currentState.Off(this); &#125; &#125;&#125;  SwitchState.cs 12345678namespace SwitchStateSample&#123; abstract class SwitchState &#123; public abstract void On(Switch s); public abstract void Off(Switch s); &#125;&#125;  OnState.cs 123456789101112131415161718using System;namespace SwitchStateSample&#123; class OnState : SwitchState &#123; public override void On(Switch s) &#123; Console.WriteLine(""); &#125; public override void Off(Switch s) &#123; Console.WriteLine(""); s.SetState(Switch.GetState("off")); &#125; &#125;&#125; OffState.cs 123456789101112131415161718using System;namespace SwitchStateSample&#123; class OffState : SwitchState &#123; public override void On(Switch s) &#123; Console.WriteLine(""); s.SetState(Switch.GetState("on")); &#125; public override void Off(Switch s) &#123; Console.WriteLine(""); &#125; &#125;&#125;  Program.cs 1234567891011121314151617181920212223using System;namespace SwitchStateSample&#123; class Program &#123; static void Main(string[] args) &#123; Switch s1, s2; s1 = new Switch("1"); s2 = new Switch("2"); s1.On(); s2.On(); s1.Off(); s2.Off(); s2.On(); s1.On(); Console.Read(); &#125; &#125;&#125;  123456121221  ContextSetState()Context StateCheck()   3NormalStateLargerStateLargestState3Screen6 6   Screen.cs 1234567891011121314151617181920212223242526272829303132333435363738394041424344using System;namespace ScreenStateSample&#123; class Screen &#123; // currentState private ScreenState currentState, normalState, largerState, largestState; public Screen() &#123; this.normalState = new NormalState(); //  this.largerState = new LargerState(); //  this.largestState = new LargestState(); //  this.currentState = normalState; //  this.currentState.Display(); &#125; public void SetState(ScreenState state) &#123; this.currentState = state; &#125; //  public void OnClick() &#123; if (this.currentState == normalState) &#123; this.SetState(largerState); this.currentState.Display(); &#125; else if (this.currentState == largerState) &#123; this.SetState(largestState); this.currentState.Display(); &#125; else if (this.currentState == largestState) &#123; this.SetState(normalState); this.currentState.Display(); &#125; &#125; &#125;&#125; ScreenState.cs 123456789using System;namespace ScreenStateSample&#123; abstract class ScreenState &#123; public abstract void Display(); &#125;&#125; NormalState.cs 123456789101112using System;namespace ScreenStateSample&#123; class NormalState : ScreenState &#123; public override void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; LargerState.cs 123456789101112using System;namespace ScreenStateSample&#123; class LargerState : ScreenState &#123; public override void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; LargerState.cs 123456789101112using System;namespace ScreenStateSample&#123; class LargestState : ScreenState &#123; public override void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; Screen  Program.cs 1234567891011121314151617using System;namespace ScreenStateSample&#123; class Program &#123; static void Main(string[] args) &#123; Screen screen = new Screen(); screen.OnClick(); screen.OnClick(); screen.OnClick(); Console.Read(); &#125; &#125;&#125;  1234   (1) (2) (3) (4)  (1) (2) (3)  (1) (2) (1) (2)3 (3) (4) (5) (6)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F21%2F%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[   .NET        .NET 1 1     1 -Publish-Subscribe-Model-View-Source-ListenerDependents 2 2  24 (1)SubjectNotify() (2)ConcreteSubject (3)ObserverUpdate() (4)ConcreteObserverObserverUpdate()Attach()Detach() -Publish-SubscribeSubject Subject.cs 12345678910111213using System.Collections;abstract class Subject&#123; //  protected ArrayList observers = new ArrayList(); //  public abstract void Attach(Observer observer); //  public abstract void Detach(Observer observer); //  public abstract void Notify();&#125; ConcreteSubjectSubject3 ConcreteSubject.cs 12345678910111213141516171819202122class ConcreteSubject : Subject&#123; public override void Attach(Observer observer) &#123; observers.Add(observer); &#125; public override void Detach(Observer observer) &#123; observers.Remove(observer); &#125; //  public override void Notify() &#123; //  foreach(object obs in observers) &#123; ((Observer)obs).Update(); &#125; &#125;&#125; Update()Observer Observer.cs 1234interface Observer&#123; void Update();&#125; ConcreteObserverUpdate() ConcreteObserver.cs 12345678class ConcreteObserver : Observer&#123; //  public void Update() &#123; //  &#125;&#125; ConcreteObserverUpdate()ConcreteSubjectConcreteObserverConcreteSubjectConcreteObserverConcreteSubjectConcreteSubjectConcreteObserverUpdate()ConcreteSubjectConcreteObserverConcreteSubject  Attach() 123456...Subject subject = new ConcreteSubject();Observer observer = new ConcreteObserver();subject.Attach(observer);subject.Notify();... Notify()Update()  1.  2.  -&gt;-&gt; 3 3  3 4 4  4AllyControlCenterConcreteAllyControlCenterIObserverPlayer 3. (1)AllyControlCenter AllyControlCenter.cs 1234567891011121314151617181920212223242526272829303132333435363738using System;using System.Collections.Generic;namespace ObserverSample&#123; abstract class AllyControlCenter &#123; protected string allyName; //  protected List&lt;IObserver&gt; players = new List&lt;IObserver&gt;(); //  public void SetAllyName(string allyName) &#123; this.allyName = allyName; &#125; public string GetAllyName() &#123; return this.allyName; &#125; //  public void Join(IObserver obs) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;", obs.Name, this.allyName); players.Add(obs); &#125; //  public void Quit(IObserver obs) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;", obs.Name, this.allyName); players.Remove(obs); &#125; //  public abstract void NotifyObserver(string name); &#125;&#125; (2)ConcreteAllyControlCenter ConcreteAllyControlCenter.cs 12345678910111213141516171819202122232425262728using System;namespace ObserverSample&#123; class ConcreteAllyControlCenter : AllyControlCenter &#123; public ConcreteAllyControlCenter(string allyName) &#123; Console.WriteLine("&#123;0&#125;", allyName); Console.WriteLine("----------------------------"); this.allyName = allyName; &#125; //  public override void NotifyObserver(string name) &#123; Console.WriteLine("&#123;0&#125;&#123;1&#125;", this.allyName, name); //  foreach(object obs in players) &#123; if (!((IObserver)obs).Name.Equals(name)) &#123; ((IObserver)obs).Help(); &#125; &#125; &#125; &#125;&#125; (3)IObserver IObserver.cs 1234567891011121314namespace ObserverSample&#123; interface IObserver &#123; string Name &#123; get; set; &#125; void Help(); //  void BeAttacked(AllyControlCenter acc); //  &#125;&#125; (4)Player Player.cs 123456789101112131415161718192021222324252627282930313233using System;namespace ObserverSample&#123; class Player : IObserver &#123; private string name; public Player(string name) &#123; this.name = name; &#125; public string Name &#123; get &#123; return name; &#125; set &#123; name = value; &#125; &#125; //  public void Help() &#123; Console.WriteLine("&#123;0&#125;", this.name); &#125; // NotifyObserver() public void BeAttacked(AllyControlCenter acc) &#123; Console.WriteLine("&#123;0&#125;", this.name); acc.NotifyObserver(name); &#125; &#125;&#125; (5)Program Program.cs 12345678910111213141516171819202122232425262728293031323334using System;namespace ObserverSample&#123; class Program &#123; static void Main(string[] args) &#123; //  AllyControlCenter acc; acc = new ConcreteAllyControlCenter(""); //  IObserver player1, player2, player3, player4; player1 = new Player(""); acc.Join(player1); player2 = new Player(""); acc.Join(player2); player3 = new Player(""); acc.Join(player3); player4 = new Player(""); acc.Join(player4); //  player1.BeAttacked(acc); Console.Read(); &#125; &#125;&#125; 4.  1234567891011---------------------------- PlayerBeAttacked()AllyControlCenterNotifyObserver()NotifyObserver()PlayerHelp()PlayerBeAttacked()AllyControlCenterNotifyObserver()PlayerHelp() Player.BeAttacked()->AllyControlCenter.NotifyObserver()->Player.Help() .NET.NET.NETWinForm .NETWinFormDelegateEvent Handler C# 1eventSource.someEvent += new SomeEventHandler(someMethod); eventSourcesomeEventSomeEventHandlersomeMethodSomeEventHandlersomeMethod .NET .NETEventTest EventTest.cs 12345678910111213141516171819202122232425262728using System;namespace ObserverExtend&#123; class EventTest &#123; //  public delegate void UserInput(object sender, EventArgs e); //  public event UserInput OnUserInput; // 0 public void Method() &#123; bool flag = false; Console.WriteLine(""); while (!flag) &#123; if (Console.ReadLine() == "0") &#123; OnUserInput(this, new EventArgs()); &#125; &#125; &#125; &#125;&#125; EventTestUserInputOnUserInputEventTestMethod()Method() ProgramProgram Program.cs 123456789101112131415161718192021222324252627282930313233using System;namespace ObserverExtend&#123; class Program &#123; public Program(EventTest test) &#123; //  test.OnUserInput += new EventTest.UserInput(Handler); test.OnUserInput += new EventTest.UserInput(HandlerMore); //  // test.OnUserInput -= new EventTest.UserInput(Handler); &#125; public void Handler(object sender, EventArgs e) &#123; Console.WriteLine(""); &#125; public void HandlerMore(object sender, EventArgs e) &#123; Console.WriteLine(""); &#125; static void Main(string[] args) &#123; EventTest test = new EventTest(); Program program = new Program(test); test.Method(); &#125; &#125;&#125; ProgramProgramHandler()HandlerMore() 123456 321 EventTest.NET MVCMVCModel-View-ControllerMVC3ModelViewControllerMVC5 5 MVC 5 WebGUIXMLWeb  (1) (2) (3) (4)  (1) (2) (3)  (1) (2) (3)ABBC (1) (2)4 (3) (4) (5).NET.NET (6)MVC]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F20%2F%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F-2%2F</url>
    <content type="text"><![CDATA[                 1a1b 1  FacadeSubSystem2a2b 2   Facade 1  2b3 3  3 (1)Facade (2)SubSystem   1234567891011121314151617181920212223class SubSystemA&#123; public void MethodA() &#123; //  &#125;&#125;class SubSystemB&#123; public void MethodB() &#123; //  &#125;&#125;class SubSystemC&#123; public void MethodC() &#123; //  &#125;&#125;  12345678910111213class Facade&#123; private SubSystemA obj1 = new SubSystemA(); private SubSystemB obj2 = new SubSystemB(); private SubSystemC obj3 = new SubSystemC(); public void Method() &#123; obj1.MethodA(); obj2.MethodB(); obj3.MethodC(); &#125;&#125;  12345678class Program&#123; static void Main(string[] args) &#123; Facade facade = new Facade(); facade.Method(); &#125;&#125;  1. 3333 2. 4 4  4EncryptFacadeFileReaderCipherMachineFileWriter 3. (1)FileReader 123456789101112131415161718192021222324252627282930313233343536373839404142using System;using System.Text;using System.IO;namespace FacadeSample&#123; class FileReader &#123; public string Read(string fileNameSrc) &#123; Console.Write(""); FileStream fs = null; StringBuilder sb = new StringBuilder(); try &#123; fs = new FileStream(fileNameSrc, FileMode.Open); int data; while((data = fs.ReadByte())!= -1) &#123; sb = sb.Append((char)data); &#125; fs.Close(); Console.WriteLine(sb.ToString()); &#125; catch(FileNotFoundException e) &#123; Console.WriteLine(""); &#125; catch(IOException e) &#123; Console.WriteLine(""); &#125; return sb.ToString(); &#125; &#125;&#125; (2)CipherMachine 1234567891011121314151617181920212223242526using System;using System.Text;namespace FacadeSample&#123; class CipherMachine &#123; public string Encrypt(string plainText) &#123; Console.Write(""); string es = ""; char[] chars = plainText.ToCharArray(); foreach(char ch in chars) &#123; string c = (ch % 7).ToString(); es += c; &#125; Console.WriteLine(es); return es; &#125; &#125;&#125; (3)FileWriter 12345678910111213141516171819202122232425262728293031323334using System;using System.IO;using System.Text;namespace FacadeSample&#123; class FileWriter &#123; public void Write(string encryptStr,string fileNameDes) &#123; Console.WriteLine(""); FileStream fs = null; try &#123; fs = new FileStream(fileNameDes, FileMode.Create); byte[] str = Encoding.Default.GetBytes(encryptStr); fs.Write(str,0,str.Length); fs.Flush(); fs.Close(); &#125; catch(FileNotFoundException e) &#123; Console.WriteLine(""); &#125; catch(IOException e) &#123; Console.WriteLine(e.Message); Console.WriteLine(""); &#125; &#125; &#125;&#125; (4)EncryptFacade 12345678910111213141516171819202122232425namespace FacadeSample&#123; class EncryptFacade &#123; //  private FileReader reader; private CipherMachine cipher; private FileWriter writer; public EncryptFacade() &#123; reader = new FileReader(); cipher = new CipherMachine(); writer = new FileWriter(); &#125; //  public void FileEncrypt(string fileNameSrc, string fileNameDes) &#123; string plainStr = reader.Read(fileNameSrc); string encryptStr = cipher.Encrypt(plainStr); writer.Write(encryptStr, fileNameDes); &#125; &#125;&#125; (5)Program 1234567891011121314151617using System;using System.Configuration;using System.Reflection;namespace FacadeSample&#123; class Program &#123; static void Main(string[] args) &#123; EncryptFacade ef = new EncryptFacade(); ef.FileEncrypt("src.txt", "des.txt"); Console.Read(); &#125; &#125;&#125; 4.  123Hello World!233364062325 src.txtHello World!des.txt233364062325CipherMachine7   CipherMachineNewCipherMachine 12345678910111213141516171819202122232425262728293031323334353637383940using System;namespace FacadeSample&#123; class NewCipherMachine &#123; public string Encrypt(string plainText) &#123; Console.Write(""); string es = ""; int key = 10;// 10 char[] chars = plainText.ToCharArray(); foreach(char ch in chars) &#123; int temp = Convert.ToInt32(ch); //  if (ch &gt;= 'a' &amp;&amp; ch &lt;= 'z') &#123; temp += key % 26; if (temp &gt; 122) temp -= 26; if (temp &lt; 97) temp += 26; &#125; //  if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z') &#123; temp += key % 26; if (temp &gt; 90) temp -= 26; if (temp &lt; 65) temp += 26; &#125; es += ((char)temp).ToString(); &#125; Console.WriteLine(es); return es; &#125; &#125;&#125; EncryptFacadeCipherMachineNewCipherMachine NewEncryptFacadeFileReaderFileWriterNewCipherMachineEncryptFacadeNewEncryptFacade 5 5  5ClientAbstractEncryptFacadeAbstractEncryptFacade 1234567namespace FacadeSample&#123; abstract class AbstractEncryptFacade &#123; public abstract void FileEncrypt(string fileNameSrc, string fileNameDes); &#125;&#125; NewEncryptFacade 1234567891011121314151617181920212223namespace FacadeSample&#123; class NewEncryptFacade : AbstractEncryptFacade &#123; private FileReader reader; private NewCipherMachine cipher; private FileWriter writer; public NewEncryptFacade() &#123; reader = new FileReader(); cipher = new NewCipherMachine(); writer = new FileWriter(); &#125; public override void FileEncrypt(string fileNameSrc, string fileNameDes) &#123; string plainStr = reader.Read(fileNameSrc); string encryptStr = cipher.Encrypt(plainStr); writer.Write(encryptStr, fileNameDes); &#125; &#125;&#125; App.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="facade" value="FacadeSample.NewEncryptFacade"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt;  123456789101112131415161718192021using System;using System.Configuration;using System.Reflection;namespace FacadeSample&#123; class Program &#123; static void Main(string[] args) &#123; AbstractEncryptFacade ef; //  //  string facadeString = ConfigurationManager.AppSettings["facade"]; //  ef = (AbstractEncryptFacade)Assembly.Load("FacadeSample").CreateInstance(facadeString); ef.FileEncrypt("src.txt", "des.txt"); Console.Read(); &#125; &#125;&#125;  123Hello World!Rovvy gybvn! EncryptFacadeAbstractEncryptFacade B/SC/SB/SC/S  (1) (2) (3)  (1) (2)  (1) (2) (3) (1) (2) (3) (4) (5)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F19%2F%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[  public abstract void Send(string message, Colleague colleague); ConcreteMediatorConcreteColleague      ITITITIT  1 Mediator ColleagueConcreteColleagueMediatorConcreteMediator Mediator  12345abstract class Mediator&#123; //  public abstract void Send(string message, Colleague colleague);&#125; Colleague  12345678910abstract class Colleague&#123; protected Mediator mediator; //  public Colleague(Mediator mediator) &#123; this.mediator = mediator; &#125;&#125; ConcreteMediator  1234567891011121314151617181920212223242526272829class ConcreteMediator : Mediator&#123; //  private ConcreteColleague1 colleague1; private ConcreteColleague2 colleague2; public ConcreteColleague1 Colleague1 &#123; set &#123; colleague1 = value; &#125; &#125; public ConcreteColleague2 Colleague2 &#123; set &#123; colleague2 = value; &#125; &#125; //  public override void Send(string message, Colleague colleague) &#123; if (colleague == colleague1) &#123; colleague2.Notify(message); &#125; else &#123; colleague1.Notify(message); &#125; &#125;&#125; ConcreteColleague1ConcreteColleague2 12345678910111213141516171819202122232425262728293031323334353637class ConcreteColleague1 : Colleague&#123; public ConcreteColleague1(Mediator mediator) : base(mediator) &#123; &#125; public void Send(string message) &#123; //  mediator.Send(message, this); &#125; public void Notify(string message) &#123; Console.WriteLine("1:" + message); &#125;&#125;class ConcreteColleague2 : Colleague&#123; public ConcreteColleague2(Mediator mediator) : base(mediator) &#123; &#125; public void Send(string message) &#123; mediator.Send(message, this); &#125; public void Notify(string message) &#123; Console.WriteLine("2:" + message); &#125;&#125;  123456789101112131415161718192021class Program&#123; static void Main(string[] args) &#123; ConcreteMediator m = new ConcreteMediator(); //  ConcreteColleague1 c1 = new ConcreteColleague1(m); ConcreteColleague2 c2 = new ConcreteColleague2(m); //  m.Colleague1 = c1; m.Colleague2 = c2; //  c1.Send("?"); c2.Send(""); Console.Read(); &#125;&#125; MediatorConcreteColleague1ConcreteColleague2  MediatorConcreteMediatorMediator MediatorConcreteMediator   Mediator 12345678910// abstract class UnitedNations&#123; /// &lt;summary&gt; ///  /// &lt;/summary&gt; /// &lt;param name="message"&gt;&lt;/param&gt; /// &lt;param name="colleague"&gt;&lt;/param&gt; public abstract void Declare(string message, Country colleague);&#125;  Colleague 12345678910// abstract class Country&#123; protected UnitedNations mediator; public Country(UnitedNations mediator) &#123; this.mediator = mediator; &#125;&#125;  ConcreteColleague1 1234567891011121314151617181920 // class USA : Country&#123; public USA(UnitedNations mediator) : base(mediator) &#123; &#125; //  public void Declare(string message) &#123; mediator.Declare(message, this); &#125; //  public void GetMessage(string message) &#123; Console.WriteLine("" + message); &#125;&#125;  ConcreteColleague2 1234567891011121314151617181920// class Iraq : Country&#123; public Iraq(UnitedNations mediator) : base(mediator) &#123; &#125; //  public void Declare(string message) &#123; mediator.Declare(message, this); &#125; //  public void GetMessage(string message) &#123; Console.WriteLine("" + message); &#125;&#125;  ConcreteMediator 123456789101112131415161718192021222324252627282930// class UnitedNationsSecurityCouncil : UnitedNations&#123; private USA colleague1; private Iraq colleague2; //  public USA Colleague1 &#123; set &#123; colleague1 = value; &#125; &#125; public Iraq Colleague2 &#123; set &#123; colleague2 = value; &#125; &#125; //  public override void Declare(string message, Country colleague) &#123; if (colleague == colleague1) &#123; colleague2.GetMessage(message); &#125; else &#123; colleague1.GetMessage(message); &#125; &#125;&#125;  123456789101112131415161718class Program&#123; static void Main(string[] args) &#123; UnitedNationsSecurityCouncil UNSC = new UnitedNationsSecurityCouncil(); USA c1 = new USA(UNSC); Iraq c2 = new Iraq(UNSC); UNSC.Colleague1 = c1; UNSC.Colleague2 = c2; c1.Declare(""); c2.Declare(""); Console.Read(); &#125;&#125;  12 ConcreteMediatorConcreteColleagueConcreteColleagueConcreteMediator   1.MediatorColleagueColleagueMediator 2.MediatorColleague 3. 4.  ConcreteMediatorConcreteColleague ConcreteMediatorConcreteColleague  FormButtonTextBoxText FormForm  MySQLRedisMySQLElasticsearchHbase   NN * NN - 1 DataX/MySQLOracleSqlServerPostgreHDFSHiveADSHBaseTableStore(OTS)MaxCompute(ODPS)DRDS DataX DataXDataX Form]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F18%2F%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[      new    new Receiver               1 1  1 1  : 1 ActionTransaction 2 2  24 (1)CommandExecute() (2)ConcreteCommandExecute() (3)InvokerExecute() (4)Receiver  Execute()ReceiverExecute()  1234abstract class Command&#123; public abstract void Execute();&#125; SetterExecute() 1234567891011121314151617181920212223class Invoker&#123; private Command command; //  public Invoker(Command command) &#123; this.command = command; &#125; public Command command &#123; get&#123; return command; &#125; //  set&#123; command = value; &#125; &#125; //  public void Call() &#123; command.Execute(); &#125;&#125; Execute()Action() 1234567891011class ConcreteCommand : Command&#123; //  private Receiver receiver; public override void Execute() &#123; // Action() receiver.Action(); &#125;&#125; ReceiverAction() 1234567class Receiver&#123; public void Action() &#123; //  &#125;&#125;  1. FunctionButtonSystemExitClassDisplayHelpClass 2. 3 3  3FunctionButtonSystemExitClassDisplayHelpClassCommandExitCommandHelpCommand 3. (1)FunctionButton FunctionButton.cs 1234567891011121314151617181920212223using System;namespace CommandSample&#123; class FunctionButton &#123; private Command command; //  //  public Command Command &#123; get&#123; return command; &#125; set&#123; command = value; &#125; &#125; //  public void Click() &#123; Console.WriteLine(""); command.Execute(); &#125; &#125;&#125; (2)Command Command.cs 1234567namespace CommandSample&#123; abstract class Command &#123; public abstract void Execute(); &#125;&#125; (3)ExitCommand ExitCommand.cs 123456789101112131415161718namespace CommandSample&#123; class ExitCommand : Command &#123; private SystemExitClass seObj; //  public ExitCommand() &#123; seObj = new SystemExitClass(); &#125; //  public override void Execute() &#123; seObj.Exit(); &#125; &#125;&#125; (4)HelpCommand HelpCommand.cs 123456789101112131415161718namespace CommandSample&#123; class HelpCommand : Command &#123; private DisplayHelpClass hcObj; //  public HelpCommand() &#123; hcObj = new DisplayHelpClass(); &#125; //  public override void Execute() &#123; hcObj.Display(); &#125; &#125;&#125; (5)SystemExitClass SystemExitClass.cs 123456789101112using System;namespace CommandSample&#123; class SystemExitClass &#123; public void Exit() &#123; Console.WriteLine(""); &#125; &#125;&#125; (6)DisplayHelpClass DisplayHelpClass.cs 123456789101112using System;namespace CommandSample&#123; class DisplayHelpClass &#123; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (7)App.config App.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="command" value="CommandSample.ExitCommand" /&gt; &lt;/appSettings&gt;&lt;/configuration&gt; (8)Program Program.cs 123456789101112131415161718192021222324252627using System;using System.Configuration;using System.Reflection;namespace CommandSample&#123; class Program &#123; static void Main(string[] args) &#123; FunctionButton fb = new FunctionButton(); Command command; //  //  string commandStr = ConfigurationManager.AppSettings["command"]; //  command = (Command)Assembly.Load("CommandSample").CreateInstance(commandStr); //  fb.Command = command; //  fb.Click(); Console.Read(); &#125; &#125;&#125; 4.  12 ExitCommandHelpCommand 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="command" value="CommandSample.HelpCommand" /&gt; &lt;/appSettings&gt;&lt;/configuration&gt;  12    CommandQueueCommandQueue: CommandQueue.cs 1234567891011121314151617181920212223242526272829using System.Collections.Generic;namespace CommandSample&#123; class CommandQueue &#123; // List private List&lt;Command&gt; commands = new List&lt;Command&gt;(); public void AddCommand(Command command) &#123; commands.Add(command); &#125; public void RemoveCommand(Command command) &#123; commands.Remove(command); &#125; // Execute() public void Execute() &#123; foreach(object command in commands) &#123; ((Command)command).Execute(); &#125; &#125; &#125;&#125; CommandQueueInvokerCommandQueue Invoker.cs 1234567891011121314151617181920212223242526namespace CommandSample&#123; class Invoker &#123; // CommandQueue private CommandQueue commandQueue; //  public Invoker(CommandQueue commandQueue) &#123; this.commandQueue = commandQueue; &#125; //  public void SetCommandQueue(CommandQueue commandQueue) &#123; this.commandQueue = commandQueue; &#125; // CommandQueueExecute() public void Call() &#123; commandQueue.Execute(); &#125; &#125;&#125; Execute() Log FileWindowsOracle (1) (2) (3) [Serializable] UndoRedo  4CalculatorFormAdderAdd()Undo() 4  Adder Adder.cs 123456789101112131415namespace CommandUndoSample&#123; class Adder &#123; // 0 private int num = 0; // num public int Add(int value) &#123; num += value; return num; &#125; &#125;&#125; AbstractCommandExecute()Undo() AbstractCommand.cs 12345678namespace CommandUndoSample&#123; abstract class AbstractCommand &#123; public abstract int Execute(int value); public abstract int Undo(); &#125;&#125; AddCommandAbstractCommandExecute()Undo() AddCommand.cs 123456789101112131415161718192021namespace CommandUndoSample&#123; class AddCommand : AbstractCommand &#123; private Adder adder = new Adder(); private int value; // Execute() public override int Execute(int value) &#123; this.value = value; return adder.Add(value); &#125; // Undo() public override int Undo() &#123; return adder.Add(-value); &#125; &#125;&#125; CalculatorFormAbstractCommandcommandcommandAdder CalculatorForm.cs 1234567891011121314151617181920212223242526272829using System;namespace CommandUndoSample&#123; class CalculatorForm &#123; private AbstractCommand command; public AbstractCommand Command &#123; get&#123; return command; &#125; set&#123; command = value; &#125; &#125; // Execute() public void Compute(int value) &#123; int i = Command.Execute(value); Console.WriteLine("" + i); &#125; // Undo() public void Undo() &#123; int i = Command.Undo(); Console.WriteLine("" + i); &#125; &#125;&#125; ProgramcommandformformCompute()Undo() Program.cs 12345678910111213141516171819202122using System;namespace CommandUndoSample&#123; public class Program &#123; static void Main(string[] args) &#123; CalculatorForm form = new CalculatorForm(); AbstractCommand command; command = new AddCommand(); form.Command = command; form.Compute(10); form.Compute(5); form.Compute(10); form.Undo(); //  Console.Read(); &#125; &#125;&#125;  123410152515 Redo Macro CommandComposite CommandExecute()Execute()5 5  GUI  (1) (2) (3) (4)UndoRedo  ,  (1) (2) (3)UndoRedo (4) (1) (2)4Execute()Execute() (3) (4) (5) (6) (7) (8)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F18%2F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[             IDWindows1 1 Windows   1 3 2 2  2SingletonGetInstance()privateSingleton Singletonnew  12345678910111213141516171819class Singleton&#123; private static Singleton instance = null; //  //  private Singleton() &#123; &#125; //  public static Singleton GetInstance() &#123; if(instance == null) instance = new Singleton(); return instance; &#125;&#125;  123456789101112131415161718using System;class Program&#123; static void Main(string[] args) &#123; Singleton s1 = Singleton.GetInstance(); Singleton s2 = Singleton.GetInstance(); //  if (s1 == s2) &#123; Console.WriteLine(""); &#125; Console.Read(); &#125;&#125;  1 Getinstance()SingletorSingleton 3 (1)private (2) (3)  1. Load Balance 2. 3 3  3LoadBalancerserverListserverList 3. (1)LoadBalancer 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849using System;using System.Collections;namespace SingletonSample&#123; class LoadBalancer &#123; //  private static LoadBalancer instance = null; //  private ArrayList serverList = null; //  private LoadBalancer() &#123; serverList = new ArrayList(); &#125; //  public static LoadBalancer GetLoadBalancer() &#123; if (instance == null) &#123; instance = new LoadBalancer(); &#125; return instance; &#125; //  public void AddServer(string server) &#123; serverList.Add(server); &#125; //  public void RemoveServer(string server) &#123; serverList.Remove(server); &#125; // Random public string GetServer() &#123; Random random = new Random(); int i = random.Next(serverList.Count); return serverList[i].ToString(); &#125; &#125;&#125; (2)Program 12345678910111213141516171819202122232425262728293031323334353637using System;namespace SingletonSample&#123; class Program &#123; static void Main(string[] args) &#123; // LoadBalancer LoadBalancer balancer1,balancer2,balancer3,balancer4; balancer1 = LoadBalancer.GetLoadBalancer(); balancer2 = LoadBalancer.GetLoadBalancer(); balancer3 = LoadBalancer.GetLoadBalancer(); balancer4 = LoadBalancer.GetLoadBalancer(); //  if (balancer1 == balancer2 &amp;&amp; balancer2 == balancer3 &amp;&amp; balancer3 == balancer4) &#123; Console.WriteLine(""); &#125; //  balancer1.AddServer("Server 1"); balancer1.AddServer("Server 2"); balancer1.AddServer("Server 3"); balancer1.AddServer("Server 4"); // serveri"i &lt; 100" for (int i = 0; i &lt; 10; i++) &#123; string server = balancer1.GetServer(); Console.WriteLine(" " + server); &#125; Console.Read(); &#125; &#125;&#125; 4  1234567891011! : Server 1 : Server 1 : Server 1 : Server 1 : Server 2 : Server 2 : Server 2 : Server 2 : Server 3 : Server 3 4LoadBalancerLoadBalancer 1. Eager Singleton4 4  4 1234567891011class EagerSingleton&#123; private static EagerSingleton instance = new EagerSingleton(); private EagerSingleton() &#123;&#125; public static EagerSingleton GetInstance() &#123; return instance; &#125;&#125; instance 2. Lazy Singleton5 5  5LoadBalancer GetInstance()C#locklock 123456789101112131415161718192021222324252627class LazySingleton&#123; private static LazySingleton instance = null; //  private static readonly object syncRoot = new object(); private LazySingleton()&#123;&#125; public static LazySingleton GetInstance() &#123; //  if (instance == null) &#123; //  lock(syncRoot) &#123; //  if (instance == null) &#123; instance = new LazySingleton(); //  &#125; &#125; &#125; return instance; &#125;&#125; GetInstance()syncRoot Double-Check LockingGetInstance()instance==nulllocklocklockinstance-=null 3.     (1) (2) (3)  (1) (2) (3)C#Java  (1) (2) (1) (2) (3) (4) (5) (6)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F18%2F%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[   C#          1 1    1   2 2  23 (1)Prototype (2)ConcretePrototype (3)ClientPrototype Shallow CloneDeep Clone 1. intdoublebyteboolchar3 3  2. 4 4  C# 1.  1234567891011121314151617181920212223abstract class Prototype&#123; public abstract Prototype Clone();&#125;class ConcretePrototype : Prototype&#123; private string attr; // public string Attr &#123; get &#123; return attr; &#125; set &#123; attr = value; &#125; &#125; //  public override Prototype Clone() &#123; ConcretePrototype prototype = new ConcretePrototype(); prototype.Attr = this.Attr; return prototype; &#125;&#125; ConcretePrototypeClone() 1234...ConcretePrototype prototype = new ConcretePrototype();ConcretePrototype copy = (ConcretePrototype)prototype.Clone();... C# Clone()Clone()Clone()C#string/String 2.C#MemberwiseClone()ICloneable C#MemberwiseClone()MemberwiseClone() 12345678910111213141516171819202122// class Member&#123;&#125;class ConcretePrototypeA&#123; private Member member; //  public Member Member &#123; get &#123; return member; &#125; set &#123; member = value; &#125; &#125; //  public ConcretePrototypeA Clone() &#123; return (ConcretePrototypeA)this.MemberwiseClone(); //  &#125;&#125; Clone() 1234567...ConcretePrototypeA prototype, copy;prototype = new ConcretePrototypeA();copy = prototype.Clone();Console.WriteLine(prototype == copy);Console.WriteLine(prototype.Member == copy.Member);... Console.WriteLine(prototype==copy);FalseConsole.WriteLine(prototype.Member==copy.Member);True MemberwiseClone()C#ICloneable: 1234public interface ICloneable&#123; object Clone();&#125; ICloneable 12345678910111213141516171819class ConcretePrototypeB : ICloneable // ICloneable&#123; private Member member; public Member Member &#123; get &#123; return member; &#125; set &#123; member = value; &#125; &#125; //  public object Clone() &#123; ConcretePrototypeB copy = (ConcretePrototypeB)this.MemberwiseClone(); Member newMember = new Member(); copy.Member = newMember; return copy; &#125;&#125;  1234567...ConcretePrototypeB prototype, copy;prototype = new ConcretePrototypeB();copy = (ConcretePrototypeB)prototype.Clone();Console.WriteLine(prototype == copy);Console.WriteLine(prototype.Member == copy.Member);... Console.WriteLine(prototype==copy);FalseConsole.WriteLine(prototype.Member==copy.Member);False ICloneableMemberwiseClone()Serializable  1. OAOA 2. 5 5  5WeeklyLogClone()Attachment 3. (1)WeeklyLog 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687using System;using System.IO;using System.Collections;using System.Runtime.Serialization.Formatters.Binary;using System.Runtime.Serialization;namespace PrototypeSample&#123; [Serializable] class WeeklyLog &#123; private Attachment attachment; private string name; private string date; private string content; public Attachment Attachment &#123; get &#123; return attachment; &#125; set &#123; attachment = value; &#125; &#125; public string Name &#123; get &#123; return name; &#125; set &#123; name = value; &#125; &#125; public string Date &#123; get &#123; return date; &#125; set &#123; date = value; &#125; &#125; public string Content &#123; get &#123; return content; &#125; set &#123; content = value; &#125; &#125; /* //MemberwiseClone() public WeeklyLog Clone() &#123; return this.MemberwiseClone() as WeeklyLog; &#125; */ // public WeeklyLog Clone() &#123; WeeklyLog clone = null; FileStream fs = new FileStream("Temp.dat", FileMode.Create); BinaryFormatter formatter = new BinaryFormatter(); try &#123; formatter.Serialize(fs, this); &#125; catch (SerializationException e) &#123; Console.WriteLine("Failed to serialize. Reason: " + e.Message); throw; &#125; finally &#123; fs.Close(); &#125; FileStream fs1 = new FileStream("Temp.dat", FileMode.Open); BinaryFormatter formatter1 = new BinaryFormatter(); try &#123; clone = (WeeklyLog)formatter1.Deserialize(fs1); &#125; catch (SerializationException e) &#123; Console.WriteLine("Failed to deserialize. Reason: " + e.Message); throw; &#125; finally &#123; fs.Close(); &#125; return clone; &#125; &#125;&#125; (2)Attachment 123456789101112131415161718192021using System;namespace PrototypeSample&#123; [Serializable] class Attachment &#123; private string name; public string Name &#123; get &#123; return name; &#125; set &#123; name = value; &#125; &#125; public void Download() &#123; Console.WriteLine("&#123;0&#125;",name); &#125; &#125;&#125; (3)Program 12345678910111213141516171819using System;namespace PrototypeSample&#123; class Program &#123; static void Main(string[] args) &#123; WeeklyLog log_previous, log_new; log_previous = new WeeklyLog(); Attachment attachment = new Attachment(); log_previous.Attachment = attachment; log_new = log_previous.Clone(); Console.WriteLine("&#123;0&#125;",(log_previous == log_new)?"":""); Console.WriteLine("&#123;0&#125;",(log_previous.Attachment == log_new.Attachment)?"":""); Console.Read(); &#125; &#125;&#125; 4.  12  5.  WeeklyLogAttachmentSerializable 123456789101112[Serializable]class WeeklyLog&#123; private Attachment attachment; ...&#125;[Serializable]class Attachment&#123; ...&#125; WeeklyLogClone() 12345678910111213141516171819202122232425262728293031323334353637// public WeeklyLog Clone()&#123; WeeklyLog clone = null; FileStream fs = new FileStream("Temp.dat", FileMode.Create); BinaryFormatter formatter = new BinaryFormatter(); try &#123; formatter.Serialize(fs, this); //  &#125;catch(SerializationException e) &#123; Console.WriteLine("Failed to serialize. Reason: " + e.Message); throw; &#125;finally &#123; fs.Close(); &#125; FileStream fs1 = new FileStream("Temp.dat", FileMode.Open); BinaryFormatter formatter1 = new BinaryFormatter(); try &#123; clone = (WeeklyLog)formatter1.Deserialize(fs1); //  &#125;catch(SerializationException e) &#123; Console.WriteLine("Failed to serialize. Reason: " + e.Message); throw; &#125;finally &#123; fs1.Close(); &#125; return clone;&#125; Program 12  FileStreamBinaryFormatter Prototype Manager6 6  6PrototypeManager 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647using System.Collections;namespace PrototypeManagerSample&#123; abstract class Prototype &#123; public abstract Prototype Clone(); &#125; class ConcretePrototypeA : Prototype &#123; public override Prototype Clone() &#123; return (ConcretePrototypeA)this.MemberwiseClone(); &#125; &#125; class ConcretePrototypeB : Prototype &#123; public override Prototype Clone() &#123; return (ConcretePrototypeB)this.MemberwiseClone(); &#125; &#125; class PrototypeManager &#123; Hashtable ht = new Hashtable(); public PrototypeManager() &#123; ht.Add("A", new ConcretePrototypeA()); ht.Add("B", new ConcretePrototypeB()); &#125; public void Add(string key, Prototype prototype) &#123; ht.Add(key,prototype); &#125; public Prototype Get(string key) &#123; Prototype clone = null; clone = ((Prototype)ht[key]).Clone(); return clone; &#125; &#125;&#125; PrototypeManagerPrototypeManager. Ctrl+CCtrl+V  (1) (2) (3) (4)  (1) (2)  (1)CPU (2) (3) (1) (2)3 (3) (4)C#MemberwiseClone()ICloneable (5) (6) (7)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F18%2F%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[ 44   Director newnew new Director            1 1    1  2 2  24 (1)BuilderProductBuildPartX()2BuildPartA()BuildPartB()GetResult()Builder (2)ConcreteBuilderBuilder (3)Product (4)DirectorConstruct()Setter  123456789101112131415161718192021222324class Product&#123; private string partA; private string partB; private string partC; public string PartA &#123; get &#123; return partA; &#125; set &#123; partA = value; &#125; &#125; public string PartB &#123; get &#123; return partB; &#125; set &#123; partB = value; &#125; &#125; public string PartC &#123; get &#123; return partC; &#125; set &#123; partC = value; &#125; &#125;&#125;  12345678910111213abstract class Builder&#123; protected Product product = new Product(); public abstract void BuildPartA(); public abstract void BuildPartB(); public abstract void BuildPartC(); public Product GetResult() &#123; return product; &#125;&#125; BuilderBuildPartX()ConcreteBuilderBuilderGetResult() ConcreteBuilderBuildPartX()ProductSetterBuildPartX() 1234567891011121314151617class ConcreteBuilder1 : Builder&#123; public override void BuildPartA() &#123; product.PartA = "A1"; &#125; public override void BuildPartB() &#123; product.PartB = "B1"; &#125; public override void BuildPartC() &#123; product.PartC = "C1"; &#125;&#125; DirectorBuildPartX()BuildPartX() 1234567891011121314151617181920212223class Director&#123; private Builder builder; public Director(Builder builder) &#123; this.builder = builder; &#125; public void SetBuilder(Builder builder) &#123; this.builder = builder &#125; public Product Construct() &#123; builder.BuildPartA(); builder.BuildPartB(); builder.BuildPartC(); return builder.GetResult(); &#125;&#125; Construct()builder  12345...Builder builder = new ConcreteBuilder1();Director director = new Director(builder);Product product = director.Construct();... ConcreteBuilder1 Director  1.  2. 3 3  3ActorControllerActorBuilderHeroBuilderAngelBuilderDevilBuilderActor 3. (1)Actorstring 1234567891011121314151617181920212223242526272829303132333435363738394041namespace BuilderSample&#123; class Actor &#123; private string type; // private string sex; // private string face; // private string costume; // private string hairstyle; // public string Type &#123; get &#123; return type; &#125; set &#123; type = value; &#125; &#125; public string Sex &#123; get &#123; return sex; &#125; set &#123; sex = value; &#125; &#125; public string Face &#123; get &#123; return face; &#125; set &#123; face = value; &#125; &#125; public string Costume &#123; get &#123; return costume; &#125; set &#123; costume = value; &#125; &#125; public string Hairstyle &#123; get &#123; return hairstyle; &#125; set &#123; hairstyle = value; &#125; &#125; &#125;&#125; (2)ActorBuilder 1234567891011121314151617181920namespace BuilderSample&#123; // abstract class ActorBuilder &#123; protected Actor actor = new Actor(); public abstract void BuildType(); public abstract void BuildSex(); public abstract void BuildFace(); public abstract void BuildCostume(); public abstract void BuildHairstyle(); // public Actor CreateActor() &#123; return actor; &#125; &#125;&#125; (3)HeroBuilder 123456789101112131415161718192021222324252627282930namespace BuilderSample&#123; class HeroBuilder : ActorBuilder &#123; public override void BuildType() &#123; actor.Type = ""; &#125; public override void BuildSex() &#123; actor.Sex = ""; &#125; public override void BuildFace() &#123; actor.Face = ""; &#125; public override void BuildCostume() &#123; actor.Costume = ""; &#125; public override void BuildHairstyle() &#123; actor.Hairstyle = ""; &#125; &#125;&#125; (4)AngelBuilder 123456789101112131415161718192021222324252627282930namespace BuilderSample&#123; class AngelBuilder : ActorBuilder &#123; public override void BuildType() &#123; actor.Type = ""; &#125; public override void BuildSex() &#123; actor.Sex = ""; &#125; public override void BuildFace() &#123; actor.Face = ""; &#125; public override void BuildCostume() &#123; actor.Costume = ""; &#125; public override void BuildHairstyle() &#123; actor.Hairstyle = ""; &#125; &#125;&#125; (5)DevilBuilder 123456789101112131415161718192021222324252627282930namespace BuilderSample&#123; class DevilBuilder : ActorBuilder &#123; public override void BuildType() &#123; actor.Type = ""; &#125; public override void BuildSex() &#123; actor.Sex = ""; &#125; public override void BuildFace() &#123; actor.Face = ""; &#125; public override void BuildCostume() &#123; actor.Costume = ""; &#125; public override void BuildHairstyle() &#123; actor.Hairstyle = ""; &#125; &#125;&#125; (6)ActorController 123456789101112131415161718namespace BuilderSample&#123; class ActorController &#123; // public Actor Construct(ActorBuilder ab) &#123; Actor actor; ab.BuildType(); ab.BuildSex(); ab.BuildFace(); ab.BuildCostume(); ab.BuildHairstyle(); actor = ab.CreateActor(); return actor; &#125; &#125;&#125; (7)App.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="builder" value="BuilderSample.AngelBuilder"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; (8)Program 1234567891011121314151617181920212223242526272829using System;using System.Configuration;using System.Reflection;namespace BuilderSample&#123; class Program &#123; static void Main(string[] args) &#123; ActorBuilder ab; // // string builderType = ConfigurationManager.AppSettings["builder"]; // ab = (ActorBuilder)Assembly.Load("BuilderSample").CreateInstance(builderType); ActorController ac = new ActorController(); Actor actor; actor = ac.Construct(ab); // Console.WriteLine("&#123;0&#125;",actor.Type); Console.WriteLine("&#123;0&#125;",actor.Sex); Console.WriteLine("&#123;0&#125;",actor.Face); Console.WriteLine("&#123;0&#125;",actor.Costume); Console.WriteLine("&#123;0&#125;",actor.Hairstyle); Console.Read(); &#125; &#125;&#125; 4.  12345     keybuildervalueBuilderSample.HeroBuilder 12345      DirectorDirectorBuilderBuildPartX()Director 1.Director DirectorBuilderBuilderConstruct()BuilderConstruct()staticActorControllerActorBuilder 12345678910111213141516171819202122232425namespace BuilderSample&#123; // abstract class ActorBuilder &#123; protected static Actor actor = new Actor(); public abstract void BuildType(); public abstract void BuildSex(); public abstract void BuildFace(); public abstract void BuildCostume(); public abstract void BuildHairstyle(); public static Actor Construct(ActorBuilder ab) &#123; ab.BuildType(); ab.BuildSex(); ab.BuildFace(); ab.BuildCostume(); ab.BuildHairstyle(); return actor; &#125; &#125;&#125;  1234567...ActorBuilder ab;string builderType = ConfigurationManager.AppSettings["builder"];ab = (ActorBuilder)Assembly.Load("BuildExtend").CreateInstance(builderType);Actor actor;actor = ActorBuilder.Construct(ab);... Construct()Construct()BuildPartX() 123456789101112131415161718192021abstract class ActorBuilder&#123; protected Actor actor = new Actor(); public abstract void BuildType(); public abstract void BuildSex(); public abstract void BuildFace(); public abstract void BuildCostume(); public abstract void BuildHairstyle(); public Actor Construct() &#123; this.BuildType(); this.BuildSex(); this.BuildFace(); this.BuildCostume(); this.BuildHairstyle(); return actor; &#125;&#125;  1234567...ActorBuilder ab;string builderType = ConfigurationManager.AppSettings["builder"];ab = (ActorBuilder)Assembly.Load("BuildExtend").CreateInstance(builderType);Actor actor;actor = ab.Construct();... Construct()BuildPartX()BuildPartX() DirectorConstruct()Construct()Director 2. DirectorHook MethodBuildPartX() boolIsXXX()ActorBuilderIsBareheaded()BareheadedActorBuilderfalse 123456789101112131415161718192021abstract class ActorBuilder&#123; protected Actor actor = new Actor(); public abstract void BuildType(); public abstract void BuildSex(); public abstract void BuildFace(); public abstract void BuildCostume(); public abstract void BuildHairstyle(); // virtual public virtual bool IsBareheaded() &#123; return false; &#125; public Actor CreateActor() &#123; return actor; &#125;&#125; DevilDevilBuilderIsBareheaded()true 123456789101112131415161718192021222324252627282930313233class DevilBuilder : ActorBuilder&#123; public override void BuildType() &#123; actor.Type = ""; &#125; public override void BuildSex() &#123; actor.Sex = ""; &#125; public override void BuildFace() &#123; actor.Face = ""; &#125; public override void BuildCostume() &#123; actor.Costume = ""; &#125; public override void BuildHairstyle() &#123; actor.Hairstyle = ""; &#125; //  public override bool IsBareheaded() &#123; return true; &#125; &#125; ActorController 123456789101112131415161718192021class ActorController&#123; //  public Actor Construct(ActorBuilder ab) &#123; Actor actor; ab.BuildType(); ab.BuildSex(); ab.BuildFace(); ab.BuildCostume(); //  if (!ab.IsBareheaded()) &#123; ab.BuildHairstyle(); &#125; actor = ab.CreateActor(); return actor; &#125;&#125; IsBareheaded()IsBareheaded()trueBuildHairstyle()BuildHairstyle()DirectorBuildPartX()BuildPartX()   (1) (2) (3)  (1) (2)  (1) (2) (3) (4) (1) (2)4Construct() (3) (4) (5):]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F17%2F%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-1%2F</url>
    <content type="text"><![CDATA[                    (1)TCL (2) 1 1  13153  2 2  22155   1 Kit 3 3  34 (1)AbstractFactory (2)ConcreteFactory (3)AbstractProduct (4)ConereteProduct  123456abstract class AbstractFactory&#123; public abstract AbstractProductA CreateProductA(); //  public abstract AbstractProductB CreateProductB(); //  ...&#125;  123456789101112131415class ConcreteFactory1 : AbstractFactory&#123; // 1 public override AbstractProductA CreateProductA() &#123; return new ConcreteProductA1(); &#125; // 2 public override AbstractProductB CreateProductB() &#123; return new ConcreteProductB1(); &#125; ...&#125;   1. .NETSpringSummer4 4  2. 5 5  5SkinFactorySpringSkinFactorySurmerSkinFactoryButtonTextFieldComboBoxSpringButtonSpringTextFieldSpringComboBoxSummerButtonSummerTextFieldSummerComboBox 3. (1) Button Button.cs 1234567namespace AbstractFactorySample&#123; interface Button &#123; void Display(); &#125;&#125; (2)SpringButtonSpring SpringButton.cs 123456789101112using System;namespace AbstractFactorySample&#123; class SpringButton : Button &#123; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (3)SummerButtonSummer SummerButton.cs 123456789101112using System;namespace AbstractFactorySample&#123; class SummerButton : Button &#123; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (4)TextField TextField.cs 1234567namespace AbstractFactorySample&#123; interface TextField &#123; void Display(); &#125;&#125; (5)SpringTextFieldSpring SpringTextField.cs 123456789101112using System;namespace AbstractFactorySample&#123; class SpringTextField : TextField &#123; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (6)SummerTextFieldSummer SummerTextField.cs 123456789101112using System;namespace AbstractFactorySample&#123; class SummerTextField : TextField &#123; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (7)ComboBox ComboBox.cs 1234567namespace AbstractFactorySample&#123; interface ComboBox &#123; void Display(); &#125;&#125; (8)SpringComboBoxSpring SpringComboBox.cs 123456789101112using System;namespace AbstractFactorySample&#123; class SpringComboBox : ComboBox &#123; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (9)SummerComboBoxSummer SummerComboBox.cs 123456789101112using System;namespace AbstractFactorySample&#123; class SummerComboBox : ComboBox &#123; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (10)SkinFactory SkinFactory.cs 123456789namespace AbstractFactorySample&#123; interface SkinFactory &#123; Button CreateButton(); TextField CreateTextField(); ComboBox CreateComboBox(); &#125;&#125; (11)SpringSkinFactorySpring SpringSkinFactory.cs 1234567891011121314151617181920namespace AbstractFactorySample&#123; class SpringSkinFactory : SkinFactory &#123; public Button CreateButton() &#123; return new SpringButton(); &#125; public TextField CreateTextField() &#123; return new SpringTextField(); &#125; public ComboBox CreateComboBox() &#123; return new SpringComboBox(); &#125; &#125;&#125; (12)SummerSkinFactorySummer SummerSkinFactory.cs 1234567891011121314151617181920namespace AbstractFactorySample&#123; class SummerSkinFactory : SkinFactory &#123; public Button CreateButton() &#123; return new SummerButton(); &#125; public TextField CreateTextField() &#123; return new SummerTextField(); &#125; public ComboBox CreateComboBox() &#123; return new SummerComboBox(); &#125; &#125;&#125; (13)App.config App.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="factory" value="AbstractFactorySample.SpringSkinFactory"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; (14)Program Program.cs 123456789101112131415161718192021222324252627282930313233using System;using System.Configuration;using System.Reflection;namespace AbstractFactorySample&#123; class Program &#123; static void Main(string[] args) &#123; //  SkinFactory factory; Button bt; TextField tf; ComboBox cb; //  string factoryType = ConfigurationManager.AppSettings["factory"]; //  factory = (SkinFactory)Assembly.Load("AbstractFactorySample").CreateInstance(factoryType); bt = factory.CreateButton(); tf = factory.CreateTextField(); cb = factory.CreateComboBox(); bt.Display(); tf.Display(); cb.Display(); Console.Read(); &#125; &#125;&#125; 4. : 123   SpringSkinFactorySummerSkinFactory: 123456&lt;?xml version = "1.0" encoding = "utf-8" ?&gt; &lt;configuration &gt; &lt;appSettings&gt; &lt;add key = "factory" value ="AbstractFactorySample. SummerSkinFactory"/ &gt; &lt;/appSettings &gt; &lt;/configuration &gt; : 123    RadioButtonSkinFactorySkinFactory  (1) (2)  API : (1) (2) (3) :  : (1) (2) (3) (4). (1) (2) (3)4 (4) (5) (6)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F17%2F%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[               1 1  2 2    1 Factory PatternVirtual Constructor PatternPolymorphic Factory Pattern 3 3  34 (1)Product(2)ConcreteProduct(3)FactoryFactory Method(4)ConcreteFactory : 1234interface Factory&#123; Product FactoryMethod();&#125;  1234567class ConcreteFactory : Factory &#123; public Product FactoryMethod() &#123; return new ConcreteProduct(); &#125;&#125;   123456...Factory factory;factory = new ConcreteFactory(); // Product product;product = factory.FactoryMethod();... ConcreteFactory  1. Logger(.NETLog4netNLog.NETFrameworkDebug.TraceTraceSource) 2. 4 4  4LoggerFileLoggerDatabaseLoggerLoggerFactoryFileLoggerFactoryDatabaseLoggerFactory 3. (1)Logger 1234567namespace FactoryMethodSample&#123; interface Logger &#123; void WriteLog(); &#125;&#125; (2)DatabaseLogger 123456789101112using System;namespace FactoryMethodSample&#123; class DatabaseLogger : Logger &#123; public void WriteLog() &#123; Console.WriteLine(""); &#125; &#125;&#125; (3)FileLogger 123456789101112using System;namespace FactoryMethodSample&#123; class FileLogger : Logger &#123; public void WriteLog() &#123; Console.WriteLine(""); &#125; &#125;&#125; (4)LoggerFactory 1234567namespace FactoryMethodSample&#123; interface LoggerFactory &#123; Logger CreateLogger(); &#125;&#125; (5)DatabaseLoggerFactory 1234567891011121314namespace FactoryMethodSample&#123; class DatabaseLoggerFactory : LoggerFactory &#123; public Logger CreateLogger() &#123; //  //  Logger logger = new DatabaseLogger(); //  return logger; &#125; &#125;&#125; (6)FileLoggerFactory 12345678910111213namespace FactoryMethodSample&#123; class FileLoggerFactory : LoggerFactory &#123; public Logger CreateLogger() &#123; //  Logger logger = new FileLogger(); //  return logger; &#125; &#125;&#125; (7)Program 12345678910111213141516171819using System;using System.Configuration;namespace FactoryMethodSample&#123; class Program &#123; static void Main(string[] args) &#123; LoggerFactory factory; Logger logger; factory = new FileLoggerFactory(); //  logger = factory.CreateLogger(); logger.WriteLog(); Console.Read(); &#125; &#125;&#125; 4.  1 FileL.oggerFactoryDatabaseLoggerFactory 1    newXML FileLoggerFactoryXML 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="factory" value="FactoryMethodSample.FileLoggerFactory"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt; FactoryMethodSampleFilelLoggerFactory.NETconfigApp.configWeb.config .NET Reflection.NET.NET .NETAssemblyAssemblyLoad()CreateInstance(.)object 1234// using System.Reflection;object obj = Assembly.Load("").CreateInstance("."); .ConfigurationManagerAppSettings new: 1234567891011121314151617181920212223using System;using System.Configuration;using System.Reflection;namespace FactoryMethodSample&#123; class Program &#123; static void Main(string[] args) &#123; LoggerFactory factory; //  Logger logger; //  //  string factoryString = ConfigurationManager.AppSettings["factory"]; //  factory = (LoggerFactory)Assembly.Load("FactoryMethodSample").CreateInstance(factoryString); logger = factory.CreateLogger(); logger.WriteLog(); Console.Read(); &#125; &#125;&#125; System.ConfigurationSystem.ReflectionConfigurationManagerAssembly 4 (1)Logger (2)LoggerFactoryCreateLogger() (3)App.config (4)  4.3objectobject5 5  LoggerFactory 123456interface LoggerFactory&#123; Logger CreateLogger(); Logger CreateLogger(string args); Logger CreateLogger(object obj);&#125; DatabaseLoggerFactory 1234567891011121314151617181920212223242526272829class DatabaseLoggerFactory : LoggerFactory &#123; public Logger CreateLogger() &#123; // // Logger logger = new DatabaseLogger(); // return logger; &#125; public Logger CreateLogger(string args) &#123; // // Logger logger = new DatabaseLogger(); // return logger; &#125; public Logger CreateLogger(object obj) &#123; // // Logger logger = new DatabaseLogger(); // return logger; &#125; &#125;   46 6  6LoggerFactory 123456789101112// abstract class LoggerFactory&#123; // WriteLog() public void WriteLog() &#123; Logger logger = this.CreateLogger(); logger.WriteLog(); &#125; public abstract Logger CreateLogger();&#125;  12345678910111213141516171819202122using System;using System.Configuration;using System.Reflection;namespace FactoryMethodSample&#123; class Program &#123; static void Main(string[] args) &#123; LoggerFactory factory; //  //  string factoryString = ConfigurationManager.AppSettings["factory"]; //  factory = (LoggerFactory)Assembly.Load("FactoryMethodSample").CreateInstance(factoryString); factory.WriteLog(); //  Console.Read(); &#125; &#125;&#125;  API  (1) (2) (3)  (1) (2)  (1) (2) (1) (2)4 (3) (4) (5) (6) (7)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F09%2F17%2F%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[  ABABAB     GoF23 6         Creational Pattern 3WhatWhoWhen GoF5GoF51 1       (Simple Factory Pattern)    (Factory Method Pattern)    (Abstract Factory Pattern)    (Builder Pattern)    (Prototype Pattern)    (Singleton Pattern)    GoF23 FactoryProduct1AppleOrangeBanana 1    Simple Factory Pattern 1 staticStatic Factory Method 2 2  23 (1)FactoryFactoryMethod()Product (2)Product (3)ConcreteProduct new  1234567891011abstract class Product&#123; //  public void MethodSame() &#123; //  &#125; //  public abstract void MethodDiff();&#125;  1234567891011121314151617class ConcreteProductA : Product&#123; //  public override void MethodDiff() &#123; //  &#125;&#125;class ConcreteProductB : Product&#123; //  public override void MethodDiff() &#123; //  &#125;&#125; new: 1234567891011121314151617181920class Factory&#123; //  public static Product GetProduct(string arg) &#123; Product product = null; if(arg.Equals("A")) &#123; product = new ConcreteProductA(); // product &#125; else if(arg.Equals("B")) &#123; product = new ConcreteProductB(); // product &#125; return product; &#125;&#125;  12345678910class Program&#123; static void Main(string[] args) &#123; Product product; product = Factory.GetProduct("A"); //  product.MethodSame(); product.MethodDiff(); &#125;&#125;  1. C#HistogramChartPieChartLineChart 2. 3 3  3ChartHistogramChartPieChartLineChartChartFactory 3. (1)Chart 1234567namespace SimpleFactorySample&#123; interface Chart &#123; void Display(); &#125;&#125; (2)HistogramChart 1234567891011121314151617using System;namespace SimpleFactorySample&#123; class HistogramChart : Chart &#123; public HistogramChart() &#123; Console.WriteLine(""); &#125; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (3)PieChart 1234567891011121314151617using System;namespace SimpleFactorySample&#123; class PieChart : Chart &#123; public PieChart() &#123; Console.WriteLine(""); &#125; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (4)LineChart 1234567891011121314151617using System;namespace SimpleFactorySample&#123; class LineChart : Chart &#123; public LineChart() &#123; Console.WriteLine(""); &#125; public void Display() &#123; Console.WriteLine(""); &#125; &#125;&#125; (5)ChartFactory 123456789101112131415161718192021222324252627282930using System;namespace SimpleFactorySample&#123; class ChartFactory &#123; //  public static Chart GetChart(string type) &#123; Chart chart = null; if (type.Equals("histogram")) &#123; chart = new HistogramChart(); Console.WriteLine(""); &#125; else if (type.Equals("pie")) &#123; chart = new PieChart(); Console.WriteLine(""); &#125; else if (type.Equals("line")) &#123; chart = new LineChart(); Console.WriteLine(""); &#125; return chart; &#125; &#125;&#125; (6)Program 1234567891011121314151617using System;namespace SimpleFactorySample&#123; class Program &#123; static void Main(string[] args) &#123; Chart chart; chart = ChartFactory.GetChart("histogram"); //  chart.Display(); Console.Read(); &#125; &#125;&#125; 4.  123! !  ChartFactory 1chart = ChartFactory.GetChart("histogram");  1chart = ChartFactory.GetChart("pie");  123! ! ! Chart  XMLApp.config 123456&lt;?xml version="1.0" encoding="utf-8" ?&gt;&lt;configuration&gt; &lt;appSettings&gt; &lt;add key="chartType" value="histogram"/&gt; &lt;/appSettings&gt;&lt;/configuration&gt;  1234567891011121314151617181920using System;using System.Configuration;namespace SimpleFactorySample&#123; class Program &#123; static void Main(string[] args) &#123; Chart chart; //  string chartStr = ConfigurationManager.AppSettings["chartType"]; chart = ChartFactory.GetChart(chartStr); //  chart.Display(); Console.Read(); &#125; &#125;&#125;  123 !  ConfigurationManagerAppSettingsApp.configC#App.config Visual StudioSystem.ConfigurationConfigurationManager: .NETSystem.ConfigurationConfigurationManager 3public C# (1)new (2) (3) (4) new 123456789101112131415161718class Login&#123; private UserDAO udao; public Login() &#123; //  udao = new OracleUserDAO(); &#125; public void Execute() &#123; //  //  udao.FindUserById(); //  &#125;&#125; LoginUserDAOudaoLoginOracleUserDAOudaoExecute()udaoFindUserById()LoginUserDAOLoginudaoudaoLoginUserDAOSQLServerUserDAOLogin udaoLoginLoginudaoLoginUserDAOFactory4 4  UserDAOUserDAOFactoryLoginUserDAOLoginUserDAOFactory ABABAB  C#Java5 5  5RectangleFactoryCreateRectangle()CreateSquare() C#StringstringStringFactory  6 6  6   (1) (2) (3)  (1) (2) (3) (4)C#  (1) (2) (1)GoF5GoF (2) (3)3 (4) (5) (6)]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UML]]></title>
    <url>%2F2019%2F09%2F16%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%A6%82%E8%BF%B0%E4%B8%8EUML%E7%B1%BB%E5%9B%BE%2F</url>
    <content type="text"><![CDATA[  UML1..*  1. 2. (1) (2) UMLUMLUML2.013 1. Class ObjectInstance Class Diagram 2.UML UMLEmployeenameagenameemailModifyInfo()UML1 1 UML 1C# 1234567891011public class Employee &#123; private string name; private int age; private string email; public void ModifyInfo() &#123; ... &#125;&#125; UML (1) (2)Attributes UML 1 :[ = ]  publicprivateprotected3+-#C#internalprotected internalinternalprotected internalirprivateGetterSetter C#Camel Case   (3)Operations UML 1 () [ : ]  C#Pascal Case , void UML 1. AssociationUMLCC++Java1 LoginFormButtonloginButtonLoginFormloginButtonButton2 2  2C# 12345678910public class LoginForm&#123; private Button loginButton; ...&#125;public class Button&#123; ...&#125; UML (1)CustomerProductCustomerProduct3 3  3C# 1234567891011public class Customer&#123; private Product[] products; ...&#125;public class Product&#123; private Customer customer; ...&#125; (2)CustomerAddressCustomerAddress4 4  4C# 12345678910public class Customer&#123; private Address address; ...&#125;public class Address&#123; ...&#125; (3)NodeNode5 5  5C# 12345public class Node&#123; private Node subNode; ...&#125; (4)MultiplicityUML 1 1    1..1  0..*  1..*  0..1  m..n mn FormButtonFormButtonButtonForm6 6  5C# 12345678910public class Form&#123; private Button[] buttons; //  ...&#125;public class Button&#123; ...&#125; (5)AggregationUMLEngineCar7 7  Setter7C# 12345678910111213141516171819202122public class Car&#123; private Engine engine; //  public Car(Engine engine) &#123; this.engine = engine; &#125; public Engine Engine &#123; get &#123; return engine; &#125; set &#123; engine = value; &#125; //  &#125; ...&#125;public class Engine&#123; ...&#125; (6)CompositionUMLHeadMouth8 8  8C# 123456789101112131415public class Head&#123; private Mouth mouth; public Head() &#123; mouth = new Mouth(); //  &#125; ...&#125;public class Mouth&#123; ...&#125; 2. DependencyUML DriverDrive()CarcarDrive()carMove()Drive()Move()DriverCar9 9  399C# 1234567891011121314151617public class Driver&#123; public void Drive(Car car) &#123; car. Move(); &#125; ...&#125;public class Car&#123; public void Move() &#123; ... &#125; ...&#125; 3. GeneraliationUMLC#StudentTeacherPersonStudentTeacherPersonPersonnameageStudentTeaeherStudentstudentNoTeacherteacherNoPersonMove()Say()StudenTeaeherStudentStudy()TeaeherTeach()10 10  10C# 1234567891011121314151617181920212223242526272829303132333435363738// public class Person&#123; protected string name; protected int age; public void Move() &#123; ... &#125; public void Say() &#123; ... &#125;&#125;// public class Student : Person&#123; private string studentNo; public void Study() &#123; ... &#125;&#125;// public class Teacher : Person&#123; private string teacherNo; public void Teach() &#123; ... &#125;&#125; 4. C#JavaC#publicUML11 11 UML RealizationUMLVehicleMove()ShipCarMove()12 12  C#12C# 1234567891011121314151617181920public interface Vehicle&#123; void Move();&#125;public class Ship : Vehicle&#123; public void Move() &#123; ... &#125;&#125;public class Car : Vehicle&#123; public void Move &#123; ... &#125;&#125;]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>C#2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IOCAOP]]></title>
    <url>%2F2019%2F09%2F11%2FIOC%E5%92%8CAOP%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%2F</url>
    <content type="text"><![CDATA[ IOCIoCInversion of ControlJavaIoC IoC GirlBoyGirlkissGirlKissBoyGirlBoy GG        GirlBoy 1234567public class Girl &#123; void kiss() &#123; Boy boy = new Boy(); &#125;&#125; BoyBoyGirlGirlBoyBoy 1234567public class Girl &#123; void kiss() &#123; Boy boy = BoyFactory.createBoy(); &#125;&#125; BoyFactorySingletonGlobals Kiss 12345678public class Girl &#123; void kiss(Boy boy) &#123; // kiss boy boy.kiss(); &#125;&#125; WellGirlGirlBoyGirlKissBoyGirl IOC Do not call us, we will call you. You, girlie, do not call the boy. We will feed you a boy  Dependence Inversion PrincinpleDIP Eric Gamma  Service,  Implementation, Service  everything depends on everything  BoyKissableGirlkissBoykisskittengrandmother IOCtypeIoCTypeGirlBoy IOC type 0IOC 12345678910111213141516public class Girl implements Servicable &#123; private Kissable kissable; public Girl() &#123; kissable = new Boy(); &#125; public void kissYourKissable() &#123; kissable.kiss(); &#125;&#125; GirlBoy IOC type 1 1234567891011121314public class Girl implements Servicable &#123; Kissable kissable; public void service(ServiceManager mgr) &#123; kissable = (Kissable) mgr.lookup(kissable); &#125; public void kissYourKissable() &#123; kissable.kiss(); &#125;&#125; Avalon FrameworkServicableserviceServiceManagerserviceBoy J2EEContexttype 1  123456&lt;Container&gt; &lt;component name=kissable class=Boy"&gt; &lt;configuration&gt;  &lt;/configuration&gt; &lt;/component&gt; &lt;component name=girl" class=Girl" /&gt;&lt;/container&gt; IOC type 2123456789101112131415public class Girl &#123; private Kissable kissable; public void setKissable(Kissable kissable) &#123; this.kissable = kissable; &#125; public void kissYourKissable() &#123; kissable.kiss(); &#125;&#125; Type 2spring FrameworkJavaBeansetBoyGirl 12345678&lt;beans&gt; &lt;bean id=boy" class=Boy"/&gt; &lt;bean id=girl class=Girl"&gt; &lt;property name=kissable"&gt; &lt;ref bean=boy"/&gt; &lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt; IOC type 3 1234567891011121314public class Girl &#123; private Kissable kissable; public Girl(Kissable kissable) &#123; this.kissable = kissable; &#125; public void kissYourKissable() &#123; kissable.kiss(); &#125;&#125; PicoContainer BoyGirl123456789PicoContainer container = new DefaultPicoContainer();container.registerComponentImplementation(Boy.class);container.registerComponentImplementation(Girl.class);Girl girl = (Girl) container.getComponentInstance(Girl.class);girl.kissYourKissable(); ================AOP AOP  1234567891011public class Dinner &#123; Customer yangyi; public void eatfish() &#123; yangyi.cookFish(); yangyi.eatFish(); yangyi.washDish(); &#125;&#125; prog 1 ,  123456789public class Dinner &#123; ICustomer yangyi; public void eatfish() &#123; yangyi.eatFish(); &#125;&#125; prog 2 AOP cook fish prog 1Customerprog 2ICustomerICustomeryangyiCustomer yangyi.eatfishcookfish()washdish() 123456789101112131415161718class Customer implements ICustomer &#123; void eatfish() &#123; // haha eat, delicious &#125;&#125;class CustomerProxy implements ICustomer &#123; Customer yangyi = new Customer() //just for example. proxy is implement by dynamic proxy or other tech in real world void eatfish() &#123; cookfish(); yangyi.eatfish(); washdish(); &#125;&#125; proxyCustomerok, AOPspringproxyjavaCustomerProxyProxyCustomer IOCAOPCustomer yangyi = new Customer()ProxyCustomerIoCCustomerCustomer(dont call me, but I call you)  1234567891011121314public class Dinner &#123; ICustomer yangyi; public void eatfish() &#123; yangyi.eatFish(); &#125; public void setYangyi(ICustomer customer) &#123; this.yangyi = customer; &#125;&#125; SetYangyiIoCyangyiCustomerProxyioc BTW,JDBCconnection.close()IOCAOP  ABABAB 123456789public class A&#123; B b; public void methodA() &#123; b.methodB(); &#125;&#125;  b.methodB()b IoCIoCABABOOABIAIBABIAIBABAB 123456789public class A implements IA&#123; IB b; public void methodA() &#123; b.methodB(); &#125;&#125; bIBBIoCIoCABIoCABIoC AOPAOP 12345678public class A&#123; public void methodA() &#123; do log; b.methodB(); &#125;&#125; methodA()AOPAA 12345678910111213141516171819public class AP extends A&#123; A a; public void methodA() &#123; do log; a.methodA(): &#125;&#125;public class A&#123; public void methodA() &#123; b.methodB(); &#125;&#125; AmethodA()APmethodA()methodA()AOP]]></content>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F08%2F23%2F%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[    1 1 ClientClientHandlerClient switchcase switchMySQLPHP Client Client410153041015103015switch MySQLPHPMySQLMySQL MySQL11 12345678910&lt;?php//  IConnectInfo.phpinterface IConnectInfo&#123; const HOST = "localhost"; const UNAME = "phpWorker"; const PW = "easyWay"; const DBNAME = "dpPatt"; public function doConnect;&#125;  12 MySQL ID 12 idMySQL 123```PHPHTMLHTML```html InsertDataUpdateDataHTMLhelpdesk InsertData.php 12 UpdateData.php 12 2/ 2 2Query Chain Valueq1q5q1q5Help Desk Data EntryModulecontent management system CMS 3 3 ClientRequestClient5Q105 HTML HTML5q1q5 12 csshelp.css 12 4 4 ClientHTML$POSTsqueryNowClientClientsetSuccessor() 12  ClientClientRequest 12   12 .handleRequest()Client$handleClientRequest$request 12 5NULL- Client UI5 5   index.phpClient Client$queryNowRequest PHP PHP 5.4 php.net/manuallenltimezones.phpClient 123$tz = 'America/New_York';date_default_timezone_set$tz;$this-&gt;queryNow-getdate(); UTC3400 km21004Europe/MinskAustralia/Tasmania 8America/Indiana/Knox-America/ndianaIndianapolis America/Indianapolis   Clientindex.php 12 Client 12 D1D15D1RequestClient 12  12  12 $handleNowshandleNowtrueD1D156 DID15 12$this-&gt;hungerFactory = new HungerFactory();echo $this-&gt;hungerFactory-&gt;feedFactory(new C1());  55-6 Client6handleRequest() CreatorHungerFactory Creator 12 factoryMethod()feedFactory()ProductfeedFactory()Creator 5 123456789&lt;?php// HungerFactory-phpclass HungerFactory extends Creator&#123; private $country; protected function factoryMethod(Product $product) $this-&gt;country=$product return($this-&gt;country-&gt;getProperties());&#125; factoryMethod()  web ProductgetProperties()HungerFactoryC1C15 12 7   8 8 hungerc01c153clue.txtmap.gifpic.jpg FormatHelperHTML 12 products.css 12   DD1D15clue.txtmap.gin ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Learning PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F08%2F23%2F%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%81%B5%E6%B4%BB%E6%80%A7%2F</url>
    <content type="text"><![CDATA[  MySQLPHPMySQL PHPMySQLStrategy MySQL 1 1 1011ContextStateStrategy ContextStrategyState1 1          10 ContextContext Context10ononoff3on105 Context1010  casecasecasecasemysqli GoFfamily of algorithmsGoFfamilyHead First Design Patternsa set of behaviors MySQL MySQLPHP mysqli  MySQLHTMLPHPPHP 2HTMLPHPClientClientContextMySQL MySQL2 ClientContext 12$context = new Context(new ConcreteStrategy());$context-&gt;algorithm(); Clientalgorithm()ContextpolymorphismClientContext$context-&gt;algorithm() ClientContextalgorithm()ContextClient HTMLPHP 12 HTMLPHPHTML 12 $_POSTmysqli-&gt;realescape-string()HTML-MySQL ContextStrategyContexttrack keeper ContextClient ContextStrategy ClientContext Strategy strategy ConText 12 3Istrategy-$strategystrategy$strategystrategyalgorithm()Istrategyalgorithm()ClientContextIstrategyContextContextIstrategyalgorithm() 12345&lt;?phpinterface IStrategy&#123; public function algorithm();&#125;   5 DataEntry DisplayData SearchData UpdateData DeleteData PHPMySQL DataEntry  12 DisplayData $_POST[data]Heres all thedata!$test 12 SearchData $_POST[data]$test 12 UpdateData $_PoST[data]$test DeleteRecord $-POST[data]stest 12   12  MySQLPHPHTMLMySQLmysqli-&gt;real_escapestring($_POST[data])ClientClient mysqli-&gt;real_escape_string($_POST[data])HTMLPHPMySQL Client3Strategy 3 3Context1MySQLSecureDataMySQL HTML SecureDataDisplayA11HTML 12 setEntry()dataPacksetEntry()dataPack SecureDataClientalgorithm() StrategyHTML 123456&lt;?phpinterface IStrategy&#123; const TABLENOW ="survey"; public function algorithm(Array $dataPack);&#125; TABLENONPHP   12  123456$drop = "DROP TABLE IF EXISTS sthis-tableMaster";if(sthis-&gt;hookup-&gt;query($drop) = true)&#123; printf("Old table %s has been dropped.&lt;br/&gt;"$this-&gt;tableMaster);&#125;  1$sql = "CREATE TABLE Sthis-tableMaster   1$sql= "CREATE TABLE IF NOT EXISTS sthis-&gt;tableMaster  CreateTableMySQLUniversalConnect SecureDataIStrategyalgorithm()HTMLClientHTMLMySQLHTMLCSS 12 CSS  12 4 HTMLHTMLHTML 12 UI HTMLClient ClientSecureData SecureDataClient 12 showAll()ClientSecureDataSecureDataClientContext-&gt;algorithmSecureData$secure-&gt;setEntryHTML StrategyIstrategyalgorithm() ClientshowAll()SecureDatadummyContext-&gt;algorithm()IStrategy ContextContextalgorithm()IstrategycontextIStrategyContextIstrategyContextalgorithm() 12 Contextalgorithm algorithmcontextAlgorithmIStrategyalgorithm() Context$dataPackContext algorithm()algorithm() IStrategy algorithm() UniversalConnectTABLENOwIStrategy DataEntry DataEntryHTML 12 MySQL DisplayAlldummy 12 6 SearchData algorithm 12 HTMLSecureData7Designer/Developerdesigner 7designer UpdateData  12  DeleteRecord  12  ; ContextStrategyContextStrategyStrategyStrategy  ContextStrategy MysQLPHP]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Learning PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F08%2F23%2F%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[  Template MethodtemplateMethod()templateMethod() 1 1 Template Methodtemplate method operationhip-hop / OpdykeJohnsonrefactoring togeneralize  PHP templateMethod()  HTMLURL addPix($pix)addCaption($cap)URLtemplateMethod()protected 12  addPix()addCaption() 12 echoaddPix()addCaption() UIClient 12 $moConcretecClasstemplateMethod()AbstractClasstemplateMethod()2 2- URL the Hollywood Principle templateMethod()3 3 OOPflow of controlOOPobject responsibilityinversion of controlOOP OOP[framework3] Kindergarten Principle 1.2.3. Elmo 4 4   12 Client 12$mo = new TmFac();$mo-&gt;templateMethod(); ClientClient  TmFac 12 templateMethod()TmFactemplateMethod() ClientTmFac 12 52templateMethod() 5templateMethod() 5 200   GPS2006 UI HTMLHTMLHTML 12 Send orderPHP Client  12 3addTax()addShippingHook()displayCost()IHooktemplateMethod()ClientClientHTML 3 12 addTax()displayCost()addShippingHook()    1$this-&gt;special = $this-&gt;buyTotal &gt;= 200; $this-&gt;specialtruefalseZambezi Trading Post200 Client Client ClientHTMLspecialtruefalse$special$specialtemplateMethod() 12 $gpsNow$mapNow$special$boatNow$special$boatNow$buyTotal$templateMethod() Client   ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Learning PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[1]]></title>
    <url>%2F2019%2F08%2F23%2F%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F1%2F</url>
    <content type="text"><![CDATA[  DecoratorDecoratorComponent1 1[Client] 1DecoratorComponentDecoratorComponent ComponentComponent ClientCientComponent  customerization Web PHPwebweb 3  ComponentComponentIComponent$sitegetSite()getPrice()ComponentDecorator 12 PHPgetSite()getPrice() DecoratorIComponentIComponent 12 Decorator 2 2  $1200 12 Basic Site1200Basic Site DecoratorIComponentDecoratorIComponent Maintenance 12 Maintenance Video 12 Database 12   ClientClientBasicSite 12 ClientBasicSitewrapComponent()IComponent3 wrapComponent()$this-&gt;basicSite3 12 wrapComponent()wrapComponent()ClientwrapComponent() wrapperPHP  12 PrimitiveWrapPHPJava PHPPHP5file_get_contents()URLhaha.txt 123456&lt;strong&gt;&lt;/strong&gt;&lt;p&gt;&lt;br/&gt;&lt;br/&gt;&lt;/p&gt;--&lt;br/&gt; file_get_contents()haha.txtPHP 12  12 haha.txtfile_get_contents() 7AdapterAdapteeAdapteeDecoratorClient$componentMaintenance 1$component = new Maintenance$component;  3 3 MaleFemaleIComponent  3IComponentDecoratorDecorator1ComponentOperation()getAge()setAge($a)Decorator MaleFemale   35$date//$ageGroup$feature 12   MaleFemale$dateIDMaleFemale/ 12 malefemale 12 $setFeature()$setFeature()   12 else  44 12 getFeature() 12   12 public private Client ClientClientClient4Age Group NN1-4 12 ClientwrapComponent()setFeature() 123456FemaleAge Group 4Grrrl programmer features: Preferred programming language:PHP Current Hardware: Linux Favorite food: Veggies  HTMLHTMLUI5HTMLHTMLPHPHTMLHTML HTML UIClientPHPHTMLPHPHTML-&gt;PHPPHPHTMLClient HTML UI4 4 HTML/CSSCSS 12 HTMLClientH.phpHHTMLHTMLPHP 12 PHPPHPHTMLMySQLClientPHP ClientHTMLHTMLPHP ClientClientHClientDeveloperDating.html 12 $_POSTPHPgenderage$hotDate3$proLang$hardware$foodClient  1$someInstance = new Someclass(); HTMLPHPevaleval 6Nature 12$quack = "Nature";$myNature = new $quack(); $myNatureNatureClientH$hotDateFemaleMalegender FemaleMalePHP$gender 1$this-&gt;hotDate = new $gender(); new$gender  FilmsClientHTML UIClientH OOP3]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Learning PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F08%2F23%2F%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[           1 1 PHPC# 2AdapterAdaptee 2  USBUSB3 3 USB  USB  USB PHPwebMySQLUser experience designUXPHPCMSContent Management System 4 4 webweb webUI AdapterAdapteeAdapterAdaptee 1PHPPHPPHPPHP 1class ChildClass extends ParentClass implements ISomeInterface PHP   DollarCalc 1234567891011121314151617181920212223&lt;?php// DollarCalc.phpclass DollarCalc&#123; private $dollar; private $product; private $service; public $rate = 1; public function requestCalc($productNow, $serviceNow) &#123; $this-&gt;product = $productNow; $this-&gt;service = $serviceNow; $this-&gt;dollar = $this-&gt;product + $this-&gt;service; return $this-&gt;requestTotal(); &#125; public function requestTotal() &#123; $this-&gt;dollar *= $this-&gt;rate; return $this-&gt;dollar; &#125;&#125; $raterequestTotal()$rate11$rate  DollarCalc 1234567891011121314151617181920212223&lt;?php// EuroCalc.phpclass DollarCalc&#123; private $euro; private $product; private $service; public $rate = 1; public function requestCalc($productNow, $serviceNow) &#123; $this-&gt;product = $productNow; $this-&gt;service = $serviceNow; $this-&gt;euro = $this-&gt;product + $this-&gt;service; return $this-&gt;requestTotal(); &#125; public function requestTotal() &#123; $this-&gt;euro *= $this-&gt;rate; return $this-&gt;euro; &#125;&#125; EuroCalcEuroCalc  5 5 ITargetrequester()requester() 123456&lt;?php// ITarget.phpinterface ITarget &#123; function requester();&#125; requester() AdapterITargetEuroCalcEuroAdapterEuroCalcrequester() 12345678910111213141516171819&lt;?php// EuroAdapter.php// Adapterinclude_once('EuroCalc.php');include_once('ITarget.php');class EuroAdapter extends EuroCalc implements ITarget&#123; function __construct() &#123; $this-&gt;requester(); &#125; function requester() &#123; $this-&gt;rate = 0.8111; return $this-&gt;rate; &#125;&#125;   EuroAdapterrequester()EuroAdapterrate ClientEuroAdapterDollarCalcDollarCalcITargetEuroAdapter 1234567891011121314151617181920212223242526272829303132&lt;?php// Client.php// Clientinclude_once('EuroAdapter.php');include_once('DollarCalc.php');class Client&#123; private $requestNow; private $dollarRequest; public function __construct() &#123; $this-&gt;requestNow = new EuroAdapter(); $this-&gt;dollarRequest = new DollarCalc(); echo "Euros: ".$this-&gt;makeAdapterRequest($this-&gt;requestNow)."&lt;br/&gt;"; echo "Dollars: $".$this-&gt;makeDollarRequest($this-&gt;dollarRequest); &#125; private function makeAdapterRequest(ITarget $req) &#123; return $req-&gt;requestCalc(40, 50); &#125; private function makeDollarRequest(DollarCalc $req) &#123; return $req-&gt;requestCalc(40, 50); &#125;&#125;$worker = new Client();  12Euros: 72.999Dollars: $90 Target AdapterAdapteeTargetAdapterAdapteeTarget PHP PHPloremipsumCSSCSSCSS   12 CSSDesktop 12 HTMLCSS 12 CSSdesktop.cssPHPHTML &lt;link&gt; 6 6 7MobileIMobileFormatMobileAdapterIFormat 7MobileAdapter IMobileFormatIFormathorizontalLayout()verticalLayout()MobileAdapterDesktopIFormatTargetMobileAdapteeIFormat MobileAdapterMobileIMobileFormatMobileMobileDesktop 12 MobileIMobileFormatDesktop 12 DesktopCSSCSS@media 12 CSSDesktopMobileAdapterDesktopMobile 12 MobileAdapterMobileIMobileFormatMobileAdapterhorizontalLayout()MobileverticalLayout()MobileAdapterMobileverticalLayout()IFormat Client MobileAdapterClient 12 ClientAdapteeMobileAdapterAdapterClientAdapteeAdapterAdapteenew Mobile()Adapter(new MobileAdapter$this-&gt;mobile) ClientMobileAdapterMobilecloseHTML()ClientMobile 8iPhone 8 web PHPPHPPHPMySQLmysqlmysqliPHPmysqliAPIUSBmysqlmysqlimysql ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Learning PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F08%2F23%2F%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%88%86%E7%B1%BB%2F</url>
    <content type="text"><![CDATA[      5 Singleton Factory Method Abstract Factory Builder Prototype 5PHP _clone() 1 1 7 Adapter Bridge Composite Decorator Pacade Flyweight Proxy PHPPHP2 2  11: Chain of Responsibility Command Interpreter Iterator Mediator Memento Observer State Strategy Template Method Visitor  3 ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Learning PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ (2)]]></title>
    <url>%2F2019%2F07%2F24%2F%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%20(2)%2F</url>
    <content type="text"><![CDATA[    1 Form1SQL   WinForm FormPanelPictureBoxButtonTimerTimer_TickGDI+   Form1.cs Pocket PCWindows CE.NETC#PCWinForm   1020int[] arraySquare=new int[1020];arraySquare [35]arraySquare [36]arraySquare [26]10arraySquare[xy]x10arraySquare[x1y]1arraySquare[xy+1]1arraySquare [xy]1arraySquare [xy]x09arraySquare [xy]1 WinForm    --The Open-Closeed PrincipleOCP- Open for extensionClosed for modification -  -   [ASD]client-clientclient[ASD]-1   -         PCCPUPC   -   A.B. ?  PCCPU ?  1988[ASD].  1 ?  private  PC CPU      1 2 3   123456789101112131415static Animal GetAnimal(string name)&#123; if (name == "Cat") &#123; return new Cat(); &#125; else if (name == "Dog") &#123; return new Dog(); &#125; else &#123; return null; &#125; &#125; 12   Pets.climbTree()   LoD private   ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F07%2F23%2F%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[  ReceiverInvoker   1   123456789101112131415// public class Barbecuer&#123; //  public void BakeMutton() &#123; Console.WriteLine("!"); &#125; //  public void BakeChickenWing() &#123; Console.WriteLine("!"); &#125;&#125;  123456789101112131415161718class Program&#123; static void Main(string[] args) &#123; Barbecuer maimaiti = new Barbecuer(); //  maimaiti.BakeMutton(); maimaiti.BakeMutton(); maimaiti.BakeMutton(); maimaiti.BakeChickenWing(); maimaiti.BakeMutton(); maimaiti.BakeMutton(); maimaiti.BakeChickenWing(); Console.Read(); &#125;&#125;     123456789101112// public abstract class Command&#123; protected Barbecuer receiver; public Command(Barbecuer receiver) &#123; this.receiver = receiver; &#125; abstract public void ExecuteCommand();&#125;  12345678910111213141516171819202122class BakeMuttonCommand : Command&#123; public BakeMuttonCommand(Barbecuer receiver) : base(receiver) &#123;&#125; //  public override void ExecuteCommand() &#123; receiver.BakeMutton(); &#125;&#125;class BakeChickenWingCommand : Command&#123; public BakeChickenWingCommand(Barbecuer receiver) : base(receiver) &#123;&#125; public override void ExecuteCommand() &#123; receiver.BakeChickenWing(); &#125;&#125;  1234567891011121314151617// public class Waiter&#123; private Command command; //  public void SetOrder(Command command) &#123; this.command = command; &#125; //  public void Notify() &#123; command.ExecuteCommand(); &#125;&#125;   12345678910111213141516171819202122232425class Program&#123; static void Main(string[] args) &#123; //  Barbecuer tangniu = new Barbecuer(); Command bakeMuttonCommand1 = new BakeMuttonCommand(tangniu); Command bakeMuttonCommand2 = new BakeMuttonCommand(tangniu); Command bakeChickenWingCommand1 = new BakeChickenWingCommand(tangniu); Waiter girl = new Waiter(); //  //  girl.SetOrder(bakeMuttonCommand1); girl.Notify(); girl.SetOrder(bakeMuttonCommand2); girl.Notify(); girl.SetOrder(bakeChickenWingCommand1); girl.Notify(); Console.Read(); &#125;&#125;        1234567891011121314151617181920212223242526272829303132333435// public class Waiter&#123; private IList&lt;Command&gt; orders = new List&lt;Command&gt;(); //  public void SetOrder(Command command) &#123; if (command.ToString() == ".BakeChickenWingCommand") &#123; Console.WriteLine(""); &#125; else &#123; orders.Add(command); Console.WriteLine("" + command.ToString() + " " + DateTime.Now.ToString()); &#125; &#125; //  public void CancelOrder(Command command) &#123; orders.Remove(command); Console.WriteLine("" + command.ToString() + " " + DateTime.Now.ToString()); &#125; //  public void Notify() &#123; foreach (Command cmd in orders) &#123; cmd.ExcuteCommand(); &#125; &#125;&#125;  12345678910111213141516171819202122class Program&#123; static void Main(string[] args) &#123; // Barbecuer boy = new Barbecuer(); Command bakeMuttonCommand1 = new BakeMuttonCommand(boy); Command bakeMuttonCommand2 = new BakeMuttonCommand(boy); Command bakeChickenWingCommand1 = new BakeChickenWingCommand(boy); Waiter girl = new Waiter(); //  girl.SetOrder(bakeMuttonCommand1); girl.SetOrder(bakeMuttonCommand2); girl.SetOrder(bakeChickenWingCommand1); // girl.Notify(); Console.Read(); &#125;&#125;  12345. 200x-xx-xx xx:xx:xx . 200x-xx-xx xx:xx:xx  1Command Command Command 1234567891011abstract class Command&#123; protected Receiver receiver; public Command(Receiver receiver) &#123; this.receiver = receiver; &#125; abstract public void Execute();&#125; ConcreteCommandExecute 12345678910class ConcreteCommand : Command&#123; public ConcreteCommand(Receiver receiver) : base(receiver) &#123; &#125; public override void Execute() &#123; receiver.Action(); &#125;&#125; Invoker 1234567891011121314class Invoker&#123; private Command command; public void SetCommand(Command command) &#123; this.command = command; &#125; public void ExecuteCommand() &#123; command.Execute(); &#125;&#125; Receiver 1234567class Receiver&#123; public void Action() &#123; Console.WriteLine(""); &#125;&#125;  123456789101112131415161718static void Main(string[] args)&#123; //  // Receiver r = new Receiver(); // r.Action() Receiver r = new Receiver(); // r.actionc Command c = new ConcreteCommand(r); Invoker i = new Invoker(); i.SetCommand(c); //  //  i.ExecuteCommand(); Console.Read();&#125;  1. 2. 3. 4. 5.   /  /    ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F07%2F17%2F%EF%BC%BB%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%BD%E5%94%A0%E5%94%A0%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%2F</url>
    <content type="text"><![CDATA[ (Dependency injection)   123456789101112131415161718192021//class Bar&#123;&#125;class Foo&#123; protected $bar; public function __construct() &#123; $this-&gt;bar = new Bar(); &#125; public function getBar() &#123; return $this-&gt;bar; &#125;&#125;$foo = new Foo();  12345678910111213141516171819202122//class Bar&#123;&#125;class Foo&#123; protected $bar; public function __construct(Bar $bar) &#123; $this-&gt;bar = $bar; &#125; public function getBar() &#123; return $this-&gt;bar; &#125;&#125;$bar = new Bar();$foo = new Foo($bar);  123456789101112131415161718192021222324252627//class Bar&#123;&#125;class Foo&#123; protected $bar; public function __construct() &#123; &#125; public function setBar(Bar $bar) &#123; $this-&gt;bar = $bar; &#125; public function getBar() &#123; return $this-&gt;bar; &#125;&#125;$bar = new Bar();$foo = new Foo();$foo-&gt;setBar($bar); newnew  just for demonstration  123456789101112131415161718192021222324abstract class Human&#123;&#125;class Woman extends Human&#123;&#125;class Man extends Human&#123; protected $wife; public function __construct() &#123; $this-&gt;wife = new Woman(); &#125; public function kissWife() &#123; echo "the man kissed his wife"; &#125;&#125;$man = new Man();$man-&gt;kissWife();   WifeManWoman  123456789101112131415161718192021222324252627282930abstract class Human&#123;&#125;class Woman extends Human&#123;&#125;class Man extends Human&#123; protected $wife; public function setWife(Human $human) &#123; $this-&gt;wife = $human; &#125; public function kissWife() &#123; echo "the man kissed his wife"; &#125;&#125;$man = new Man();$man-&gt;setWife(new Woman());$man-&gt;kissWife();$anotherMan = new Man();$anotherMan-&gt;setWife(new Man());$anotherMan-&gt;kissWife(); ManWifeWomanMan  ManWomanCat ManWomanCat 123456789101112131415161718192021222324252627282930313233343536373839404142abstract class Human&#123;&#125;interface canBePartner&#123;&#125;class Cat implements canBePartner&#123;&#125;class Woman extends Human implements canBePartner&#123;&#125;class Man extends Human implements canBePartner&#123; protected $partner; public function setPartner(canBePartner $partner) &#123; $this-&gt;partner = $partner; &#125; public function kissPartner() &#123; echo "the man kissed his partner"; &#125;&#125;$man = new Man();$man-&gt;setPartner(new Woman());$man-&gt;kissPartner();$man2 = new Man();$man2-&gt;setPartner(new Man());$man2-&gt;kissPartner();$man3 = new Man();$man3-&gt;setPartner(new Cat());$man3-&gt;kissPartner();  DogcanBePartner 12345class Dog implements canBePartner&#123;&#125;$man = new Man();$man-&gt;setPartner(new Dog());  PHPWeb]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL Cluster]]></title>
    <url>%2F2019%2F07%2F06%2FMySQL-Cluster%2F</url>
    <content type="text"><![CDATA[ MySQL ClusterMySQLMySQLSNAshare nothing architectureMySQLMySQL MySQL ClusterMySQL ClusterMySQLMySQLMySQLnode MySQL MySQLMySQL4SQL 1 MySQLMySQLSQLMySQLMySQLCMDmysql -h localhost -u root -pMySQL  2SQL SQLMySQLMySQLMySQLSQLSQLSQLSQLSQLSQL MySQLNDB ClusterMySQLSQLMySQLNDBMySQLMySQL8NDB ClusterMySQLMySQLMySQL SQLmysqldndbclustermy.ini[mysqld]ndbclusterSQLNDB Cluster SQLmysqld.exe NDBnetwork databaseNDBMySQLSQLACID 3 MySQLMySQLMySQLSQLSQLSQL ndbdndbd.exe MySQL  4 MySQLMySQLconfig.iniSQLIP MySQLndb_mgmdndb_mgmd.exe  MySQLMySQL4SQL1 1 MySQL MySQLNDBMySQLMySQLSQLSQLSQLndb_mgmdSQLMySQL ClusterMySQL MySQL ClusterMySQL ClusterLinuxMac OS XSolarisMySQL ClusterWindowsWindowsMySQL Cluster MySQLMySQL MySQLMySQLSQLMySQLMySQL5MySQL IPpingMySQLMySQLMySQLSQL MySQLMySQL MySQL Cluster &lt;http//dev.mysql.com/downloads/cluster/&gt;MySQLmsizipmysql-cluster-gpl-7.3.2-win32.zipMySQL64 Windowsmysql- cluster-gpl-7.3.2- winx64.zip MySQLmysql-cluster-gpl-7.3.2-win32.zip MS1S2D1D2IP 15-1IPMD1D2S1S2SQL 1 MySQL mysql-cluster-gpl-7.3.2-win32.zipMS1S2D1 D2 Cmysql-cluster2  SQL  15-2  bin C\mysql-cluster\binPathPath3 3 MySQL Cluster MySQLMySQLbin PATH 2binPath D1D2mysql-clustermy-default.inimy.inimy.ini[mysql_cluster] 12[mysql_cluster]ndb-connectstring = 192.168.4.15 [mysql_cluster] ndb-connectstring IP192.168.4.15MMySQL SQL1S1S2MySQLMySQLSQLS1S2CMDMySQL15-4cd C\mysql-cluster\binmysqld.exe -install mysqlcluster15-4 MySQL15-4The service already existsCMDsc delete mysqlclusterMySQLMySQLmysqlcluster15-5MySQLmysqlclusterMySQLmy.inimysqlcluster 2MySQLS1S2mysql-clustermy-default.inimy.ini15-5 CMD net start mysqlclusterMySQLCMDMySQLMySQL15-6mysql -h localhost -u root -p15-6 MySQLMySQLshow engines;15-715-7MySQLInnoDBNDB15-7 MySQL 15-7 MySQL3S1S2 MySQLNDB Cluster 15-8CMDnet stop mysqlclusterS1S2MySQLS1S2my.ini[mysqld]MySQL NDB Cluster ndbcluster4S1S2my.ini[mysqld]SQLIP192.168.4.15Andb-connectstring = 192.168.4.15MySQLSQLMySQLSQLSQL15-8 MySQL MySQLSQLIP192.168.4.15MMCconfconfig.ini 12345678910111213141516[NDBD DEFAULT]NoOfReplicas=2DataDir=C/data[NDB_MGMD]HostName=192.168.4.15DataDir=C/logs#[NDBD]HostName=192.168.4.11[NDBD]HostName=192.168.4.12#SQL[MYSQLD]HostName=192.168.4.13[MYSQLD]HostName=192.168.4.14 MClogsD1D2Cdataconfig.ini config.ini  6 [NDB_MGMD DEFAULT][NDB_MGMD][MYSQLD DEFAULT][MYSQLD][NDBD DEFAULT][NDBD]DEFAULTSQL [NDB_MGMD][MYSQLD][NDBD] SQL [NDBD DEFAULT] DataDir [NDB_MGMD] DataDir  IP  HostNameNoOfReplicas=2NoOfReplicas[NDBDDEFAULT]NoOfReplicas2MySQLD1D2ABNoOfReplicas1AD1BD2D1D2NoOfReplicas2AD1AD2BD2BD1D1D2 MySQLMySQLSQLSQL 1 MCMD15-9ndb_mgmd configdir=c/conf -f c/conf/config.ini - initial15-9 MC/logsndb_1.pidndb_1_cluster.logndb_1_out.log15-10ndb_1_cluster.logndb_1_out.logndb_1.pidID 15-10 MC/confndb_1_config.bin.115-11config.ini ndb_1_config.bin.1config.inindb_1_config.bin.12 M CMDndb_mgmshow15-1215-11 15-12 15-12 1186 [ndbd(NDB)] 2 node(s) id=2  IP  192.168.4.11 id=3IP 192.168.4.12 [ndb_mgmd(MGM)] 1 node(s) id=1IP 192.168.4.15 [mysqld(API)] 2 node(s)SQL [mysqld(API)] 2 node(s)SQL id=4SQL IP 192.168.4.13SQL id=5SQL IP 192.168.4.14SQL3D1D2D1CMD15-13D115-131186Ndbd  initial15-13 D1D1D1C/data15-1415-14 D1D2CMD15-15D2Ndbd  initial15-15 D2D2D2C/data15-1615-16 D2config.inindbd initialndbd 4S1S2MySQL S1S2MySQLMySQLshow engines;  S1S2 MySQLMySQLshow engines;15-1715-17MySQL NDB Cluster 5 MCMDndb_mgmshow15-1815-18MySQL15-17 S1S215-18 15.2.6 S1 CMD mysql -h localhost -u root -pS1 MySQLSQL15-19 1234create database student;use student;create table teacher(teacher_no int primary key) engine=ndb;insert into teacher values(1); 15-19  teacher  NDB Clusterteacher  S1 C\mysql-clusterdata\student15-2015-20 NDBS2CMD mysql -h localhost -u root -pS2MySQLSQL15-21 123show databases;use student;select * from teacher; 15-21  S1NDB ClusterteacherS2MySQLMySQL Cluster MySQL Cluster  MySQL Cluster MySQL Cluster MySQL Cluster SQLMySQLSQLMySQL]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SQL]]></title>
    <url>%2F2019%2F07%2F06%2FSQL%E8%AF%AD%E5%8F%A5%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[ SQLSQLSQL InnoDB explainselectselectselectselect SQL 1QPSQPSquery per secondMySQLMySQL 5.1.30QuestionsMySQL 5.1.31QueriesQueriesQuestionsQueryMySQLshow status like questions;show status like queries;1 1 QueriesQuestions QuestionsMySQLMySQLMySQLMySQLMySQLMySQLcom_pingcom_statisticscom_stmt_preparecom_stmt_closecom_stmt_reset QueriesMySQLMySQLMySQLcom_pingcom_statistics MySQLshow global status like Com_;MySQLSQL Com_selectselect Com_insertinsertinsert Com_updateupdate Com_deletedelete OLTPOLAPInnoDBCom_commitCom_rollback Com_xxxxxx 20MySQLshow status like handler; Handler_deleteHandler_deleteCom_deletedeleteCom_deleteHandler_delete Handler_commitSQL Handler_rollbackrollback Handler_update Handler_writeHandler_savepoint Handler_savepoint_rollback 3 Handler_read_firstselectselect column_name from tablecolumn_name Handler_read_key select  Handler_read_next Handler_read_prevorder by  desc Handler_xxxxxxMySQL5.6 Handler_read_lastorder by order bydesc Handler_read_rnd Handler_read_rnd_next MySQL show status like Innodb_rows;InnoDB Innodb_rows_readInnoDB Innodb_rows_insertedInnoDB Innodb_rows_updatedInnoDB Innodb_rows_deletedInnoDB SQLSelect_scanSelect_full_joinSelect_full_range_joinSelect_range_checkHandler_read_rndHandler_read_rnd_nextMySQLselect long_query_timeSQLSQLMySQL SQLMySQLshow processlist;MySQLMySQLshow processlist;MySQLMySQLCommand121 1  MySQLshow status like uptime;MySQLMySQLshow status like slow_queries;MySQL selectselectselectexplaindescselectselectselectselectexplaindescexplain explain select descexplain join explainMySQL 5.7explainselectdeleteinsertreplaceupdateselectMySQLexplainselectexplainselect SQLexplainSQL2 1explain select * from student where student_name like '_'\G 2 select explain id select_type simpleunion primary unionunionselect dependent unionunionunionselect union resultunion  subqueryselect uncacheable subquery dependent subqueryselect derivedselect table type systemconst const eq_refconst ref ref_or_nullrefnull index_mergemergekeykey_len unique_subquery index_subquery rangekeykey_lenrefNULL indexindexALL allMySQLselect fulltextfull table scanindex scans(range scans)unique index lookupsconstants possible_keyspossible_keys select  nullwhere keyNULLMySQLpossible_keys select force indexuse indexignore index key_lenkeyNULLNULL ref rowsMySQL extraMySQL distinctMySQL not existsMySQL left join left join range checked for each record (index map#)MySQL  using filesortorder byMySQLselect using index using temporaryMySQLgroup byorder by using whereusing where using sort_union(), using union(), using intersect()index_merge using index for group-byusing index using index for group-bygroup bydistinct Full scan on NULL keyNULL Impossible WHERE noticed after reading const tablesMySQL No tablesFROMSelect tables optimized awayMySQL group bySQLstudentstudent_namename_index1explainselect14-69 1234create index name_index on student (student_name);create index name_index1 on student (student_name(1));explain select * from student where student_name like ''\Gexplain select * from student use index (name_index1) where student_name like ''\G 14-69 selectselectname_indexstudentselectname_index1name_index1studentkey_len selectselectInnoDBselectselect1SQLexplaindescSQL14-70typeALLrows66selectselectMySQLwhere 1explain select * from student where substring(student_name,1,1)=''\G 14-70 select12SQLexplaindescSQL14-71selectMySQL, 1explain select * from student where student_name like ''\G 14-71 select23selectSQLteacherteacher_nameteacher_contactname_contactteacher_contact1100000000014-72 12create index name_contact on teacher (teacher_name,teacher_contact);explain select * from teacher where teacher_contact='11000000000'\G selectname_contactselectselectname_contact14-73explain select * from teacher where teacher_name=\G4not=&lt;&gt;SQLexplaindescSQL14-74 1desc select * from student where student_name not like '_'\G 14-72 select314-73 select45MySQLselectstudent2012001explaindescselectselect14-75 12desc select * from student where student_no='2012001'\Gdesc select * from student where student_no=2012001\G 14-74 select(5) 14-75 select6 selectMySQLselectlimitstartlengthstartMySQLstartMySQL1newsnews_idnews create table titlecontentpublish_time 123456create table news(news_id int auto_increment primary key,title char(100) not null,content text,publish_time datetime); MySQLinsert_n()newsn 12345678910111213delimiter $$create procedure insert_n(n int)modifies sql databegindeclare start int default 0;while start&lt;n doset start = start + 1;insert into news values(start,'title','content',now());end while;end;$$delimiter ; MySQLinsert_n()news 1call insert_n(1000000);  30 14-7614-76 210 10 news_id900001news_id900010  1select * from news limit 900000,10;  1select * from news order by news_id limit 900000,10;  1select * from news where news_id&gt;900000 order by news_id limit 10;  1select * from news where news_id&gt;900000 limit 10; 314-7714-7814-790.05480 14-77 14-78 14-79  limit 900000,1090001090000010select14-80select900010select201394  10 news_id900001news_id900010select 1select * from news where news_id&gt;900010 limit 10;  1select * from news where news_id&gt;900010 order by news_id limit 10; select 1select * from news where news_id&lt;900000 order by news_id desc limit 10; SQLSQLSQLSQLSQLSQL 1*MySQL2SQLAB 12select * from student;select * from student; selectQuery Cache selecthash 3MySQLINVALIDINVALID4prepared statementprepared statementSQLSQLSQLSQLprepared statementSQL5join6limit 1 7joinjoinjoin14.6.7 profilingSQLexplainSQLprofilingSQLprofilingprofilingSQLSQLprofilingSQLSystem lock Table lockI/OCPUSQLprofiling 1setprofiling 1set profiling=1; 2SQL 1select * from student where student_name like ''; 3MySQLshow profiles;SQLDuration 14-81 4MySQLshow profile for query 1;Query_ID 1 SQL14-82 14-82 profiling 5profiling 1set profiling=0;]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F07%2F04%2F%E9%94%81%E8%B5%84%E6%BA%90%E7%9A%84%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[  MySQLshow status like table_locks;MySQL1 1  Table_locks_immediateMySQL Table_locks_waitedMySQL Table_locks_waited   MySQLAMyISAMselectAMySQLBBMySQLBselectAMySQLCselectCBselectCselectCBselectAMySQLMySQL  -low-priority-updatesmysqldselectselectCBselectA MySQLset low_priority_updates=1; insertdeleteupdatereplaceload datalow_priority selecthigh_priority max_write_lock_countmysqldMySQLselect  SELECTsql_buffer_result selectdeletedeletelimit  MyISAMMySQLMyISAMconcurrent_insertMySQLshow variables like concurrent;14-84  2 concurrent_insert  concurrent_insert0 concurrent_insert1MyISAMMySQLMyISAMMySQLMySQL concurrent_insert2MyISAMInnoDBMyISAM MySQLshow status like innodb_row_lock;MySQL14-855 14-85   Innodb_row_lock_current_waitsMySQL Innodb_row_lock_time MySQL  Innodb_row_lock_time_avgMySQL Innodb_row_lock_time_maxMySQL Innodb_row_lock_waitsMySQLInnodb_row_lock_waitsInnodb_row_lock_time_avgMySQL    InnoDB  repeatable read repeatable read InnoDBSQL SQL SQL InnoDB     innodb_print_all_deadlocksMySQL InnoDBlock in share modefor updateInnoDBREAD COMMITTEDinnodb_locks_unsafe_for_binlogON1 InnoDBinformation_schemaINNODB_TRXINNODB_LOCKSInnoDB_LOCK_WAITS InnoDB  information_schema  INNODB_TRXINNODB_LOCKSInnoDB_LOCK_WAITS INNODB_TRXInnoDBSQLINNODB_TRX2414-4 14-4 INNODB_TRXINNODB_LOCKSInnoDBIDINNODB_LOCKS1014-5 INNODB_LOCK_WAITSInnoDB414-6 14-6 INNODB_LOCK_WAITS metadata locksMySQL 5.5.3 InnoDBalter tableInnoDBalter tableInnoDBalter table 1MySQLAaccountInnoDBalter table account engine=InnoDB; 2MySQLAaccount14-86 12start transaction;select * from account; 3MySQLBaccount14-87 12start transaction;select * from account; 4MySQLCalter tableaccountaddressbeijingalter table14-88  1alter table account add column address char(32) default 'beijing';]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Git]]></title>
    <url>%2F2019%2F06%2F06%2FGit%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5%2F</url>
    <content type="text"><![CDATA[GitFast forward mastermasterdevFast forwardgit log 12345678910$ git checkout -b cb_dev master$ vim 1.txt cb_dev$ git commit -am 'test'$ git checkout master$ git merge cb_dev$ git log * e429856 test* 121be0f  xiaoxiaole.json* 649f161  README.md* 3d02ba4 web  master Fast forwardGitmergecommit no-ffgit mergedev$ git checkout -b devSwitched to a new branch dev readme.txtcommit$ git add readme.txt$ git commit -m add merge[dev f52c633] add merge 1 file changed, 1 insertion(+) master$ git checkout masterSwitched to branch master devno-ffFast forward$ git merge no-ff -m merge with no-ff devMerge made by the recursive strategy. readme.txt | 1 + 1 file changed, 1 insertion(+) commit-mcommitgit log$ git log graph prettypretty=oneline abbrev-commit e1e9c68 merge with no-ff|\| * f52c633 add merge|/ cf810e4 conflict fixed Fast forwardmerge  master devdev1.0devmastermaster1.0 devdev]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Git]]></title>
    <url>%2F2019%2F06%2F06%2FGit%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[tag **  ** 12RPGBossBoss  commit 1 12345$ git branch* dev master$ git checkout masterSwitched to branch 'master' 2git tag commit 1$ git tag v1.0  1$ git tag -a v0.1 -m "version 0.1 released" commit 12$ git log --pretty=oneline --abbrev-commit$ git tag v0.9 6224937 3 1git push origin &lt;tagname&gt; git push origin tags 4git checkout [tagname] 5 1$ git tag -d v0.9 push 1$ git push origin :refs/tags/v0.9 6 123$ git taggit show &lt;tagname&gt;$ git tag -l 'v1.4.2.*' tagtagtag,commit v1.0, v1.1, v2.0 build-20150702, build-20150910  mastercommit TortoiseGit]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Git]]></title>
    <url>%2F2019%2F06%2F05%2FGit%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E5%92%8C%E8%AE%BE%E7%BD%AE%E5%A4%A7%E5%B0%8F%E5%86%99%E6%95%8F%E6%84%9F%2F</url>
    <content type="text"><![CDATA[gitgit diff 12$ chmod 777 pack.php$ git diff pack.php git git 1$ git config core.filemode false  1$ cat .git/config gitOK  , readme.md  . Readme.md ,.git status  git git config core.ignorecase false]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2019%2F05%2F23%2FMySQL%E4%B9%90%E8%A7%82%E9%94%81%E4%B8%8E%E6%82%B2%E8%A7%82%E9%94%81%2F</url>
    <content type="text"><![CDATA[       DBMSDBMS  memcachehibernatetair  Pessimistic Concurrency ControlPCC     Optimistic Locking    (data race)  exclusive locking    MySql InnodbSQL mysqlMySQLautocommitMySQLset autocommit=0;  12345678//0.begin; //1.select quantity from items where id=1 for update;//2.2update items set quantity=2 where id = 1;//3.commit; id = 1for update id=1 selectfor updateMySQL InnoDBSQL  Compare and Swap(CAS) CASCAS  1234//quantity = 3select quantity from items where id=1//2update items set quantity=2 where id=1 and quantity = 3; quantityupdate ABA one3two3two2two3oneCAS3oneoneCAS ABAversion 1234//version = 1select version from items where id=1//2update items set quantity=2,version = 3 where id=1 and version = 2; +1ABA version SQL   1234//update item set quantity=quantity - 1 where id = 1 and quantity - 1 &gt; 0 SQL1quantity - 1 &gt; 0 updatequantity1   1 2 ]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2019%2F05%2F23%2FMySQL%E8%84%8F%E8%AF%BB%E3%80%81%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E5%92%8C%E5%B9%BB%E8%AF%BB%2F</url>
    <content type="text"><![CDATA[     ACID ACID     commit AbstractPayExecutor     AbstractPayExecutor   AbstractPayExecutor   AbstractPayExecutorLOGGERLOGGER  T1T2T1     20 21Java   Ann+1             MySQLMyISAMInnoDBMySQLInnoDBInnoDB InnoDBInnoDB MySQL 1ABAB1000BBA1000B 2A18B20A20 3A1B0insertselect  Read uncommitted Read committed Repeatable read Serializable InnoDB 1Shared and Exclusive LocksInnoDBSXSS SXXSXSQL 123456789101112131415161718# T1START TRANSACTION WITH CONSISTENT SNAPSHOT;SELECT * FROM category WHERE category_no = 2 lock in SHARE mode; #SELECT * FROM category WHERE category_no = 2 for UPDATE; #COMMIT;# T2START TRANSACTION WITH CONSISTENT SNAPSHOT;SELECT * FROM category WHERE category_no = 2 lock in SHARE mode; #UPDATE category set category_name = '' WHERE category_no = 2; #COMMIT; Intention LocksInnoDBISIX Intention locks are table-level locks that indicate which type of lock shared or exclusive a transaction requires later for a row in a table. record LocksInnoDB Gap Locks6072809572select * from student where grade &gt; 72 for updateInnoDB809572-8080-959572 Next-Key LocksNK 23InnoDB  123456789101112131415161718192021222324252627282930313233343536CREATE TABLE `a` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `uid` int(10) unsigned DEFAULT NULL, PRIMARY KEY (`id`), KEY `idx_uid` (`uid`) USING BTREE) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;INSERT INTO `a`(uid) VALUES (1);INSERT INTO `a`(uid) VALUES (2);INSERT INTO `a`(uid) VALUES (3);INSERT INTO `a`(uid) VALUES (6);INSERT INTO `a`(uid) VALUES (10);# T1START TRANSACTION WITH CONSISTENT SNAPSHOT; //1SELECT * FROM a WHERE uid = 6 for UPDATE; //2COMMIT; //5# T2START TRANSACTION WITH CONSISTENT SNAPSHOT; //3INSERT INto a(uid) VALUES(11);INSERT INto a(uid) VALUES(5); //4INSERT INto a(uid) VALUES(7);INSERT INto a(uid) VALUES(8);INSERT INto a(uid) VALUES(9);SELECT * FROM a WHERE uid = 6 for UPDATE;COMMIT;ROLLBACK;  12344 5 uid=6 5 next-key3,10]]></content>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL Force Index]]></title>
    <url>%2F2019%2F05%2F23%2FMySQL-Force-Index%2F</url>
    <content type="text"><![CDATA[ MySQL Force IndexMySQLhint MySQL FORCE INDEX 1SELECT * FROM TABLE1 FORCE INDEX (FIELD1)  SQLFIELD1  IGNORE INDEX 1SELECT * FROM TABLE1 IGNORE INDEX (FIELD1, FIELD2)  SQLTABLE1FIELD1FIELD2  SQL_NO_CACHE SELECT SQL_NO_CACHE field1, field2 FROM TABLE1;SQL,,SQL MySQL force Index  SQL_CACHE 1SELECT SQL_CALHE * FROM TABLE1; my.iniquery_cache_type2SQL_CACHE  HIGH_PRIORITY HIGH_PRIORITYselectinsertMySQL 1SELECT HIGH_PRIORITY * FROM TABLE1;  LOW_PRIORITY LOW_PRIORITYinsertupdateMySQL 1update LOW_PRIORITY table1 set field1= where field1=   INSERT DELAYED 1INSERT DELAYED INTO table1 set field1=  INSERT DELAYED INTOMySQLMySQLOKMySQLIDMySQL  STRAIGHT_JOIN 1SELECT TABLE1.FIELD1, TABLE2.FIELD2 FROM TABLE1 STRAIGHT_JOIN TABLE2 WHERE  SQLSTRAIGHT_JOINMySQLTABLE1TABLE2MySQLSTRAIGHT_JOIN MySQL force Index : SQL_BUFFER_RESULT SELECT SQL_BUFFER_RESULT * FROM TABLE1 WHERE SQL_BUFFER_RESULT.MySQLSQL  SQL_BIG_RESULTSQL_SMALL_RESULT 1SELECT SQL_BUFFER_RESULT FIELD1, COUNT(\*) FROM TABLE1 GROUP BY FIELD1; DISTINCTMySQLSQL_SMALL_RESULTSQL_BIG_RESULT CREATE TABLECREATE INDEXALTER TABLEPRIMARY KEYUNIQUEINDEX 12345678910111213mysql&gt;ALTER TABLE `` ADD INDEX `` (column list); mysql&gt;ALTER TABLE `` ADD UNIQUE `` (column list); mysql&gt;ALTER TABLE `` ADD PRIMARY KEY `` (column list); mysql&gt;CREATE INDEX `` ON `` (column_list); mysql&gt;CREATE UNIQUE INDEX `` ON `` (column_list); mysql&gt;ALTER TABLE `` ADD INDEX (`id`,`order_id`);articleidorder_id mysql&gt;ALTER TABLE `` ADD INDEX `id`;//articleid 2  Sql mysql&gt; REPAIR TABLE table_name QUICK; 3 1mysql&gt; SHOW INDEX FROM `table_name`; 4 ALTER TABLEDROP INDEXDROP INDEXALTER TABLE 1234567mysql&gt;DROP index `index_name` ON `table_name` (column list); mysql&gt;ALTER TABLE `table_name` DROP INDEX `index_name` (column list); mysql&gt;ALTER TABLE `table_name` DROP UNIQUE `index_name` (column list); mysql&gt;ALTER TABLE `table_name` DROP PRIMARY KEY `index_name` (column list); table_nameindex_namePRIMARY KEYPRIMARY KEYPRIMARY KEYUNIQUEMySQLUNIQUE 5 1mysql&gt;SELECT * FROM TABLE1 FORCE INDEX (PRIMARY) ; 6 1mysql&gt;alter table test add key id_a_b(a,b) ;  a=1 and b=1  a=1  b=1]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Apache Rewrite with Htaccess]]></title>
    <url>%2F2019%2F05%2F15%2FApache-Rewrite-with-Htaccess-%E7%90%86%E8%A7%A3%E4%B8%8E%E6%8A%80%E5%B7%A7%2F</url>
    <content type="text"><![CDATA[ .htaccess RewriteRewriteCentOS7 apachehttpd.conf 1LoadModule rewrite_module modules/mod_rewrite.so #  123$ cd /usr/local/apache/bin$ sudo apachectl -M | grep rewriterewrite_module (shared) Site ConfigRewriteRule Rewrite.htaccess.htaccessHypertext AccessApacheOverride ConfigOverrideSite ConfigRewriteRule.htaccess .htaccessOverrideSite ConfigAllowOverride All/usr/local/apache/conf/vhost/example.conf 123&lt;Directory "/var/www/html"&gt; AllowOverride All&lt;/Directory&gt; AllFlieInfo.htaccessRewrite Rewrite Rule  1RewriteRule [match_uri] [rewrite_uri] [flags] match_uriPatternURI rewrite_uriURI Rule 1Rewrite ^match\.html$ rewrite.html [NC,L] Pseudo Code 1234567// http://domain.com/a/b/c.htmluri = a/b/c.htmlif (uri.match("match.html") &#123; url = "rewrite.html"&#125; RewriteRuleFlag flagsRuleFlag [L]LastRule [NC]Non Case-sensitivematch_uri [QSA]Query String AppendGETflag [QSD]Query String DiscardQSAapache v2.4 [R]: Redirect302 Status Code[R=301]400200404Status Code[L]Flag [DPI]: RulePathInfo [F]: Forbidden   RulesFlag 123456root/  match.html  rewrite.html  .htaccess  secret/  database_password.json .htaccess 123456789101112131415161718# ### RewriteRewriteEngine On### RewritepathDocumentRoot(/var/www/htmlRewriteBase /# Rules #  L flag  Rule ### Rule 1.  domain.com/match.html  rewrite.html RewriteRule ^match\.html$ rewrite.html [NC,L]### Rule 2.  domain.com/redirect.html  domain.com/rewrite.htmlRewriteRule ^redirect\.html$ rewrite.html [NC,R=302,L]### Rule 3.  domain.com/secret/  secret/  root  .html### $1  group capture $1=(.*) RewriteRule ^secret/(.*)$ $1.html [NC,L] match.htmlredirect.htmlrewrite.htmlRule 2Rule 1302 Status Code POSTMANcURLRequestResponsecURL 1.Requesthttp://localhost/match.html 12$ curl &apos;http://localhost/match.html&apos;Im rewrite.html 2.Request http://localhost/redirect.html 1234567891011$ curl &apos;http://localhost/redirect.html&apos;&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;302 Found&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Found&lt;/h1&gt;&lt;p&gt;The document has moved &lt;a href=&quot;http://localhost/rewrite.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;hr&gt;&lt;address&gt;Apache/2.4.33 (Win32) OpenSSL/1.1.0h PHP/7.2.7 Server at localhost Port 80&lt;/address&gt;&lt;/body&gt;&lt;/html&gt; Responsehttp://localhost/rewrite.htmlRequest RewriteBaseRewriteDomainDocumentRoot 1234567891011$ curl &apos;http://localhost/redirect.html&apos;&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;302 Found&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Found&lt;/h1&gt;&lt;p&gt;The document has moved &lt;a href=&quot;http://localhost/var/www/html/rewrite.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;hr&gt;&lt;address&gt;Apache/2.4.33 (Win32) OpenSSL/1.1.0h PHP/7.2.7 Server at localhost Port 80&lt;/address&gt;&lt;/body&gt;&lt;/html&gt; RuleRule 1234### Rule 3. domain.com/secret/ secret/root.html### $1group captureRewriteRule ^secret/(.*)$ $1.html [NC,L] Rulesecretdatabase_password.json 123456789$ curl &apos;http://localhost/secret/database_password.json&apos;HTTP/1.1 404 Not FoundDate: Sun, 07 Oct 2018 13:39:11 GMTServer: Apache/2.4.33 (Win32) OpenSSL/1.1.0h PHP/7.2.7Vary: accept-language,accept-charsetAccept-Ranges: bytesContent-Type: text/html; charset=utf-8Content-Language: en http://localhost/secret/...404 http://localhost/secret/403 123456789$ curl &apos;http://localhost/secret/&apos;HTTP/1.1 403 ForbiddenDate: Sun, 07 Oct 2018 13:43:08 GMTServer: Apache/2.4.33 (Win32) OpenSSL/1.1.0h PHP/7.2.7Vary: accept-language,accept-charsetAccept-Ranges: bytesContent-Type: text/html; charset=utf-8Content-Language: en RuleFlagR=302 1234567891011$ curl &apos;http://localhost/secret/&apos;&lt;!DOCTYPE HTML PUBLIC -//IETF//DTD HTML 2.0//EN&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;302 Found&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Found&lt;/h1&gt;&lt;p&gt;The document has moved &lt;a href=http://localhost/.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;hr&gt;&lt;address&gt;Apache/2.4.33 (Win32) OpenSSL/1.1.0h PHP/7.2.7 Server at localhost Port 80&lt;/address&gt;&lt;/body&gt;&lt;/html&gt;  $1 .html 403  Rule 3  Rule  1RewriteRule ^secret/$ / [R=302,NC,L] RewriteRuleDebugRulesRewriteCond RewriteCondRewriteRuleRequest URIURIRequest HeaderHostUser-agentApacheRewrite URIRewriteCond 12RewriteCond [test_string] [match_string] [flags]RewriteRule  test_string match_string RewriteCondRewriteRule 12RewriteCond %&#123;HTTP_USER_AGENT&#125; (facebookexternalhit)RewriteRule ^blog/(.*)$ fb-bot.html?path=$1&amp;type=%1 [L] Pseudo Code 1234567if ($HTTP_USER_AGENT == 'facebookexternalhit') &#123; if (url.match('^blog/(.*)$')) &#123; url = 'fb-bot.html?path=$1&amp;type=facebookexternalhit'; &#125;&#125; $1Group CaptureRewriteCond%1 RewriteCond ${HTTP_USER_AGENT}RewriteCond 123456789%&#123;REQUEST_URI&#125;DomainURI PathRuleURI%&#123;QUERY_STRING&#125;GET%&#123;HTTP_HOST&#125;Domain 163.com%&#123;HTTP_COOKIE&#125;Cookie%&#123;HTTPS&#125;httpshttphttpsonoff%&#123;HTTP_USER_AGENT&#125;User Agent%&#123;REQUEST_FILENAME&#125;RewriteRulerewrite url match 12-ddirectory. -fregular file.   12RewriteCond %&#123;REQUEST_FILENAME&#125; !-fRewriteRule ^(.*)$ index.html matchApache RewriteCond  RewriteCondFlag 12NCNon case-sensitiveOROR RewriteCondORANDRewriteCondRewriteRulerule 123456789101112131415161718192021222324252627282930###  ARewriteCond 1RewriteRule 1RewriteRule 2// if (Cond1) &#123; Rule1&#125;Rule 2###  BRewriteCond 1RewriteCond 2RewriteRule 1// if (Cond1 &amp;&amp; Cond2) &#123; Rule1&#125;###  CRewriteCond 1 [OR]RewriteCond 2RewriteRule 1// if (Cond1 || Cond2) &#123; Rule1&#125; RewriteCondRewriteRule RewriteRuleDebug 1.Debug POSTMANcURLCacheResponse 2.Regular Expression RewriteRuleFlag[R=302]302 Status CodeMoved TemporarilyCache302301Rule301 1RewriteRule ^(.*)$ =$1 [L,R=302] 3. HeaderRewriteCondRewriteRuleUser-agentReuqestUser-agent 4.Cache cacheApache 1.RewriteRule.htaccessURI Path  123456root/  a/  b.html  .htaccess  c.html  .htaccess 12### .htaccessRewriteRule ^(.*)$ $1 [L] 1.Requestc.html root/.htaccessRulec.html 2.Request a/b.html root/a/.htaccessRule b.html a/  Apache.htaccess 3.root/a/.htaccessRequest a/b.html root/.htaccessRulea/b.html URI Path %{REQUEST_URL} URI  12RewriteCond %&#123;REQUEST_URI&#125; ^(.*)$RewriteRule ^ %1 [L] 2.RewriteRulePATH_INFO Rule1Rule2URI 123RewriteRule ^(.*)$ web/$1 [NC]RewriteRule ^(.*)$ sec======$1====== [NC,R=301]Request a/b/c.html Ruleweb/a/b/c.htmlRulesec======web/a/b/c.html/b/c.html====== Rule1/b/c.htmlPATH_INFOPathRule 1DPI FlagphpCMSFrameworkPATH_INFOPATH_INFO 3..htaccess RuleRequestweb/ 12RewriteBase /RewriteRule ^(.*)$ web/$1 [QSA,L] Apache 2.4Redirect LoopRequest URIweb/xxxxURI.htaccessRewriteRule web/ .htaccess Redirect LoopRewriteRule 4.Redirect Loop Loop  1Request exceeded the limit of 10 internal redirects due to probable configuration error. Use &apos;LimitInternalRecursion&apos; to increase the limit if necessary. Use &apos;LogLevel debug&apos; to get a backtrace. RewriteRuleRedirect Status200Loop 12RewriteCond %&#123;ENV:REDIRECT_STATUS&#125; 200RewriteRule ^ - [L] RewriteRule= HtaccessOverride.htaccessOverride 1.Request RequestApache.htaccessApacheRequest Request /example/sub/index.html Apache  .htaccess 123/var/www/.htaccess/var/www/example/.htaccess/var/www/example/sub/.htaccess Apache/var/www/example/sub/.htaccess 2.Compile RewirteRule Request.htaccessRewriteRule CompileSite ConfigCompile cacheRewriteRuleapache Apache Benchmark100001000abOverrideRewriteRewriteRewriteRuleRewriteCond Override0.1 .htaccessSite Config.htaccessOverride Site Config.htaccessOverrideInclude.htaccess 123456DocumentRoot /var/www/&lt;Directory /var/www/&gt; AllowOverride None Include /var/www/.htaccess &lt;/Directory&gt; .htaccessApache ]]></content>
      <categories>
        <category>Apache</category>
      </categories>
      <tags>
        <tag>Apache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2019%2F04%2F30%2F%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E7%B4%A2%E5%BC%95%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[ idB+  InnoDB  4IdName Id Name Company 5 Gates Microsoft 7 Bezos Amazon 11 Jobs Apple 14 Ellison Oracle select * from tab where id = 14;B+ Name 1B+Name 2B+B+  rowidrowid  select *NameIdselect Id from tab where Name=Jobs NameId Covering Index  1 MySQL  2IOIO 3 InnoDB  InnoDB   / MySQL   2(col1,col2)(col1)(col1,col2) 3(col1,col2,col3)(col1)(col1,col2)(col1,col2,col3)  (col2,col3) 2a, bB+  1,11,22,12,43,13,2abab ab ab 123select * from table where a=xxx and b=xxx ;select * from table where a=xxx; sqlb1,2,1,4,1,2 1select * from table where b=xxx NM  1 2MySQL&gt;&lt;betweenlike a = 1 and b = 2 and c &gt; 3 and d = 4(a,b,c,d)d(a,b,d,c)a,b,d 3=  in  MySQLMySQLSQL 1 (col1,col2,col3)(col1),(col1,col2),(col1,col2,col3)   2 (col1,col2,col3)sql: select col1,col2,col3 from test where col1=1 and col2=2MySQLIO IOIODBA 3  1000Wsql: select col1,col2,col3 from table where col1=1 and col2=2 and col3=310% 1000W_10%=100w100wcol2=2 and col3= 3 1000w_10% * 10% * 10%=1w ICPindex condition pushdownMySQLMySQL ICPindex condition pushdownMySQLWHERE ICPwhere ICPindex conditionserver index conditionserverserverwhere ICP MySQL Server IO  IO MySQL ServerMySQL Server WHERE MySQL Server ICPdata access ICP MySQL Server   IO  ICPIO MySQL ServerMySQL Server ICPMySQL Server  ICPwheredata accessindex conditionserver   1SELECT * FROM employees WHERE first_name='Mary' AND last_name LIKE '%man'; ICPfirst_nameMaryserverwherelast_namelike ICPlast_namelikewherewhereserver  ICP ICP whereICPwhereserverwhere ICPICP 1MySQL  &gt;&lt;betweenlike 2=in 3 4B+ 5     DBA]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHPyield]]></title>
    <url>%2F2018%2F12%2F05%2F%E5%9C%A8PHP%E4%B8%AD%E4%BD%BF%E7%94%A8yield%E6%9D%A5%E5%81%9A%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[ yield yield&amp;return yield  123456function getValues() &#123; yield 'value';&#125;//  "value"echo getValues();    yield&amp;returngetValues() 123456789function getValues() &#123; return 'value';&#125;var_dump(getValues()); // string(5) "value"function getValues() &#123; yield 'value';&#125;var_dump(getValues()); // class Generator#1 (0) &#123;&#125; getValue() 123456789foreach (getValues() as $value) &#123; echo $value;&#125;// $values = getValues();foreach ($values as $value) &#123; echo $value;&#125;   800,000getValues()memory_get_usage()200,000 12345678910111213141516171819202122&lt;?phpfunction getValues() &#123; $valuesArray = []; //  echo round(memory_get_usage() / 1024 / 1024, 2) . ' MB' . PHP_EOL; for ($i = 1; $i &lt; 800000; $i++) &#123; $valuesArray[] = $i; //  if (($i % 200000) == 0) &#123; //  MB  echo round(memory_get_usage() / 1024 / 1024, 2) . ' MB'. PHP_EOL; &#125; &#125; return $valuesArray;&#125;$myValues = getValues(); // foreach ($myValues as $value) &#123;&#125;  12340.34 MB8.35 MB16.35 MB32.35 MB 30MB$valuesArray yield: 12345678910111213141516171819&lt;?phpfunction getValues() &#123; //  echo round(memory_get_usage() / 1024 / 1024, 2) . ' MB' . PHP_EOL; for ($i = 1; $i &lt; 800000; $i++) &#123; yield $i; //  if (($i % 200000) == 0) &#123; //  MB  echo round(memory_get_usage() / 1024 / 1024, 2) . ' MB'. PHP_EOL; &#125; &#125;&#125;$myValues = getValues(); // foreach ($myValues as $value) &#123;&#125; //   12340.34 MB0.34 MB0.34 MB0.34 MB returnyieldyield yieldyield a. yieldreturn 1234567891011function getValues() &#123; yield 'value'; return 'returnValue';&#125;$values = getValues();foreach ($values as $value) &#123;&#125;echo $values-&gt;getReturn(); // 'returnValue' b.  1234567function getValues() &#123; yield 'key' =&gt; 'value';&#125;$values = getValues();foreach ($values as $key =&gt; $value) &#123; echo $key . ' =&gt; ' . $value;&#125; http://www.php100.com/9/20/19693.html laravel ORMcursorcursor,cursorgetgetfetchAllcursoryieldfetchPDO mysql 12345$sql = "select * from `user` limit 100000000";$stat = $pdo-&gt;query($sql);$data = $stat-&gt;fetchAll(); //mysql bufferedphpvar_dump($data); yield 1234567891011function get()&#123; $sql = "select * from `user` limit 100000000"; $stat = $pdo-&gt;query($sql); while ($row = $stat-&gt;fetch()) &#123; //php yield $row; &#125;&#125;foreach (get() as $row) &#123; var_dump($row);&#125; PDO PDOture,MySQLMySQL API MysqlsqlfetchAll phpMYSQL_ATTR_USE_BUFFERED_QUERY yieldyield 12345function getNum() &#123; for($i=0; $i &lt; 100000000; $i++) &#123; yield $i; &#125;&#125; fetchfetchAllmysqlyieldfetch getNum]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2018%2F11%2F29%2FMySQL%E4%BC%98%E5%8C%96%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[ MySQL4rangelisthashkey  1NOT NULLMySQLNULL0NULL 2enumsetenumsetenumset 3MySQLblob 4IPchar(15)IPIPMySQLinet_aton()inet_ntoa()IP  111user1user2user1user2user1user211user2user1user1_nouser1user2 12user1user1_noaccount_namepasswordsexuser2user2_nointerestintroductionuser1_no BlockselectI/OCache 1111joinCPU 2 112 2 33 select12 unionselect11211unionI/O OLAPMySQL4rangelisthashkey1 1  range list3201120122013 hashhashhashhash keyhashkeyMySQL 4rangerangeMySQLSQLsalesaleMyISAM 12345678910create table sale( sale_id int not null, sale_date datetime, money int)engine=myisam;alter table sale partition by range columns (sale_date) ( partition p01 values less than ('2011-1-1'), partition p02 values less than ('2012-1-1')); MyISAMsalesale.parsale#P#p01.MYIsale#P#p02.MYIsale#P#p01.MYDsale#P#p02.MYD1 1 MyISAM saleInnoDBsalesale.parsaleInnoDBibdsalesale.parsale#P#p01.ibdsale#P#p02.ibd2 2 InnoDB SQLsale3 12insert into sale values(1, '2011-1-2',100);insert into sale values(1, '2012-1-2',100); 3 sale 2012-1-2salesalemaxvaluep034 1alter table sale add partition(partition p03 values less than maxvalue); 4 maxvalue 2011SQL5 1explain partitions select * from sale where sale_date&lt;='2011-12-31' and sale_date&gt;='2011-1-1'\G 5 select explain partitionsp02  2011p02SQL 1alter table sale drop partition p02; MySQL 1analyze tableselectMySQLselectcardinalitycardinalityshow index select count(distinct())from; MySQLanalyze tableMySQLSQL MySQLanalyze tableMySQLselectstudentMySQLanalyze table student;6 6  analyze tableanalyzetablelocal analyze table 2optimize tabledeleteinsertupdateMySQLoptimize tableMyISAMInnoDBstudentMySQLoptimize table student\G7MySQLstudent 7 1 MySQLmy.ini[mysqld]skip-newsafe-modeMySQLMySQLoptimize tableMySQLoptimize table student\G8 8 2 optimize tableoptimizetablelocal 3check tableMySQLBUG check tableMyISAMInnoDBcheck table quick fast changed medium extended check tableSQLview1student 12345create view view1 as select student_no,student_name,student_contact from student;``` check table```sqlcheck table view1; SQLstudentstudent_contact 1alter table student drop student_contact; check table9 1check table view1; 9  4repair table 1Incorrect key file for table&apos; &apos;Try to repair it. MySQLrepair tableMyISAMARCHIVErepair table quick extended use_frmMYI analyze tablerepair tablelocal MyISAMARCHIVE 5checksum tableMySQL checksum tablechecksumchecksum checksumtablequickextendedquick checksumextendedchecksumextended MyISAMcreate tableCHECKSUM=1MyISAMchecksumlive checksumchecksum NULLanalyze tableNULLMySQLcardinalityMyISAMmyisam_stats_methodMySQLNULLInnoDBinnodb_stats_methodMySQLNULLMySQLNULL3 nulls_equalNULL nulls_unequalNULL nulls_igoredNULL MySQLshow variables like stats_method;10innodb_stats_methodnulls_equalInnoDBNULLmyisam_stats_methodnulls_unequalMyISAMNULLNULLnulls_unequalnulls_equal 10 NULL MySQLshow table status;show table status like ;accountMyISAM11 1show table status like 'account'\G 11 MyISAM accountInnoDBaccount12 12alter table account engine=innodb;show table status like 'account'\G 12 InnoDB show table status2 2  MyISAM3DynamicFixedCompressedDynamicFixedCompressedcompressed tablescreate tablealter tablerow_formatfixeddynamiccharvarcharfixedchardynamicvarcharrow_formatfixedrow_formatdynamic InnoDBCompactRedundantMySQL5.0.3RedundantMySQL5.0.3MySQL5.0.3 row_formatCompact RedundantCompactCPU20 CompactCPURedundant]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLACID]]></title>
    <url>%2F2018%2F11%2F27%2FMySQL%E4%BA%8B%E5%8A%A1%E7%9A%84ACID%E7%89%B9%E6%80%A7%2F</url>
    <content type="text"><![CDATA[    ACIDACIDatomicityconsistencyisolationdurabilily41 1 ACID 1atomicity  2consistency  3isolation  4durabilily  SQL4read uncommittedread committedrepeatable readserializable4read uncommittedserializable 1read uncommitted  2read committed MySQL 3repeatable read MySQL 4serializable selectlock in share modeInnoDB 1read uncommittedread committedrepeatable readserializable4 1  dirty read non-repeatable read phantom read MySQLMySQLselect @@session.tx_isolation;MySQLMySQLselect @@global.tx_isolation;2MySQLrepeatable read 2 MySQL InnoDB4InnoDB 123set &#123; global | session &#125; transaction isolation level &#123; read uncommitted | read committed | repeatable read | serializable&#125;  1 read uncommitted 1MySQLASQLaccountInnoDBMySQLread uncommittedaccount3 123456alter table account engine=InnoDB;set session transaction isolation level read uncommitted;select @@tx_isolation;start transaction;select * from account; 3 read uncommitted 2MySQLBSQLMySQLread uncommittedaccountaccount_no=11000 123set session transaction isolation level read uncommitted;start transaction;update account set balance=balance+1000 where account_no=1; 3MySQLASQLaccount4MySQLAMySQLB 1select * from account; 4 read uncommitted 4MySQLAMySQLBMySQLAMySQLBaccount200 2 read committed 1MySQLASQLaccountInnoDBMySQLread committedaccount5 123456alter table account engine=InnoDB;set session transaction isolation level read committed;select @@tx_isolation;start transaction;select * from account; 5 read committed 2MySQLBSQLMySQLread committedaccountaccount_no=11000 1234set session transaction isolation level read committed;start transaction;update account set balance=balance+1000 where account_no=1;commit; 3MySQLASQLaccount6MySQLAselect * from account; 1select * from account; 6 read committed commit 4MySQLAMySQLBMySQLBaccount2001200 3 repeatable read 1MySQLASQLaccountInnoDBMySQLrepeatable readaccountaccount_no=1007 12345alter table account engine=InnoDB;set session transaction isolation level repeatable read;select @@tx_isolation;start transaction;select * from account where account_no=100; 7 repeatable read 2MySQLBSQLMySQLrepeatable readaccountaccount_no1008 1234set session transaction isolation level repeatable read;start transaction;insert into account values(100,'',5000);commit; 8 account 3MySQLASQLaccountaccount_no=1009account account_no=100 1select * from account where account_no=100; 9 accountaccount_no=100 4MySQLAaccountaccount_no=100MySQLAaccountaccount_no=100MySQLAinsertaccountaccount_no10010 1insert into account values(100,'',5000); 10 repeatable read accountaccount_no=100repeatable readMySQLAaccount_no=100 commitcommit 4  repeatable readlock in share modefor update serializable 1MySQLASQLaccountInnoDBMySQLserializableaccountaccount_no=20011 12345alter table account engine=InnoDB;set session transaction isolation level serializable;select @@tx_isolation;start transaction;select * from account where account_no=200; 11 serializable 2MySQLBSQLMySQLserializableaccountaccount_no20012MySQLB 1234set session transaction isolation level serializable;start transaction;insert into account values(200,'',5000); 12 serializable InnoDBInnoDBaccount serializableserializableMySQLserializable MySQLrepeatable readrepeatable readlock in share modefor updateMySQLInnoDB 5repeatable read 1MySQLASQLaccountInnoDBMySQLrepeatable readaccountaccount_no=20013 12345alter table account engine=InnoDB;set session transaction isolation level repeatable read;select @@tx_isolation;start transaction;select * from account where account_no=200 lock in share mode; 13 repeatable read accountaccount_no=200 selectaccount_no=200 2MySQLBSQLMySQLrepeatable readaccountaccount_no200insert14 123set session transaction isolation level repeatable read;start transaction;insert into account values(200,'',5000); 14 account_no=200insert 3MySQLASQLaccountaccount_no=20015accountaccount_no=200 1select * from account where account_no=200;lock in share mode 15 accountaccount_no=200 4MySQLAaccountaccount_no=200MySQLAaccountaccount_no=200MySQLAinsertaccountaccount_no20016 1insert into account values(200,'',5000); 16 account_no=200 MySQLrepeatable read  InnoDBInnoDB SQL   SQL InnoDB  repeatable read repeatable read InnoDB InnoDB     MySQL 1 2MySQL 3MySQL 4 5 6 7MyISAM 8MyISAMread localread 9 10 11 12 13InnoDB 14 15replace_course_proc()choose_proc()selectstart transaction; 1select state into status from course where course_no=c_no; 16InnoDB 17 18ACID 19MySQL 20 21 22]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[]]></title>
    <url>%2F2018%2F11%2F26%2F%E7%8A%B6%E6%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[            Context        PHP StateGoF1 1 ClientGoFContextClientConText PHP switchelse 3x3992 23 x 3 524: 12345678910111213141516if($this-&gt;moveUp())&#123; $this-&gt;currentCell = $cell_1;&#125;elseif ($this-&gt;moveDown())&#123; $this-&gt;currentCell = $cell_7;&#125;elseif ($this-&gt;moveRight())&#123; $this-&gt;currentCell = $cell_5;&#125;elseif ($this-&gt;moveLeft())&#123; $this-&gt;currentCell = $errorMove;&#125; switchcase  statechart3offon 3 3     :PHP 24ConTextContext3 ConText 1234567891011121314151617181920212223242526272829303132333435363738394041// Context.phpclass Context&#123; private $offState; private $onState; private $currentState; public function __construct() &#123; $this-&gt;offState = new OffState($this); $this-&gt;onState = new OnState($this); // off $this-&gt;currentState = $this-&gt;offState; &#125; //  public function turnOnLight() &#123; $this-&gt;currentState-&gt;turnLightOn(); &#125; public function turnOffLight() &#123; $this-&gt;currentState-&gt;turnLightOff(); &#125; //  public function setState(IState $state) &#123; $this-&gt;currentState = $state; &#125; //  public function getOnState(): &#123; return $this-&gt;onState; &#125; public function getOffState() &#123; return $this-&gt;offState; &#125;&#125; ConText3(private): 123$offState$onState$currentState  ConText ContextIState--(off)(on): 12$this-&gt;offState = new OffState($this);$this-&gt;onState = new OnState($this); (self-referral)$thisContextConTextConText$this $currentState$offState()offState3off :Context(triggers): 1234public function turnOnLight()&#123; $this-&gt;currentState-&gt;turnLightOn();&#125;  context:turnOnLightturnLightOnContext Context2986 ()9 ContextContext: 1234public function setState(IState $state)&#123; $this-&gt;currentState = $state;&#125; setState()(IState)ContextsetState()  contextcontextOffState:. 1234public function getOffState()&#123; return $this-&gt;offState;&#125; OnState: 1234public function getOnState()&#123; return $this-&gt;onState;&#125;  ContextContextContextContext IstateContext: 123456//IState.phpinterface IState&#123; public function turnLightOn(); public function turnLightOff();&#125; Context: OnStateOffState. OnState1234567891011121314151617181920// OnState.phpclass OnState implements IState&#123; private $context; public function __construct(Context $contextNow) &#123; $this-&gt;context = $contextNow; &#125; public function turnLightOn() &#123; echo "Light is already on-&gt; take no action&lt;br/&gt;"; &#125; public function turnLightOff() &#123; echo "Lights off!&lt;br/&gt;"; $this-&gt;context-&gt;setState($this-&gt;context-&gt;getOffState()); &#125;&#125; OffState12345678910111213141516171819// OffState.phpclass OffState implements IState&#123; private $context; public function __construct(Context $contextNow) $this-&gt;context = $contextNow; &#125; public function turnLightOn() &#123; echo "Lights on! Now I can see &lt;br/&gt;"; $this-&gt;context-&gt;setState($this-&gt;context-&gt;getOnState()); &#125; public function turnLightOff() &#123; echo "Light is already off-&gt; take no action&lt;br/&gt;"; &#125;&#125; OnStateOffStateIStateContextContext OffStateIStateturnLightOnturnLightOffContextturnLightOnLights on! Now I can see ()ContextgetOnStateOnStateOffStateturnLightOffContext 293263null ClientContext ClientIStateClient: 12345678910111213141516171819// Client.phpfunction __autoload($class_name)&#123; include $class_name . '.php';&#125;class Client&#123; private $context; public function __construct() &#123; $this-&gt;context = new Context(); $this-&gt;context-&gt;turnOnLight(); $this-&gt;context-&gt;turnOnLight(); $this-&gt;context-&gt;turnOffLight(); $this-&gt;context-&gt;turnOffLight(); &#125;&#125;$worker = new Client(); Context(off): 1234Lights on! Now I can see!Light is already on-&gt; take no actionLights off!Light is already off-&gt; take no action OffStateOnState(off-&gt;on)(off-&gt;off) :(on/off) on/off34: (Off) (On) (Brighter) (Brightest) 44 4(off)(on)onoffon(brighter)(brightest)brightest(off) IStatebrighterbrightest: 12345678// IState.phpinterface IState&#123; public function turnLightOff(); public function turnLightOn(); public function turnBrighter(); public function turnBrightest();&#125; 4Context (nada.png)  OffState1234567891011121314151617181920212223242526272829// OffState.phpclass OffState implements IState&#123; private $context; public function __construct(Context $contextNow) &#123; $this-&gt;context = $contextNow; &#125; public function turnLightOn() &#123; echo "&lt;img src='lights/on.png'&gt;"; $this-&gt;context-&gt;setState($this-&gt;context-&gt;getOnState()); &#125; public function turnBrighter() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnBrightest() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnLightOff() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125;&#125; OnState1234567891011121314151617181920212223242526272829// OnState.phpclass OnState implements IState&#123; private $context; public function __construct(Context $contextNow) &#123; $this-&gt;context = $contextNow; &#125; public function turnLightOn() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnBrighter() &#123; echo "&lt;img src='lights/brighter.png'&gt;"; $this-&gt;context-&gt;setState($this-&gt;context-&gt;getBrighterState()); &#125; public function turnBrightest() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnLightOff() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125;&#125; BrighterState1234567891011121314151617181920212223242526272829// BrighterState.phpclass BrighterState implements IState&#123; private $context; public function __construct(Context $contextNow) &#123; $this-&gt;context = $contextNow; &#125; public function turnLightOn() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnBrighter() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnBrightest() &#123; echo "&lt;img src='lights/brightest.png'&gt;"; $this-&gt;context-&gt;setState($this-&gt;context-&gt;getBrightestState()); &#125; public function turnLightOff() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125;&#125; BrightestState1234567891011121314151617181920212223242526272829// BrightestState.phpclass BrighterState implements IState&#123; private $context; public function __construct(Context $contextNow) &#123; $this-&gt;context = $contextNow; &#125; public function turnLightOn() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnBrighter() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnBrightest() &#123; echo "&lt;img src='lights/nada.png'&gt;"; &#125; public function turnLightOff() &#123; echo "&lt;img src='lights/off.png'&gt;"; $this-&gt;context-&gt;setState($this-&gt;context-&gt;getOffState()); &#125;&#125; (brighterbrightest) ContextContextContext: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071&lt;?php// Context.phpclass Context&#123; private $offState; private $onState; private $brighterState; private $brightestState; private $currentState; public function __construct() &#123; $this-&gt;offState = new OffState($this); $this-&gt;onState = new OnState($this); $this-&gt;brighterState = new BrighterState($this); $this-&gt;brightestState = new BrightestState($this); // Off $this-&gt;currentState = $this-&gt;offState; &#125; // public function turnOnLight() &#123; $this-&gt;currentState-&gt;turnLightOn(); &#125; public function turnoffLight() &#123; $this-&gt;currentState-&gt;turnLightOff(); &#125; public function turnBrighterLight() &#123; $this-&gt;currentState-&gt;turnBrighter(): &#125; public function turnBrightestLight() &#123; $this-&gt;currentState-&gt;turnBrightest(); &#125; // public function setState(IState $state) &#123; $this-&gt;currentState = $state; &#125; // public function getOnState() &#123; return $this-&gt;onState; &#125; public function getOffState() &#123; return $this-&gt;offState; &#125; public function getBrighterState() &#123; return $this-&gt;brighterState; &#125; public function getBrightestState() &#123; return $this-&gt;brightestState; &#125;&#125;?&gt; Context  ClientonoffClientoffononbrighterbrightestoff: 12345678910111213141516171819202122// Client.phpfunction __autoload($class_name)&#123; include $class_name . '.php'; &#125;class Client&#123; private $context; public function __construct() &#123; $this-&gt;context = new Context(); $this-&gt;context-&gt;turnOnLight(); $this-&gt;context-&gt;turnBrighterLight(); $this-&gt;context-&gt;turnBrightestLight(); $this-&gt;context-&gt;turnOffLight(); $this-&gt;context-&gt;turnBrightestLight(); &#125;&#125;$worker = new Client(); ClientonoffClientbrightest5 4onbrighterbrightestoff5() 93 x3,() ,9IMatrix4,(onbrightes) ,,, PHP,,,()PHPPHP,FacebookWordPress,Grady Booch (http:libm.colyCL6se), Facebook,(),,PHP,,PHP,]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag>Learning PHP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2018%2F11%2F26%2FMySQL%E9%94%81%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[ InnoDB MyISAMInnoDB MySQL for update InnoDB  lock tables account read; low_priority writeMySQLA MySQLMySQL MySQLAMySQLBSQLselect * from account; MySQLAMySQLBMySQLAMySQLAMySQLB1 1   update2 1update account set balance = balance + 800 where account_no = 2; 2  1account_no=2 2old 3oldbalancenew 4newupdate update14SQL: MySQLMySQL MySQLserver-level lockingstorage-engine-level locking MySQLMySQLflush tables with read lock;MySQL  MySQLAMySQLflush tables with read lock;MySQLMySQLAinsertupdatedeletecreate 1ERROR 1223HY000: Can't execute the query because you have a conflicting read lock MySQLMySQLBinsertupdatedeletecreate MySQLAunlock tables;MySQLAMySQLBMySQLBMySQLAMySQLA MySQLAMySQLMySQLBtest viewMySQLAtest viewERROR 1223MySQLAMySQLBtest view3MySQLAMySQLAMySQLB 3  MyISAMInnoDBMyISAMInnoDBInnoDB InnoDBMyISAM InnoDBInnoDB MySQLMySQL  read lockwrite lock read lockMySQLAMySQLMySQLBMySQLMySQLCMySQLAMySQLMySQL4 4  write lockMySQLAMySQLMySQLBMySQLAMySQLMySQL5 5  MySQLMySQLAMySQLAMySQLA MySQL  MyISAMMyISAMselectselectMyISAMMyISAMselectMyISAMselect MyISAMinsertupdatedeleteinsertupdatedeleteMyISAMMyISAMMyISAM MyISAM MyISAMMySQLMySQLMyISAMMySQLAMySQL6 6   1MyISAMInnoDBInnoDBInnoDB 2readwriteMySQLAMySQLB MySQLAMySQLAMySQLB MySQLAMySQLAMySQLBMySQLB1 1  3MySQLAlock tablesMySQLAMySQLAMySQLaccountbook7 123456alter table account engine=MyISAM;alter table book engine=MyISAM;lock tables account read;select * from account; select * from book;unlock tables; 7 1 4 MySQLaccountMyISAMaccountaccountaaccountbaccountaaccountbaccountaccountaccountaccount8 123456alter table account engine=MyISAM;lock tables account as a readaccount as b write;select * from account as a;select * from account as b;select * from account; unlock tables; 8 2  5read localreadMySQLAreadMyISAMMySQLAMySQLBMySQLAread localMyISAMMySQLBInnoDBread localread 1read localread MySQLAMySQLaccountlocal 12alter table account engine=MyISAM;lock tables account read local; MySQLBMySQLBinsertaccount9MySQLAaccountlocalMySQLBaccountlocalMyISAM 1insert into account valuesnull '' 1000; 9 read local MySQLAMySQLaccount 1unlock tables; 6MySQLA MySQLBMySQLCZMySQLB.Zlow_priority writeMySQLA 7unlock tablesMySQLMyISAM 8lock tablesunlock tables 9MySQL unlock tablesMySQL InnoDBInnoDBMyISAMInnoDBlock tablesInnoDBlock tablesMyISAMInnoDB InnoDBSXInnoDBselect insertupdatedelete 1select select * from  where  lock in share mode; 2select select * from  where  for update; 3insertupdatedeleteInnoDBInnoDB 1233 2 1MySQLAMySQLstudent 123use choose;start transaction;select * from student for update; 2MySQLB MySQLBMySQLstudentMySQLB 123use choose;start transaction;select * from student for update; 3MySQLAMySQLstudentMySQLAstudentMySQLB  1commit; MySQLAstudent SX MySQLAselect * from  where  lock in share mode;InnoDBMySQLAMySQLB MySQLAselect * from  where  for update;insertupdatedeleteInnoDBMySQLAMySQLB 2 2  3replace_course_proc()available1replace_course_proc()selectavailable 1select available into s from course where course_no=c_after; available110 10 replace_course_proc() replace_course_proc()availableavailablereplace_course_proc(): 1select available into s from course where course_no=c after;  1select available into s from course where course_no=c_after for update; selectstart transaction 11 11 replace_course_proc() choose_proc()choose_proc() 12345678910111213141516171819202122232425262728293031323334drop procedure choose_proc;delimiter $$create procedure choose_proc(in s_no char(11),in c_no int,out state int)modifies sql databegin declare s1 int; declare s2 int; declare s3 int; declare status char(8); set state= 0; set status=''; select count(*) into s1 from choose where student_no=s_no and course_no=c_no ; if(s1&gt;=1) then set state = -1; else select count(*) into s2 from choose where student_no=s_no; if(s2&gt;=2) then set state = -2; else start transaction; select state into status from course where course_no=c_no; select available into s3 from course where course_no=c_no for update; if(s3=0 || status='') then set state = -3; else insert into choose values(null,s_no,c_no,null,now()); set state = last_insert_id(); end if; commit; end if; end if;end$$delimiter ; InnoDBInnoDBMySQLAInnoDBMySQLBlock tablesMySQLB MySQLAMySQLAMySQLB12 12 InnoDB InnoDBInnoDBMySQLISIX ISInnoDBInnoDBISselect * from  where  lock in share mode;InnoDBInnoDBIS IXInnoDBInnoDBIXinsertupdatedeleteselect * from  where  for update;InnoDBInnoDBIX  selectlock in share modeselect InnoDBMySQL3 3  InnoDBInnoDBInnoDBInnoDB 4InnoDB 1MySQLAMySQLAMySQLaccountInnoDBMySQL13 123alter table account engine=InnoDB;set autocommit=0;select * from account where account_name='' for update; 13  2MySQLBMySQLBMySQLMySQL14MySQLBMySQLB 12set autocommit=0;select * from account where account_name='' for update; 14  MySQLAMySQLB InnoDB InnoDB MySQLshow variables like innodb_lock_wait_timeout;InnoDB5015InnoDBinnodb_lock_wait_timeoutInnoDB1415  3MySQLAMySQLshow full processlist\GMySQLMySQL16 16 MySQLMySQL IdMySQLMySQL UserMySQL HostSQLMySQLMySQL dbMySQL Command sleepqueryconnectSleepMySQL Timetime=4848 Stateinitupdatesleepsending datawaiting forlockWaiting for table metadata lockMySQL;sending dataMySQLsending data48 InfoSQLSQL 4MySQLkill 49;1649MySQL InnoDB SQLaccountaccount_nameaccount_name_indexMySQLAMySQLBInnoDB 1alter table account add index account_name_index(account_name); InnoDBInnoDBaccount_no between 1 and 100account_no=1account_no=2account_no=50  account_no=100 next-key lockingnext-key repeatable readMySQLInnoDBread uncommittedread committedInnoDBrecord lock explainexplainselectupdatedeleteselect MySQL 5MySQLrepeatable readMySQLAMySQLBMySQLAMySQLBMySQLAMySQLB 1MySQLASQLaccountInnoDBaccountaccount_no=2017accountaccount_no=20 123alter table account engine=InnoDB;start transaction;select * from account where account_no=20 lock in share mode; 17 account_no=201 2MySQLBSQLaccountaccount_no=2018accountaccount_no=20 12start transaction;select * from account where account_no=20 lock in share mode; 18 account_no=202 3MySQLAaccountaccount_no=20MySQLAinsertaccountaccount_no=20insert 1insert into account values(20,'',5000); 4MySQLBaccountaccount_no=20MySQLBinsertaccountaccount_no=20insert19 1insert into account values(20,'',6000); 19  InnoDBinformation_schema INNODB_TRXtrx_weight 5MySQLAMySQLAinsert20insert 20 MySQLA 6MySQLAcommitinsertselectaccount21 21 account MyISAMMyISAMSQLInnoDBSQLInnoDB  6accountInnoDBMySQLAaccount_no=11000MySQLBaccount_no=2500MySQLAMySQLBtransfer_proc()22transfer_proc()  22  3MySQLA9-394MySQLBMySQLA5MySQLBMySQLB6MySQLB6update 1ERROR 1213 (40001)Deadlock found when trying to get lock; try restarting transaction 23 23  InnoDBMySQLtransfer_proc()transfer_proc() 123456789101112131415161718192021drop procedure transfer_proc;delimiter $$create procedure transfer_proc(in from_account int,in to_account int,in money int)modifies sql databegindeclare continue handler for 1690begin rollback;end;declare continue handler for 1213begin rollback;end;start transaction;update account set balance=balance+money where account_no=to_account;update account set balance=balance-money where account_no=from_account;commit;end$$delimiter ; InnoDBInnoDBinnodb_lock_wait_timeoutinnodb_lock_wait_timeout  InnoDBInnoDB]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2018%2F11%2F25%2FMySQL%E4%BA%8B%E5%8A%A1%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[   updateinsertdelete  1accountbalance 1accountInnoDBaccount_noMySQLaccount_namebalance 12345create table account( account_no int auto_increment primary key, account_name char(10) not null, balance int unsigned) ENGINE=innodb; 2SQLaccount1000 123insert into account values(null,'',1000);insert into account values(null,'',1000); 3MySQLtransfer_proc()from_accountmoneyto_account 123456789101112delimiter $$ create procedure transfer_proc(in from_account int,in to_account int,in money int) modifies sql data begin update account set balance=balance+money where account_no=to_account; update account set balance=balance-money where account_no=from_account; end$$delimiter ; 4MySQLtransfer_proc()8009-12000 123call transfer_proc(1,2,800);select * from account; 5transfer_proc()8002008001690 1234561690 - BIGINT UNSIGNED value is out of range in &apos;(`test`.`account`.`balance` - money@2``` ```sqlcall transfer_proc(1,2,800);select * from account; account_no | account_name | balance | :-: | -:1 |  | 2002 |  | 2600 80020002800 transfer_proc()updateupdate MySQLMySQLauto_incrementMySQLMySQL transfer_proc()updateupdateupdateMySQLupdateupdateupdateupdateMySQL MySQLcommitrollback  MySQLshow variables like autocommit;MySQL@@autocommitON1MySQLMySQL@@autocommit OFF0MySQLMySQLset autocommit=0;MySQL  @@autocommitMySQLAMySQLB MySQLstart transaction;@@autocommit MyISAM MySQL 212002600MySQLAMySQLMySQLMySQLaccount_no=2800 1234set autocommit=0;update account set balance=balance+800 where account_no=2;select * from account; account_no | account_name | balance | :-: | -:1 |  | 2002 |  | 3400 26003400MySQLBchooseselect 123use choose;select * from account; account_no | account_name | balance | :-: | -:1 |  | 2002 |  | 2600 MySQLB2600800MySQLAupdatenewMySQLAselect3400MySQLnewMySQLBselect26002600 MySQLA34 32MySQLAMySQLrollback;MySQLAMySQLBselect2600account_no | account_name | balance | :-: | -:1 |  | 2002 |  | 2600MySQLAMySQLMySQLAMySQLnewMySQLArollbackMySQLMySQLAnewMySQLA  insertnewdeleteoldupdatenewold MySQLMySQLMySQLMySQLcommit; MySQLMySQLbeginset autocommit=1start transactionrename tabletruncate tablecreatealterdropcreate databasecreate tablecreate indexcreate functioncreate procedurealter tablealter functionalter proceduredrop databasedrop tabledrop functiondrop indexdrop proceduregrantrevokeset passwordcreate userdrop userrename userlock tablesunlock tablesMySQLAMySQLMySQLAcreate table test_commit(a int primary key);test_commit  42MySQLAMySQLcommit;MySQLAMySQLBselect8003400,MySQLAcommit, MySQLnew, MySQL,,MySQLnew,,new ,,,InnoDB MySQLstart transaction;,,MySQLcommit;rollback 5:update,update,update, MySQL,transfer_proc(),ransfer_proc(),, declare continue handler for 1690MysQL1690,,; start transaction,;commit 12345678910111213141516drop procedure transfer_proc;delimiter $$create procedure transfer_proc (in from_account int,in to_account int,in money int) modifies sql data begin declare continue handler for 1690 begin rollback; end; start transaction; update account set balance=balance+money where account_no=to_account; update account set balance=balance-money where account_no=from_account; commit;end$$delimiter ; balance() ,transfer_proc(),(rollback) , InnoDB,,,,:,if-elsethenelse, ,MySQLset autocommit=0;MySQL,start transaction;,,MySQL,start transaction;@@autocommit ,,,,()MySQLsavepoint ;,MySQLrollback to savepoint ;,,B 6:,save_point1_proc()save_point2_proc()account_no,,insertMySQL1062,MySQL1062 :MySQLsave_point1_proc(),insert 12345678910111213141516delimiter $$ create procedure save_point1_proc()modifies sql data begin declare continue handler for 1062 begin rollback to B; rollback; end; start transaction; insert into account values(null,'', 1000); savepoint B; insert into account values(last_insert_id(),'', 1000); commit; end$$delimiter ;  save_point1_proc(),,insertlast_insert_id()insert(ERROR 1062:) ,insert,B(rollback to B) ,(rollback)save_point1_proc(),account,insert 12call save_point1_proc();select * from account; mysql&gt; call save_point1_proc();Query OK, 0 rows affected (0.03 sec) mysql&gt; select * from account;account_no | account_name | balance | :-: | -:1 |  | 2002 |  | 34002 rows in set (0.08 sec) :MySQLsave_point2_proc(),insert,insert 12345678910111213141516delimiter $$create procedure save_point2_proc()modifies sql data begin declare continue handler for 1062 begin rollback to B; commit; end; start transaction; insert into account values(null,'', 1000); savepoint B; insert into account values(last_insert_id(),'', 1000); commit; end$$delimiter ; save_point2_proc(),insert,B(rollback to B),(commit),insert, save_point2_proc(),account,insert,insert 12call save_point2_proc();select * from account; mysql&gt; call save_point2_proc();Query OK, 0 rows affected (0.02 sec) mysql&gt; select * from account;++++| account_no | account_name | balance |++++| 1 |  | 200 || 2 |  | 3400 || 4 |  | 1000 |++++3 rows in set (0.06 sec)rollback to savepoint BB ,B,,rollback(rollback to savepoint B) ,commit MySQLrelease savepoint ;,: ERROR 1305 (42000): SAVEPOINT does not exist, ,,choose proc),replace course-proco, 7:,9-13(, c before, c after),,,,state-1;1,,available0 () ,state-2;,statecourse no3update,, SQLreplace course proc),(s no)(c before)(c after),,statestate0,;state-1,;state-2, 1234567delimiter $$create procedure replace course proc(in s no char(11),in c before int,in c after int,out state int)modifies sql databegindeclare s int;declare status char(8);set state =0;set status="";if(c before=c after) thenset state =-1;elsestart transactionselect state into status from course where course no=c after;select available into s from course where course no-c after;if(s=0 1l status=) therset state =-2:elseif(state=0) therupdate choose set course no-c after,choose time-now0) where student no=s no andcourse no=c before;update course set available-available+1 where course no-c beforeupdate course set available=available-1 where course no=c after;set state =c after;end if;commit;end if;end$:delimiter; MySQLreplace-course-proc),select2012002,9-14select * from choose where student no=2012002; 3,1,MySQL,9-15set @s no =2012002;set @c before =3;set @c after =1;set @state =0;call replace course proc(@s no,@c before,@c after,@state);select @stateselect2012002,,9-16select * from choose where student no=2012002;  chooseprococourseavailableInnoDB,,choose proc)insertinsert replace course proc),3update,3update,, ,(insert, deleteupdate),,replace course proc),selectavailable ,select,]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL]]></title>
    <url>%2F2018%2F11%2F24%2FMySQL%E7%9A%84%E7%B4%A2%E5%BC%95%2F</url>
    <content type="text"><![CDATA[ MySQL      1  2MySQL MySQL 3  4 6-&gt;1488 part 5  6  7 MyISAMMYIInnoDBInnoDBazMyISAMInnoDB 8  MyISAMMySQL primary index MyISAMMYIMYDMYIMYDteacherMyISAMteacher1 1 MyISAMteacher teacherteacher_no InnoDBMyISAMInnoDBInnoDB2 2 InnoDBteacher MySQLMySQL MySQLInnoDB  InnoDBInnoDBInnoDB InnoDBMySQLsecondary indexbookmark3InnoDB 3 InnoDBteacher  B+btreehash MyISAMPackedPackedherhere3, e InnoDBInnoDB 9 btreeSQLselectSQL 10  MySQL1MySQL   I/O  1 Cardinality2   CardinalityMySQLMySQLprimary indexPRIMARYMySQLunique index 2  3 textchar 4where selectselectselect12selectselectwheregroup byorder byMySQL 5where 6 leftmost prefixingfirstnamelastnameaddressfname_lname_addresswhereMySQLfname_lname_addressfname_lname_address firstname lastname addressfirstname lastnamefirstname firstnamelastnameaddressfirstnamelastnameagefirstnamelastnamefirstname fname_lname_addressfirst_name 7   MySQL  MySQLPRIMARY MySQL]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[PHP(DI)(IoC)]]></title>
    <url>%2F2018%2F07%2F17%2FPHP%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5-DI-%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC-IoC%2F</url>
    <content type="text"><![CDATA[       ACIoC/DICA IoC/DIIoC/DI  IoC - Inversion of Control  DI - Dependency Injection           IoC/DI PHP IoC/DIIoC/DI   IoC/DI  IoC/DI  IoC/DI    IoC/DI     ACCAC$c = new C();ACIoC/DICA IoC/DIAC  1234567891011121314151617181920212223242526272829303132333435&lt;?php/** * IoC/DIAC *//** * Class c */class C&#123; public function say() &#123; echo 'hello'; &#125;&#125;/** * Class A */class A&#123; private $c; public function __construct() &#123; $this-&gt;c = new C(); // C &#125; public function sayC() &#123; echo $this-&gt;c-&gt;say(); // C &#125;&#125;$a = new A();$a-&gt;sayC(); IoC/DIAC IoC/DICA  1234567891011121314151617181920212223242526272829303132333435363738&lt;?php/** * IoC/DIAC *//** * Class C */class C&#123; public function say() &#123; echo 'hello'; &#125;&#125;/** * Class A */class A&#123; private $c; public function setC(C $c) &#123; $this-&gt;c = $c; // C &#125; public function sayC() &#123; echo $this-&gt;c-&gt;say(); // C &#125;&#125;$c = new C();$a = new A();$a-&gt;setC($c); // set$cCA$a-&gt;sayC();  $c = new C();   IoC/DIIoC/DIIoC/DI PHP]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[14-]]></title>
    <url>%2F2018%2F07%2F15%2F%E7%AC%AC14%E7%AB%A0-%E5%AF%B9%E4%BB%98%E7%A9%BA%E9%97%B4%E9%99%90%E5%88%B6%2F</url>
    <content type="text"><![CDATA[   O     OO ONO(N)NNO(N2)NN2 ON JavaScript[amy, bob, cindy, derek] [AMY, BOB, CINDY, DEREK]  123456789function makeUpperCase(array) &#123; var newArray = []; for(var i = 0; i &lt; array.length; i++) &#123; newArray[i] = array[i].toUpperCase(); &#125; return newArray;&#125; makeUpperCasearraynewArrayarray array[amy, bob,cindy, derek]newArray [AMY, BOB, CINDY, DEREK]  NN makeUpperCaseO(N)  O(N) makeUpperCase 12345678function makeUpperCase(array) &#123; for(var i = 0; i &lt; array.length; i++) &#123; array[i] = array[i].toUpperCase(); &#125; return array;&#125; arrayarray O(1)O(1)O(1) array4100makeUpperCaseO(1) arrayNO(1)  makeUpperCase     1 O(N) O(N) 2 O(N) O(1) NNO(N)O(1)O(N)  4JavaScript 1234567891011121314function hasDuplicateValue(array) &#123; for(var i = 0; i &lt; array.length; i++) &#123; for(var j = 0; j &lt; array.length; j++) &#123; if(i !== j &amp;&amp; array[i] == array[j]) &#123; return true; &#125; &#125; &#125; return false;&#125; O(N2)  1234567891011121314151617function hasDuplicateValue(array) &#123; var existingNumbers = []; for(var i = 0; i &lt; array.length; i++) &#123; if(existingNumbers[array[i]] === undefined) &#123; existingNumbers[array[i]] = 1; &#125; else &#123; return true; &#125; &#125; return false;&#125; existingNumbersarrayexistingNumbers 11 O(N2)O(N)  O(1)O(N) hasDuplicateValue     1 O(N2) O(1) 2 O(N) O(N)    O  ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[13-]]></title>
    <url>%2F2018%2F07%2F14%2F%E7%AC%AC13%E7%AB%A0-%E8%BF%9E%E6%8E%A5%E4%B8%87%E7%89%A9%E7%9A%84%E5%9B%BE%2F</url>
    <content type="text"><![CDATA[       a  Neo4j      Dijkstra FacebookAliceBobBobAlice   123456789relationships = [ ["Alice", "Bob"], ["Bob", "Cynthia"], ["Alice", "Diana"], ["Bob", "Diana"], ["Elise", "Fred"], ["Diana", "Fred"], ["Fred", "Alice"]] AliceAliceBobDianaFred AliceO(N) O(1)Alice  Facebook  Ruby 12345678friends = &#123; "Alice" =&gt; ["Bob", "Diana", "Fred"], "Bob" =&gt; ["Alice", "Cynthia", "Diana"], "Cynthia" =&gt; ["Bob"], "Diana" =&gt; ["Alice", "Bob", "Fred"], "Elise" =&gt; ["Fred"], "Fred" =&gt; ["Alice", "Diana", "Elise"]&#125; 1AliceO(1) 1friends["Alice"] FacebookTwitterAliceBobBobAlice AliceBobCynthiaAliceBobCynthia  12345followees = &#123; "Alice" =&gt; ["Bob", "Cynthia"], "Bob" =&gt; ["Cynthia"], "Cynthia" =&gt; ["Bob"]&#125; FacebookTwitterTwitterFacebook  Ruby 123456789101112class Person attr_accessor :name, :friends def initialize(name) @name = name @friends = [] end def add_friend(friend) @friends &lt;&lt; friend #  endend 12345678910111213141516class Person &#123; private $name; private $friends; function __construct($name) &#123; $this-&gt;name = $name; $this-&gt;friends = []; &#125; public function add_friend($friend) &#123; $this-&gt;friends[] = $friend; &#125;&#125; Ruby 1234mary = Person.new("Mary")peter = Person.new("Peter")mary.add_friend(peter)peter.add_friend(mary) 12345$mary = new Person('Mary');$peter = new Person('Peter');$mary-&gt;add_friend($peter);$peter-&gt;add_friend($mary); LinkedInLinkedIn AliceBobBobCynthiaAliceCynthiaBobCynthiaAlice Alice  Alice [Alice] Alice 3 (1) (2)  (3)  AliceLinkedIn AliceAlice--Bob Bob[Bob]BobAliceBob AliceCandy [Bob, Candy]  AliceDerek [Bob, Candy, Derek]  AliceElaine [Bob, Candy, Derek, Elaine]  Alice28Bob [Candy, Derek, Elaine]Bob 1BobFred [Candy, Derek, Elaine, Fred] Bob--Candy-- Candy--Derek--[Elaine, Fred] DerekGina [Elaine, Fred, Gina] DerekElaine ElaineFred [Gina] Fred--Helen--[Gina, Helen] FredGina [Helen] Gina--Irena [Helen, Irena] GinaHelen[Irena]HelenIrenaIrena Persondisplay_network 123456789101112131415161718192021222324252627282930313233343536373839class Person attr_accessor :name, :friends, :visited # visited def initialize(name) @name = name @friends = [] @visited = false end def add_friend(friend) @friends &lt;&lt; friend end def display_network #  visited  false to_reset = [self] #  queue = [self] self.visited = true while queue.any? #  current_vertex = queue.shift puts current_vertex.name #  current_vertex.friends.each do |friend| if !friend.visited to_reset &lt;&lt; friend queue &lt;&lt; friend friend.visited = true end end end #  visited  false to_reset.each do |node| node.visited = false end endend 12345678910111213141516171819202122232425262728293031323334353637383940414243444546class Person &#123; private $name; private $friends; private $visited ; function __construct($name) &#123; $this-&gt;name = $name; $this-&gt;friends = []; $this-&gt;visited = false; &#125; public function add_friend($friend) &#123; $this-&gt;friends[] = $friend; &#125; public function display_network() &#123; $to_reset = [$this]; $queue = [$this]; $this-&gt;visited = true; while (!empty($queue)) &#123; $current_vertex = array_shift($queue); echo $current_vertex-&gt;name; foreach ($current_vertex-&gt;friends as $friend) &#123; if ($friend-&gt;visited == false) &#123; $to_reset[] = $friend; $queue[] = $friend; $friend-&gt;visited = true; &#125; &#125; &#125; foreach ($to_reset as $node) &#123; $node-&gt;visited = false; &#125; &#125;&#125; Personvisited    OO(V)VV NO(N)  Bob  123456current_vertex.friends.each do |friend| if !friend.visited queue &lt;&lt; friend friend.visited = true endend 12345678foreach ($current_vertex-&gt;friends as $friend) &#123; if ($friend-&gt;visited == false) &#123; $queue[] = $friend; $friend-&gt;visited = true; &#125;&#125; BobFredAliceeach  E2EOO(E) O(V)O(E)O(V + E)  5AliceBobCindyDennisEthel --Users Friendships Friendshipsid CindyAliceBobDennisEthel UserCindyid Friendshipsuser_id3 Cindyid[1, 2, 4, 5] idUsersidUsersO(log N)idid Cindy44O(log N)MO(M log N)log N CindyCindy4 NO(N)O(M log N) Neo4jArangoDBApache Giraph    ChicagoNew York City714 DallasToronto138TorontoDallas216 RubyCity 12345678910111213class City attr_accessor :name, :routes def initialize(name) @name = name #  @routes = &#123;&#125; end def add_route(city, price) @routes[city] = price endend  1234dallas = City.new("Dallas")toronto = City.new("Toronto")dallas.add_route(toronto, 138)toronto.add_route(dallas, 216)  5 AtlantaEl PasoAtlantaDenverDenverEl Paso300AtlantaDenverChicagoElPaso280 AtlantaEl Paso DijkstraEdsger Dijkstra1959Dijkstra Dijkstra (1) (2) (3) (4)3  Atlanta Atlanta Boston Chicago Denver El Paso     Atlanta AtlantaAtlantaBoston100AtlantaDenver160 Atlanta Boston Chicago Denver El Paso 100  160  AtlantaAtlantaBostonDenverBoston100Denver160Boston BostonAtlantaBostonChicago120AtlantaBoston100BostonChicago120AtlantaChicago220 Atlanta Boston Chicago Denver El Paso 100 220 160  Boston--Denver--180AtlantaDenverAtlantaBostonDenver280AtlantaDenver160 BostonAtlantaBostonDenver220Chicago160Denver DenverDenverChicago40AtlantaChicagoAtlantaChicago220Denver200 Atlanta Boston Chicago Denver El Paso 100 200 160  DenverEl PasoAtlantaEl PasoAtlantaDenverEl Paso300 Atlanta Boston Chicago Denver El Paso 100 200 160 300 ChicagoEl PasoAtlantaChicago200AtlantaEl Paso300Chicago Chicago80El PasoAtlantaEl PasoAtlantaDenverChicagoEl Paso280 Atlanta Boston Chicago Denver El Paso 100 200 160 280 El Paso El Paso100BostonAtlanta AtlantaAtlanta Atlanta Boston Chicago Denver El Paso 100 200 160 280 DijkstraRuby Ruby 123456789101112131415class City attr_accessor :name, :routes def initialize(name) @name = name #  @routes = &#123;&#125; #  Atlanta # &#123;boston =&gt; 100, denver =&gt; 160&#125; end def add_route(city, price_info) @routes[city] = price_info endend add_route 123456789101112atlanta = City.new("Atlanta")boston = City.new("Boston")chicago = City.new("Chicago")denver = City.new("Denver")el_paso = City.new("El Paso")atlanta.add_route(boston, 100)atlanta.add_route(denver, 160)boston.add_route(chicago, 120)boston.add_route(denver, 180)chicago.add_route(el_paso, 80)denver.add_route(chicago, 40)denver.add_route(el_paso, 140) Dijkstra 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455def dijkstra(starting_city, other_cities) #  routes_from_city  #  routes_from_city = &#123;&#125; #  # &#123; =&gt; [, ]&#125; #  # &#123;atlanta =&gt; [0, nil], boston =&gt; [100, atlanta], chicago =&gt; [200, denver], # denver =&gt; [160, atlanta], el_paso =&gt; [280, chicago]&#125; #  routes_from_city[starting_city] = [0, staring_city] #  other_cities.each do |city| routes_from_city[city] = [Float::INFINITY, nil] end #  # &#123;atlanta =&gt; [0, nil], boston =&gt; [Float::INFINITY, nil], # chicago =&gt; [Float::INFINITY, nil], # denver =&gt; [Float::INFINITY, nil], el_paso =&gt; [Float::INFINITY, nil]&#125; #  visited_cities = [] #  current_city  current_city = starting_city #  while current_city #  visited_cities &lt;&lt; current_city #  current_city.routes.each do |city, price_info| #  routes_from_city  #  if routes_from_city[city][0] &gt; price_info + routes_from_city[current_city][0] routes_from_city[city] = [price_info + routes_from_city[current_city][0], current_city] end end #  current_city = nil cheapest_route_from_current_city = Float::INFINITY #  routes_from_city.each do |city, price_info| #  #  if price_info[0] &lt; cheapest_route_from_current_city &amp;&amp; !visited_cities.include?(city) cheapest_route_from_current_city = price_info[0] current_city = city end end end return routes_from_cityend  1234routes = dijkstra(atlanta, [boston, chicago, denver, el_paso])routes.each do |city, price_info|p "#&#123;city.name&#125;: #&#123;price_info[0]&#125;"end GPSDijkstra   ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[12-]]></title>
    <url>%2F2018%2F06%2F13%2F%E7%AC%AC12%E7%AB%A0-%E8%AE%A9%E4%B8%80%E5%88%87%E6%93%8D%E4%BD%9C%E9%83%BD%E6%9B%B4%E5%BF%AB%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91%2F</url>
    <content type="text"><![CDATA[    O(log N)       O(log N)  NN/2O(N)O(N) O(1)       j jmbmbjmqzqzm 3 -- 012      Python 12345class TreeNode: def __init__(self,val,left=None,right=None): self.value = val self.leftChild = left self.rightChild = right  123node = TreeNode(1)node2 = TreeNode(10)root = TreeNode(5, node, node2)    (1) (2) (3) (4) Python 12345678910111213def search(value, node): #  node  #  node  if node is None or node.value == value: return node #  value  elif value &lt; node.value: return search(value, node.leftChild) #  value  else: # value &gt; node.value return search(value, node.rightChild) 61   6150 7561617575  61 56 56 614 O(log N) O(log N)  45 45 4550 4525 453333  454040 5411log N+1OO(log N) O(N) O(log N)O(N)O(log N) Pythonsearch 12345678910111213def insert(value, node): if value &lt; node.value: #  if node.leftChild is None: node.leftChild = TreeNode(value) else: insert(value, node.leftChild) elif value &gt; node.value: #  if node.rightChild is None: node.rightChild = TreeNode(value) else: insert(value, node.rightChild) 12345 5O(N) 32415  O(N)O(log N)O(log N) 4  10 1011111110    56 5261 56  56615661      52  52 5255    5555615561       Python 12345678910111213141516171819202122232425262728293031323334353637383940414243444546def delete(valueToDelete, node): #  if node is None: return None #  #  #  elif valueToDelete &lt; node.value: node.leftChild = delete(valueToDelete, node.leftChild) #  #  return node elif valueToDelete &gt; node.value: node.rightChild = delete(valueToDelete, node.rightChild) return node #  elif valueToDelete == node.value: #  #  if node.leftChild is None: return node.rightChild #  None elif node.rightChild is None: return node.leftChild #  lift  #  else: node.rightChild = lift(node.rightChild, node) return node def lift(node, nodeToDelete): #  #  if node.leftChild: node.leftChild = lift(node.leftChild, nodeToDelete) return node #  #  else: nodeToDelete.value = node.value #  return node.rightChild O(log N)O(N) O(log N)          traverse (1) traverse(2) (3) traverse traverse Moby Dicktraverse O(N) Pythontraverse_and_print 123456def traverse_and_print(node): if node is None: return traverse_and_print(node.leftChild) print(node.value) traverse_and_print(node.rightChild)  B2-3-4 --]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[11-]]></title>
    <url>%2F2018%2F06%2F12%2F%E7%AC%AC11%E7%AB%A0-%E5%9F%BA%E4%BA%8E%E7%BB%93%E7%82%B9%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%2F</url>
    <content type="text"><![CDATA[                    --     4--1000--41004     4abcd2null8 1223  RubyNodeLinkedList Node 12345678class Node # data,next_node attr_accessor :data, :next_node def initialize(data) @data = data endend Nodedatanext_node 1234567node_1 = Node.new("once")node_2 = Node.new("upon")node_1.next_node = node_2node_3 = Node.new("a")node_2.next_node = node_3node_4 = Node.new("time")node_3.next_node = node_4 4onceuponatime4 NodeLinkedListLinkedList 12345678class LinkedList attr_accessor :first_node def initialize(first_node) @first_node = first_node endend  1list = LinkedList.new(node_1) LinkedList  O(1) 212301122 LinkedList 12345678910111213141516171819202122232425class LinkedList attr_accessor :first_node def initialize(first_node) @first_node = first_node end def read(index) #  current_node = first_node current_index = 0 while current_index &lt; index do #  current_node = current_node.next_node current_index += 1 #  #  nil return nil unless current_node end return current_node.data endend  1list.read(3) NOO(N)O(1) O(N)  12345678910111213141516171819202122232425class LinkedList attr_accessor :first_node #  def index_of(value) #  current_node = first_node current_index = 0 begin #  if current_node.data == value return current_index end #  current_node = current_node.next_node current_index += 1 end while current_node #  nil return nil endend  1list.index_of("time") 0O(N)O(1)  yellowblue  1 2bluegreenpurplebluepurple1 1blue1O(N) 11  1 purple35431 O(N)                 LinkedList 12345678910111213141516171819202122232425262728class LinkedListattr_accessor :first_node #  def insert_at_index(index, value) #  new_node = Node.new(value) #  next_node  first_node #  first_node if index == 0 new_node.next_node = first_node return @first_node = new_node end current_node = first_node current_index = 0 #  prev_index = index - 1 while current_index &lt; prev_index do current_node = current_node.next_node current_index += 1 end new_node.next_node = current_node.next_node #  current_node.next_node = new_node endend 1first_node onceuponatimeonceupon 1list.first_node = node_2 O(N) 1--null N                  2purple1green LinkedList 12345678910111213141516171819202122232425262728293031class LinkedList attr_accessor :first_node #  def delete_at_index(index) #  #  first_node  #  if index == 0 deleted_node = first_node @first_node = first_node.next_node return deleted_node end current_node = first_node current_index = 0 #  #  current_node while current_index &lt; index - 1 do current_node = current_node.next_node current_index += 1 end #  deleted_node = current_node.next_node node_after_deleted_node = deleted_node.next_node #  current_node  node_after_deleted_node #  current_node.next_node = node_after_deleted_node deleted_node endend         O(1) O(N)  O(N) O(N)  O(N)O(1) O(N)O(1)  O(N) O(1) O(N)O(1)    N O(N) NN 10110001001000100000100  N 1100011001000100 8 O(1)O(N) O(1)O(N) O(1)O(N)O(1)O(N)O(N)O(1) O(1) --   123456789101112131415161718class Node attr_accessor :data, :next_node, :previous_node def initialize(data) @data = data endendclass DoublyLinkedList attr_accessor :first_node, :last_node def initialize(first_node=nil, last_node=nil) @first_node = first_node @last_node = last_node endend O(1)  Sueprevious_nodelast_node(Greg)last_node(Greg)next_nodeSuelast_nodeSue insert_at_end  1234567891011121314151617181920212223class DoublyLinkedList attr_accessor :first_node, :last_node def initialize(first_node=nil, last_node=nil) @first_node = first_node @last_node = last_node end def insert_at_end(value) new_node = Node.new(value) #  if !first_node @first_node = new_node @last_node = new_node else new_node.previous_node = @last_node @last_node.next_node = new_node @last_node = new_node end endend O(1)O(1)O(1)  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758class Node attr_accessor :data, :next_node, :previous_node def initialize(data) @data = data endendclass DoublyLinkedList attr_accessor :first_node, :last_node def initialize(first_node=nil, last_node=nil) @first_node = first_node @last_node = last_node end def insert_at_end(value) new_node = Node.new(value) #  if !first_node @first_node = new_node @last_node = new_node else new_node.previous_node = @last_node @last_node.next_node = new_node @last_node = new_node end end def remove_from_front removed_node = @first_node @first_node = @first_node.next_node return removed_node endendclass Queue attr_accessor :queue def initialize @queue = DoublyLinkedList.new end def enque(value) @queue.insert_at_end(value) end def deque removed_node = @queue.remove_from_front return removed_node.data end def tail return @queue.last_node.data endend  ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[10-]]></title>
    <url>%2F2018%2F06%2F11%2F%E7%AC%AC10%E7%AB%A0-%E9%A3%9E%E5%BF%AB%E7%9A%84%E9%80%92%E5%BD%92%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[                3   (1) (2) (3) (4) (5)   103 0 2 5 36 4 1 5  6 2 7  8 33 RubySortableArraypartition! 12345678910111213141516171819202122232425262728293031323334353637383940414243class SortableArray attr_reader :array def initialize(array) @array = array end def partition!(left_pointer, right_pointer) #  pivot_position = right_pointer pivot = @array[pivot_position] #  right_pointer -= 1 while true do while @array[left_pointer] &lt; pivot do left_pointer += 1 end while @array[right_pointer] &gt; pivot do right_pointer -= 1 end if left_pointer &gt;= right_pointer break else swap(left_pointer, right_pointer) end end #  swap(left_pointer, pivot_position) #  #  return left_pointer end def swap(pointer_1, pointer_2) temp_value = @array[pointer_1] @array[pointer_1] = @array[pointer_2] @array[pointer_2] = temp_value endend partition!  (1) (2)12 (3)01 quicksort!SortableArray 12345678910111213def quicksort!(left_index, right_index) #  0  1 if right_index - left_index &lt;= 0 return end #  pivot_position = partition!(left_index, right_index) #  quicksort quicksort!(left_index, pivot_position - 1) #  quicksort quicksort!(pivot_position + 1, right_index)end  1234array = [0, 5, 2, 1, 6, 3]sortable_array = SortableArray.new(array)sortable_array.quicksort!(0, array.length - 1)p sortable_array.array [0, 5, 2, 1, 6, 3] 3     [0, 1, 2] 2   8 9020 10  1 11  12 1  13 2  2[0, 1][0, 1]  [0, 1]   100  14 0 1  15  16 17   [0] 01 3[0, 1, 2][6, 5]  [0, 1, 2, 3][6, 5]  5 6 18656 1966 20 5 [5, 6]1--6     N 1N/2 N/2N/4NN/41.25NOO(N)  8 812 1.25N 1234 8  * 1.25 = 10  3  * 1.25 = 3.75  4  * 1.25 = 5 + 2  * 1.25 = 2.5  21 NNlog NN log N N log N Nlog N 4 2 8 8 3 24 16 4 64 8218log8 24OO(N log N) Nlog N ----4 1Nlog N831  log NNNlog N   4545 8 + 7 + 6 + 5 + 4 + 3 + 235 NN + (N - 1) + (N - 2) + (N - 3) +  + 2N2/ 2 OO(N2)      O(N) O(N2) O(N2)  O(N log N) O(N log N) O(N2) O(N log N)O(N2)  -- 10525  O(N log N)  82   552  3 332  2 22 O(N log N) O(N) 838428 + 4 + 2 = 14814 6464 + 32 + 16 + 8 + 4 + 2 = 126128254256510 NN + (N / 2) + (N / 4) + (N / 8) +  + 22NOO(N) quickselect!SortableArrayquicksort! 1234567891011121314151617181920def quickselect!(kth_lowest_value, left_index, right_index) #  #  if right_index - left_index &lt;= 0 return @array[left_index] end #  pivot_position = partition!(left_index, right_index) if kth_lowest_value &lt; pivot_position quickselect!(kth_lowest_value, left_index, pivot_position - 1) elsif kth_lowest_value &gt; pivot_position quickselect!(kth_lowest_value, pivot_position + 1, right_index) else #  kth_lowest_value  pivot_position #  kth_lowest_value #  return @array[pivot_position] endend 2 123array = [0, 50, 20, 10, 60, 30]sortable_array = SortableArray.new(array)p sortable_array.quickselect!(1, 0, array.length - 1) 012  ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[9-]]></title>
    <url>%2F2018%2F06%2F10%2F%E7%AC%AC9%E7%AB%A0-%E9%80%92%E5%BD%92%2F</url>
    <content type="text"><![CDATA[      3           blah() 1234function blah() &#123; blah();&#125; blah()blah()blah()  NASA10100 JavaScript 12345678function countdown(number) &#123; for(var i = number; i &gt;= 0; i--) &#123; console.log(i); &#125;&#125;countdown(10);   countdown  123456function countdown(number) &#123; console.log(number); countdown(number - 1);&#125;countdown(10)  1countdown(10)number 10 2number10 3countdowncountdown(9)number - 1 9 4countdown(9)number9 5countdown(9)countdown(8)  6countdown(8)number8 countdown10  countdown 21countdown(0)  22number0 23countdown(-1)  24number1  0 number0countdown() 12345678910111213function countdown(number) &#123; console.log(number); if(number === 0) &#123; return; &#125; else &#123; countdown(number - 1); &#125;&#125;countdown(10); number0countdown() countdown()0   33 * 2 * 1 = 6 55 * 4 * 3 * 2 * 1 = 120 Ruby 1234567def factorial(number) if number == 1 return 1 else return number * factorial(number - 1) endend  (1)  (2)  (3)  (4)   12345if number == 1 return 1else return number * factorial(number - 1)end factorial 123else return number * factorial(number - 1)end  12if number == 1 return 1 number1 factorialfactorial(1)  12if number == 1 return 1 factorial(1)1 factorial(2) 123else return number * factorial(number - 1)end factorial(2)2 * factorial(1) 2 * factorial(1)factorial(1)12 * factorial(1)2 * 1 2  factorial(3) 123else return number * factorial(number - 1)end 3 * factorial(2) factorial(2)2factorial(3) 63 * 2 = 6 factorial(4)    factorialfactorial(3) factorial(3)factorial(2)factorial(2)factorial(1)factorial(1)factorial(2)factorial(2)factorial(3)  factorial factorial(3)factorial(2)factorial(3) factorial(2)factorial(2)factorial(1)factorial(1)factorial(2) factorial(1)1factorial factorial(1)factorial(2) factorial(2)factorial(2) factorial(2)   factorial(3)  3 (1)factorial(3) (2)factorial(2) (3)factorial(1) (4)factorial(1) (5)factorial(2)factorial(1) (6)factorial(3)factorial(2)  NASA   Ruby 123456789def find_directories(directory) Dir.foreach(directory) do |filename| if File.directory?("#&#123;directory&#125;/#&#123;filename&#125;") &amp;&amp; filename != "." &amp;&amp; filename != ".." puts "#&#123;directory&#125;/#&#123;filename&#125;" end endend#  find_directoriesfind_directories(".")    1234567891011121314151617def find_directories(directory) #  Dir.foreach(directory) do |filename| if File.directory?("#&#123;directory&#125;/#&#123;filename&#125;") &amp;&amp; filename != "." &amp;&amp; filename != ".." puts "#&#123;directory&#125;/#&#123;filename&#125;" #  Dir.foreach("#&#123;directory&#125;/#&#123;filename&#125;") do |inner_filename| if File.directory?("#&#123;directory&#125;/#&#123;filename&#125;/#&#123;inner_filename&#125;") &amp;&amp;inner_filename != "." &amp;&amp; inner_filename != ".." puts "#&#123;directory&#125;/#&#123;filename&#125;/#&#123;inner_filename&#125;" end end end endend#  find_directoriesfind_directories(".")   1234567891011def find_directories(directory) Dir.foreach(directory) do |filename| if File.directory?("#&#123;directory&#125;/#&#123;filename&#125;") &amp;&amp; filename != "." &amp;&amp; filename != ".." puts "#&#123;directory&#125;/#&#123;filename&#125;" find_directories("#&#123;directory&#125;/#&#123;filename&#125;") end endend#  find_directoriesfind_directories(".") find_directoriesfind_directories   O  ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[8-]]></title>
    <url>%2F2018%2F06%2F05%2F%E7%AC%AC8%E7%AB%A0-%E7%94%A8%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97%E6%9D%A5%E6%9E%84%E9%80%A0%E7%81%B5%E5%B7%A7%E7%9A%84%E4%BB%A3%E7%A0%81%2F</url>
    <content type="text"><![CDATA[              3        5  3 0 0   0 53 3 5 LIFOlast infirst out  JavaScript--JavaScriptJavaScript 3  1(var x = 2; 1  1var x = 2;) 2 3 1(var x = [1, 2, 3)];    (1)  (2)  (3)  2 3 (4) 1   1 2 var x =  3 4 y: 5 6 1, 2, 3  7 8 9 10 11 12  RubyRubypushpop 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354class Linter attr_reader :error def initialize #  @stack = [] end def lint(text) #  text.each_char.with_index do |char, index| if opening_brace?(char) #  @stack.push(char) elsif closing_brace?(char) if closes_most_recent_opening_brace?(char) #  #  @stack.pop else #  @error = "Incorrect closing brace: #&#123;char&#125; at index #&#123;index&#125;" return end end end if @stack.any? #  @error = "#&#123;@stack.last&#125; does not have a closing brace" end end private def opening_brace?(char) ["(", "[", "&#123;"].include?(char) end def closing_brace?(char) [")", "]", "&#125;"].include?(char) end def opening_brace_of(char) &#123;")" =&gt; "(", "]" =&gt; "[", "&#125;" =&gt; "&#123;"&#125;[char] end def most_recent_opening_brace @stack.last end def closes_most_recent_opening_brace?(char) opening_brace_of(char) == most_recent_opening_brace endend  123linter = Linter.newlinter.lint("( var x = &#123; y: [1, 2, 3] &#125; )")puts linter.error  123linter = Linter.newlinter.lint("( var x = &#123; y: [1, 2, 3] ) &#125;")puts linter.error  1Incorrect closing brace: ) at index 25  123linter = Linter.newlinter.lint("( var x = &#123; y: [1, 2, 3] &#125;")puts linter.error  1( does not have a closing brace  LIFO  FIFOfirst in, first out 3     5 9 100  5 9 100  RubyRubypush  shift  123456789101112131415161718192021class PrintManager def initialize @queue = [] end def queue_print_job(document) @queue.push(document) end def run while @queue.any? # Ruby  shift  print(@queue.shift) end end private def print(document) #  puts document endend  12345print_manager = PrintManager.newprint_manager.queue_print_job("First Document")print_manager.queue_print_job("Second Document")print_manager.queue_print_job("Third Document")print_manager.run 3 123First DocumentSecond DocumentThird Document  --    PHPphp 1 phparray_push()array_pop() 12--&gt;array_push():--&gt;array_pop(): 2 phparray_push()array_shift() 12--&gt;array_shift():--&gt;array_shift():]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[7-]]></title>
    <url>%2F2018%2F06%2F02%2F%E7%AC%AC7%E7%AB%A0-%E6%9F%A5%E6%89%BE%E8%BF%85%E9%80%9F%E7%9A%84%E6%95%A3%E5%88%97%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[                  1menu = [ ["french fries", 0.75], ["hamburger", 2.5], ["hot dog", 1.5], ["soda", 0.6] ]  2O(N) O(log N) O(log N)O(1) hash Ruby 1menu = &#123; "french fries" =&gt; 0.75, "hamburger" =&gt; 2.5, "hot dog" =&gt; 1.5, "soda" =&gt; 0.6 &#125; french fries0.7575 Ruby 1menu["french fries"] 0.75 O(1)   12345A = 1B = 2C = 3D = 4E = 5  ACE135CAB312DAB412BAD214   BAD7 1BAD214 22 + 1 + 4 = 7 BAD8 1BAD214 22  1  4 = 8   BAD12106 BAD8B2A1D42  1  48 DAB8BAD  Quickasaurus   1thesaurus = &#123;&#125;   1thesaurus["bad"] = "evil"  1&#123;"bad" =&gt; "evil"&#125;   1BAD = 2 * 1 * 4 = 8 bad8evil8  1thesaurus["cab"] = "taxi"  1CAB = 3 * 1 * 2 = 6 6taxi6  1thesaurus["ace"] = "star" ACE15ACE = 1  3  5 = 15star15  1&#123;"bad" =&gt; "evil", "cab" =&gt; "taxi", "ace" =&gt; "star"&#125; bad 1thesaurus["bad"]  (1)BAD = 2  1  4 = 8 (2) 88 evil  O(1) O(N)O(log N)O(1)   1thesaurus["dab"] = "pat"  1DAB = 4 * 1 * 2 = 8 pat8 8evilevil    pat8evil8  dab 1thesaurus["dab"] (1)DAB = 4  1  2 = 8(2)8(3)0dab1  DAB88 810 dab 0dab1pat 1O(N) O(1)       19 PUT = 16 + 21 + 20 = 5757575 + 75 + 7 = 12121 + 21 + 2 = 3PUT319 101619  5 51 555 10011005100 1005  710 1420 0.77/10 710 O(1)  1-- O(N)  1true Javascript 1var set = &#123;&#125;;  123set["apple"] = 1;set["banana"] = 1;set["cucumber"] = 1; O(1)O(N) 1set["banana"] = 1; banana1 4Javascript  1234567891011121314function hasDuplicateValue(array) &#123; for(var i = 0; i &lt; array.length; i++) &#123; for(var j = 0; j &lt; array.length; j++) &#123; if(i !== j &amp;&amp; array[i] == array[j]) &#123; return true; &#125; &#125; &#125; return false;&#125; O(N2) O(N) Javascript 12345678910111213141516function hasDuplicateValue(array) &#123; var existingValues = &#123;&#125;; for(var i = 0; i &lt; array.length; i++) &#123; if(existingValues[array[i]] === undefined) &#123; existingValues[array[i]] = 1; &#125; else &#123; return true; &#125; &#125; return false;&#125; O(N)existingValues  12345var votes = [];function addVote(candidate) &#123; votes.push(candidate);&#125;  1["Thomas Jefferson", "John Adams", "John Adams", "Thomas Jefferson", "John Adams", ...] O(1)  12345678910111213141516function countVotes(votes) &#123; var tally = &#123;&#125;; for(var i = 0; i &lt; votes.length; i++) &#123; if(tally[votes[i]]) &#123; tally[votes[i]]++; &#125; else &#123; tally[votes[i]] = 1; &#125; &#125; return tally;&#125; O(N)  123456789101112131415161718var votes = &#123;&#125;;function addVote(candidate) &#123; if(votes[candidate]) &#123; votes[candidate]++; &#125; else &#123; votes[candidate] = 1; &#125;&#125;function countVotes() &#123; return votes;&#125; O(1) O(1) ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[6-]]></title>
    <url>%2F2018%2F05%2F31%2F%E7%AC%AC6%E7%AB%A0-%E4%B9%90%E8%A7%82%E5%9C%B0%E8%B0%83%E4%BC%98%2F</url>
    <content type="text"><![CDATA[ while 4 PythonC#          O(N2)--  (1)12  (2)   (3) (4)(1)(3) [4, 2, 7, 1, 3] 112 2temp_valuetemp_value 14temp_value2 2424  3temp_value 2 2temp_valuetemp_value7 44temp_value  47temp_value 5temp_value2 3 1temp_value 67temp_value 7717 84temp_value 9414 102temp_value 1122 12temp_value 4 43temp_value 137temp_value 1477 154temp_value  16434 172temp_value23 18temp_value  Python 12345678910def insertion_sort(array): for index in range(1, len(array)): position = index temp_value = array[index] while position &gt; 0 and array[position - 1] &gt; temp_value: array[position] = array[position - 1] position = position - 1 array[position] = temp_value  1for index in range(1, len(array)): 1 index 12position = indextemp_value = array[index] positionindextemp_valueindex 123while position &gt; 0 and array[position - 1] &gt; temp_value: array[position] = array[position - 1] position = position - 1 whilepositiontemp_valuearray[position] = array[position - 1]position1positiontemp_valuetemp_value 1array[position] = temp_value temp_value 4 temp_value temp_valuetemp_valuetemp_value temp_value1temp_valuetemp_valueNN - 1 1 + 2 + 3 +  + N - 1  51 + 2 + 3 + 4 = 10  101 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 = 45 20190 NN2/2102/250202/2200   N2/2 + N2/2 = N2 temp_valueN - 1N - 1N - 1  N2 + N - 1 + N - 1 = N2 + 2N - 2 O--O(N2 + N) O ON N4 + N3 + N2 + NN4O(N4)  N N2 N3 N4 2 4 8 16 5 25 125 625 10 100 1000 10000 100 10000 1000000 1000000000 1000 1000000 1000000000 1000000000000 NN4N1000N4N31000N O(N2 + N)O(N2) O(N2) O(N2)N2/2N2O(N2)N2 + 2N - 2         N2   1342  N2N2/2OO(N2)  [1 ,2, 3, 4][4, 3, 2, 1]  [1, 3, 4, 2]  661242630 N2N2/2N temp_valuetemp_value 3 N2/2   Javascript[3, 1, 4, 2][4, 5, 3, 6][3, 4]34 Javascript 1234567891011121314151617function intersection(first_array, second_array)&#123; var result = []; for (var i = 0; i &lt; first_array.length; i++) &#123; for (var j = 0; j &lt; second_array.length; j++) &#123; if (first_array[i] == second_array[j]) &#123; result.push(first_array[i]); &#125; &#125; &#125; return result;&#125;  result N2525O(N 2) NMO(N  M)  intersectionO(N2)   8  123456789101112131415161718function intersection(first_array, second_array)&#123; var result = []; for (var i = 0; i &lt; first_array.length; i++) &#123; for (var j = 0; j &lt; second_array.length; j++) &#123; if (first_array[i] == second_array[j]) &#123; result.push(first_array[i]); break; &#125; &#125; &#125; return result;&#125; break N2NNN2 N2  ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[5-O]]></title>
    <url>%2F2018%2F05%2F29%2F%E7%AC%AC5%E7%AB%A0-%E7%94%A8%E6%88%96%E4%B8%8D%E7%94%A8%E5%A4%A7O%E6%9D%A5%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81%2F</url>
    <content type="text"><![CDATA[ js    O O       O OO  O(N2)  (1) (2)1021 (3)(1)(2) [4,2,7,1,3] 1 0 1124 242 2722 31 121 4311 501 1 2 012 672272 742242 832232 22 3 277 947 4 1034 3 1137 3 4 34 1247 4  Javascript 123456789101112131415161718192021222324function selectionSort(array) &#123; for(var i = 0; i &lt; array.length; i++) &#123; var lowestNumberIndex = i; for(var j = i + 1; j &lt; array.length; j++) &#123; if(array[j] &lt; array[lowestNumberIndex]) &#123; lowestNumberIndex = j; &#125; &#125; if(lowestNumberIndex != i) &#123; var temp = array[i]; array[i] = array[lowestNumberIndex]; array[lowestNumberIndex] = temp; &#125; &#125; return array;&#125;  1for(var i = 0; i &lt; array.length; i++) &#123;&#125;  1var lowestNumberIndex = i; lowestNumberIndexi1021 1for(var j = i + 1; j &lt; array.length; j++) &#123;&#125; i + 1 1234if(array[j] &lt; array[lowestNumberIndex]) &#123; lowestNumberIndex = j;&#125; lowestNumberIndex  123456if(lowestNumberIndex != i) &#123; var temp = array[i]; array[i] = array[lowestNumberIndex]; array[lowestNumberIndex] = temp;&#125; ii  510 # # 1 4 2 3 3 2 4 1 4 + 3 + 2 + 1 = 10 N(N - 1) + (N - 2) + (N - 3) +  + 1 111  N # # 5 20 14(10 + 4) 10 90 54(45 + 9) 20 380 199(180 + 19) 40 1560 819(780 + 39) 80 6320 3239(3160 + 79)  O ON2OO(N2/2)NN2/2 N N2/2 # 5 52 / 2 = 12.5 14 10 102 / 2 = 50 54 20 202 / 2 = 200 199 40 402 / 2 = 800 819 80 802 / 2 = 3200 3239 OO(N2)O O O O(N2/2)O(N2)O(2N)O(N)O(N/2)O(N)O(N)100O(100N)O(N) 100OOO(N)1 O OOO(N)O(N2)O(N)O(2N)O(100N)O(100N)3100O(N) O(N)O(N2) O(N)O(N2) O(N2)O(100N)O(100N)O(N2) OOO O(100N)O(N) O(log N)O(N)O(log N)O(2log N) OO O1OO(N2)OOO Rubyeach_with_index 123456789def every_other(array) new_array = [] array.each_with_index do |element, index| new_array &lt;&lt; element if index.even? end return new_arrayend   NN/2NN/2O(N+(N/2))O(1.5N)OO(N)   123456789def every_other(array) new_array = [] index = 0 while index &lt; array.length new_array &lt;&lt; array[index] index += 2 end return new_arrayend whileNN/2N/2O(N) 1.5NNRuby OO ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[4-O]]></title>
    <url>%2F2018%2F05%2F28%2F%E7%AC%AC4%E7%AB%A0-%E8%BF%90%E7%94%A8%E5%A4%A7O%E6%9D%A5%E7%BB%99%E4%BB%A3%E7%A0%81%E6%8F%90%E9%80%9F%2F</url>
    <content type="text"><![CDATA[ O           OO(log N)O(N) O OO O      (1) (2)  (3) (1)(2) (4)(1)(3) (1)(3) [4, 2, 7, 1, 3] 1  142 2 347  471 5 673 7 7   2 7 824  941 10 1143 12 7474 3 1321 14 1523  3 4  1612   Python 1234567891011121314def bubble_sort(list): unsorted_until_index = len(list) - 1 sorted = False while not sorted: sorted = True for i in range(unsorted_until_index): if list[i] &gt; list[i+1]: sorted = False list[i], list[i+1] = list[i+1], list[i] unsorted_until_index = unsorted_until_index - 1list = [65, 55, 45, 35, 25, 15, 10]bubble_sort(list)print list  1unsorted_until_index = len(list) - 1 unsorted_until_index 1sorted = False sortedFalse  12while not sorted: sorted = True whilesortedTrueFalsesortedTrue 1234for i in range(unsorted_until_index): if list[i] &gt; list[i+1]: sorted = False list[i], list[i+1] = list[i+1], list[i] whileforsortedFalse  1unsorted_until_index = unsorted_until_index - 1 unsorted_until_index1 while sortedTrue      5144 231 3241  4 + 3 + 2 + 1 = 10  N (N - 1) + (N - 2) + (N - 3) +  + 1  101020 10 9 + 8 + 7 + 6 + 5 + 4 + 3 + 2 + 1 = 454590 20 19 + 18 + 17 + 16 + 15 + 14 + 13 + 12 + 11 + 10 + 9 + 8 + 7 + 6 + 5 + 4 + 3 + 2 + 1 = 190190380  N  5 20 10 90 20 380 40 1560 80 6320 NN2  N  N2 5 20 25 10 90 100 20 380 400 40 1560 1600 80 6320 6400 OO(N2) O(N2)NN2 O(N2) O(N2)O(N) O(N2) JavaScript for 123456789101112131415function hasDuplicateValue(array) &#123; for(var i = 0; i &lt; array.length; i++) &#123; for(var j = 0; j &lt; array.length; j++) &#123; if(i !== j &amp;&amp; array[i] == array[j]) &#123; return true; &#125; &#125; &#125; return false;&#125; var iiforvar jijfalse OO OhasDuplicateValueN  ijijfalse  NN2N1NNNN2O(N2)  12345678910111213141516171819function hasDuplicateValue(array) &#123; var steps = 0; for(var i = 0; i &lt; array.length; i++) &#123; for(var j = 0; j &lt; array.length; j++) &#123; steps++; if(i !== j &amp;&amp; array[i] == array[j]) &#123; return true; &#125; &#125; &#125; console.log(steps); return false;&#125; hasDuplicateValue([1,2,3])Javascript console9939O(N2) O(N2)O(N2) hasDuplicateValueO(N2)  hasDuplicateValue 1234567891011121314151617function hasDuplicateValue(array) &#123; var existingNumbers = []; for(var i = 0; i &lt; array.length; i++) &#123; if(existingNumbers[array[i]] === undefined) &#123; existingNumbers[array[i]] = 1; &#125; else &#123; return true; &#125; &#125; return false;&#125; existingNumbersexistingNumbers1 array[3,5,8]existingNumbers 1[undefined, undefined, undefined, 1, undefined, 1, undefined, undefined, 1] // 3,5,8undefined10,1,2,4undefined 1358array 11 OexistingNumbersundefined 1if(existingNumbers[array[i]] === undefined) existingNumbers  NNJavaScript console 12345678910111213141516171819202122function hasDuplicateValue(array) &#123; var steps = 0; var existingNumbers = []; for(var i = 0; i &lt; array.length; i++) &#123; steps++; if(existingNumbers[array[i]] === undefined) &#123; existingNumbers[array[i]] = 1; &#125; else &#123; return true; &#125; &#125; console.log(steps); return false;&#125; hasDuplicateValue([1,2,3])3 OO(N) O(N)O(N2)hasDuplicateValue OOO]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[3-O]]></title>
    <url>%2F2018%2F05%2F27%2F%E7%AC%AC3%E7%AB%A0-%E5%A4%A7O%E8%AE%B0%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ O O(1)O(1) O(N)O(N) O(1)O(N) O(1)O(N)O O  O(log N) O(1)O(log N)O(N)  O     O(log N)  224002222400400 NN O O OO OO 11O O(1) O11O1O O(1)112011 O(1)1O(1) ONN O O(N) O N ONNO(N) OOOOg(x)f(x)gO(f)O O(N)O22440O O(N)O(N)1O(1)  O(N)O(N) O(1)O(1) O1O(1)133 O(1)31OO(1) 3O(1)100O(1)1001O(N)  100O(N)100O(1)100100100O(N)O(1) O(N)O(1)O(N)O(1) 1000000O(1)O(N)O(1) O(N)O(N)1O(1)O(1) O(N) OOO(1)O(N)  O O(1)O(N)1007 O(1)O(N) O O(log N) O log N O(log N)1 3 O(1) O(log N) O(N)  O(log N)O(1)O(N) O(log N) O(log N)log loglogarithmalgorithm  23 12  2  2 8 log28 283log28 = 3  26 12  2  2  2  2  2 = 64 2664log264 = 6  log2 88212 18 / 2 / 2 / 2 = 1 8213log28 = 3 log2646421 164 / 2 / 2 / 2 / 2 / 2 / 2 = 1 62log264 = 6 O(log N) O(log N)OO(log N)O(log2N)2 O(N)NN88 O(log N)Nlog2N83log28 = 3 831  O(log N)1 O(N)O(log N) N O(N) O(log N) 8 8 3 16 16 4 32 32 5 64 64 6 128 128 7 256 256 8 512 512 9 1024 1024 10 O(N)O(log N) 1 3 Python 123things = ['apples', 'baboons', 'cribs', 'dulcimers']for thing in things: print "Here's a thing: %s" % thing O --forprint  O--for44 10for10forO(N)  1print('Hello world!') 1O(1)  12345def is_prime(number): for i in range(2, number): if number % i == 0: return Falsereturn True number for number2numbernumberFalsenumbernumberTrue O(N)is_prime7for752101101O(N) O O]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2-]]></title>
    <url>%2F2018%2F05%2F26%2F%E7%AC%AC2%E7%AB%A0-%E7%AE%97%E6%B3%95%E4%B8%BA%E4%BD%95%E9%87%8D%E8%A6%81%2F</url>
    <content type="text"><![CDATA[    PythonRuby        44 (1) (2) (3) (4)  4   [3, 17, 80, 202] 75 1 75 75  1075 75375 2 7517 3 807575758075 4 5 675     [17,3,75,202,80]2222 [3,17,75,80,202]22752275 Ruby 1234567891011121314def linear_search(array, value) #  array.each do |element| #  if element == value return value #  elsif element &gt; value break end end #  return nilend      1100 501  5075756263 110   9 7 12 9799 29 474 37 47 744 Ruby 1234567891011121314151617181920212223242526272829def binary_search(array, value) #  #  lower_bound = 0 upper_bound = array.length - 1 #  while lower_bound &lt;= upper_bound do #  # Ruby  midpoint = (upper_bound + lower_bound) / 2 #  value_at_midpoint = array[midpoint] #  #  if value &lt; value_at_midpoint upper_bound = midpoint - 1 elsif value &gt; value_at_midpoint lower_bound = midpoint + 1 elsif value == value_at_midpoint return midpoint end end #  return nilend  100 100 7 100100 10050  32 73 1154 21  33771001001  1000010000141000000100000020     ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[1-]]></title>
    <url>%2F2018%2F05%2F25%2F%E7%AC%AC1%E7%AB%A0-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%BA%E4%BD%95%E9%87%8D%E8%A6%81%2F</url>
    <content type="text"><![CDATA[    N N N            Hello World!Hello World!  12345x = "Hello!"y = "How are you"z = "today?"print(x + y + z) 333      1array = ["apples", "bananas", "cucumbers", "dates", "elderberries"] 5  0apples0elderberries4  4 2 dates figs bananas    555 A5B500AB  4   [apples, bananas, cucumbers, dates, elderberries]22cucumbers   55 1231   (1)123 (2) (3)0 3 (1)01010 (2)303 (3)310131010 + 3 = 1013 1013dates  3dates dates dates3 0 dates 0 0applesdates 1dates2 2 dates3 44 --2  elderberries 55500500 NNN    figs  2figs cucumbersdateselderberries2elderberriesdatesdatescucumbers 1elderberries 2date 3cucembers 42figs 431  NN + 1N   2cucumbers 1cucumbers cucumbersdateselderberries 2dates 3elderberries 312 1 0 5145001499NN     [a, b, c]bb   41   NN 1 -- --[apples, bananas, cucumbers, dates, elderberries]figs 10figs  21 32 43 54 figs 6figs 565 NN+1--N1 NN12N+1   ]]></content>
      <categories>
        <category></category>
      </categories>
      <tags>
        <tag></tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx]]></title>
    <url>%2F2018%2F04%2F07%2FNginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ Nginx InternetInternet IP   CPU   nginx.conf  eventsnginx Nginxworker processPID  1worker_processes 1; Nginxworker_processes events 123events&#123; worker_connections 1024;&#125; eventsNginxwork processword process work process1024 Nginx http 123456789101112131415161718192021222324http &#123; include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server &#123; listen 80; server_name localhost; location / &#123; root html; index index.html index.htm; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;&#125; Nginx httphttpserver http httpMIME-TYPE server  httpserverserver serverserverlocaton 1server IP 2location serverlocation Nginxserver_name/uri-stringIP  /uri-string - nginxwww.123.com127.0.0.1:8080 123456789server&#123; listen 80; server_name www.123.com; location / &#123; proxy_pass http://127.0.0.1:8080; index index.html index.htm index.jsp; &#125;&#125;  nginx nginx9001http://127.0.0.1:9001/edu/  127.0.0.1:8001http://127.0.0.1:9001/vod/  127.0.0.1:8002 123456789101112server&#123; listen 9001; server_name localhost; location ~ /edu/ &#123; proxy_pass http://localhost:8001; &#125; location ~ /vod/ &#123; proxy_pass http://localhost:8002; &#125;&#125; location URL 123location [ = | ~ | ~* | ^~ ] uri&#123;&#125; 1=uriuri2~uri3~*uri4^~uriNginxurilocationlocationlocationuri uri~~* - 123456789101112131415161718http&#123; ... upstream myserver&#123; ip_hash; server 115.28.52.63:8080 weight=1; server 115.28.52.63:8180 weight=1; &#125; ... server&#123; location / &#123; ... proxy_pass http://myserver; proxy_connect_timeout 10; &#125; ... &#125;&#125; load balancenginxlinuxNginxLVSHaproxyNginx 1 down 2weight weight1weight  1234upstream server_pool&#123; server 192.168.5.21 weight=10; server 192.168.5.22 weight=10;&#125; 3ip_hash iphashsession  12345upstream server_pool &#123; ip_hash ; server 192.168.5.21:80; server 192.168.5.22:80;&#125; 4fair  12345upstream server_pool &#123; server 192.168.5.21:80; server 192.168.5.22:80; fair ;&#125; -NginxNginxTomcat  nginx  locationexpires ExpiresExpires3d3URL304200 1234567891011121314server&#123; listen 9001; server_name 192.168.17.129; location /www/ &#123; root /data/; index index.html index.htm; &#125; location /image/ &#123; root /data/; autoindex on; &#125;&#125; location Nginxtomcatnginxtomcat Nginx master-workers workermasterworkerworker  bug worker worker Nginx  redis io worker worker cpuworkercpucpucpu 123456#  worker worker_processes 4#work  cpu(4 work  4cpu)worker_cpu_affinity 0001 0010 0100 1000#work  cpu (4 work  8cpu  4 ) worker_cpu_affinity 0000001 00000010 00000100 00001000 worker_connection worker nginx  worker_connections * worker_processesHTTP        worker_connections * worker_processeshttp1.1 worker_connections * worker_processes/2HTTP worker_connections * worker_processes/4 NginxKeepalived+Nginx Keepalived+Nginx]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
</search>
